<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>常青的小屋</title>
  
  <subtitle>劫回落山的太阳</subtitle>
  <link href="https://changqingaas.github.io/atom.xml" rel="self"/>
  
  <link href="https://changqingaas.github.io/"/>
  <updated>2022-12-03T13:22:03.000Z</updated>
  <id>https://changqingaas.github.io/</id>
  
  <author>
    <name>常青</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一件小事</title>
    <link href="https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E4%B8%80%E4%BB%B6%E5%B0%8F%E4%BA%8B/"/>
    <id>https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E4%B8%80%E4%BB%B6%E5%B0%8F%E4%BA%8B/</id>
    <published>2022-12-03T13:00:00.000Z</published>
    <updated>2022-12-03T13:22:03.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/For_Picgo@main/img/image-20221203211545712.png![image-20221203211545712](/Users/changqingaas/Library/Application Support/typora-user-images/image-20221203211545712.png" alt="image-20221203211545712"></p><p><a href="https://github.com/antlr/grammars-v4/blob/master/golang/examples/unicodeIdentifier.go">https://github.com/antlr/grammars-v4/blob/master/golang/examples/unicodeIdentifier.go</a></p><p>当我准备删掉测试未通过样例时的忽然发现。</p><p>或许，这就是技术传播的魅力吧！</p>]]></content>
    
    
    <summary type="html">关于。</summary>
    
    
    
    <category term="记录" scheme="https://changqingaas.github.io/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>网站收藏（自用）</title>
    <link href="https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E7%BD%91%E7%AB%99%E6%94%B6%E8%97%8F/"/>
    <id>https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E7%BD%91%E7%AB%99%E6%94%B6%E8%97%8F/</id>
    <published>2022-11-20T07:00:00.000Z</published>
    <updated>2022-12-09T03:28:09.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码看着不太对，请再试试。" data-whm="抱歉，这个文章不能被纠正，不过您还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="5b03bb7a2c46dd2e19eeeb35d3048fc51bdf3b32265006af127c42adbe06fa7a">655ff9f578eae0bdc5954cf0fe9f55cb6a8773c12ee4aba8b440e62bdd9dbd20b90c5d612b55fa332fd5c9ee9562d7d3d4e89ddf50bda47b57bd88ab1bbf4a15141c7fca122da3d5e895242c39d062d734d61d0b3a8d5c630522dd415d1c24e774abaf897dc9850896db293bc4bd483fac9b04d07771c310ea6be512372075bc9d9a1d16d9351c4a8de1e05a98c414dd3a11200dffb1f8255deed03b2cbf0361c0320d7171f75aa1f2a210efda122bbbb6b8a0d2ed734f4ac86a8540e41d0de2822470699ac6b2211911f89ca4e2619e8e2e46d0e502c2e8ebc71c2ee1e5e536fe650e60920834ed6d24f38780f7b96f9a070d483c94c3465d7034e6472d438d10c51fdcd2bed6c56f54d18df5c6e81d86caaeccb4d833a05c73a1c3cf3f6c6c539ede983fed701b0e5a310f177d6fb74fd61e330dcaa3d67bd8f6f7d3ac0a3b451eb9cf30a8c2d9268aa59c31b6ff4fa7608e25999b68a9b3df21059dd514e2f781f1b671a5789c47ea51d9261fb983e8c9f70732eb90e9b675cbfcc519b0ee26a11091c45a7b9c70b578aceb29a1ada8416e0cca0fe6a07234b8b4635cea20ffb6dca0c73be53ae7829dc94cf37a0c0f2c62d22093fdf0b5fb41726a747ea5e6414a47e4a7f80180fcf5d14337223033e698777f5bc79fa89932229cf3e10e95e784d7f7ab3a896737201620bc40dbc3a421908dbae047c36953f8f456568f2d353c78edef5e941776449f32a7418cd06fbf2ce1a3d400838d9fe7e69a8c29841dab16edb0af95553e85b0831b5e3b68c6deda97347b9215367a194a016a270f060bd13dc198bb939d3987d8299cf60370ae8596fce4e25300e0a5f2bbf78fc14768c0ce394babd5a67e8bf2425fe4dfd7c260aeef6bca154212effcc2c0333a8b0738c716030c08a0b5b098043e669607bd6e46a817ad70f9c57382bac412edbc998636008f4caf8a7a10c7fa0dbe31403831ab8c4c2529a7609eac3a608ed626816d970912ba36db94f6fe5490e9e055f9dc5a2afbb9d9d3f2316f49dd5f5ff29aafb4977580b452d90b43cac91fb29c99525d7f426178fe7cdea6c246ce7864f11757ecf3f73432fdf7f0dcf183375676676a32aa3b4a80c5cbd9561027fea4959e1951ccae5a39459dad182ba62ea397afe511f1961ddcb6fca050e36064923f3ad06816bc42a6fd2c6c335d31adfb6afe37289291fa16db6e2f6f0bb62072d11ace5ced5c402c1c92a9e1b938a7525f6a2211c6cf7ee0c9829dafd5e3a9ba2ff57ca4649888d70da4ee57ab645228e088dd71d4422ea4e7957082ddd59483364de3e5f896e09ec22c2da155a99e12dd6f9000796b52b805d1601f9f7bb40486b4332cfa954dc631a72b12d3f83c695b34a08d9ceb19adababeecaad703bea4dc408b60b6e2a0ae63af158134fb88c37b16504c529fec39146a73ee47fea1da5126fe9668467147081aeccbed04787eaae3fe20a7cbff398aa32e00e4277a1f54fc4d42938f7126e8c175e5e8c73ba5f3ec237b1f2162a103d33191b92e0cda351a8a99bb1abbbaf3ac9316702585aa30077510e1250b9579c8a09e62360c405440f642ff59db4c7be4775d68d8c2f59b12866ab0aaa7f66613d683920c63c67158777df5634c847121811aed98c108a44846a550e260fbf84af8f1a9b355b1fdff0608d3e4500d44525624c7a6a0433533cefde982eab94fe9d72ebdec1477cda176dcea32cf51e1466e9cdc814a3196dda37c7847997edbe14e6458948ca71b29114973c63474ceabf1f676087d688ffadec9d250b0ca4fbc3b796e562e09930a200570867622c60eaa39a74c12147c870dfbb173452c178c95979139575ff5d5ef834c936abca4dcebace83cfb29f1f3b9d5eecb941ad4c050b1ae6ee4fa99985f34d6c5fbf668e5791c02cdf8031a32932938e05d89130e96fcbd97eccc57015e684956d220d1f6e65989afc818a2f470b92972f1482dd4e9c9c81eccff58f004d02c2b08417a9db572dfd974bce61260398cfb9be8653d70468a9adc0b69cfe2fc24bc2a9ffe0b29048ec45d2cfcf06a9e9b9659d01d550584e8a1b427a055335833eec4b104e522f77a1b3d13566d12ba1b9a316b467fb41f5719b96119986dcd1aefe556bebf43645dbdacef5026d208be0821966ee31647a34e037461d96d82cfc3623cb3e3e58e90747894809de2eb941b5dc9915e274d72e70541a4c9fbe14285a96e4568a3a57425e04af3585c3ac5a8aecbfb51022179b3d34655f7bd8edaeaf038d314770f6f70c0bb00a54b1e8f83545f768ba2d462d20da0bb9fdf9a46a87e2fc44d8f7f58fc792962d51386b3143f90fb2e52374cf5ecd7a5efa928f5909707e1642b3edd0a0e6d702a44ba1406df724e2def330cc0ad28cb35e99922db04f46e7fcb1cac3c8a208fc1f6414027bed106f4a29879a1519106c8c925f4d923a419fe513b78e495e0c8890b506be7777c68461a5ecd4db68c3e7a22a2aed29188763706c964fe3aac9dd6e0d990d76e47662652d8f6b674ba7bcddae39f908d3f2de6d82ac8d6654d5c5d77b6453c72fc06ecb2f27a0936f42354ba7022c900ab1a6f959f3013a932f51f5a0f019322cc83ad49adee4d70577c81442ecfc7126f94eb70c4ced6ec00a9fb529cd316e8e9f3c1afc84d21465f93015a720866f240912934e12f220fd6e810f742e228db224f4880b502c80f183371c51b1feeae3513853c3e0d037ca27d7d2f9c179baada9bd5af24e54a138039c8c94062251737a8e4e90d3e5540a69c457062e9a5c6ec3f71929b849bf5a574415514bd0c53541c62fdc9cf51309c19dc8553f676673d26d30acb52a5a332e319afdd902611e3af34451a381efd8473153c0bde1408f11b2727b84e121a395f627897c29e418c40119fd4273199a1f2a8f68817f06843a6a05c8dad74aa0ada91de86cfa48ba78b4ab84fcdcb3abf83197f8f3004520e99a7587f4fa716bc2e118f2ff67f73081b5bb7e9b66fd395e122d705773584d20912c9962cbff23f58a1eac0d9e7464a5863fb2e6056f8e41886c2ccc262a103e15379edc3e7639ca6d8917a24be79a0ac84ce5591100c011dfedff87291b5b2da72972d1ce497df3a28c8f1cb81781d860f5e7d0e41e8959a169027bb2ff0c9e188a3c61e24ea5b9a69a962a79f4b99e39e797b559c1fd5ebed9353c9fb3582b9d621fdfdf924e12cde68b090b2e5692f68f6cefdfd7037f65794858d41f124dfe47594447bf0ac1b6ae808aa81d8d5fb0529a42e956320ddbfaf6706666d692a83489ed7ed11725f2a53accae70acefca234e641a68febbccf62d682e6dce726127e2e475246b9f8ef3ce53aa6136875bb472fedba95f3086ebaf9bb0fc1b7bfb844177cc11a4d423758fb465fc9c9330b8f198bcc20a8976838f9fb226c0c08861a5a20073ccb44411e236eac19ea1f7e77ddbbf3c3c58b3af48bf92a9d02af22fca49a686921ef776a3224ba45e1301b85d0e6516ae0f3b0c6c191796d41c809303e3dc34a0f5a92df5c92154ceb99d8521cda3743022ff929a258331c73cdda5d5fcb8eb786954b66b478e8eaf4300803703427f84c39fcfc68ca72708a0ac85b27a27fd26c0a1aafa6fcec93a220b8f9aa1bf54d6e9fddacad72697f07a580f40547e58cd7d795fadcb5b50cbdedb4ccbabde7fd3ead68208b36e869a1d1fe705ae9c6b1dc80ec0e491c711a05e281b412751b1d1cbcc4ecb8f2223131f040cd17c59bc68805b72383f86ea166eed68973e473e9e73193825c03d7b8d1dd45c0f68fa0b538cf28fcac9b8594be8c3efbedb326691740fc9892181790fb1b77a52322c0e59ffc34c7023f8fde59216e3eec4628adbf4971b62db388364b8fe9cc1ea7b5e29ae36b74f132e110b072b6ba1043cb0f532864d0ce2f630a4b189a2df43600bc97583313a3704a694c3b0530d2dbc31f942212f494189b2011c5508c5ab4ef5891fab4d9cbb35d81b08b559df9c83b6c182cafddccfba0cea958b32a3804d38197fcc19b4dc4b8b26c49983da4cff3c993d60999c0ff2f03b40c1bc0d13f6a009b89333267e3957bc3d4f0b2e7bd11c86516a30c1b4d951c49bb623b5b6869bba3bff2ddb063ab65d9f5231f306d0cc84c2119a5d3e35762a472f8dcfb38c234e636d203d781fe72655cc8c9eb46ad3ed970166ba09b6c46a2d73ea99f2d9c9de3c6f02af0e00907fb456b3c79ad9e8088a1043ab5e909b98dee4b025aaaced03c9a9e319fc44274b0d4991d79530c3143f6be294794dd469b9219f6dbc1e638013821a1ce930622ab7d39da1db7ae2f08c0c7d7e69b7e01f6c4f80a0d32f3f8388ca60edde4dbddb74169a4f65745f548b0cd7adc416c3186ba915125192a286572ab7fc84578f7fd5bfb5848d871fa41bba9122be85637d88eb3daeb1f13189c4b70102be587c07c87a41369005b802161a37ad9c048086c49c5b94b01d96a80c94e3ca0dd0a8a9f32c9d239615a62ccb70e458dce2edf968b21fb80b9894c00b6b9f200f4ef335c48a577f4f6cd48753700686d7c59a85d7040bd8e6f9d64061732d416907f2ed2827cf12b85952589fec581aa8bdaf99d4c90a8ecba90bb9614282cef7d9d95d995185400f5df8bf8f0320b5f0a6948326b4cf29bb138aab0c0d984b5c6fc05b8249235eeddb3b2c40cb27a1b29f0a32a0bbd7672674330a84954f0ca91d98ac82f93cfdeac2568e86daf290cfa5f554a034d443037cc77e1d330eb63068f13c9a323bc3a7b0cf47a15d20f6311dc30ee5236b52fc47f8be0b3aeceb7c6c91bac4c86f600bf29be30cda125f21eeab7aa195a03613550e9ead45af97c39924a94262d2872cd4a073708e56bce27e8573af41b50c1fac7eba357b540c79e422a5ecf3f83b138bf507f751b00950618c2acd4b1fb22f195934ea76e368feb54b1da996b05f6a4e5ca76ae1c984796ffec82b0329c83d0cf9c9c9ea28ee3b4bba2fc0b39674c887afc3ffcb00e446167a92b63396cd1beb02358d7fa022bc0355f04f02c9429d52bedb5a433688ae5cae3c8a04e93d22c05fd9ec03371fc1f7bc76d8980a739c1526c9b226496ad8d0a0e0eee84c8ae70e5b10fd9f2e186ec3ebecf220bb1be2957c04fcf8e95f9d2e1dd221dadc75335cf04da17df5a0c9d8718a9058b39ecde1c5f2d26d90be9f72f4c06167a48a8522a8b4dba145105b8ed4546b74ae620bf9a2f5b41e00dab6d64bb321404dcdd1cdc56797a5bff95c2f3c865ae285b40f2d4d809e4be1995ea5953028652cd5dda2413569af1e926fe34afb0c6619d366aecaeb8f1c92f3a5465877d28a845409c8e87cf25f02c11d9b58a16b7195b9f6153792b69bda71f3d1402e3baf7d2111b343ee0808c65709e205ddde5953365c184da059045a220d666d51a8d884f6a6f50d5d018d3a520e2ac1b5eb5e60609dc86082c16221eb4a6267100c6c307f8acbcec8a59c87ff01c0f6677afce57b72dd2416823cf00f3b316e3ba4675762b4ad3bd1bfda5a46ebf2773bb42134da4b0ae449cf722ebcf1d3bad0a3c57999a7007cc5644123d022b027a550d683bc2c40e8f75d423704db2095f9e2e9d9d4c3b33bf5233e20431d8aeddeef839110ef13187246817bf6a8170571199ae0ecd277924d46129feb566a2227395c25b92d6e51b4c0a6d7d8f2032a6e36d7a587c903bda4d8decbfac5d5e5d5ed8a9d9429835367b54b0a292c07366f84043d436dc6d7d765d197f5c37eaa697757a7ea1ed2aff21d9769a6752c66abc5b6d821e61248178eb1060c64875bbbb78634912a5d0d66c86e2a83f42883e71dc2d8dd729d93ad7808381ffad9c01517b8b5b2b80023f00457e61e2a8b69bbe6eeacc6cba62a665120221b06e729b11a5d721e7524f5850a343b1a5921cc6d2e927a0f0ec2d77399ef4bd83c6be2b2916a584d9e09ec2439f9eeb151998772512342c11ab8720b09f958d3f0539e94bf16e9a621fcbd49697e3a0e48d58e8e0277580f427131451114d091d9af67c5a8cdc2abbe5a9ed46e2c1661ee45201876f93a7d8abcedd88c48003020bc09b21abd6f1b71b4a667b6f3ab6ceeb46b4f91bc801ac25153e6574d921398f0c07ab122a8b7381e512d4000a36256ecb35d1d4959c73682c974e8e23553d0319e5711cbed3b30d8aa9c0b28ae35a772e72a9af3a70b46d002f6ed41ccb942cb53eed709096b91ef2e4c6b665c272d90dccd7df5a168e62d97f1e832653b059a68d5adfd1812a560c025d8ed32078d8378ebbe0fd259b7a8b57812b1286a4365189fe3c105203c5f9e7b32b71d5c3fef3c6948f76c6cfbcec5ce2a342e75828781eb728461db1a450c171623ea4d5916acb44e2033a2cb8ee24b15af08d3b25b38a8ca948198a1e7f742d7b7bce9e249c2de5f9efcafb02ab4f5dc7f68290e480e4f4d6aa8b89b4a4d09b3ca4a6840c2ac1eb9a5f23e9d3b65a703efd4011b302f3751c51a5435c7188659f85e12dab183b12ace628b72d7c1639ef087e6db0fd028dc4224000d99952dba18beaf29a23fa45df8a97d70d83cb8365c9461904a77fa7d2b79efa9beb377c34b7b91103ab7ef075eeb199456df99cd8fe5130c5c497108fe77793137bb78c420e96a5c273f377626febc3eb0fedd2fe32ad476134eee44e4834072790a71bfd7f2a9857e18d922868e91c128d0864798950c2bfee09015969335dc5e2dd38e767740bfef05cef2ac6c79a9cad8e2730d59496c1d07699362ed7deee84ba66afb320fa5b03f957ade44f0113c41e0c6af91db0d2f8247e3db6a6d44f8d7706bb78e491de21abe1a5a37d9fc66825df16e47c53e328b08def69e0be17ab3d135a47478dfd691ad0d528b32b9fce467801bca5ba8dac25e933d69ac44b2b15b27e6594729fa1dc2d1298f83e1f76f7c7899c44238d1f34de743562da3b560ecfdbba2a664d41491007f575a2b2a9b143dc1998a8f1eb10bfd1f913f9d50b2d14dd507af0bec6e4970d490d281ac5cfc079e67ec6ed57559edf0e113f94814fb2138438a619f0302d7034edf4c052e38250dfaf78b86f5ea2eff6b5a576693e748f047eb3f4c9391108b23f807427358ba293032b64d0bd7e32282ae87a088a4a1e6f0d961e33c3a790f188bc3267a245ac3119f45267329c7fda5d8329e1e9f1e013ea3c4e813b59284b36bfebc715f3e7af1263931855e69cc94ae4071e2c1e870321869cec096bf81eb554d6bbf5ddbd08782e66ba78134532fb2e2e7b8cf27e9190820677095f2a622f9a6e9a0ad3a5a895c58861d4dc216674f59102725ef50aaa193d9bc8ff7ea68de0c655c3e81d43310711d47948ee30d629005250a0a55217393e6ef804e4884d39e5b691e7a7e8704262e90b6316cb525517394658d31e7acd999fa33e68f6f45f24b77c94139501eed4d7b7c26c130f527987999c8059ab91317b8c5cd0512ed97465faeb2a54e39afb17e5408a58bf067d3ceb757799024e633888fbb770d37c9db360b82684adb3b4b5addf3c21cb0f7814430103fc6e5a30bb787903f5c9407b947d76649b2655c673300dfbfddb7a3129c8c8678986875d64d0f2f25499611f8bbac0c97b5d84b0c6b20a943da7278dcc6cb03d2337cf3a881e23c0e6de4fbdbf979cbdfe1026fa455cc9d7846e1c1b7298436c6667396d6966ce8b7a8fc4132d14702f02953182f50883a9d1a3f011481312d20e08cab791a71b08e33d903e9ec4bf4766a834c6cfbd9f0c1f421016c4a217937b7e915b29cbe5dc9d5e984be42b2010a531f0f42d0d01ed4316a24fe30f0b5fb4e9f42ba40969522813777967d1263c4097a24b2037f07d5c87b2dcbb01660c676616a64d704c97e71a76ad011fde76e9577b0ae09792bb000d1fc784ee359e1583f78e9381436b85176c26f5c955bad317aceda1e8414e3dd1de645ee0972ef44bdd147b86cf89daade8d8b9c955a4d68678884e11ce052062b9099558fe20447b909480f3b07008e655a066ba5a46a0c701c43d085cbacbc7fabd0a24e344e4f1d919dc201aee7cef775edb8ec93f16abcdc0cc2501222adccd924e3abdf45f85cf5fe419cf147c910aa2f951903ec15d7008a2e90d2b947ef1f27a0126f98b9c834531c00d068b109a7a75ed026c65d16dee02e1ab92da9736a4211e521ba31afc44ee8794480ad60de537adbe4f37d53f8588b1d31ab544a3cba135d6328bf90d026931500504ef525cb42b64c2f066d50801942c212a032ee73e6732d840bc256bb8bb1ca99fb15a9bf0906f1dda9e4a8737408e15bd4603013c387530cf945ccc6f8bd65fd1e6bc309c2c080726fd439fc2c37f735982c5aab4f295e8674bc3b8ebf83ea209d47d9f43e4a4df82e95d9480e384ce9a17bd26c51acccdf4865d171b71a85d5037d06cffa55c232391b6601dc71a4c13d7a99792ba7379d53d3eda191d92af4950bd1bfa644c04fdb9b642078c0581397fc272d1188fb6638b59b18117cda1822808c59b90867bbea40379e5880a551b052ec3e7cea67507d075176455372bef5e285b75ac81e285c53adf9d4c8666ce85ddb0dc7c0f65394cebe4e9dcb91ee216467f6379519b8fcc7929497a0a38420cc6a6ad6aeb3882fff8eef4aa9aec5a32d4a3f057f6c2207f2ed2ffa469cae993c2e26519b2aed6ecce67d9566bcb7b927adc1f4d502260f6b1dc90bcde431fb489ad6602067d1757ac75b4c1907e4b0fe4a5b0902cfb8893ddfeccc7fad9d455b2428e2fcc70da119251084a0f2a16a13a166fb023e123c981a68343dd27db45fdd1a8fe8eac60593c76e29189b276e742fd6de5e52343b2ab7782cf91f37ff2524fddfb531f9b90286d151a42bac59992f5460e4ec36a891fda5ac09bc4f861f18b4063d3d220d6d6b6d4cf9ed78874ee7f74a4876a904ac14e520eb4b07b2267006ddacd48d718ef30459bee26e97006fe100dafb3ca53ef4fd1c8e7837cb39d14f7e8d9dd43b01262c03d29d74abb033c4e54d1e329b02d27b599cb6f626feb314e88ea2e8923c09ebeca169ea1ec916388597b711e7d8b1bf3de22e3e3a8a3f2ea5fb3c7be6a3e7117e42e03e19220ec55e24d3820cbc9c1a7e69122456613dd2f45ada57e0fa028312ffba8c624db477f15dea23186d6a2c89ba5911ff080b23c7ec612ac9c40dfcdd8153b628df1346fe30a0fd7cc6c48a780de45177acf18d16f77e303cfb667b04b7fe380a2aa7e1ca1599c40d23e0b8a49481353dd386211bcfb41b9aeb317336e8b06cb3dc269325a757df6fed34cae1e533fd5cd2a98cd3cacbf264d3491b6d634aedbb10b85bb624d214c5e1b797648966ea359c01787456e280ed916e56c660a42c3e7ad161637769fe8115bace0d7daefa9e1016bf45cc99bd2a8e8ba62d884c23e7f5137cd3fe67365bf4e02a06d748c3b6c74c9057a1d05ea45d429b52991fc0fd9dbc2fc2279fbcacbb42b9163bcb1f3fbb3c6eb8f443abecbf72ef1fc8f5dd163624bba3f6a57869ac91902c1e4be706a3747dbf15d67097ca290c4ad4919c9dc4a08949bb5fe9a8d4206f93fa9ca6ce676797dc0b2ce21ca3ada0359c03bb1d2b6428276de20eacb9b08b7bf97b318aadb7f5c654c0a2faf740e823a669560b4e6e2a212791b6013a753f2575fff9da91d2abc5c232689d67e9ed4e82445db580f5f54f5701a1bc9ba5effbdf18d8c872d6f9c0c51b2462de6428b4ef5f50335b71ea3d4d690ba997df9e18f28c76730986843a75bb737411cc75d944e05e6a6053ee1f2dd42f182be64e86e570aceb14213ecdd2e1059f3bc37dfe8fb31cba0e8bb671fa32d06c7a796a1ad34f4874416a3e22ba26eee1db5afe37512635a84d8febccb5d863ca95e43d625fa2382b3c3f77d534be189076ae4b6217a251149355e25659a4182538e01dee610a5b49bfae4106090f1c0172b8fe8019d65434ce2dfa2b9c0322c0e9c9484e5efcbf1d0423c1a27f7ef53a49149d6da909cddd38e8f1199fc4bf5f4a7d53e11f9d026212e014d42b06f5b1d9080f5b037aef02bacc25553f537227df65c24f6c16b1fd3fad00a7d94e57354ccff6ebbdeed0ea9490d00e1cb0e2e0ee9cf9b13093602d5b59b6056846312bc30527f6e389ab713a3e9f3c8cda3220858ff760e8e14a115917ea05a651c3153208a8c778bff6cd7ba98ef0cf23b97f11fa7448d8adba399ef1f6ca8338235acbce12d29d7f74fc576e139131a80189cd0fc10ab03735770155617102ef2204a45e2184955f3f06c684c78c96d8b7a4d5503f993f3b6966e4d9ae2162c04c333b690bb823dbb6cd44b1cc6dc3aed9732881de9805a6e5f05621ab519972e3551d3894de64c5faaaa04bcab052b2cd7d4d18c5eea1e317d483d524a6913daab407d2cc5711b5142c1d71a8ee0dfe76702f961cd5812e316d9b931891756696f6ced65290c4eff00deb55e9cc67e6310d3e1a18dec2550db6e0784a7b86a67be38749c422e529eaab15079181203abdd5108a3d3537ab811b0f55b88dc5c7e36bd505615f8b2c2b0ae8199d38867e3f47911825ea61bede30ceefd94721ea0a4ac2ca531d6f41f2ae9bae95f1f436ecf8097202c229d2e2fbc8bfff95eb735beb2a78a3aaf6b0d5893c9fce4c87a5683445651f0790a2b1d10948209f447985e3ac64ad732c59f59686979d0a910df14a475e2afb512bbeffb0b4a79c2da9ddee059b763b60ac879de1aa354a5b8dfa74bf23294bcc5c0a33342edf07379b6d47377d4b5434a452d7d1d7988e986ae0843db0fba16a6291578f28f93a2401dbc5520920038d2013ac93ba5c1a9190ee576e9eb68cb575645400db1dcd0aef1b5955d07bc0bdc1fd7af7b039bac94db0996db53b3a5cad121cd31becbea319722ca6bab94e6a279e805a10f2916963b78d80c8ad3042b6d604a191e001c202cda2defd8747e4425b68a8717f18b16f0b6cb3d67551145922c0855dd6770a6a3697d749c84b538ee21e6359c634ad165d7671e52e5452dc0f41588491d035acc5684f0eccfc8f51a12242c4ed022cac8e937472ef47e91d6c9d65b45a460c1afd34130d8e20eff9192f026c3d8bb161599c5b7b7f6f041a7a8c79b66a5f515a3789d5606d0d6013ad6d64be0b027adce692578c6ed665fce1e66bccd46c6554c4f4e22b6bbf56758c2d6f1259e88ddc3c33b37e6b1cc1721bb3319778f8c55fdcf497748c7811eb8962e8f602e9636f01ad2a600cafc47695ffceba2a400d715884cce985e467f3bcbde102f9e6cc708b6bc778e03bbd722de5f0030cf11e4feef836614f34b1c7f3b7875bebbfda185bd87ceac685618f9e5f171bcef0cf127d00e2167568d8ca92f66508be63a762831741ebf6553737b9d59845e8f9acb796736f32476082e0170b912663c08c4439eca99964745819585383181dfd8f94dfe4c1457a2d2d4699f60d7c6d7941e98321a300614c1536241e29098a8c3fb3651d2134a4c05e1c20b8143be1f770970f6e6a7da900056224bb9baa06b37d7e6eb54c01e574b8eac20b1a2fa8a985666ff55e7322da63c5950eb6609ba233df7fb4131da6e5057040d22b287dadbf783fd3f4df8927ddaaf05f6ed72e78109ea60f347c1a9f077fcd833a2c837f7bd173acc14f28253201f0c25c6f9f64cf673e1ea8b983275401d7d4a352d6b7ccb57ffaf120d09df26b55eeee58f395bb0d2284a97c837ebca1123799d6d0e877e5eeaae56d15b0234f5e4b15297766b8210ea572a94345c342ee98ba056a114dfc0977af766e873813ca1c4f11ae73f26a0d357feeb7cae30be754f3f2d19cf8aea85b9a53a8ba9c959b131cd4a7800eccf92772730ad2d374a5150a0cd060cca9ddbd19018733c7c5d6473dcf9e8c3b471c3b57b6ae40fb70d1a360f833d4df065134a8c5324714e5273d56fe4fcdc341e40ef4c2dd390b6c585d1571071f7e8a0b10a2b9455603689dbf77984c08deafda4398e700f4ebb67e211ae0f201bba60ed5e44a9b1d1c19c0d5cb3899f0b4d9bdcb50527184930b18596ea3adabadf1cf3f47f9f27daa2620a47328e436182c031a251242431069590d724c9c51b7fbf71ddb7724dc8a77bf65392528d9cd4ccd0b3cc59f13c9cc09148ef39e22a8ee73755d1f9857517ac7c8ba74a9e2c82886c8e6175aa2f40431c4fba9cb844b77705de8afcec50917b014cd4e574d66150b442ab3d882b89109eb18fb44459cb59eabe76b231768c4fed53f16396a836a369260a9defe74193dfa3cb29040c94ebff17a2a88c1e9208c5e724e79d7634b6b95952b94466940252efffdcdee3ad38f3d150935c922464164a5fb6dced23c6767b89fe7fbde279bba4488fd8e25e4d95ba048ed8c3cb92536d58ecdaee4f4a3cd245a9e555b3fcce20bca0285edfee14b46bba5fab93f75d0a61e355d44a26850790be54d0d13eef457180424dacac035fb7b07efce1f3148f4d7cc0479258e11e1e1161dbd3596561e7b56bc2ffc9c2adc202445cf96662c377c7de2fe723d1fc34f8ec9e87dc85cd291cd588ee8b5fb3cbe3d85bccbd212ef43e99a75f45a9f1dd9ae0d1d9fc78ec820719ad31cd1758942065c2a00d3eafba4e5d992bbc6b142f4e8a58315b44685dd0c494c8899a8a3678fc37b78e315b4d171659569bc97b5e74460d304e061e85b6fc2df5aef74218fb8ff47e29af405b7d7af77f1ded3ca0ae728a298d22bb6a8fe2a7f3d0c975a148a7a9796b5747912df8cb24f4640b90c665963b3eca76c2062d6bc79d1bedf98d680960c5941db412743adc6a922b20f744b0be0f244970b735de012f7284dd78753a159ed0c269e7b2059706d3c2611cd1777fbd642b6ac81500a793c8d56f8755353feda9689cd5dc6054fbf4550db9db1b12331fad080a18806bbf1a07f4fc8d8ac35e67dfb2c2d2539cfd9aef96710ba02b97047904cf683844558618980dd2602696f6626b7d0e56abf582ca0fd3476565d87e0dbe8451fc28c0ff4da846a95841e18bd656497887c532fe40d85935212631c63f667d4904aecbd60df739e9e6f55408d0e172813faf4a56eb3a1c84cca52c365c8b6c01f26b9f8ce13f54222cec0618841d4919b66859abba6ad9e423ff8e5780d34ccee778530eda273b5e9e44afd67fac4d7ee20eaf201be50bad27be35a32b05b02c769d7fc34b7c60a6622b83fa413b274657d61dd5ae286120deea3ed68452f7bac4e5dc0e64fd87c37219ced2277ae371623911e2d17fb17955417803e43ba18dd755f37a507e1489149d792eba2a62de514d14843a98ad7311a701b6c100237b2fa94cc2c94481ebfcc96d198144f02cbbfeb1f66be58d6115b872f0ae53bb1305b3dd15e9d23a203fae87a24ff7ca46fa913bdf443cc8a3466ef0fcf052a2fef3dccbeb8365644327d5340846df42cfda9b818ef0b7372e12892f4ffe408f2b0696bc2055ffc1f0dc7e9f1a16534fddaafdb55e8c7e18ee26e19b15016809494ed30e7d449282aa8f1df353709d4ade2fb465f2f18e70110289156d0bda92753c0e5da7c17c92e758d8a2e9b062dc6d238715cf1f3ddcee0c51f3bab438ed005886f20934989853b22026783990b4524308f64d56aa955a9998d495c0ab77b5455405f67fc45743965d76542fb40707d4a320068fec058e00cb5165c615295d321f3cb20dc42d5bd24e9133d66a84120659868c0f7dcff71a27b02fdf0126da9d7c60e4b1b727c65bdd78c5dcaaf872ee084f2dbda1f5a2fea321a7c321a86547ec323a97b1270d44caffc4f9d634cf6d0174f03381ed2bae6c5f9afee2950b7087cdf63e8ad90d82a2573edabc0e5a45d97019b4c6ddbcf0b2cc5e62d2ddca83649e9b6121e2cf256b085468cf6222e0f8a0c971fc466021befd6d72f75363bb327353927f0b262c1294eef9e9df1167137127b0aa6cac1c8af911aff4495dda3fbf967344b3d78ea1d8b148d088612c01f721506dc638945b224de577221d96b38c28b1c680a282679609f63e070145aba0d4d10c45b6585fd66bb30ed6b1653c0b4fd84105bead10c16e24a5ef8948ce6658d557bdb65ec192dfdd4b77cda61da751f78e4c38c0352279b96d4cb6e3acd4acba40f7388a8abd1ceb5f2ed26b30526bd79a1fdb6d31a72aa11af244af90f47bd732bb821cdeba930f70b03bac2182b6b599ebbdaf0282ce110b4c3e39a99d3ad1fd53ad388ff3fa278afbc4b947a057e0973b441784346136cbc1158180c9653d4ae561675e722b6a49b97817d89ab304b92dd6aa60baa67948c5cf74d4b0cdc0d648dd1fa43482abd878bf04e130d185ccf406acd00191260d25ad5abc512e764e8b0b929b35752d619b5a6ac2d4e01933b7f7d7cbef771d2b108525b0ad30941cea626d15fb92b797d157aac3957e3fcceec4395b9417783d7e6ee09545f4beaaab546f5df2eb0a16d919b8353aec809988655a2d3c762cba8afdc19f38feabf762220640b1025a64236d2ecc6674948508c356d21eab0d119273356126d6acbe05d58e7540743d1fafed8406a1b322754657213aa3a67c97dfa5932dc3445015b9394e7695a505d0504ac97e637d1d71eb210d2a9686a849bb5a0ff3ec7a0c16f27e3246801b774199c5505d92e437e0ae6af3e493f33981836f82d185ce379a657e6212b2f72ca5c5df20d168d08a76bc4dc53dc79d5a25ff5b84d1490e49887a382bca46f02e7a3ecd715ee62ab4fbc7a7d91171906e12e987dc001b35b046e8b50d6573f3b9f9d83002078081116eecaa427833585b62eba4d57fa2f6f6772b19140de515c93f52b11c64e8d9acf93acdeb56c0784cb45745181dcb796eb07396e855053187ae8e3d3a7b55481db8f7f946b28b84b78b075b36cadb9035b8a620aacb147d6af25f48ee4268dc884ec9555eed0effaae70d7e27ec2cae66b35e7a8f5034d4b943e17773f95254f2a8f2b9e37cffa945819a6e49c6aec9b7e66bd5ca90aea281bb9d8893474652b41dc4598af27a376150efcbc0bc022964f258690c503c18152d65ffcbae1ab97443dd1bb355ded54e78a5ce0b9652a32e62f4c9819ae4e362ea58cce8edabd68ea0d1ba3450f81d3410cf257c62bd8e2772c135faeeb1be62ab5fb12f9a25c4504ed80165b3150e8dbe53383e819ba65bbf19eb3a38284cacaf6a6659705ee745cdf8605b340a439c77db5fa75fb922e3c11baebdc521a7f1f1730aa179ecc9da02a4991fcd8e9f2f0533187eb80a5a14cf5d24e8c9649e1d0c5619e2f427a5a09d4a9c44ce96d29ec34adf6580cf03f8bab7b828fbb3f0acbbe06a87b692ea2ad37762934672b7881faabf16b6681e969ed232021b2d4b8156f975ee2ded7f1c5653937c820f4196541a73a098a0a33a540aa722c8f04e81b0556216f0ae353de75b135e4bd70478c72416b9b7258f7ef9935c50f9ca7ca41f15a37624e68855c5fa51116e7c252a586f33e532cc968f7600ba8fe590c8201ea5c55fe101a9a159c04e519740feaa202022e39d7ea48dbc7bc8665fb16d950df18045e73dbb801a569c0e555db827effbeabab2a48f43b5ad9692957a2230a5e82a9bc7c27acf0806ba2f05abb69a4acfba239c575fabd9073591bb289c261fd7c07c3c85b81bbea565ce30fb205667e8157296b314060bde789b530237cdb1beeda8388f1221fbe165bf45b2d5ba8a345f81ebca7f1b954c167d02196bc81ce831a078c65dd3051f0bbc5f526463b0b53153681072f2cf68ab62c3896e3cbd02254490eca38494ce47c07f030642be6688b9a780cbcd4c906a0e37ecb43684fcd54048b895ea8974f77c5bc96979bb0a5a5b2f49e74239c391029a7b5a2bc9066b808086d5ee8d35b4ec552ce0b0a82386739446c43c7ebaf3b86e2ae39c0278a78f0acf6e375c3e4d5c48352d43721f85f4b551ba891eeee05de3b6daaf8039d3c12d26d57dbe13fa28a61cd9c7bfd4f9ee69b4646f8599bb425dfeca6793c834fdc07d12a8b3f8420ab779f32f967a496dfdef1cd1b0423af0a66febecae5927fa3196b48bbaa5c35053f26f00c81eedd4c1c727bb5a9b6b5cb92ab6a810443371d76039f2326ea8c81a5f1f221ae47e25476c719a7423707d3eeb0648fa64bae8216e9ad974b36c8f7e68f3d62732ae2c657f88c41bc03f0e3e9ac20f0f49ba89ed1c10df52667a81e2eab93b181e9bc7e7a0c463ec8dc1676eabe0a25c1f68f9c9af1c8c817ccbef501f1ca795ba9688dc9fea0271b8d46db46f34bdf15dd25b519afb86252e0cc625b5f223eace6d8014ab2188eee7974c81c40cecbb65bd8b24dd62aa9661c1c8845ce98f736b16182a09eabc66ceb7e29318bd9f57881b88101c4f5ca7c425788282de45b9daa99699034356e046737eb8b69e98db19a5f0a528acad1c449b027e8ae81ca600ab73aad65037e0ccb18cf30729892e1f9e57f6a5e2856abfc7c935bb8dad164424afd5958e29ceb76999bd9c3ab754c09dcbc61265d995724ded5cbf7a6a142519a9d24aa912ca87bf11d3c6099545d063f2186a756ee1f07c24a39460b0b2d37ee27f7ed518e704836ac1ffe9d879e7bc17c7645fb355f08e3dd22ace705370539ca1c1d23e176a6305602f82ba19e988e7ccec4e92112dfa56f37de9b2291ae45167a19c218235a37a7e691f42a285a2d60c6f9cc0e57703a2120bc34d743d4effa2028a15ff4656d7d3156b18fa9ec9fba31960445342f85e7d6d5e8b03bdd8c21d15087fb92ea90281c795a8c346ca32bd10a5b671b74f85dde75d0c4f85a4965752c004d2a8158169c41b4aa395821f51f72a8c63157cbee90bcec5bf0f236ccba2bbab21d0f2665b6db9b4f70cdf6c7088a26e10038ccfca8bce7ac2d2d96e81827f584cfe35dcf83281465785229d7492737038b658fdeaba1cfff738adbf5aaadebcb254b1a33f6bb714e838ef2c3a890f28ecec48b71e5446569ab4650437226fa621a2f2c83099d38fd86c13980fc4a6e3b2da636013590f96d8656aaf454e57eab35b3d778118ac39fa947dcb171fb593e748747d99900dc80cffe445746c3205ce87c19e5ab7f67ea936ac128583b3254fb2c35fe88219befecbeb43d97d06a115deabf147c46b179ea04d427291b058366e16a72cc184530073173a0f8f1743aa34b8c3826a9dfb0b4ab595e27f4c27264b8e773993d9bbdcbef9a405f3885d6ea83e9e57875cf01ea4e7f44bfb1f530a9134745ffeb81642fc396de0ceeb051c691256b2eef7f3e48760d8073c488c9c64a6baa21d7f7a2736f05dad83649a911f915fc5019ccc3f3f25ad01b6b930b606e6a1da8fe2fadc5a65179ce794ebc8cbadf03834bf49f5bc66d60de153672c2dbb2bb0295b9e180510234919e536094aa1bdd680a0cb1d8406fd364923310fa77c0ba0cb206f7b7b8805dcd498ac9f8a2ef7c8382ef8929ca5017efe868c09aefa278ab37202566f01069939b51b3a0c18d6485abb8258c81f97098e18225288e9ca86d5c260bf88a312dfab4248e2ec9053155fc0d561e2058b34e84f4457395c0266eceed5c0ddb2cc130b6d908d4cf3596bfedd1e4800bc26ce88c17e1928e4f388f360770d2e71446dc96fdc7191bfba834d9d5f9985acc8e7f8b0732598158c3eb4be23d45d952bddf777d8b6f98b7411e22c46c9547196ddf23f8462cbc79f8ad222245fefb140a2142ec7c2c37cc217ba9570190db657f15907b8af5e03e052547f7f0ee503b546492042f68a7235e17c9528856862832eec507e568d67cb64f7404bb32f6d6b6d80a58f5fe4f6d9907c964e4f2b7605c4eef84b559fae75394e82309f322af0df409c3f23ed2e5397aa54ecf74ee15a4eb7d3fd4629b1f80a4093c19602d4e64372461798991ee1753984be2e3f536df34ea866a26b4f4aea731b1f04c10bff95b0ea4c992c91dc63bd58fcf4577df93a391f864ff07f92b4599c1083662ea2957cc9b0111e50bec888a0183d8de53434ac7071fc5faaa21dadfc335bad767c59c8d4fa91fe67d16d4af0e2d4fdb4f466c9753b1a41f7c2821e763c052e43f8240f0eb4a7f6e8864e8143b7e55bf1cf7f51bdb601cc79e6014b3d70e1bb6f51fabdba22d4a69ba18754cbc840d19f780ef9db310b8edbab62351793f93a07a3398d4607492149dbe145bbd41c84ae16242b25d20b3a5c54227e0cfa3b1919788ab18f613cabea87ada1af3ec10fb11a94f3be7c952ac4ed6681a79f07f2f4cc3f7b8225bb98bca0711fec87adce225c1e890d2cf1f7b4b2df146451baba31ee2d38bc594f676fe7f4b6154b2c24301f5ecc3e53f071909c8998f8920bc83534b9e57e91f5976590542dd51084def46c7f621f4a952b7f0ade7a85a79c11f7542cdfecfafb821e221955ac7a81bfe66dc5242d20fc2317cac732c1c91fdaa2f1f3b1560c4ff371cd01a8767ecedbffa4376f0b2b9553d7fa25496274f87eff20bd146accfdf25210188bad1bcdba35628ae66016de32ac1b2d0fe04c54b92f644ef29c32e9bffd9f5de3536f9291b639b6fb07622662a22ef9c9a60fb0682a736c01bdbb65f0fd5fdaa287a4763a695193a0e610c6c16ed26cb9092c43d26b268f6f8e64de80f1ea1ea5d1fc4e9f89f34e3e546be3eb958669e3168ce23f4aee1733b051a30b0a8b9aa8c876164776acc62ce032df35985652881633d383a44fbcdcc3fd69aa6defdc58408225dffbe11ac581b9adfdfd96c339829497e9d0ed4b7f30b1e99e68718234ca79b5e8558c6532d4e9b39f19c6b225d7975ef6b077070b38fcbfbea128283112e0c2d7a6c7b14be30823e5870ae6b5df87b958f0aca375ea3a3ac8abb5d691983a20bb8648fad3fd458873f190569f5b0f37a591405434da824d228eedd48379bf0242a56761e8ae904dd2d3be22c56c3a24bee4084f38abfd7855ee0bacb299b15eb6e29c8e05f4b7360e747f6ed355fa5b665653dbd9321374b0686d8f80a571eeb5c97ea81089cbb19b96cf12edeec8cb49b6186dcbc83f84dfcef5eefdcb6b0b0fac2249e7423152cb20e89968164389596d1da84d5b7bd302cbb8b3e48ba167ccdbcd0c0cc12b566712d29ef4dd9d7bafc46bc50f30f44f03927d95a2348a633445184fc0db4bc63544151baad5b7dbd1e9ab5fab580ccfc3235501d6a12ea621bdd30098ddf16dda60902ee2de70b240541a7ebd38e33102c44d275547c0b6b4729ced19f4637e3d06378133eba8f8d6cb1af34b7f3f4a3df4bc07721f2a69147b33231a17df13337a4071db7a029520dce3a573252f90db7d639d0c53b7960d10e07f21aca07d0945d614894916402a373746839b64cc576ec9584529a461b9b03a45cb322df6731e3a37c8455aab15556331b7d2696e15fb051e9ffc0e02cd0c0a766d79d758134873b93c71a3b28827fe52a1f3fa8e26c00a6118bae64703d3cec306a026c704e7989046cff2bfb29832cbaba204e7134041112d00639dc7304baf89715499b10bb284dfa2c55fe94184014d77d30d3b48de723e2264e013eb42da49113224482d8fa1ac3bda43b6cca6efceb0149e9044b652034aaac9380e183423311e141198a3a1741d90e6de81631bd0c321215f4b96de63b726296a7d3a335923ebb1b80428657a5f0dcb43ca9f8549dfd6bd0cc49ae09e789409e368d6166c73930205103b136e439e4b7e4f95021a0d146daf55fbaf860370e57507498800e1a0df3dbbbdc810dda8ada5f8b80e117038f512e6750b9c019fc88fd756bbd29d75d228684fa7a5e4156c7967d8c8f449206868061704b77530734a71c0eca9e133da5425b94a23d7804622149e47bd85e1c05b0d4cfb6e7e6b8d2a722c3c6ebc3e427b58d7c5929e11865bbededa72c9f028253bfc5d700b245986d81563086bdf8738c47005283a92263bd59d9097bc7df39857218f5d6cc7ac4e9472947de2feba40dd41332beb0f762ccab9d0e55bc09c5b46632523bdc81098af54b7914b828bc987668815b971cab1fbe93aab95b3ddf6e1a03368fb47a7e6d34860fba95872111a0ac8f749f67d830875c2811b82d9dcd52a27d8970fd9b1ef60ec40219395d0141b45f96643b8f50fb89e55518fafd595232454f3f6b5a2da1d81543d37d9fcb9cccba23c3f05f967e0c3364943f098bf9c91c943e292de7b50b0957e0259e8bfce5f59641ea4056a999ed3691870b23e5b68bd4a7f4170fc29d60a7afd7881c7774278e589baa3a842e45cf8533e746febcf7fb26f13b9da35c0b3f15e94c797e36bdce4ec50a2b7a9616fe17dc30266d1c5af2b0b982e7f3c390c26c601e7244205d588c71f613c8409da51eed272dc5a5523ce74b89147edf06475fcf85f5c12f9542e69867a01352ba0e60e46780f34d4b0fd768ac1fdf32f24bec65d067f98727e4cb72442b334707ce6dfd1c8c0d07a0b4cea02d4b2e615b277af733bcbc020b41f43577755bb7ef6c97e0e3a73dc0332b499d5fc517f0c9b92a1e8cea3407d2a9b46bab1628104e455fe7d896e55ebeb6bac664e87db72f90a331aba3bae4161893389ae5ac4e38e95345007c746a9519d65d1a04bf476d688bac4868ce7ad9bbfd208db07e8a007cc5addaaf660f8bba4cd8c6146e7f34256a62ce27f29aeca0356b42b0b7220b0625c69b1645c4d411504389d72592948068252e345eac813e45237aa3dc9bfdac5711c71fae6a2ab86983e9c4ba641bfcf87d2ed4964ce21108335b150fb33ca6fe7b03d06be953777587e3875675947817d87f98ca1feccd280561b9e596621e59378c57174a574da43c3fff4f280b360ebf484f9a6fb1f4f5189aaea1a859e98e9ec73e05195ea9147980b15472276679aaa648dd82872258854d476d9cfa3030e6fd9885eca6f01400396f56c6a91d48374cd01fbb3c7dfbea8a73384786f9b25e099991a82c04c0efc556810b4d4f5fa95efdc439ebfecf6bc2b69c9bd52a2f6fb9c953ef9ed94f4074ad503a7babdcf2568c56df840f4fab25b536f258d8d891ee034019fd5a4a05269b373a2d1059dbf562816c01f6e50a9c85209089f72041e29c6dd3df5b0d07e4f947b9456fc1321f9ebda33b07ff668a98089efdf59a1ac667fe6c29b277f095f808285708e6a9169dc2e6de87d6dfcc2a03f894500002b93362288094474b1b37a4b375cffec0c020ecd28b6fd7bf5e7cc861047f4d266b6a636caaa2e6d5e36a8d1d4ea12d9a92fc3131f11ce1a54253fa474d1d421e81206629ec51ec2bbbab0ae5857332b7862fdb76ebcfb5fb9a5b4042b72d471abc9a1968a63f37e18aa9e6fc25383a7a6140b88c3388184547713624b81bfd978d9908b1ec74c05ca9eef1199d5db0532344ed11c8e15c8a7769853b7a0f61b713a819f3bea9ade2b9748448e765348bbf9bd94a9b209387043b9435cea3496baec97184f96838ad56104aa9550bc34ac80860848bdcfea2294cfe60b331da440f0d73f566fd02a2de299011443c4afe4b18f26eeca76a81850fbec1b25bd3bc6978abbf8a88d69c37fbfbc718a5443907663b3981866e53ecac4ac4791eb9e18c25e681ee362be391dfbc29548fb0979bcabc60087895bb34ec571c07f85ecf8a21f1ffc794730fd4d5291801c9c653bbd72384016f2d17a5fe39fdbeec50942a9bec85314802a973809208505f5978dc66d7cad3e1af1662970a1469b98216d1cbd93121ec51b465a620862b751a16c8082d828bdbb6f5e2742b9490940b82bf012f2ce4f11f2b37943aced9f8771d78b88f9d716b6d2d4d5ee2c937e2e610170b6d646ab7202e33cf6cb8ed42dfef6382c021816e759119ac7d1b20bcbc5b5efc83d080f32d180902126833f09b4fe89a4d55772ab4568e9d678df9ba6649f08fed107afdf7eaa3a84d6f0b7738ac461b83c5ffed42856d0485cec6b14ffb108c98333f51f92d172b1cce80fbcad6d22cac74a78889f90ed87e4f7b4e8363936a392feeee6fd10d5e17ee0df77eed09a60b84d9f72e2c688cd8c36904a0ed1cac33c5ce120a20199abf9a05c400ffc795dc9ce1981bb96427ac4459cba7443f0943d429212328ed3c74b830857984daaf6d3f034f8a5446713cee1873c20379ae7d487387c253fa14113d7b3844bd1a616443fd03a2a0053969ef99bd315d848bf08ea58d359b4eb70327e4dc2b990f6b21430f3a6882402576c742a3f6a4d75fd48c7144e19577895bf57917e98e20618262d8c4e16601cb1d1f23c6e219fc6cc0d390c7796ed08a78dd744e2ded15e3720c767a053e20eac69bea55cf3c5161f465a2696f69710abc39c826628eb8fb14d7ee22dacf7cd837190603877a366ce5b66603796c76f5a519e2b5a89c9c43d5996c8c540dbd5c6660bbf50ce874d8638f284e566db99599c97e63e499d58962fc40e76cef2662a2827a2d15dae966c4299de4917528b7adb26bb5976059c30653ba8b554db277bcdb3885cd34e1e245ee9a3ca7d6282fa7618b4ca26ef7087a1093ba7a35d2a151d988a3013c7f386a6270101ac9dced38e2c0481464fd22a7b77d15ca220b6a77a29eb077dd0ab1b644721c9e2b01feb96ef072a5484448e12849abda1d19c0978c886d0905edd93c2fe3eb8439b1082a05664e3a9330300457283367b3f50163a3efc2bb4bd49635980a81caa795b8ea66fd673d845ca2126da0ee25318fb635ee4ddcd52c5cd0f0fa0b6b40e14993e789a44caec9ca95a1a3801f064c5f0dcc4726d89b03aa7a84cd752108816efc73563180d6b10357dd8b0d2d40701d396b86d4cb14c71704ca231cee9841a7a22114ee96797aaaaad3995606d1930429923b76ef20a85fa32220b2f723a229ace54bd6c429599d060221d99228dacf33f052cc485b18f64d3e3a7dcba96097f27e9c06826a4d743d73d7ad9d598f37a137b361aad832c8f4dafff738b66a984f91a13fb1422d55ed106eb6f3ab9ae6b2fb1573836218fd1ee616f03de905d4384bc495b057f0d00ecf9ace42d1700765bd297886e5ce180916c75fcee3ad6433c59344954afeaacdbed7b906bab750c4d7bf24c6b0d4c8ffc35c0aa9d51216c327b7c3cbfa5bff32681eda698cad7965d829e36558fe02cb85db2f01d124f6e2cb72fdc8510200cac5570fd0a744dac2dab2ccc0d93054a4836fe17719387cb1da464b6da6da0092e2ee6683295b4b7b8f6359d1943dcc602e95d24832dd8b42068ce1e9c86f93a72d2e13468eef4c2ff5881de34a02effdf126df7f3bfc6559e6c02a92414b7b0aadb42aa168da0532283859f6d9617e27559e13bc2bca2a1fb075e9cb22cad8a5e6732b3a4105247b1c457fb243ea8a47db9ac04de07d099871d19d84b2a7be00b18ce8ceb9d5207394aa6caa262beda953542b1bbafff54761ada7319535d08835c3e2053550fd4973ef7aa4b7dada293bcc95e5222e384f9760a717208452d0c0c43e8df92da27e12bf69a6b61a414e2b8ca8c985fcd46ddbf84f0a5df7d8ef5feda58c7082843abc2d52b60e0a5ec5ac8f60170c945a85c3762341ea69287297a35c8fbb6800b6d0bcf06df9c0eb6ed4e3903087ad11c4487bfd6be7605e2dafa280e9628cb8954306ad34e881bd7897b1af266c60fe8822cdfd52f8f9ec7ba5baab3da41db16c5dc91cd304fa2849e6bda522aa43fdfc0b9bf011e2753f8a5f55cf40e0773e14c310fb3da26dc0e27ebd37536d1a4f7597a83271a3586ba5634245027d6d2808fa42ace9f639782f96b0f26708c4709c086053689e5c61fd48d9b8ab38822085f44741f750557087cfc39bc04392f09cbcfb19f985189a31edd878cfe7fb23de2395d40dec3dc2388a8298774228c8585c63e6e7cd98433d37ee75221732ce56e5dc9d487c1c8f3746a5076f2cba36a2b9dcd961dd1939f0c434b7d4f7a704c94ccab0d637ca0e3eb6dfc2dceab4d75bbc9b5aae0616378b4dcc872d1c3ddc403edf10e5c787f81a7bfa7ec0c176a742f40e976e5a8d362bd89146aa7c09a977691606c98ddf17d99b84622fa837a79d39f9a35266a7229bb14f186aae981255653a198c20a1f0480bccd9aff7b6d14c6bd59cee9a44394f7abb1ca2bd9019fbba69a5cbe004f38e6d28c480e1718a5664d1326db498edd19749017dfd9af228db83d5e8c0349771a1488d77f62d912f384c72bb7f821e24b4224049e248426a8ce09785fbd7b16e41e8e774cb7bcb5c76840ed87b3a65dfd6b4f9f22b8449d5d1ac59308d83c32547f0045dc0bd1f24d5f1c4070fe44b66acd22c98dfe3502a1876ddd925b53fb1800447e9d2adde3e6183f32adc8189e79a3b5c60d26509c3092435be252ac14199dfcfbd4273d27cbd6e2c34cf2d39fd6efe5b3fe88f64d859d5f8cbabdc4e84c789235512a8e0b8dd39be86b0d7a091b4b06e5b75670f99c14150f869ddb62c0a77b6dd9123d998d77ab1bcf7ff72d28801dc1aebbbcb3600e52956f7fa0b55992df4748d21fe504ad08f29482e1be5866d2b4986659d25d65d68d7fb3f54e01c82c16b7fe3eb2fb070aa7c9a4a4eafe75e9622b0136de712ea243d9a600402f7c380dd527ea7ab44e46064be15a74a53616c9ad21c8a11a72a8c1825f11e1931ca94bf98204f9f729752d702778205afdf362bf798ab39c2244f5b305a80280f34208fb54605a324df29856f20334e12690bbf284a96d6dd1beea49257b381768f0c80029554bcc70405e8b7bce40286664a6edb67f61a17151211c8c09cc3cc5860ecd4a95ff887872e7802f318955009a1d0ad8e19a7757adb4afb7a1d33e3f905e95ac98158281a5c07c55fcb4f20a7e088df2818b35c9c94d82ae597793d38dd64121ad121424c6187abf33f35003bf17c9a98f99f71d7e50b63bc82388d7b86c8cf00c126ae2a376f9928b1bae9c041b5d6b2172ae66d473565f02b702b9832c32bf5f4ad8f784c657a7ddc8b6e8fa15f2036343387526b9a1d482aa0a879e32ae9e67e89de8c4d3fa9c143d2a1a25d43674d68fcd3e91ae96bf3200e67b64f5277beaf524c27e324624ba5b947055268ced26ea726fc167b127e379252fe2141bad6836afaacbea9f2b81fc0fec1a624a687c0a6c30b4bec6d739c9e181e56e8a3e9c8290d7260226bcc8aaa277c44390e72cbd24ae06d3454b65bc51d05eb1640a5d826bb29113fac64743fa9f3fd2db6f1aea3d9d5d96a540f1331ea78a544e6dd90a27d148008386e8ba5b5bc6ed4ffd0126fc6f9884b04a70704f319cb528dc207079e7d65280fe6d40ccc9ecf1a21e880a2aff2cafcb4e4c1fac975aee679ac2af17b365601adb015d1ccdf3d61afe33a5eda96ae019a25f3c271388498c2bf79732e04b02d3f556978542f8c6b5126eb62419274e509739014503f347484d6eae0b88ec638aa5f55a8fa083717388493c2d10ddc4e6b6ed36f2e607c2fe1e753ee3efaf2befac9c303ec9b8b3e8eb79ddb76e25ef1eeb3c56511df5776d661352d4634439fd8cf1427818d414bef5ec9164336c0e8ef5c68582b026a9475658b52d8b3966af1418bfeb0d3e996f2fb49a53c4d40ae35428837df901dc06d11cf1403b1314095d899f81527a5f49c7af5792dd65f86216c1deac3082c6e307aaf6eee3035873a6d945cdc9f7f8d3b4b95c468941c23fc7a92e0d90d831fd8584d2b05e8f3722b64cf9f826ae078be7a6faeb434f5e6dabd128cee5352b8b451749b57b7f120d9bb9259e740c8afd72bc0ef198947f8300bed91ed3abb7113894b4c07d1bcfded8775be01e1372315fa932be2260a4c0d926a224110679769d653f54c1a1dfe93940b7b0e7e39e986474b8e1a6d8e6ed706836cee2ccad3962c76f61d6f1d96a8251e558499e4bdff1bbc1102107bacf4c2fcf8a6f46dc5123bc29b553f5149ba89f6efff312408577420a2267cd52fdf09b07de356b2d18e46b8bc9b809f1b4019205ac74c7236143c4401964035c7a6a836b0bb471e19c9a4125f24a1f40a02e50ffc307c710d0fdb080f401be2cba03675e75764efadffcca8aaca9925cca79fa16d767290e9d6e66239eebbf7cc72044c13da531028872b8680c4905550aa1a67a530f9c8a5fd6c3dbba7cc0f94109889c85ce7214a8635b5b22c9b94cb91052058275a975027b3d6c234291a042f5d362d6690732a469307cc11b11487d2c45c888178a281a44e37d6dbe1baba69ced49663d916ef9f39f0bddfa4b5a95f49852e49363412c569ba0e7083c04f270af4a6794ad5128e38e645fceb5723a47a85c53f1d1c01e38dab2398286c5986e7c81434df75d57de6e8838b4df463e12ea652b5bacaea2dcb3499cb2bd6a7c8ac9beb2db3803c66e31107a9293024775b426d9abec8c56414d5d39ed6e18bff5f5127f47771facd8086ade757e50655affdbf3a6f5d1f55e96b5b379d543453998166fd746e19c45d1932de0b2989510f8cdcfa8f54e2ea15510af1cbc7e00ff5dabc54c3f0c2d294755c36eb46f45dbae29a67388f1da6087fc548ca4fa3f6dbe6e4a6d45114799f1dce5e0b11cda2442dde608b431866542830f08d7fb38e17f5db807697c735d140c7a3565425dfbb19679a392058ed238196458827498827c00f6b29013bffbf25f3ce109bdfe0300dc6e5d887911c69103b6ac049947c1a4c4af199ee4151ecec3fe90c4cb60c18cd4245eda5587368bab88d14a26a37ee7134e18277e7ed9dbccad704ad89b917c7bad275af6a07923f9eb04c8fa4dcca1d692a0eac4ceb6977092eb922313317a6402da9288f39ec170f32470b5da1f1a2327c8a8e6a94c6c2f90f3f747bd19ab220d5522afa2ca05c2b4be8f6ee4a4340b9c690a6c375a7742fc1c51a344347ec581bf349d3970389ba7b098183eb3f0f1db15c590b3f065ccd86967101f2817c51da4abcd5b6fa96fd337f9434164844e98978b47f396ab142dbe3d5182c7f773adfdb726767b07fd8a90cb466418b9848231b5f109f58f896e78dbc9c682c85dea44caf084caaa71126f90192de789e5e8004365474dae7b43b29d026a825c90cade0b7615c7b6fbc8caebb90aa662ac782007cfd94b03fb1134b63b9ebf7c1a55856834c4ea65acda2e77a495e14569d3561c3bee538c9b6fa0a90b7f9e02d516de09493c9fb9053d89fdb79177d7f7112dc44547675b84a4a48a6b836e40b2c36fcdc8bd63b6b7ecc726d9ac471ea700cf393e515a71319d9632a3359b97188d29df6d596026c64b20b852fccfe364a991e8f599722a453b02550752a01f9a402ad7e36455112bd820395a0b394dc230e3ba0be6e25e2933d65efe6b495cf7bebc89f1e9e5a44a2e351906a66dd70376aec45222e0dcc89147ccb567410995d9a5b50586a8f3a2f272eec1418dd6288ac257197939c61f139117de83000a3946c8bff54ab3de9a0376077918d6f49a6906b130f338785c8a79854eddf7683ef4379daa9066452b5c0e95665d0b01453e437d66dbd22970e33567fcf0d2a409de0a8b837f0027ec363d9d06fced8d6fe35f715f4f5db839ea3cc90b0e3bb16dec3161bff4f1bb32f54ffa0bbf379eb197733ca092335d4c2b4bdce8003be04a10fc31b74c640a2636de63b3f9cae916e6db04f468f9de5721a674f38f83bf985934a7bd41312370d8e89462b4a6fbbdede5ac364cf6e141997e230406dc0ee9359dcc8e68588707b865d02464fa43946844c737b4b0125af30f3404e9f9120f5b6463105143eb77fb6bf4a4404c23156411dedc96d2c3277aed35ef064f0ae5be17977f242c64e6aa292d8d08c64852baa53a250bc431db5e71e58ead5533803f88de673c59ed8b9173323b51f8d0525dd322b89eb445fa62e5f1eef3ab4538d41881f6adf73b45d899da1118838547cd34ccc821b795f46a4c80ed6213f944e084c8f5f552a768081712c35b0eb9f63625628fe57d0ffacf89ed781a67f9e1528c515d92d268943e04d3be9db03aafb5edd279ef27bd015aec716ee4d444c11d7dd5acf4d2203ca821346b29a2753fee2118cf01fee68204fbe357d4899d0df474777028090d40452612a3533c099b19272f43d1c8288a9e0a2b06f9babefe70c848f388dfbdb960b524e8d417e47b40c864a3ca417b85a69ddf480d1647c573acaa9d00f354f89317db7109ab70e0a06c315f71ce08cbc1648d551abd29f752b10ec05aea7ec12a7a9c20e1281cbc2ccd56d12a7e1f3b6ff58df1cba6f306120176eebe869a9b2d01f0296543cc168edeec9047989f5b94c88c46dfdc3c58871467bd9dc09af217fe2dfc52fd994c1501c7335c117ae74de14c8031a4b77f942cc70560de4ccfa872811cb589426d2bbb8e52889c31993c8642475d82483f2d8419bd492eeb7a958cbdabe0b5b51644fba01d5f51a27f8c37f9261fcd08696fd2d28dc23a5ad1b086007019b7087fa894cc4183e2102ccd3ecb8cc13b068beee87a833f81e34bf641d06bb213965f7e738bd22905d1ec91b43a8ce204a01812ae6c398c56ada40b59b7d12ac366b8c9e3cbe15024dcd652b67da9f726e1954a8b62c8801ce13211f666914e21d59c78fe7cd8a4c195cf2a58f110df31a7eb7a549272746ec6c07c9bba6c75e32208ad9b9d2fbd574cf35e62ce967c19ede4c1dafaffef14385ceca3bdbe8da349680626dbb7adaddd63caf44898cb08183fc871d587c3ac632fc7417e425ad0887e99a88591b5c70ff7e9d2f9406320047bac3631f862098b0a8320cfa2c7055cf610d1b0c8c9d278755d36beac9e18d85dc4fd94cd73714a836455ef6f22ee0c0ddf8c64ee764a23db2003d4f4f10a1105d3767a9f27439915857c882b0c2f1c2ae4dd68507a7ab08ac3f6ff2dd88e1c0656034b57da4f73f466f100fdad2ad19f8961f55bef44e6e47d884842f0d966bb10dd30ef799a39ef27666f68a416364ae9ac6057155f683847e718b7a5dee4a953000a1971d26cb315e477832b29afb7f03dffe41c2d2fd2ae61f9ccc083d5ca491ea2819f8aa4a64f4feedd9fcd86caa95d3399c9e1466dc54a207c6d6a207f80251d7549b8ab187e2d8a2e48673d6db4cee2e07f7cdc0446834f5ad08830ce0f2b991e1af64e1a9d88a42f6ebd3741ddce1a7ce42e2ed19e63d6bce566c8624100229bee8fb70c2996df6b8cd0dc485f91ef432d1ddc2eccf316e88455c5c2a0549195be50998b0fe01f8f79b6a232db7627985755269bd7571d784e1b93dca053c94e588d2b484977dc7fa3c3ffbe42e625ca53c8fc22df64839ceb62975207cfb6542d7d7a921f7489f93b08fc87f95f686838cc686744602e5f62d8d00db8f649f7f2d7265d8b446fa4e063d09cdc063b04f57c123864d52a61415ead71a129cc75abd2ac57b99dba3fc52b50c816bbccb977a8715852debe32dda213b6e336d638843d64babcdaab21ac1a3f512c0fbd8f9cedcb2b27741b26be3427470ef8d4cacce067f6fd6d76729908c10a5afe045d87c78b523b0647407cb684018c7b8242878b6a24ff8338c7ee9bd5fd066940b3b9dc948d1562f3722ff7fa309f75c87dedf572b06e84328470630f17ec150ec53a6d8758e5b21c706baab9969dfadd6c955d656bf1b3ec6fee2f63342f962a60fa40b879a0fa81359ea7cb8f976bcbc8947b6bb58e6a78f8904fce0953a5ab9900a3de831e42e37fe6e0e558532a8be5b4cf0afc8e77fdb6dee1cd7d36571c55a65ab3eda648f1d7e50c7661920ec997da62d4c8ee492557573060545f907d220e2c4b7f5d7dbce203377f3f629f8699fa6f2b579bf0d9e5fc7f94679b55725862ad13d35f244095f7612667c910e548c83e06b299fca06c9d09a3fc4c137e03cec8aeabf8249b525889e028966a18cf6dba2f6e8654945c1569479fdd87027124d37a56223c923996ec73e5e1612f2dff4b691f52198003dfd83b395be94d45dda22b01e9649e90d5f0dffa9f3ae9f5ceb46978ee211894ef0b0259b0e5c4cbe6b6a4d584a4540868b22c7dae917a95f4c622e8adb7b44dabc235932c93ae27ae0a2c56438a76b77c56733f50521acc4d5176da13701cba8a752669101a5699240f542fb6c13bb0cfb5fc01b2114613c7cde5b4fef235460c4fd5f932eb5067beacff0db9f05c7ac8e77d7e28633e59886d7163b76a97ec86b9eb895b9cdf3920585559e2de585c3ad134cd9fbcc237a0ac1a63409172554b0eb41f08ff1eead4c2452e2739342f6204c6a5bb9424f4c97680799e042dda2da6de0c963aff319e9e5b657bb5fb8393626967cc8647898610ab618df0b991132787446aafb9f68f03048eae2b88539c9086d25d587dd65129c06f99181f2fb5cc84ae2ea0e5bf8bc2e8b11f8384afb11c96d35ebd1e3d737f2dd158afd53b0435995c54f5f6b643c5de8a6e31e7a8f4cb9e2bcbf3b3c6ed075c066dc0b0665c84ff6b14eed34171607e88723b7d4ef1cd188967e750bd96ae5146b64817b47070e84560c5a3471eed7e3a913bc2ae5c510ab8e687a9abec6c3ad06bfdd938b21692fb21ed698b47fe970c35817671b060f2a2b70b138b73ab5ce5c0effc98c6ca77f19039c51bc91024fdd6ff88a728237690ccdb5f8ebe0f611638f27886ea5119d40eacad2347ae37cd66addc10ea032143143dcdc92c09426c3080cb294a0d9230cc07a9565aa0f1386efd5168b73244846ae3813751905ca6aecd09fa8eb0b56a67db6c8df3a48d66714612658efc1518297a1ba3f034377a9c65f90a7b8b574e1be09cb28b4667fd23afaf8f7902b968521f0bb56f22510042bc487b7cfd682edb39a642aa8d7489293d4784f2f3139e6fa3b43ea8b0fb3d91f849da3ce3afd7da616dd957dc5663191f034c35166963d4a30641b3ddbb25a94b9809c72eb368dee7c2643358ca9584e9cf2b6792660ecc1115839616305ee2fd5250e17d7c01169a808777669f16be758ba5346469f20865ba590230e92ed85b6f6bf07a7a9f75c60bfb053e710fe08ccb19c7314853fd50d5605f4068a46af600a5a1a726104eda3d440458a97d1c284b06e775c0d1c1fd0450cbf6cacb546307b8977b3c228e7be92501bdad1aaad68b290e790f322dadd8e0c1b5aa1e3365b7694f1cd59798004910a553956c806c550678652d1b0db3c3d3c6f44f0e292d9272e2a879312ab336fcc8e2d7cd6d8e267538d36d84979708cb87638cd81dea1c6fafd768b417bfcade07434a42361ee829e3268b95434462a794f2cab70367c98d798d7bcc6858d081bf1fe77492128b93da1084af4374dfca19421eefa3b01815331ecb8c1fa0326b714ed34740f8900d29488336d31856d2916e2ee7b639a7e4e7e2feeab80a4c3d1e5437e8b5957e9d7e5a4c1a7d24b4696e522832a3bb3a78e4fb364ba60689e79281618b50f8d306696cc2a39f6e4b67780baf35ec68b0e8006b1279403ef3d6c5a08010e8b0f01d0f4f5135d766886d44a516c9e2993e79c0c7927e4e2732896d846599b49f433a21cd17c1fac5b6e54cd820fc99dff04122cf9b1a5f14a9600f06142a2e7ee1bcd3df3c6ce336717e9975afcfbc521cc73091a9a8af9f726f3608d109fca3d41e6d6004e10af1c78e8e9a31087a50f8d273d4dd7b5abefdc97c76c4083288b6c2bf2f22e94098ee7b86f6f286983eae2b035e66e8ca6de7f0fba4922825cdcfb6b2fc21f24f6d4b4a5876d3de5c251b663d940325526b6969874f09f11a21c75c5ebad70e751b5485f9b920bb7309c5d9ed0219644e23bdf7c33f28856d95c5b527fdec6c050f29fd834a3964cf0bfbb02bad9d501080fb4121a17aad1917fa471703e2aa074708b05712f9640157519180df558c402dd9da08caa601b8a65d34e6be6ec37624630f6a76872dbce3ae390ed6ab086fc44e783a1a051954b71c920d5c8eaa47b274429b4b09f8e1afbef36dc0495312fe603d6f4e4326af171e1f3516c630eb63a47706addb9f73140337bb1ce2271d3b2563e0efffb2e0633778b79dcac6929d6bb0b81fae750980c7365cd895367de81e9748eae94a73c15c60b96f5425239b43bf94479b7688ed53e6e40a89a552a764143abd3e71202fb72e90d9dab8ac7f79628690d7b9db65d3e4a6e6237354ee2d7417c6d7cf25141ec593368db84b1bceac03a15e03c51f03567f9dab0a09ec56a32313d83c3750ce72192e47c5e21969aa8ac2acb74dfc235e1705caa10a335f75c42baad3605bcec321b790d60d7dba99ea1623783bfe64662db7c8038efc37d798e643985fe09b3adf16235612c73b54bfadca79d655a0414071410cabf3ac875f3312310a580b4388f2c6a2205a53414a510c71afbf5da5adb1238fd144c40cea7600d13bb7a561bf8f488e82ede6534b76d8da6c371a19f7be014e0e0aacb7f3cc7df8d157a7868b48b9148fde23b8ab3fc7a4e0e05c68ed7a42cdfb0fe16a9408a26272d8d3b896058839230a6a517f2dc3dcc367fbb4688b59235f27704924037b2e723ab4daed8ff274d32dd9911a24c968fafc83292dceb2501a42a6639ff0060ed2139d5bb69e9eab5ee6f49b7ebe85b4b779156fec0aca018237f2a685e7b5624af2d3861649bfa801fb5259e522dc52b5e857fa17e7566fca75ae3ae31eb90eb</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好，这里需要密码。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">有些网站放在这里比较合适，放收藏夹碍眼</summary>
    
    
    
    <category term="记录" scheme="https://changqingaas.github.io/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>文字摘要</title>
    <link href="https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E6%96%87%E5%AD%97%E6%91%98%E8%A6%81/"/>
    <id>https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E6%96%87%E5%AD%97%E6%91%98%E8%A6%81/</id>
    <published>2022-11-20T04:00:00.000Z</published>
    <updated>2022-12-08T07:28:08.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码看着不太对，请再试试。" data-whm="抱歉，这个文章不能被纠正，不过您还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="7cdc50d66a3f04ce7e225f7419dd7f94a1cbfaf1f66c8b3daf356f221f72ff9b">655ff9f578eae0bdc5954cf0fe9f55cb2e0db6be177836a05f82f2f8b7f4b5c478de9e0faecc32789ffe3b0906e2ccc4c61b7be1a28098f634a5740af43287766ad4e83cb61e36b77c49c1a35ff70f80451372d8732f2849d43dfcb708331e1d28453596f16eec07d931b51a82f1cc200d483c060b812bff1d6afd51afe5e5a965531c343bbaf3f6addd73105a13a27d1d71745c4f08a25f57018e941df8a04cfb1179c3bd2dc18e2cbfa80431b867a85a4f70ff73e1e20c4e6b7c9ac3288722a1414d1a6f6fa8e995a7169dd5a2c6ec39576ad1b09753030b0239ecd7b63547022d4ff45e970406560a8191b79c5def947f837a56b43eeb590eb7f39e57ba723e88643770343b365b234bc8e09c3cc7cc68379b3ff57865ed668d5070542576ee48bed75b529f628f0624c2bed7df349f0a3731f59960cf8be934eeb799b75ddd1cb3af1b3396ecb79960045a6be7e0c31d8cfc8f7a9aea20615892b479b21d3b95bf9573dc392df4822ad920c2855462f5c1b66b16a8d7c75ce00e8062bf4e7be4e7f28f66e52e627a9c28187ec97ab9cfb6dcf642f0ba2271a6ea5fcfc7e89c31e4d64d1dddf876ba285ddd5f4634d337a8b9b679ae163b4f7ffcc3e62eb868336274c04ebfc97942bf6cf153a8af7c6e3cb1b1d0758630e96fead2443d44f358038c074b0163b2f92278adeb9101e94a656e940a6af42946cf1ef39f29964bb83dc07f18b2aae70b2ceb657886e0aa8773dad751448f01a31c06cf13b976ef7a534acb7c9509bd030e4eab78804f886c01c10dc1526961ef91cd554f357a5809c86a0e8099f1f7a944ad0c4c5b0c8801b60b7098859a45f24a3e79fdb1a89cf46729c5271676c55856e6d6cf9ad752db0d69efaac428472257ca6a96aadeffeeca631c41fc6785389945b2d520eda0f22b8537c8f0c7342976fe6c252df47a496b61bd701f3d8c5a15f3b51bf2a1e1a3b73844f05c950d538c07839cb814f93f4adce0a10f0451110ef0031701e63e0b3ae12b7c0129b8a164bfba60153aa650f4ab95f33fb76379301f3aaa6fe5c6a4f6cde629bc1ab9c7b5dfbc32180e5af445a4894d2fb79607127ea4f1b96863a6c7d964a8cfc2f143e0c05f2b47dea2d4dc511d620555a165bc871f14b30790126538ad47fcb0f4aebbb1a73bc234df754c0628267333cf3b8e093d6ba8bbe4a89eddd9033635da0dc137cbe2577f4dae9b46a7f7a5fe248b1362d48d6738be34be9ae8d4c97f5daf61fb3d168c276fbf6371cd48dfcbdbab82697195392df99fbf375b99ca2f2a6eed85c18226519d3583b97f7f748f0e5cf988290048bafaa074c282ee7ff50ca8be0276f19101f11a161f22df4b8ac6fc1096a0611334296c9182bc393dda5a2b04cf9d3ea7d9bb1cfcab80740a872dfd042b55cb3e2400afb0d404df083c74fd60b4c5c3df66f7585833e229e598e41cd70fe1faae54d9d1d3f3f9a3fa022b15f7db51e03a3f74ebd1f0f04dfee1631453bdc90d3af4067d1f7a0b1e25b1a04d4d72e6fee4b96a8975a5b67b775bd508af6b6dff797c99537aa360d3f6c941e01ce48119ffc6f9f8f819bf9f3e6350b34ed3f4d83ca75e6eef5b1d6394b0e68b5d4afc69613140a73c1f3f4d686834b7c95850ff21469513c98681bc25b258b8900a9872ee01c7df66042f93bb5cf62c9ae6c82fe183a8843e744155a857169f1300bb66994a5269c3484ef39c36e31a508fa18d2101174185a3ef8f31063a237af455736ca5800ff77ed773e4a824adc900a0688fc8b487d871b962f5697ce62e7cb9e0c7b5eed371088c127063cf526f27f35cd9e90e94062a53be3e5161269a24449221bb9ba19b2d646cb93fbeed643f8b1f29806ee43609a0325c6e1f4004197fc603046e29f959d21c1df2aaa01464c865eacf5e25284e71bb0d29f5af916dfbe7a28923e7eb0e52c18932a696770c5f0f83827fd069313fd555127ad5dca34bc8a19df20909206ea8df2c20c89ce3bb3e45c979e7c5c76d211257c7e3a93aa5a12a34fc88b293dd0bc50c49cb7b3be5767fe37d7ece598442756592bfdf10b083bdd8e8381efa46d0cf971a70a021687ed3866b9c5f44e11d282fecb9cd86a70fe48f1771865d7cdd60c552a0e4414b872abf02c64435dfedb38cedb3ee4496f5dce8309a201d85dba63a8d84f7f4fa8be4540456c96c85c32571d32050342afbf34ad5d0749aae8559a4c0bac44396307eb0c37980730045445f955662705075c40be289d83724d32a56a309818dd0c973b0d4fa9a38c22762d4e199d4fc9094ee289ea7217f1cf0b3535a55bdbc4a8fda0d116e6a5011ed364d488423db6e7b6bbbd77bf8aa0e0496b807a6380b6cec4e0403abc1ee75190e57e5736a529d59de9a6a3757deb9ebd1b1d945dc9ef106d35933691e1ad2bbbfd03b74f13c9b85d8e088b6a341cc3dfebe51f590ffd150c0b77d374d70996896f5e8ae1dfc1cec44fb2ba28071de856bb2a97716c041f7e54cc838bf0361d8680f7dd7fc7a85648c89821c99daba97c04c6a0c9c9940a6f6f9b1c445b6529a0fcb768b561c40a69930d6eec1f97f4a5793e00ecaf35c4a9b94c33dbb6608b7204feb2b25a334d43cd799b5cce81dad00bd03406c772f2dc4d33632cc5db6451725af18f6e43edaa8df7f90809404625467fbc962dd64c5fec7d1c1df0f4216ff582a050234127c3a024ede65ea17bcd4e02eabedf103184c722b9b73eebaeeec7b3dfed2dbc6f35bcae9160263fb42680492124579031924e6d1925bf4fce2a74f575b75ce26abcc6149e2767246bcb22b270d968fcbf58c712b46d8a11c481ad6d706c37b15a13aa756a707f3269870f6edeccd8014922fbe92fa6d44d5e4e0621507d4b1d76f6edb7f49b3719d72d63cb7f8bf199029dcacade30c99fbc56c7366ea67b21a0a9e5280113fdb7d666b7b8ca942dc153f881fd4a019ee4231a9887cf19f0b46fa4e6b295fa8fc339f5fd1cc91fdc6cf2264f8984520ff72836010e9778a27f56f4475290fc111750d65de17dbb9f765a9ac8867dcf863ae8954383041f3217b9e3349a515ca3f89fdada349119e0118388e1752b02d26e4d6377548af8b9c036336191c0029164e55311af478578855f5b058f46551977d9a60fa1815b64cb94f154b3a5b5c4d10789f09d2c27d4548fb0ae7624acaafec25aa55717565bc24bfbaefd33d8d9dc4801bd9c91c3aea48f32ddff1bab2c9e470fe42ce66e558d3a1a2339f22537eaf17aa6e93c22c8e575608095dbc86bc89569739b9ca12153b324713b847bc63e6832d8fa8bf83de192abb1959c2ddaccf10cce9b40b93c5e45fe5d02727624aeb8e7f3f6712d9188cebba0a91e1a24f2cfa8810ac5677ba884d13e63462f571785eb4ec78969a2ef2dd01b91bb841e23f6d4adf8b86352a849b852bcc7ffd03f866eee31bf5b0b8b4356435114ff6dd53356a1e02fb82211f01498cb07fddb2282c3fda0bac750cfd06535d39e768d59132f00c42f2a66c188bcd7afc9cb59fb8b939ec47f7c791faeb75eea7c8b06fd0f1152955e7603aeb6ba0dec9f47615efdaa7fdf39778097dca5083ca8b7ddcfd0bf7dffa57c6544087383d323f46dc90b36c0729d27f7f0cbfc6e8867bbbad8d9ccf26f6e6d16beb5b14ae3bc6bf1076eb413a8541551d7357a115fecbb53e4780d91221877cfb86f77fea54d874c81870c31f9e5c76a79c37288fd915ca501fe31c70d17f861eee71e9486cdd38370cdb9cc326f9e9ee1ce82e59cab665720e53a6155c026a412550aba53c79491e28e9ddf3acd2c0c1be3aae46f864245bf7f39b5617ae515744819ad2e1092e275816b2cdab01299b53aba51c35b2f907321979515dde4492bb69a5a5a3ff48303c9e8eb0f973577031f21d1e1d446ae2c4906622bdb8960a2efd07b1bef60534523a0fbb502e4f02fa633a1f94f7eb1d50a5c37a8bd0159d40be44629818f3734bef21e343b530ed17b39d9c14bef2bcd27c5b0cae5ff96a7f7fc43db5b4384f88cb3142b39408809653720a124fcf6ded78307f0480aea750c982afe058a46291faaa5550a0e480c612d2d89e973b0748dcf99e2659f371a9eaee8477ca5e103b3f331bd42c0cff9eed1f1893fc7887cbcbff63643c60246e519ce56df93a78566ae6685d26eb10e21265c2adce2f874715e8f5f0f39cb0fbcabd79af1546bbce4497d598fa40deda4148c6a50e69cfec7d1e61cac4904380b599b7e5393428b08467123ec91acbf50814c32023fddbd3013b85ffac4c926b3582234a229720774b06abeeaaf4a75cab7559ad27ac3d669839402431383f94dd76944f95c00b72d0f0436ab89352711f1f9cfcf8f5b9846536df8f582c60640c1242c8bd5f7566c9fed51310a6c6e61ee46bd8ba9ab8a80296aff79b79dfed9d8058da3e1034aee02259e6741082c9610bed85d323e804976487a06fd9191d14bab2ae036d9b1300c83ebeb772c4b9f4eb6b9982806dcc80a003614046f166d9985c8432abeca309f642c70893a5ace0db834b8bd22c5a1f6c544a1057ff1c29f1e198fa549eaf2f2faf66108078511d7de6c9c9ebe58478f4703027dbaa3aee7c25495b6e4800c2037ce7d905f387734483a19add0f33b1f152294665776212f6cc2b09cb59d369f8440681ecd2664be260d249b015d680e750e79b2d7dc559c14fd528ec695ab50b1d42bf4047864d465b116d4a1991a50df5df9622d85e2f41dc7b9b3052f3334bd0706a6551f6ba83e9ad7c61b8e50e1aec51c453fc8302f881b2e41fafc2bed5421ef40b6927bf898e6fc21002af3f3cbbf1278f016d25424fe92bbf7b0e6db1f27d1ddae03a40952a8aa9774c2ba8907fbf60c5abb9e3d3fdd640e87c3666f1cad93472b0a1c5df3c6d8489422adf4938967a4a68f5ba6bce7342a15518739d2fbeed3e68aeddd5ad8dfa0492e5b116a13197b7735642c4b540b4f66a73408fd69fcde4593a7787d92bf575552fa4a95346292a99f4295fec457af65bef28b47873b0960d1b54ad5fdab8504ae1013186aed0c0ae90119bbe012c76b4b623cb8b10ac81b5797015c6bb1e86bc62f9e24c99f8d23525adea46a955787abb52c610f178491f2c8efc7e87270e4217aa6f4db2bf76df13ed14c3bef963925a013591c87fd4dd065224dde196698b613f69acd10b408c259e11cf9d4bc62fc7b56dcd453b1feac8b7e46848a0945d273dda1fbeeafa7a4da3d50a4e40a7cfb644941e9419878fb693d226a3c4071e19cc8a61a6a0c7761837183c751690014d2b2bdc95b50efd4dad9cea77294e42644000ba7342e55346b4548ec9f9b400f932331b6bdb179cd59f2c7e46e08aab088d3ac84023bd608c9c5fb99ac2bf09e36ecc13d9de84e2aab8e2a0d2fd6c315ada6e0b6391ff6004f1694d63376480a50239a3f0ebe728b570723084a05530175218a7f4881140d4a8984d8724407036a3631ee47b670d601bb247d756048f5d58e4efa448dd81774a8b80aaf157f669f3278a3ad9990cf8a7f758c5d8ba33a62812db927c3010a34163653fdf4c90ea08f2d4d60864ddaca05fcc3e0b3d2f334134fe04e2140e744cf1d9e011cc70c3e06480b566947b357b4d8ceb943fbc9f9457a3d30b8def60da7dc8848b71823a2942d32f3c5501c4c4427c5feca0c2ea5a4681530638c04de93368bdc6d3bb73e48b802655f1142cf12d30aeb0c5225938509f983f50136d0354ad5af33885e672e1a3cd07dab0f78d04a8ea560b3141462fa55f17c0cbfe99f16af60dde7b5c1c31e33d1f30b4880bd406df35d8f27d66d75ab26b47c88915d345a1dd456b9f14d4636f311f7d30d66ca824ce50f363b92bdd579a2db7b0bb03fd8cf4f8ae51b796716b54b8de36a9f015377c7925722c00ffce35f43867bc6d684e671623b533604663e0420a696def97277cff14552c8140dbf1460186d1cc70b39ed0981090343972fb9e29075ab89b949477685e167ea0cb1d3ea3c2f5d3d3f3ce9a7f73e1d64394972054d0e1f0a7e81879e61452cf67ee83ab14e41fe7b2df3f0a6223616054d8661ae194d8962ab0f6cfbe73e954d16e77f9ca9655f721fd9f4462f0e935f09fc3b50b9ff73d007cadaed0f7429f75ebc57da9db6305df9a0dc6df927d3e957fc603d1d73e48233e17fb1290ee02398b53c82fe9a596d6b3ccf0aa31bc08cca82a807f727ac3aa813c3f3fc74214b51d2c9e5d8de08c02c05087d3eb4382c80949ead1ec2056ca37a45cff40869f44aa0665d8e9cebddb228fc8c75e49a32681e3f883785e1dc3d5f1d78788fbea177f5b738dab416bba315cd2b2ec5c513fc28104a7a666f4f0110804a2779805df6cc7ffcba6b518ccd423b362df74f07f88677610e749ebd247ba278d658f3fa5f9835db7688306507b90a207c31dcd89032c6f49c43c4699dd3da1fddf0e4a6937583620137b9168bfc60be36840b18f98c070625e40039021f2c4b5509373a767e7b74ffda6acd57116a0ead27fa883f81d0b204cf22b00df716d1656cd65f11a9efdae25c2119759ff90f9708140d5e00630e5cefd166aa4a7bf0cf076ac8d28829b782d6d7af0514d9c11c34f920246fde2f3a16c18d06fad663d0ebe0ecb19fb67687ca2e55e5f9c2eff3ed16e3aa6fb52bdec2a099a7ecd46e4f394ba3d2669ff0fcd31d34fc87768fb32bf2ceae3db712a4b3d6ad3f3832b3538f5df41a42ef2154642bfea73b296594635f19b9110eeb562b147db786e0cea361a6ea01b42022bae3474042c27d9cc385bc991a3e8de116c71f26025e2140c7c64befb7ed878025eda4b328b9d834285391379af07fd7ddec0a6b5b7cf7f075e6a4111dc53118589921f4a139d4db120be134d15e96c100d1989116141d49a0eb738d15ad684e59568ff908f81759c416c2ced02627b1e275404d9efb4ff2f6bbb90d33ab6ef438e468a5ad5433976b0121fa73dc6a0533fdb7a2ecc67e1e0bb4fcd3ae54fa7e4efaab06009957f47206edbb46dc1cbc1879231497cf7f2c7e70d90a12d172615ef27a92781d61a915f8876bc549bf67806dba5e2077cf75766d951c1324e16a73f7c11fff0ce646d4da885bdffff5c887fbfdf2e869bec608f2f4542f97b700a50c9b0dff8de2197cfc4d1cfcde9d869afe2a31162c72f7275a47e8162a89c06b7c511eef8deebdea23107b685cbe707c4872e5612a9510dc5038c8945e3b76e851637b7f630081b8141956efc22225f8d9dc3ba18529ed666b86b147faaa1851aaead4f1781504aa56d70ddae87ecd8a0fe1cbe934b2c454341516945bae6b9f34fc409fcf442af27089e4a84298fc87b60f513adaf1447287b7587db8db31729da1e40ed90d6834e6b6730292db8fddd070379b642f9ab3aa7453de87af0c1b84e30f463d56538531678f1d6665e697a406c97c6dbb3f3f462f9c022d90ac8265b47cca0459504ade5141b91b4ce69f573ba0d1e34f4fc81f6997b0609cbf759cd77221448b09536f4bee0569ad5fe5444a439d7243b07d363a046b8ad0db59dff2d3239eb8dccab4db6c23dfd999cf0a081298a2c7b0e187bc22e0634ac919ceef2982a5d3f4be0a5d447bebaa236d1cec2648bebab265b1a7ee2be336e043f2ef582545f62bb5d48a48d2b2283ed1faac387470ec7079d60618e1da5850d8034f96fd3ca060908eb2cab774a2b2ed866ebd95943a837b21a03d79d04010cf2fb91093fa1785c30b182902d5cab9d141a8c88ff3c0f6ebafa0659a37087d523cfecf128fc6db571989f63c6d2ca776cf4712d674cf1167adf82d1a3f2359df3a66b685a84e0ff35297ce4627b1f797c3a22759943cdf3691608c70b386e2dcab1413bd48531915b6a89fa5c06569a940896c3f7cd8f007e4071f93ce6b4c38add344e0f09a6b3b6cf389890e8c460690f2860cc3614a1c4a6883dde26a81f4a9f9dfff5933459e5aef9b628557851c190a7ef2cb1e71f37087e8efa0d51ca5c1e24ed48161b06fa74ddf28f26a4d0489262da35aeb1e101899c2a58c6cd16f1fbc6fcf1b71fbcb0ba48e77561ddcea5386877eb29ca785f6e8f68e952fa461fee1c8c8384498f7f36da4873d2585ccd37dcfb19a144a175af31e531c282b3a3a6e3570dda4ec122c392b672229f9bc57d5d157da1a6371fd58c582d24d1be6fe3905c007608b87f285c143eb1349a7dc6756cbd6d1102f550096456f3aa77acb13b928f9d0caac29f05e83cf57d1e93d4de290f6a82c60f73527cb5e24c719bef054805a2752418bf4d26d1c4699e74473d3797bb49e8b8bb694fab275cf31206b3fdd819f4c6fd89dff7326014d0274d896e05d6efa076037b03cdcf5dc3b61caafddc0ce932ae6f85ba2fe31e65d869f4f91304930ec854ba1bbd140658d06ff80314011da2eef20f68c9b727f3faf357bd27488d0ec3425efb0dc367eb8955ff2244c23a7cc44d7f8d72eabddb8425069b7ff5d97814c1fffaa3e4b62c3687939daa06a1890bad15f74a4a270dac5c2847e0ea7d315f28d546f455c08684731f56d75d4e92af29384a3d578d82a8b7535ae5bd1e6a6fc359611da57cdc8ac6c927c76a23775454a736c5ec10c847f038e61927a4e5008920ae3b3f812f600a04a493a94e57687b4c51ccebec9b93e7f235c33b0e32fdf2c3ff707ac0dd2828b7b6f7232932ca305f408d88ff3b8fd73f79fd714ef517d920fd9286ab912c9e5f0e57945c6ebbb811cc047496f7f0a8772ab34cc1a715a17109940485bb4d9deab1920b0afec87413cdfa8757a1d490a0e66b281d48154ba4d1b0935ae2159376902ecdbcaf9b4546f543ca1bcc86e035cd2c858e683b8ae62fdb676ce99d208fb06f75a53c45d1033f08fa1e898b652a187a5236521a30cd2c0a633a180738638fb6e1dc57debcb5d80ea3aabad210d38f26cacb369257a5b3362d31ae988f2ea4861494d8e6074f3fcfc64fae41f1d6b4eca6ef28796b6564f8c5dc4831cb66bed3532f73cd6605abf4cfcf8376ec545d35d9fc31fe4d07494c60d64b01bcb244631ad4ba2437831fb19ec07e98b28dde81db2afa613de22bff7a540fe501a3c76b20418fd4afca5576a9a28f7f18902059192607e195f2e6808fe9c148b0b09e361450594ea9e34374ab1831413c39ee5e36a2ffaf5a11ca6b7d98ab8899646e46d0329a7d521564ca34143ca96ae8643d8554e99d4be2353994a554f1dc82d58d25ac936c8e2339a5edd88728219bf853a04c78c5c49e0646d857f0f5c642d92648f2378425edf659c35693cb89c8ba75aafaad08f645f0f329c7271860f6642793bdcc6eb0da81d5b766e8bf87a5ff74413e193fcb22b9c2896cc0af87dcf449138df3773256aeff52d077c44dac800a4b0f429a0f4bcfdb74f81291cd5be5175c7d60b1e13c9daa8d8ff4a21abd521828342e58e0b01b8fed44f411e87572b6874abb06e75cf82ea3d6d4c129b17cf9d840261b8c1b44e1f089c7d69c381960f7baf904ab9345747a64334ce1230f4569ff893f0bbc464f8ed0b1f01e488ec3a60689b6f49862f0f82c5a51d8ba61cb5cb288aad54a4e07dc360fe79acfa7f34f635df161a334a9a162cffb18961d12a69e79ba90ff7289427736843a80731d6e8f06fb03e0cf736d901d4718e46db1d09411267a9bad3fc6114614fb9fe6a4c33c300a73e605cf6d91322875f85d23a1940b64906f35b25bb589346b50c17a0855352e6cfd8dbe4100fdd013e8e828cc2a8a8856077590b07319dca1001c0daf9b6420fee0100fed73bf12875dbf9d3933f4cd33326e77127ba18807287166d948757809761765a069436f848530dd36c4a5d25b500b3d18614b5f123af10884374b45ecd98fdd50a2961807fb0243b5fe0e4b913403dcd4b69634f64ef6cc40999d1bfa798a958fb6914b7727a4318df4b647037358d398cbad3fec5c5750fa664c96adac14094696cb676c79900ac754af578276500ad39267a3724c76d3331498b60a08677c4c2c50b158c276674e0115ad9ff5218525f5b6d9adceca818bdf53d148927ab1b8c850e1afb9fa1e164da7e14743aea61abe8f1bad70565c79f83875ef8c04561eac51bceb42b1ebcd198abf77ef673bd00a438fc6ea7935db4a2ab3a9f7fd5dd44df7feb90306694dc93946b3e4f9ef254d37ef0a76cbe83bf1c8e11f86d2c82c3be6dfdf184f48d3a7d45bd8a4c22cb7733f14aaf0a6f46f2a1084a5755dc3fe59870dbd45b2184dfe81465191640d3a21515f2c6e9ba56be3573a1f4723bce689c25ee74fc8dd1c13b78f365ab15776842a772ee6422e02c78454ee6054274b04497926d2af6752bd4decf923e32cdd1cad66c4d868d4904c2753b6db3e5366fceb237b91fc0ba93153e663c0cc6dc3a696a31e27cc0b05a23048108fa3ed1685882ea356748a2f2e730204c1d39d407ec84a35c45fad247f62de87aec32d891f5c0f527aa1b06e0b5b262b43a7e9b4d42ac8889a559a6b7e5c9c445b80da01462b597bf34e33acc15e70f98befae4c7edac8eaeda20e1dd64b1382706602fad05042cd987c320c5be3750e371a9c24bcb41f4491057e498fcdc15629f4aaa7a66c724c6e2986b22a5cc84ff688ef5e179293f66d5ecab7c70cf9d1372ad198274a9b9903c4e3186cc8d33dba85cf1b5e24142f3c77f304ad00501860a94256f06e1eed5116fde247d93976e1cfb1979336e47323834d691319ad8bf2bdb85cd0537de1ad48e6898e03e72f334363831f05d84142b4169ec08a0b1f820274a9dfc86d7e8de1e65e36dfe35bd1b1e0ba5e1c13562ab4177329ba7460bd23fbc05030a2c411ab85f974a8e253332a6bf7248bde7d9a1349a845740a9b9e2949aee25df3275d6dc7516c15a12f96a2c1e389cb7210eaa133a638e3fcce850fb9c567c151e84501336bd9c2c8ca0c7c246ea24d993c08e108390dea058678ddbcf30fc9d63175a1a5ea0dbad551d3ac7d08f6ab2cb17540b22e3c464ecd47098920227b135cbe045daaa580e2bb956dcfc6f74d765e87e30770f79aabdb43a6887a78cae29ee5c7d062db3ba02a1ffa85ccc94d445fc13eb8e80581211f094351edcc73c5e648ebf47ff415555da6d2239a1b3816fa47c0ca7976090f992721f9bc3a1a8b5bbcb50a656f76aa6ff13ba8b989e8f80e6b223f137ab8bc5a749fad8d6856490718d072a93c51dc1f203fe69301cf8f8a553fb6d4436d07e39011586162b0604323cbb64d73eca52ea6444461b7bf1d7120343056e8cd3816a12eb7ea1930afdb35b9e633e8a90d91938835a13541b4609ffd4791f9a83f90790006313cacbaa0d098a8503a2a2285762256e016ddba1030d3918948da4c189281c0f8110cffa7c8663c1d070fcd7e58ff48aaa23fa4336c08b23d72d6f08a170d31a023c29d18af96ecc34b104fe9064908cb62c1c95258cb0764ad93556af860568fc5409d6de72ff42fd59b4cb347486f8673d32430706383471f0bae75e8bd9acac70a9038b1f5718b04492bfc2548a1e94af65428148ae40221c6e91c5f2b49535989f27a43d270b0535ef0e95ba6ec70045a12825f9bc1a287ffca3de2bc2bdd69ade6416f0fb76e6c92abae5143b407e86f4f461276e73e9f57d678223d506f6dc0c8b1eba3ca549b649fcd9520ae32f16cf2cc97ac5823a8c8dd1466bc0d1dcf085ea8506c3ae7ff740ffce72fb2cfba0a32f9aa6d36f8f28dcd4b5afc0edf82d67b813134eb7cc2abf44ba2b79251cfcf71f94c731e7a58d4904c476a8af7de91dec6b366dedd9cd3c6549523459ed05d3797ed9a3dce8c92f272d0c6e386ff08d764987dc330d7d3cdb1c7c469e3453ce5da557e98234d723ee6ca753b9aba1aaa819078ee59e83ef199bf35b12690eb4a2aa9c77bcfee24d526c3b6c980ef24c3d0a1d3ee2546238aecb5bc1160bad3537443acf0d83f625d09c18e38a36e099591bf01687d03aa00133ae0c30f0931727d01efa249fc543ebf5a264d9eba1ac65a41426078927d7ceb1c789d113b4f1a3a16dee04d606b6bb188b420fff52318941b3d89eab31940a8bfbf4c8fbb3c7eb0a2a738a51a9ce4b87960ea311d73b3ac431b525654b525efd7fdc4e2c414129908d0100e20c0d53811090cf89ca2e8c48cdbeca9bbc279873b957593a0bee2e9bc76ea913594c9cb930f8c51e19cbcadc990db9d675079f785bd2efacb599febb437807a92675d86487eec705f380a097426e004dadcee12e221ae828d538b44b0716914a1c02853a6e64a486885da821fee9a14e3e51992ac511fcc0c833616e61f92800f91c2d863b707a18a71b275595b181433a1477885b0e9671bffb29330929572bb68178ab9fc9824edfe73cfa474b9333e1555c2890387be825059b0cb924f585f496b711549ccbc96c46016b5cceaff643635486ec82d06d28c13da0744f92c2957fe60a0eb4f5541f52a437bcf55a319ba7a9c2e1faca423ca5b921c801fc59abc2a77bc532ccd8aa01212ef957dacf765a48cd475074194d9485910cf63c03a3514c49df8a66efbfe2dead5c7e2747f4d5521c410038f51bb2d3c2578bc4f74ab63c34adc88826df5a00215487aeeca60a0051ec07912d1d5cbd91203c3179371b18c2630abbb83f5d0f0d285d1ccc906e0a5a4a41bfe5e22ba156fbb81a41ab0260e00fed8dcde7688f9384c6b72b49ff3aebc0162175597eda7875764bf21a06c1593983441132d7b607c5cc9fc4869c58adfb9ed35eb0e114772a813fecd742fa59a4a657cb0276e2e414f23094842aa812192eef22cacaaf15a4017e490fe73d3116d98f9c2d83af154a9e616eca2463a8bcf067940c2985efc94ebab0be6c378fa8554d38ad202eca21352b3c00dc92ebb03ac90fa456b0640ecb314a6f274ba264f5c96e95e8e0b91a30ea4e15917ae65059223492c4e4559bcd75b3ed86ee2975544e819ffabe095c86a82bedee68e19b3adfa0957cfc764301a007f8b03563532e2bb83614292126105938bd20cb7641d201b5c1156ec1244f0c36333b032c986510535594ac5ea06cabbae4d2fddb8e32ebe7838fef0a1a0853cc3457133e587d905da6222267d519cbf000aee437bfaf7e43446b10484e5973c324e77629fa1b7418cdec805477083e884b7e1f01421b20a342f1d45bdcfaddfd96bd36e413b0ed618ef7d6c17dd95bbf1fd8b5ae947f3651e9dd0f1f4d90e8e46ef38f82b708cc47795f22c72a267b14438f24ceb47f945a0315f2178802adb4a5524ae5edfb39cc8da7156fd82e7e37fe97b30919805ba3456efb3ec625db7072fdaa582652a5ca29866bff7af8194e93802a54c77b95b5ed75d44f2501b1bb633ec0a8e697659059c7743da7be8cdd2b0638e7cda9bf48ae23e3330ff83ea6205902029dac63d234ecc71037afdea96e8ffcaba1198cbbad67096ccc5d940bc130f91aeb3d0e3a071aa87893b6617e98cf03e9ec741be8c683b7cb54caf3fd2d85f3a1893e5b9d8d9b53ca33378262c9693e9c26ef3d12ce33ed17246bf41925482c14bda200b7d7fae5a26c17a48f8562c1c5a5403d5ce71616689d4cb47ffdd9b00ba1de990150b572b38767103f041d5d86948ebb7af0a8e625ad5e5fb5b3fbe38a40631dd2d8c243067f51f4f48e7ff710c6a675828c631177294373bf7f8fb1cff5bcb89eba02998097ff31a73e6c69df7bb4d6d3b51780f8012ba11e3075c2d40b0011e5ee9e4b36aa627a3b23e1c449926914d8cf7e87b00714d47cb68722ad55e6c59b85764e0b61322f798a195580423387c82819f99d393ce3e434054eb213659aa6c19c45b721980c94b8cd88d3ce526d9348262c356308b11d7ee8626fef820c59780eb3fc6a4ee1da852d4056a08e66c04a56d1906e7b57318aef8d470e5d2f993cc8914292f0161b07a97203a1e02f1a9f97310f80f4e5b1326ac1cf7fa77e94355f4e461908adf427e2f47e226d62c72ee752d02a6f9102c92c076963499767a377762df7bcae8eb21eaede7dc509815700cf9f5ecd8a6baa536f1f1990b33a61632e1e0efafe1f9937be6467a59a540aea8cb2454170a4f4c4d04bd8ab4fd34f6fcd812a109135961138ab1f9be8e5c30a1e0844e91e790b3b8a41feef7889fdacc60a1912c72b98d9fc8d59dc1f202f60a773a62eb58fc043049386e6bbf1e65c794d43065fed88956a6df6657cdfc1714729ee9a08c851d2ddd2d596225beae7edbc1dd7812e3c0a994e7f74b0f3b96446bdacd35bde8575461cb5e8c66087064cfb8ac0da2c724c64d3eb159418da4f307de9d3a51884a6a56c8fd3984063cf17021491f1947a3c2db57afac2568cb19f6806dac9e61f8f24c28de4d22a4b4c71b81ac45c9d21bad03438881768963fc5b1865b8b1e609c45d9c1c63d52e62ce69020b92fbbfd03b6dea5c0a534e891bfcfb37c64d46e386d8c967c6ecab9ff81484ef5cc586a5c6881dc9970a8536c8850e6e02c1bfdf5b579f220e4d56c88ad6aaf933d253b6bd020d2beca2d5af1f53ceccab2ea0c3ad1419a6f629e65d60624f0b09137c4058daa77372802ba0a5df5f23e5ded77579a7ebe6698726216efa0f2df3e51fed1c3a3f353a9d9ab0afe7fa3db5f33eea1f8ba7fd691c9ea4ee74e8930ed8657a605fa2125bad9cf8e3bd3b22facde989fd47ea27877c7c16029331e02ac0e43390a678339c45fd4fb7c1a342b6146c1a9fafa313b8c7510907f8c33fef036775d0a5ca85857fe4178cdbd276cb82921ed7e2eb316e705fcfc26e9a9a7fd1ef22e4b3cdaaed9475f5e432022fc829b136f99257ec2fdbb0e1d6e02dd8a65e5265f76f95a5df78475b87d53bd582ab9371ee1e65d954c27fdff564b22db0aa685c88856c5e2a3cf4b6ab82fcb71140a482fe37b3c344e6c384e6388e3b850e8ce4dbd46435da1af850cc7c49a8398289f0a3bbe3ff1f8ef321cfdce2187bf428d5565acce4d271e1ed88d5840fc3ad22f72bfc197209a048e450215b9bffea2ea5a69f96e70611637a2a1b55b09f63f1100e1e09128bcc3999ea4a946675df6177ff064dd464265f84626394cfe98a7ee694f641001461f50fa4510af796a29b5be69db83873338320bf8e0bc1f567f7012969e09af1a94e951084ba70fea854ceb0be8cf9be44c63005ed47b9011e76d505ef46b7100d2d07e7148e5696c57d02f2421ea536cc47af2c974a24db48f32bae4ff2504c7b632c536d7071c8e245fed9d463ab1bf23a5b9b41bc845e066d772a040f1249e8243b51c5c96013963a781a69e01a4c023134b5e4e474691db645c8615341378e530baa5197006a8c0f0318760170c17e0ce725dd14f444e605fa4aaa3edb988aa26ef127a5c4bb03bed01e2e47999ffe4dd335ee4595789f847a80b22e9c6aa8aea2d5150528fb5fc03dd8441d483105ef79c846da162ad1fa0b98d23fe7ebf441f85aea7e7b36f4d7f8b7961c493ddceeb86a812e738be625c95405d5eb42d11e7b58a89dcd234bcd95561851632586711ed29d252f67da3dfe0cebd9425200afade66e8ebb4d400f887613f3fee9676172d4cb1f666810130b08a59b6cf605b32a655f1506e8c5f491f89ae22d7cef26faa0b4f6ca820a539312afdca7aa948f775993516cacfe1cfc34e4d96c70f0d0ba6c932ba27a7278a5a2232f6133f09e7ef4c2756ed8fd7f6b86549d9842810dbb7434d4b58e7bc0105777913b54e946b8a08721ac862d01f804ed989166242fa297ace41e0f6174af85b273bd0523d4760b94b1d8e73f40b8e96a7a1ddd814f32f3272142654292eb9839cd1ee786b090e6c5ed653a01292531013427ae4d0cc234c024fbebb530c60b8cfd974992ae822eb4c15fc72c5d4e99587b2ff544c9075b0aa04e348f71ff248369cba9d10656798e6da6409588cff7b43b4eab02838d4145dc271a1227b30a7eec0ef335d235ecf98e9922367a0bdc46240ba95fe4e9f46924d8774414259b182614d192f2f5b6be692d07013eb150add004c8537103eeb12201ba500da730eb2be750a313c6eae272b9cf0d3ea38a02ca31548910c58f48f9f09e4f362f4e48ac5f34d8c9184b44ad76dfabb8df18863d670397a94d79a1851a8aab484efba90d737416ae0c6889f7af8c93cc7c4e166bec0586f6ca21f3b5e3cbf31fba21114c235fa890b44d74dc1ffd8357c9c5686620137ee9088afd7709b3ef65e09c6108ee45b771f75527dbbbcdad0cc99e4c967b8e0459b2e157134e78c0cdd884f6595eaee160e64a61386df5e19fe445f6b37ee1076be4ceaaa87dbff8c51db9d9956d57203d8d32578f0255b7b0de1073a8bca0844b47040d8bdd53450429abea8e352ed3fcd4fb84fcb8d302d9063eb41b055138bccf7280b2a9e7836b4863d95f4c9aef8f52c58594698786e4d02d9d832d3c3253a0cf0a14b5d6d50a4ec76c3e9867898d60a5d3cb1f25b3d0dffba88d7183174919af8605b6f9fed27b4ac9f76ea4fd5392dce1ec484f8f0d5f6ef6eb98e7335c068f5206cad646cfa27fc7a368ebe4e4897e41a0d085a33c76f4d0f75f90823316a7fa61afb9e8bc5b2594bc46bd8e75d90288cf06013787b4bc2e4aa0ea3e1108d634f18335251afd7acc67755b93175d48539132af3b748cac6d2fcf965e11b099d13db2f6dc97278beca9dbe5db99ab5a9dd3471c0d6aac24f28f2390fedead9066ac122759990764f7f5697dee044cf7e754bcefa60c4ca2d163977b01f058945b9bd3b3a1e3f26f1e62809a077958d7b78ab096929f16be09c1e0dd9ff10866b5646d737614b68945ca803f069f4ba2437d230ee32d1ed47873ef5a1e2bd10305b53079d1324ac3ef3be3dbdbaf735f5209054f4a0646c095edfd01ad70013f909f5dbff1e31d039cb43adc7b94cdf9af46838df36cdc4fc5d61b4a19133fe033662535c1d57e9d1d55c7e4b0be102d1ff5868e5ef17eefc9a527b19bea9c0f01196ae5a15ec2b67b2fc53622cd45012b58dae21126571a362f1fffc862316249a4ed0a0d4c398f97bd94ef01d7e54d09aa7456beb597f27325964efdc78343d0355bae6f240ff36cf2d83869d0e542bb576242a7e3ed303743fcd42fff255f26e1d0926ead2187ed1dbef42b9244bb23cc4ba58d73528471abeac153cf5d474ef7d996e194c824e14d0dc4bd1f257219ccae246076391276e1404b0a11075a22826b07e351af3c69ae0879f6b34ba00a5871fc6672149959512559c761fccc48966f126bac0aaf630a3936082105b2cb521373c59dcaf5746994114ece7b6b4c12125bcaace9ba481f8b6bbdf179ef93d5fc4ba18a19764d0754595f1fc3cfd8b886ec420a513487430a4593369ba435175db1ff107ede57cfae2b566a983af8ce9c27819151913a548058ec4ac7fd60bed3102350d22617b8a8de439e64805b4ba9b65c8c2e8e7070d846377babe7d4a350f1ea61b1479c360b69f09222df5e87efce4091c1244e35aad26bfbc770254d9009a569c77cd21ee1b28f896f33d41b12cb04869649a000020f6e8b7f425cd6c0b60b31af8485ed43236e5ba5e61198d5622e79cb5e6db78a0e45c560eee3aba6a8ff0fff6c279d8a9b5f51f79d61c9cee68af7ac7fa93e95ad9b29752fcfd9fc630177866a1a4326599c8134382885b9cc8d03ffe3f59cfe24775e3d357ad368ace56d170b9c8bfeb1e544f278d7ae37c282280b9c2e2166b3bea4b20994b1b26e54bbe1012bffef02f566e61b3383d57456cc96e454323c20cc4b29a26b399db3de5f93442800e3870ede57f73d6934d457d11a1981ca177edfcc1eef1330fed274d86fb2d7f1c026b18953f8c6aede995a5dbe058cf7791d3f144920bf739998a69659e80f1d141e153130bab49caaee68915d6c8184d444bc4d5ae5e443702502b61e5aec81a39c4469ee5fb11a2ae7265fafb052240d8f03830dcf7dabbd8ca896d02f1b94e480f8350688c0e5115628cca81d7da8cd161b2618fba5f7a18e218746f6831910912af02305e6b47f5f0294eced6b4ac30d4c7209fd270ee6febc36d78a0b9f9000a5fcc7c67253656408b7000d614f637c788e4675c198c67d7a4fc05c786dcf26381bdf85255cc16a1cc6f4b0d36b2a8a5057185f6371eabd1bd25f928e7711ee594c6175431b0c5f3d5712867756bfd02ce5c2c38b4055cbfdf6cdcd56f1165ed27f8a4d1c8884e5398aca81a6b8a90d39cffb532439897326548312801c85a498b4575c38d5b64006994598d7959bb7e12dc08f2d94db195f5bb68ce02ec4cc37dcf930165d36e45f6199c4229dea29af458369472492d47e8267c39a4046d5102a9e66c4cc313f1d630c10e1e5d92a9e818e32d1be25411b418d1fcf78869ad0a8d6d0b64ece97b26fa6c47155d775c33323ee7f3027964ae27bbb453a09287faa14d734940a743abbca1c608fcf06c43adc9d56875cbaecaf3926b89616626b005ecf64dde6e8b89aa565c28b618a07dd2b322f254a0f94f54048a3dcbd2fd145aab967285df80931364eb1388a06e42d35c8143504baf9de5d672998c0b3ec90efde88f260e4644e7a6ff8a919e192cf4204c7f4d39614be49cbf4514d015a1320693516fde0cecb2553955abd7a25b3cc2d0b7e7aaebceed10da155b0e93589d82467d40a33083aba6637310a111d639b84c0b12c7e6677392d5f83ac8869198de3f0fc5787461400ec164d4adc4cc614d6412f48d90b22f7e6fa76e4a5e66a8d931269599ce7e6caa9af5ed7c6242808f9803e91bad2cfd67c1fb1c414db83fcc2485529cc4fb3e814869956a2514be0e43d18e71df774d47284f3fc2f221b9fa8f745de060b584b7341aab922f62079153d3d095999c94faddf41eb623556ebf83cbde7e430de51f69b6f31ea45404b82a14fc7da9f558a28be7e575d3cebe306c7f9674a8922b46929e936aaff5d51af0ea9452570de71650f44bbb323ba6c6a194d151fb3c94cb8f7656cf1f15da97a87b9df9bd55370204079724df7ccc19124410bdef94c5063f949406398382fc5706ad58c181d2ff60aab68509b635274eda5bb280e1e67a742c527bb4110271e5b35e5cc1aba128ec4505ef4ffc1af23223c1093658ab6b24e6660ca3598f4f66848bbb495861b3af8a3717a39ff2d33397149f95440c85e7fc9e3a1b37cf997f9fc2e59d0c0ad0cfd8640a7dbcfec7ec53c033fbeb026b1e046550a039b2da794ee838791166951ead8c45a66adfbb551fcaaca5c25435747d3bb74d9195380239f897c34eba7254bc36114521b255d418a1dcb33ca063f2b9704bdebc6e6b63ba742a8d71cb0bb29005ccf5593ae3804d4c40ede519c91560835c14f1426e46ed1acac33379b140e5bb08d32b5f666783c0c5c69c88852d3a6590bb7f398918aaecbcdf411f797241f867922a9b27f76cdd7124be2204f94f9ae2fd2c8f7fdf1c53870a40d5e4d8c98c43fffc405694eff3cee00d047ca2eb549322e9a4f52e14f8bcab8b38450d4cf2ef6bc46e6963d90e1c4e1f8aa4847b5ac033667bab4fa1f23c213d2d01d8416f22a3682397e11d3973a7331b79361651f8f7992b5bf51971c8ca69c8e5b0fbb1b2ceea58b3bfeb9a198c507450ee8d0bf5c435131cf82041cb5e3ebbb38eccf8d3d543187d18ad319d6dbccabcf837fc35e9b72175cd0d38178d186668ef59740e53ea24a25265543cf83baa02f06156377d021a91dc7a2b7eb3a6facf8f404d2fa4c46832d1d2c148607c4034d94726004827004bc1b76557e4fdf44eec7a370baf8b7e7d629735079fbca2d04d0f667576cd78a8b303bdc9ea6795a8f2cf0346aa149d7e3f009e090c24dbb90825f0e5da388c6d7409394ef9a9ecb8975cd4b51f705ba702d7d7051138cbab8d10baffad6e37a3a4cbe5c2876a8c51f8657bd543a60e1a7ca81d1294660442fc6b0c80b46cc4c0e4324236e148c737412dfd7e0584a53404695fe355aec18aabc2f468fbcf8be51cf88e00526f8adde500c35ddcc68175023a9da3e7e8d4d75cc2e4a13f272ee3f16f9d3b5de1f8f19430fd814713476443b4347f150768a061cf50cfbc8310ef82900a9237a43f4be9ca4b7bc5727c360fde6888e16a9639e67d46b00f4441123d8283e3af95ab52d3385d2ea6feebc1731173337f07060385bdda4edb0a84e799140e04c2c7e1ff0bae7fd605919fabab48c28c602b8154c993a2f56b3a9d41c5678ffb8d5af85eb28f4192974e417b32126db06d20c44d9e76587e70a4a73cf183930a6eccbb0c87da67a496e6ac13f8cb78b29e5d597cee6c995317de72afdcb3841b2cb6297ac1212d548deffddb49902285e9743eec368d39bad5e0109710b370187ec992cd83389e3ea66d5d428881584750b336285540d92be684f24a119f34361a66dd2e8efbf8a5955708d63251dd328648c1cda76927b804858873443232a6ba22f25a393e53406ee1411781b572855f2e8da6c79727b73229433d2cd52986e7198388586bfbf004abeb5aa1f672b6fffdb48799a27facf9af3b09fdad0c30b785c58b2e02fa71e69d4953f37b5707369f8015daf6e1c2a26ba543e6300e83b0434841415099e4d7f81c6cc927e16627617af19e84c0482c60c1bbe33654a42cc1e1f0fc59027a8d692fdd5f6c885cffd6165ddfc6efe916feba3bd6139cedc94ad46399b9f10b5f9d16ff293cc694a5e5a4a0f7c4ec1741ff0b0bf234d6cbbafaad2d8ddad029d6d192b3810901ce186208cf5a7c8c465f7802c19d1c35ec45c27b6c3eb26e7c52f507e2f85de638cb36f05b22da529a570cf53bd276f96abe7c65f53b302c9001b11558ff49c1320c11074f907b876b6925527b5f5011461fac9ff43f1895bad89456ecacc1a5956545266735a81f74fcb537d4f09200e1e8946451878c7d268569e79fca3c1deb966765876a4a678faf73f2053a75d83523be852a000099a32e19c2aeaf6ab3e0ae0b183ab08806bef46ae5751a3cc01659b48a196ed84a2ccb2678b5874653910c0f48f1d5bc63bd0bdc9baf58722323f2efb6e9f60658087bc5bb8eb155226aae8d09d9316376e283d24d84743e47e7fd078e07091daacef9cde0d8f80e70cce1b6c3981ae37ee84d0a23874fdf5725d935e2a49c626e9c518d280a28e912812b47fa2804c6441e67f6b8772d6b08d3dd4700c0a2bdbd4275f746573a8bcea615e1e6a870da9d36707b51eae862edc8817d9c34d16ab9a54acc2aa33733a2f76f568dd00d64ca009592f8bb214802f6f04a861f5cccd7c71a2f30a4a3f1d58dd751af7af811dae8fa9cce82f9ee3c58fbc4b3b9fabdf47060dc3890c60422d60348d5fab5ae486f662b601d204aceb3f0c41386092aa84b4556c1e3b548532f5c1620126cf02ee7856e5016ddfa69ca3d805b9a9a7c3a4a7cde1b8858d02eb1ef22e4799c70c5dadc39919c743fb77c620c88328817a1b50480f121b77a329983b1043fc8152924f9a6f097e93b2e6619ed1aefa0b3693f59237b4c73e5c6694849ed4868d9a1e366bb3e4c97439643def939d2cd4820b86dbea573b387b8a6ebd9155ff88ce03a0f0ad05537b3139a21a565c1665111bf77f715038f2f8ca154d2cf44cb9eedd70a05567deb51169d74c6acbf72559be9b2ad4baeb32efd5e5a2cad2d9cb8a2b28886d064b479614db1c7cd9d50016ed10a63d75d7d25298fc915319d168d5291386717b403d3fb7443914483b24be520c305db19dc096e8e7a601e6a51b4673efe81aa39131033f3a7cc8a94127cd892a041b5ea96c6c9f96f48a13c1d0bd9220355da748118c75514ca133e804fa0a0810aac73e235958cef43554768a86c0afc26db4e1b247bd2dacc93c5dee4516c63ade732e872d67de426a03959c0c8210bc440b60458b6480dcad90186b5b54cb7dc3f47a3b9a0c2f786c70508bae039aaed0047b65f806984606ac3b93afb542686119214faddb4ce0b91d05da55691ae8116bed2d5288c319dd3058e64be0e23cb2491032fbb27d19596c9091a43541a1c73ccaa205320c6985ae2caa7393783c8a1c15253416bea2c9628850e10e31eae2814b042b3a9465a414bd91061f6dc75d60ae7e2457bfb7b0ac23d8a0446ff0b93188993af1bfae09e69960929cf7ff3cea11b277595d88c8d3486e8e5f951cdd0637fb349703564846d6e78ef18c48a9a102905ef229946804f7f776dadfb6b8d9b3e41ea49e517a7247eb7d8aa7beab1cbd7ee13cde16a17fb21d298ec5d2ed1f06cac6c5ce32c8fb8508ad5e0c11c5877b7fc4a0f0a08804b145106f3a7c568861ab13e4945680d2c41ef370abbc9019cc58ee4f5a42e0524d8ac74d716824378cfa9ee4985c43812860526088baa0c19cbcab5d6c8bd1588d3f44e2d236502ecb244ec3da61bc17767ea1bb427c2ebcff16be44a2f8cd0300b3234fc06de4dad90bf736ad2cd60c3feb522a680f66264c3e4ae33875976577ff5b9d491aabb4e58a6905d14ce3d265853b6765914ce135e97ea2274f99748f733e1978ae40b1659d92b426d6cb514fe8625815bb17af0ea24ddc1a06fc07ab8ee24c11881beea55aa06eeed2b55d2d87ab2b9a68947777011d0373e542ddf4c12eb6049650caa173783dd538a85da0f682f1a7aaca534f0784071260ee3097da5c30d77664eef4d38b26fc39e3021f296fc236bf58a2bbb3851ae78ea11e440fd9c0030111aa39f7da0fd5dde19152791ca050d7b211df5d94ea7747608ee70e5606995bd7446f44deaa78010e80c058f0dd7208969df7cf1f586651a33b3746c8f31f081d1599b60c4947ce62eec09ae9967da4d606bea62fe5ef8d1bb27306265242b390ad4b0b06c168a5fc90894345817b7117742ea0cf7fe59fd0fb175612117d1ee971903cadefd614b5c335835236b68b3c954e5a5c5c9a80205ffb79d74673ede76ad371a2904f51b2e676a94803631e20ef6f8cd7374d5ec170c24ef7959c9ada17094f4ab7b3e324b081296d596a46bf33c4ca3a2ad10ccd1f839f1ab733f63d9c2126555d38c2b3352c415c7074ba54427007f0c9a42bdd6af6e7db82614537468f54674d249c71cc64af273a521969901bf4974a10e8f61fc346497059f30391e7798f1664c6542ab1c6d5f99066bcaa1c89008e0908c07575e1bb8d9bf95af5eb49de395f7689bbd8696e85ca6952dfab3b119a3e0dfa334f82f7f678c8e51b66a32373d0204e0d999bb0d7ec0fd12fb6da4be1773f82e7ac60a836b51440d5c58dbe0f64e930f8ba6d02d7b2e3789b6c32e56bf74d8854fb1ba9abaa0cc8b94147762048cf7765f4346a461f88fd83c7ca433a7926a44b0d521aaf26d8a43e06f9ce2e50d0fbe966c9b908b0d0bff91a8a02211bcb7aa7e564d6c2103dd99dc6b32cdc991d4190088aa5e467fc2b1ecb0bfb6193846a6c47d1d985a3711c7cf4e4830517f51e88bed063870387928be8c6c0cbdb9702ad7e52db91295ce39c579337547717f92936a0ab305b64136b01c6b8e2ebd2118c55b143719279c6d9d0bcd3e21126756442bfb425f2b198088dc495908eb5072be5b13c24a8cd200f7e68b62ac1aba7b23a28cd7807224c51a198607d5de4ae40cba1f36e527339efc10ad144b79d9cf1b51bad231767144ec769e997ccb2c703ddd88e1c736077fb34a8c7e0d94b935c30e131a6032c202149c3d231cd220c09eacfe65825ee1a0861c26099dca9c3e626d61778c6786ef6e885f4ae1817bf024da450da500b82b31370901e34ce732f7049e03b07798cf301979a9f79a0738f71306b746db9033f335d7e3302600549ce9485d625c61c2ad3021a69f7d4515e41c1c0bb424c97c395fd18326e7334068a18e3f4c73f42f9d1f6958467d253472ccb9eb7f525fd75d5e0fc46f5a3b19a90a43a92f55cce0f6343f0407d3007b967fbf39c6137eab105cc41b1e57948fe8a0a1dc5a8b16b35d0c6aa5c5ae757b03e40edd537ceef38a220987639840d2678205eb51157687234de302b700ce3e7ffb0c5a335f2d3b322c2187df9c0c3effc159010320375409923b026fe9149a1e55fa28c88990f4d68b98883f9551aeb5b948bc4cdeecec472b7ac7704fc6af497592e21415ab5407ded36202784d09490fa2d57d684ac438b8ea2d36bb6e4feb187f55b67cdac15f9209fcd064757d9928f1e9de04e7e75c068b45bda28df6cded68b17d3fe36eb4e8e022bda6b52db7a4bec3fe1b09a2114f0e1603fdfc98447fa6e03706a19f4ac65f1835cad875c93875a683a56d39c9e4732c92d329d726eee9409edbab52eb3e0e9f0ab717ea9b2486ba20a334a5c2f509f9c01a21de790195ebfeb66c355f41a1453a340111304dbb12c18a48de8e5edc39ada37c8b0097c89214a5cf0e9866bcd79460185631f5e7e4496d3e0f87ad69ed141f01fdf5abdf5df233ba6e21d3a0f608a34056f51050d2d25aaffeda63d2ac0b9ea468feb2d36b07eeaf021be60d794ddc03f6067da618da4d5712df4fac39f73f0d683391994f64f1cbd1d1a4d9c3bb8b73e01f1541842079ea46835f80040e824a937482e9650d1e7537ae91e5d828a4bd7efae9f2b2e6f1d7d612056178b58fb1bc95c83c69e14ca4740846f4a297d379b49ba5a9d66052d92986e06c67d5ef040cd00914094d6b6dff28e6a6a4b6ff137325e3fa69489b75dcebca6dd4d1b9ad8df8a8bfadd24aa7209697aaa4ccf29a3b390532b8ac3a9fcdc6b31f2f750a26014166244cf240a1ce50baa971ef73cdacb73a5c6494f1d668704505871116261d38deb95ef733cfab269a9c4de92ff836902c62609a4375daa5c1c0b3a66fe5740ca53ccb9f3722f474ce6abf7e35979e2a340dd669180d5d93d798661758c9d8897cc6a21f77a69cdb3893f75674a2f9c4e035f19e907dcde3a083b6fb2e459cd2059f4dd27c874e1caa89b66bb09ccb59d3d03240d4134c1a62d28dda2046af3aa22097f6b6acfdba53c34a8b0ae0d3a6ae5ee69f9622b96fe52e24be2b08900ece3069004348f615688ba71352131db33a1e204202de90259d3ac91f6d9f54268b40b6bb8152894c091d7aa2080b2cd27aeac49812f01e3de3c9a851f65e5b0e40d59f3a9f1e444942dec1d283777b725089ce321c9395a2164dcddd376dd5a9e5bbfc595848d34814cf0d95975eb3d6de6eac89ce030817b8b753eb32fb46481ae665ae1cdd4d68ccbb114eac7b52dd4620b20a01170618e69fe20bacbb837ad63561967b85de0b75dd043a874e0718b30ec6719b50b8229817c6ae97d01038609d8f57541e7de5cd6d398bd6ff9d06cb390efaae44be196d9522c0f439f224887fd532d42dc3a37a93e042c28ee9c3c8051525d51ed65ff501e4b06641e8f3a194d4bc3c702f9221d36aeda97797b41b3133374ef72ab2686458c70c9d9edcbff0ff37914e0ca72eb46274840d9d0b222d79b1003d8f0390bfba4d8375c9723f4e92ec1a9763b1b0bfc3e2407ab0b851b293aaca8b5bd62a344c28f741bc413f8971755debe5684afb2c1a44ce924594cf913692380dc4bfbd9c537065cb177156c3c16c5f87a4a34179f441f8fa3e7ab5e418fb740210e5da048f8bb3f2c78e09ee225ccbda0c50d36281cc125b6f1e5da92a941cc1ca363a1f9bbf22462138af5b4b330fa02c923783c201dab58ba5ff3eeca86b37c61f255138cb83cc23dfa800e8b5d8183832cb5411d7c5a0c1bdf8b5ed0eeb75650e2bb150585c3423a007f2c918a7e990b7a0ff6eec2fdf57b6492f18933eb6026040a296b325a4324c13da39a3f14a91dc0d8beb4c38a4ffcffa6a4d537afc5d7f8456f48d23a4aa0f1ec6ef9b3cfa5fbec7b7d5a78644a4c07d243aa76095bb140614ff08ba725746672c2a09ce58c520c0114a4a7ae2c00cb8ee9f309da56e87344cfa7159417ed66be3d78026abf16eae263d848fa5f36f41f33e314c3e7e976d009291794921a454974b345617e7ab3af4b31079203e382afd584a6a509985277192880f8feea5ccedc5a5a5c5f8341c1f766d701081b3082c2ce324ee9a18a437c01e08817bc95792caae6ca77507d9aa0d4a73fa8fc2974685460d34788151fed3c3e5cd4f2d793abddd01a410309cf877ab86c87ab21ce1daafec438080fcdfc22816dcc0a7af86ac9ae72bafd9246f0396da237e9fb7dae59257a3e416faba71f90505fe66f34529bd7846a8f2050188bd3217a3f6970e29a09ecd8c20b9cbf2f96e920eb6a9b93113e5c408d1abe3da9e966ae879814d30a7b5bdce9cb28b28eedf15f4d45814dda4a17bce042d1b48c87f9d19e30cbfb16943120a4e7b3c6b48d7729dde7315d99b9560d6079f8be1c1f1248c1d264a8c61c0692cc0b096fca6920308bd3a26ee88d94693c10168945927018b70b9f36c67588cd99d1ac932439cfd7fa50b2170b59f3e826d943ad9efbfb2862be084405f83c9766f1294183a76eb94ba2027b230b16ce27026a606097a5b6ac31800379ca6efbdcdff57be16702a6890a1371943810ac416260399bf219f53278efe3b0421e483a77b84abd27edd86d9d7fe3c1fb0ce4ebda3cd2d2524453681a93982ee2ca33810141387fa7b55a39f4fd72b4c8ce799c5bb0cbf3ca25f0ae4c71bdaafcf3696a8f05426f43e53af16d59c0011880f8869a47223ef77119c572ba6d627a4dc95777cb44b580c96a7988c9d80e1f629d7f3ced52cd0d54e9f0d7659c641f09243a81ab8c229775ea1978cc569a69a4f92185eff9b8c66c02b68c8a9debef8bc5f2bbdea5ff0fdeb44f9fc8fd24a4331c84a533314daab0bb57771a9ca948c19fcea01d8103f8cf5a58c7e2f7f4580417e070939c32f5c51f101619ef9a613b82432dc0ff42a330f9769939f44bc99a3243b2cba0c3ed2afed509eaefffe87d2bb083a6cb1c644915811484afb896c8ddc8574f467ff73b3b61c028a4049dca4e6a39ec06155ef15c569ba809d45c4114bf2e0e524c29fec06dd58554f3272378e26d037058f29773147812bd7e82a5c49bc0efa392c464ed9b5aec8d88e9cf2cc72b1c1445090121ccb544516d788f8b902057ecedc538471b58675129e641d84235152dfad26b7a180a55269fb27baad75ff185e14e21f516b3368ecbb95705b0986ad32cb7dfb71aaae5393bb064cdc407b3db1d15a9b586613449ecb9fd5e15d1b4294d2ff181cdad205a0bf1caad59e70521ca7044e3ac7e167477cd8fa1624291b3e56766d7da7912e1a4f5f720de15cf4c295bc7f6ba7c9ba10e4409e3fa08e42e35f62e6434c98762d4490773f5b37dd52a59d444ea2fec86b2dfffb3ebdf24f1394a82c5b90ec7f881ff0dc62b044de58491dd80d478c3c2522394705bb47bc65cf8f7fd46c76bb933c12629d20fa344a7c06a21d17841185813311276497fe672a2af954080b3b214c841e4853efe5145f7c3458a61d53d2812a7b55f957b65c342d52d6c76ab5dc6ee96084e58d6ce8b5468bf1c7b16422af5e00220537c09768aeb4c6610053eef63435c492ce0c6fe999876659c7982e1322d2c91760f626951bf7635df2511494f503dcf35fc8c96c649c75f265ee612a211c96abcdf9281261811bd1f2c65baad3583cfe876c101068b2137958ba7605411c3737c1a58f12526ecea9df23dd5269cbdc5bbe44c80d5f1731f62ab33651b863b70ab105d2caca69f8d5d72788a112a3a2be5c2a12e39012737fd7afef695fa50779b7f22876fc6840f88724483f41783342052246fb11dec91dc621a599aad843f16fe435d075b6936f7ca54d4559e09d13863a6dc686ecd716cbd4bc0d9fe56a5fa4b961334009e8d5a0ed005bc60687a376d396f8a69c0ba436c6b4ff8e1d5c5595e70f5ed74a5778f448a43dd4589e6eea1cb3cfaa3965dbc7bdae39ecf3b137de70c2d4b36be1d71a1d6daffc8894bc436437bd8965fe52e7e2913d8a27406054bb47a1c8512ba16bde74dbc6fda5894a2a64de424412810b7b2c1c9ed415527cad2dd88cd098c3c66684024feae2eb70e30e9ce0d90ae455d7661b3c49b3c85265ff822235057eba1f6479a5f0a7db13a888ac7bc1abe8497d58f4361856c6afc39e2d5d770cf47eb452da891745911374bcf27aab825d90a97c9895d8eb13ff64538ced5218e631ab564bd7653dcd09ac973081fd0956cbe33d512ccf4ec163a377e820a1b01ab98561ba446e936c7c271b60c599ec7d9ff19b0c4e9db788e40cf1a3732b1f5608e13d7c19d655d252d71203f380836c6c7a7d1d6d5d083315c3cb870ee13a9b275c81ab606813b8ff6aea17572a3cf1d4ffd9f5255af0948d0c7fa576bab99c4d44d9866fc0588686dc04057962ca4ef2438e815b49a5769bf55f8d64f9c149614a3e6e086b020dbde7503ab3771de3e158cdfa09f272ea55815f2cc318dc02b1103d12674bb0450f38a01cab123de0f4d4143303b5baf7a8c16f5344c4a5a512901b6c6ee1011d219f2843fde766f9d3b2c4fd4a72ad303ab7d00fa4f7239ded07c04de3483ca0023f290dc8ccea0a9d2d2ce516ef8083e98f6ca57941b91297887caea8895b942d9bdb5ab6b56b17178c3a34ef03bcb026b8f089131f1339188573f654f51cdd22def2233b51acedc0b93fb34b9d5ed72498aa027a16d8210e1e00648e4ec52c34250688b6e79331ee2faa6835f99e5f2fdbceeca5d8caf09da909c015188f6f1e9586d3292b94744a483cf64d72147c465806d9f99e9beb16b3c3dbe56c119300ef1116fa7a80b0eb0a7fc0ce4b46275454803d11c5d2756a0984bf14ca935a1da76c85da55e04f6c312a5f2e41585fbe37227265e2e96fce73a82b78f32e01f0708a0d649961d8977875e13eca86e21e7e7b48febead2cc44b7c3359f82b272e5fefd831c61d01a83afac6b42983d9de335a10c41ed32c73dc2c2b8e735df1b66011e6ae39287374dc1faeb544dd746621713d15e40a95f77fdaeecdfe0b0ab00c97ce2d3494e9153a3d6026481be8e031c6173d4d74ec881f9fc47615e4c0e501895051c1fa99a59043627cb63735615f165baa549145e4d68cba054dace94c14dbbd4530324f361f622cbc457bd37718999a093b6a7c28d83214008ce5aacd36769497490aebac97b751ee0e6737b9e6eadd09a784f7d0adf6c5922976352924aad17a115c54ffce63501fe47cc12a1328f0c776d09ba68e16184d47449a8d71fde1d20e09a0aeafb19584a8f4ae4fcdb95d204167633a984024372403f2faa695c883ad8f46bdb92066a779032713e0f442e86e21f0f12a822f03aacd9c0951594da5b75dd225b0ff5aa882a6b8d9218f8e32081bf799facd5a7ebb78e873b9171bdf54c8b5874060b45608bf84395b985127f980afd03810f9ec3e2ee26b16deb1a6743eea03b8d81745579cb2d1d075a7ec59bad34c75df5f63ad0cbed20d7d626debb982fb3d1af165f841a56581b8da6b1505207ddabb1e4087c8ad8409ead7d7003d53ce624843bb58d0de424edb0b12dccbf1cbb2a0b10a80dd760dfa3ef9d65035718a542c4d5d7cdc7d93b09b23c17b3ba8810ac1ef969c2de3b51b553cb2bc9fce6d673a6f158a9a8f35dffa3956641a5cbfcc3627320bc81b1f5a4c9d778a05ac2cdaa5b6c16b45df96cfee49255b2f05cba581d01d1310a07591f5df871c7f631e88b4ab2a815c6571a52268e5d5b374869b61b243040892ee0f7f7f316d4c9998d28a30da3c333b25fb3bce9679e88b33fdec3108304d25ddc3fb80ba51463cd09b5fcb5b07123fb9f3aac19137743c0105c5a58c3cbcc6e44aca3716726b50d8bcce691b56c42a4ecfccddaa8584001261295c05e5034542b7914654c1e7115917872c9fa57f6e49d5dfa76c2d58e42ee761f150ea79d73570a211f43e9d211dcb24b02f5938ee04bdb11f521b4b895fcb0847064bafbf3d4254db7d0b4e58523f34976d20a1c1f06148cda9bd497d51cdb5bd8095ddcd48d684f332af5f2f9c4e39becc4c081052d5738f066e57332ede4253a5da9468e81b092e01253fb093016b81477d86a4dc9a069a04128d7e4b477ff6003c3731910eedcddb9c5293dc1c98cd26796f5920af4850e34f8e5f5411433e341c5e9cc3f20a7209982130e4a146ae36a3c91a35269a48e5145285646a6ceaa8547f7793af4343ed9156a5f5e7713f1c44c943441dd85671f38fa0f315aea9d69eb5a3cffece14aaa8cb73254ffcf531c1c5da4d2ff4e7442476f9ef254123972b565475c8eccc5abd10044b5bf147721ae8a005a451669f5d312f83ee6ec7f1af4441ac879ca37e4d9c9dc56175088851cf2651156a8e27a58398d2f24922125fc66a29fcd2a0a813731747dc35333416dc19071135835b2e6f2817dd08a5359d161a5ebc9567a48a386bf332e7f181593ac1d91c13fb71760a8e11d2c4b60128e44e4f6dccb2f4a51770ce34423e9e8909919185be3e228809f90bd9669d01a9d03d74f712641f2071a279fac7b923ae02baaa0a0707b550aa472c9cff3a2b25b562e4b3743babf9d248f01f4b80209abba83ae53be22b909e803e9baef0fd6912f33a563eb51552d740a2f606a24cb5a74917b00288418d1c3e2a0c507d89ea6524a8e83265b3f3b423d824723618ca642071d5210d30a5213240ce7c9e1363fe00dde1a39f21396d9543d40914374fe3086898e764bd9499521fc794c6a22350a684cf70cfd520558576bc8a7421279e48cab699e2e36916d751df7d1a87f46f4d436799205a90ad7c6ab5e36bbb94d0860810da896da8c4a6157b7c91d462b751727e351fb1edd9fa5b9a4a9496b7905853e85751391f1b759d00dc07eae29a16313a0bec03977b6a39fc3cb381e0e4853190d4ec1e77e2b49c59f93ac9643681df73e02f8cd4747022ccd1e10c7f1237277972d5d2b7c8f5ddb741e9b278bc191a51d7d3c34969f89e6c9987ed9109b1f178bad774c340dd2817651d24f55f974bd1690f764572352b73ee6a3dfeecc539ae0904cbe1a5f67ad2d2481192f95fe49ed23ae50740141eac6fde13ae91e0f89d11e80e1030ccb6d120500149cae091cde133e47c408a37196151e4b33bd6f18c35bb4610597bb6390b159b4802d298b36db5d9da23751ff3c046f1078a1629dc1587b994bd706394f2a92457bf2a6a6a0484055f17c93b84c78a024090d827264ae632072f327936bf7f0b005b7a14a85b2a015abcbc7f2ee052642a94c44dcc36081e20b64ed3438a6dfddb5a1a6db114ca39311a2c291258a7b6e6afb67d52de5bfe92053913993e9a4a2c6b853726db17c42b6da8bceb7ff817d5a7306081485c1a1a742b773b43398cccf6fb7494f2aaa351e761277265432dd1e1b1d32ef8cc32e8e9d99252aa2c7732a69eb80784355e4988b3c48f6b112c7b70560be0fd2c65d0e2dcd14d81c8e5e030a8d69b98f375f855d0b93da66a307562ab5e2999c90f87adc2b3bc471db9913f20f29ef29977f82c39daa34d105ca5fc78769e1ecb839cc138740b8d62aa7404ec4fccd51440a660635ae595396a9737bdfa4cf45c91c2b9ec901db5b8400580da46788e5fac1cf17ae70f48a9ff8742cab6b536c49367fe922651a12630abea2cc38edccf196933978fdfb96a3acc44b35047685ad529b28595c9e359662b497b0c424d29f8352768e84b8b0c64a13696588639802d96465e5c4360d65fd2ba22e188e26a18e29b30a13b7341f08c17a9dedca326f21bc4dac800a80bb15dcb1765f6f9d2610700c399b0d099fac9c44793eff322dd7668cddebfc98e9eccb1991f9fa087941c41f902fbb3144893f8b558a1d38708a4a9a79b452671e454b1591d7c89b4f9b1f5e4ce3038fff3d1776a4cf9af12e4ca9ec8249aa75af4570474c3241a76f82b42014d45d2afb2103d27117612fc8debe3cd664d83b3820a8f82901bff3f68d3e71cc76fb15d9996a011a1d503031fdf25e003144bf8e2b49a3d89ef2e2306acbcf8e6896220cd0dafcbbe1eef0f097fb7aeb2cdae4bb8361fbfa15beba56963d53e4392c723e65a2c8ac19c26347b86180cd914bbe2d9e3f16d8f6c06b5417b7f76e05dd09a89802e99732c409422fd5859ce57d662d972addac1b9c024038c1dde22667b826e84289e5298728e1add4c78d6c235b57d9fce09c76304196ba445d9487f758a416bb8ef69d5aae6045a4367ea2990fb1b3cd3f98ad2cd82d334bbf1c985835bfda9f84c6015e0898850bf82a85d45d88d857c9149da5a4186ee1c40e998a3b4586d9803f1e7721afadb3640de5d4a3d52a8c0e98cd4e7ecbaed2e388d8f1edaf3658d7fa60e385df9bf8b8b2ec6636a99bd6e3b70550b6023a03982a6a3b0f3ef0c4139250cd02b05495df6206dceac2bcf4822ee6f8895368b8a099869023aca3e354bc155549e9ff31ff0d5d196425b65cd1f25974e150d867b90972061c4b51720aba064f683aea1607e19e44f1228eac78e803e87c5d7e9d6274d48c7532822f2e32662d0f828a2ba241f33f892c52e7c1bb1a28486486fa84a94c3b7e3136bf07fdcf37e1345e1cf89e5893c19afda0e710b09ad857539b01b90578788d7f542dc36306a9becb4fbbc061c3798cb2c461c3ebbd1e1b31455371788c53d292b350ff5c8b739b18f6f0e209b616831291e3c8c532e0be23d65d10375530ee24c443210f4cd86ef7f84c088d430ebe49384a87bbd05494497236bc0d0329bd8456d4cd62bd1a7edaba180f5c01e0b379afdc67a656db6f95f57a75ed2e44fcfe9287601c9ae4cea2771b38c874d128acbc4ed1e983d954e1c1361a98954ee8c31bb74a8fc55b8cea2a590bed65a940e73d17a49ed70d14d3ef0a0b34c0359adc02ab7f647032099fef05ed5cc369b0f3148593ca07df14701a5bbbf15cfb8540dcc08801bf26676a8fe35992ded3868539e0315a2c3de71beb96598dad87347288c4ee17a4a1de6b94f6f1fa613a3571b1c48941e031b80b5837b934908a7ab78b9c33d2e34709c763068ec31400c7aa0addd3155736ff6b371aed7bb98936cac3c698a1aa015a7431fbd7aa9971737969b5ba54339790bdd978ceba8324c067390d22eae22222e0762ef1f03e74a24ed391f697c4c7545c17a5be44de7432e953246929c1513b2b9ff7888bb9287334b02836028fd94eab741f811ea3c1f317db5af7797e37b90104654826608b704936eb6b313848aeb12c1f0f3ee8456a95f69a28240739d866158b6dd7adc6452fb5673f8292b2e88b1c6fd89775cada58387314cc5079b69a33af146cd6dd174cb78ac8048f8a877c3867ed170a4fc3e3f26043992af691ee3b61cf00f1aa72b79eb0eb757bfd6af87456b836ce282053964932c4f747de13d34dafb3b9d07cacd2af136e9aa32460b2d41fb16111abda8d8f157dc20add49ad19ff80f79590c78b6f685fb1697918126267d3327342cb50db0bc5daf8543b89713ccdaaabdd1d58fadde86b07ed528f94acd4cb4e01c2ea4388ada64267f2933801feecd5a5f2ab6df43f7ecbc24f13e5b114c29f31b20fc4c459481784d4f3dd9a80e0c8a2158321c1a6184d9df88d58d8ceecad4eb2ba6b1df0f1e76c726145c6a5a281a3ad2f1b5a441bab9dcdc6b9c332a657e4d36c4ee77a00de8460f1cb65063995e768c5b9989b6cf50bcc619f678309bf97576d90ca434bfb42ea80e7c9dfe97bfcecf5a30d31c9cc6257b03f9c8d810105058dbe3b7749a301fc93d19ebca91ff7b488b6d54f5448f5e8a85c657e2b2cf8300dbb7bac34a245ae52a5f419724e80ac753d7368ae6f7ba0873ee4c591d129fe37edad7cc609cdf406e93c50d2ec746b3264eb4907881b06e5c1d959a7dcd6c360cec3e53fa1fbbf8507d9497ef340fd8de5f315b563e1c8e7fdc4ebf3e53c5ed7689f2cbd26a7f3c07433171a6a12b2a7569e034446e5ce59a206ef4c4f831defadc7a8e7f674c137030130c0d88bafab7fb2d1501e0a4f777ce8da262e52c0c9c8dd7411b0afc4846813242a0021dd8bc27e2894c67fe3da77700795b97a30a95e7ea60cfa7ef694c918c86907bf9894325fbfd1465cc9a126928f289638a78015423076e8a25f7605395cf1a186e89948631a31c21efe23e8e748aada0497b28415d593682ea83f8b16808bf3950964012aa65be933959dbcebb5b76d8e2c0007fcba3cb182260df995c8fa46befb4554afb6dc2d2dc1e4fa51e59fe5656cffd14f0da0e578e6d8e32b4aa764cbc1dbfb9ef6e309b1dceb4484cc14358f921c0e373d345b6ad059e26df1e102d02e40af7ad2fd533594723e3d00304e1abb448cd3784c2695eb4cb8c212c29859c45a131db05794033552ac9ce272e4c3f2ad72c584934f7c5d6b2e0112124c4676918a8baf7e5a10f5b4252acb902e619bfd6e334c94c7c02ff1025311f1c77f3d4c2c4b21e2bf768d20d28eb335987f4117560889915e0613c1149ad1f927896a177ec88df653b2754ad0f0a8807b3be93081d619aeb2bce817e8aa10670f308c717945ab399d88bd2c75bbf86a913ef18efe5cb64d5a2cc0d35fcb815c8eafab56eaac2a30fbfddfc2d534f858dc04d2e457a55c5de83086845b3edd50916e995017ec5549dc03c0a22ac21b202b7097822036388cdaa51e4cffb160eebf9540a26a557cff594a0de643b1dc519f6494b9a84a3fcfa3edc1353cea1ef3c0f7daf7e050572537b460943de6d851129eb24faebb6860a9627927303a3ad457e287da38784f8dfeaedc337db0c77c6b3dc9edcae14ca22f5b2fdc141d4c3f38b92b9f283ca311a095440cf7fe9d8b23576221c4c45558d2fa8cd403ce9119a5c76114ec11a2d20ec7e29997b71dca4a60620e39cb2f9d37602aff5f32180a5a08930ba325e5b66bcb83a26aea98e1cc016adcd6022b1234145f296a738775f0a2241bc5229f476ab2fc0ee5e7af21a0e7b46f3d63ad1440f60f8522d94cf289d6c05b9a215ec322ce391c050adcbb36a58889d36b84db52fd46dedaf4d10b5fa6dd0d5ac47320875331a3ed5f1e75a7169cc467144663fd329f81d1e2706ba8c25e02653bd2ae15b6802927a9e3618c8fb3b4d51dcdbe0d7ff14e86e01f56fd276e349ac039f069d68b3dae0d351cc0380852d5ab2668a074b50f8ae8ca7606890d3e262ff874a84edb01100f1af276e52370169d47f5b63428b7fbf645cdf97c9156f7d9e60d205f9353cebc5d3b9fa91a4f197032b7fad2fbb4a38b1abc79f0545a2c173394c1003f7d59c3c7aa8ff5a4b2b727d64cde401f34f12641816ddaea5989f6bbd5fe0e3c286982032b7af8aee56890524ba9ce208c829fd442da58b4d1199a64c76adad65de2b4b8fee85d4d6b092e69d6bde3be496651eca8c1353fb5ec74300a7d5b253354aebdd8e699838d169ba3b10ea5cd87f235afc40767733b1f1a4401de10fede33c74864aece9fdeb3ab5a168dedb40b371b7fd4e8652c6d521e96d4e4a364160927aa1dc6e56f09ab360652416608e348444e199cb1af06b269b85cf7c57ed7190c4d893eb0cae8c84014c1ed89650329a900545ab90f406e458f3c7cbb920e43fef2b67d49b3f11d36384d6c9a4d4b8bfb047d6ce8a4b3a07432bc1e72a5452a4222e043b15b91360414dbd948015501217da7cff7b6a439dacbc33e1ae4b1b7a69f7ec563e39a6afb15616821aa9e712a78e81a200e326e4f2618ad3bc884b366390101fa3ef2d45c96b85097a20330d1a968b2876ef3e104d956c07bbc04b19065b4afaa0dd7f94337e75e605fc54a0fee00eeab98427c0b58c5c7aa621f727511ae58ae2efe333ba55473b24a399f202f0d6cef12074533f4185a56256ae7a1b7e5d4baec423a3540efcfff5bd27a07e79fed854e2df7895177d77165d9902a6246cd8d2e0ba99fb57398f93f08c8f791f1e00fdb608c11daf5d279da9082a23442c5f88c404e2fa38180b367ff1553ed8fe4e6f60084552c8cac776db791899c5797145a4284a04221a242b92f22fa079c03add219308598013b443f901512b46534bd6df4458c93d0678a03b702d76e01afe0738d2c360474258833d6f3a0f1e86eb88dd5bdb3b6fe5ead4faf2bb468ea7ea1f615eb3ed744d2543b574dfd1d986da64891368d998f3b05d1fc8a6097a79fe57fc5c45ce0570eabcfad301489d0f0f1a5916492535d96ebfe6e5f0f95bb8d00d7aeed3884943ddc1620fe04c1ea55bcea08e6a606f311efaabf88220a8f4288b1e6d322a11d3fd9e906c039c51ac38c999cd5dfbdab2226b293dee3258187a0c51156f1607267350bcbda4eba353164809b884bd2612c16f558e5c44b8d1aa29f7a9b1052ea0a89eb36b2e9038a9b4d83cd57278b6f496a34e6ad1f557b3d241f38eab6334e3bcfad7fdd80f2da289859a43843de776d1f22ce5ca1d01dbeeb2c91736dbc0a14c89b8cfee0836e0770e38ac96b4d59fc11296feb012eb6aabe09fac197c8d3c146225b993389312a18dcb238929cf22c600c3215ef259a2f8c1d4e5dd5603719bba7d5f6661c982d1267473843cf7d79385d07625b82766b3d9b2324d22358a1c041dc04514f8ebcff3a54af2faa169e55c812fc9bc9e6f32eb36aa15a5d48e81fd6a1e1880abd00e3929ea2dc20f183cc5ea59368a1b87be23c53bd090ffbcf8a15d6eb4445da05025226a9ce62ea66b45656b99a41e9f96ae8673d52a1dacf3f9d180fce85528c0cf2085f5dbf315b24bd1a9dd6e773a2722fa47993e13db5c1ad4614f4345c57f8fee92c5b81fd71b137fc7bc09bb421939526e4d95aad7b2dba0708d7f8c59639edc36dc47f154d1734d6721a00b6330bf356b8be1940f179230078c8a26ac0c2ea5567959628ee3aa8c33d215c2eb047a4f7cb3e655a4e4fa74c1cc586ea169cc01f27a3bb08b7cbd97c9d79f8bb487f215220e0c1144b26a8831f91c76151fec8a683edd78d7838e5e510a7473c27215927442aa47f5986581b4afde1b7d1ba9c31a57858b7f302eef1035e37c9202f18c03b8cfb4896fd49e32f765c8982e8f9d2946b7310095670ea0098b1e9b5f765a1fb69f888185cfc60c692200eda0c4f76d3ac82cb23301569c1671a56665e9a5a198e1a8168ee76fd55588f869eb42c482077c65c4f8abf024f86869477bbca2ff7ec9c7775d676fa9ce5769edf04da17a0f32646c585607099f312887495e63bc8bfb9c9991516574c6d0cd38390144d64a2403355c02448c2a82a66c19fe2eafa03c75d0c9276b67b264302eb5420051055446d24a52d6efc418be24235a8c05b46a133c814750b173fbed6554235cc1d0eb870c495ba024f89c85d8fad19d83ff807417506fd382cf53c2100ab071d9a73006d9d65f67ec1acc271b546ca3551c675649e9eca7a314c63fecbb52f732f9ec7d8b01435f79bdea59bc69e602eafab3e6e310b45181e81a874291a00606d309c80059738b0112e672288a73c74ce34443f702e16f3a2e8973062afd4842f1032e3a95ef86ee56db5dbe3fb998c3752ed4c89d05ff389e50eb90e393392d2fbbeef85364a7c62f2f1766c1b41d06311e853fabc1d6638690329610a8459e39d4e81c34ce44574503bd83096dd1d1ed6ea3e84cff0f9329f348b68d6a35ae2ecb76f4143f66f1e7ac254295a0f80cfd56d55d64ed80d01a093a6d70d8e7121ab322d3310d44ee75ad96b45ea5cfce76a7db9147cf2935cb28699e77c7fcf310c179a2c4b91d52196bb850260489b3c6c1837c167c2f8c345c40955778a81b54f4ea41d2a935bdf398d2dfe54dad0ec3c52d3bcf4b2facceef2d858606b143b127e69d843a0d17aedd1a26116ebd01560fa3032e7fb4dcd8cd750fb39469259b49aee7636ca15cc04069218763cc22f5be6abd4d4c0fa6aae4ec33787146fc760598962ddd280e0d32972de3e6df0fdcfc775bd32ab2001558c16ea0a3c02d355d5ebbcbd07e5f3a5f28d7534e95fe8d687b17edb4c09d3230ec056a0e53a92d6149b9c6d926eebca44240eab8d491972fb4a29ef66fe43e73fd58b1c25543f485d346ae25b20de66bb26ccc43aac05b2e506b7f94731d174e363103240c9c811fcb6638b8586b58606a700d1fbfc65966b52da15f6f5eca10bab92f000ea03dd6b1a05ca776938ecd5ad15a74787e70ff42f17d06d911c6af54d201e02c0e4ebb2b008eae5f9f2aa6dea67c152530366b99785cd0f7c139bd763116db1078c28f365b0b04593542876bb77b05246ad8a089e8961013bb9a7c97724d34189ebed661edaa2f5e63daa5fe03069567e599d5ccae491c7f1179c2be808a1c8dcd796e3f81ae2dabe61b4e169fe16c2d4113c98624502a99abb350bed7495e16cdea496a654e4f37cfbae3ada518d14cc52648b40ff1ea0f16b2390c78baef039ee30ca87e05ed7e68f43354dee2762a6e262fe72b7a29dfd30d9a1967313265d34d973fbf3ee6a5dfab6d04bf9faf5e63eb94b6814913c2c2ebfa9097adcfdca91bfa4a7cdc4ad6219b897613b5d5e02c2891398440c3b82e41a16ee39252be97981f8082756657dfe85b2e9f86cc636536afe68762280312a2ef0891e15f303d04b27aa54bd856d6bf0f309b2e0d251f49b8db4bf12da804d05ef184b3b0c3d15647efc4d667464f3852edc0025aa025f6edaa0eae1542a197b59da82341ac537fccaa878cff5eb74666b38ec4848020bbb6597f10e33013a27f91f5f2c4b6430eeb74c940ef35a190776f657e654855f33ee6c009fbef33e7f353e1cde302e09814ba6cf636823a684f2d806d31917c64ce8ea3b19b82ebe1d5bdd533e4ec994d43699fa23c3ecd75e6678f0c407871a41c0f5db2573a6a6817bbda37e8dc99f07ac34058ec4631a3fb878c5a8be251fb16f7852518aa93e73411a6aac5f754f3ac1605dedd48d09a74108e66e86fec53b841a3cb0d48f810dbbb9fe27b396ea2b4a81ae7104fff2613df51b676787a9570d3d52a9101f6c0eb188a24c29daa0b655d8a2383b82ddbf51d00cdd7842918461ca3717e866503edae14cdf2cc67781114f7bfb4aeee0a259060d3fc1c866de7ee85002c4b42bd69baa791d928626bf92ffd201b32ce016f9234cbd03189cf17d519544e9e1179a85ed7281673bbf5053ac9a973b8a58d75baa41d681d37780339be9bd78467138cfafd8e873e5230e778f401d7a3d9613e220939c02ba5d90e9e18cb72344023272ddf8bffd12402687ed249d56e5f8dabff2d1aec4b9b2d9d64207797495e45eafd7542fbf27b969609cb3eb0b74ab742f40aea535f641e383ed4e649782ba1cdacf6b90c40cd1e6b758cff2d0efe3ade81d12f5a2a023b627ce4f0ee1f4bbddfa1b1cb732d522338132b0a67a44161fd36ee00ef7e4b0341fda8f3cda6a837c2c4b315df7a29049c480da7a8cad4dd7fa9fdd0b44973af3bbd72b8c2ee6d0566ecd9cc0a1bb669b85b1d21039d1c0d968cc44389405dbc59cdde8cc23af4f2d441f6a0526fd5b0ff77fcd1e524d5c20f93976a5de983abf0503b5d07168b69e2b025ddeffdcf019cf40b43cf8c8da355705c9735cc799e2ff939163fb53d8cc769e0b63cb6dc2fa49292d4ab790f928afdb5bf0487656e50ed61e98ccc0264570e76051d6ed83b8cdbbf99e6d48d2345ccdcaa5a5e31385784e20fb9d5b54a85928d6b5a31a11024a9cbec56d4cf2e59de579998cbb26dd722e8eacb8d5d469cc34b6d4f12ed6f63dd94e8fe29ea79f87147eac969a32d529a223ef8da1d4c6b4ac896e441b970a6d302cd3db7ba1f0b2f90121b3150b440db86fc30b2d59ad3a710eda87b3c5652af27ba6bb54f1196d7d3b69e8cd0fbc7aabb1a2f9587e4c1ad36d0f9b5fdad1e4ef6571754cb471cd795f848bf8bb81cd0d43ca7781fbd604cba5064f374b4393bfb39db9dfe7c012668efd13d94df0ab79c8d4d79f672bbe8a840b6bef461bcdcf35b52220d9d429d55c23216f8b7146cab4563bc332acd8ce68ab249e7607c640a5a18fdd5bc0e1193bcddcd20d113060b9bda6c07bf45daa60828f03c690bdc9b52bf96010d4a66669e3fff60c919022401a8ce01ddeffba572265f5466cd7ab88cf04cf0a740e6c091186190c09df16ab25d6de1bfb9c22866b847a3a549fd6a3ab6bf1c6bf805b051bde7b625cc2425e6913d1cf26b7e80dad7396c7b5b6286056997dba5444dc9bc56cd63ea769df84b847f030c64e9d2e0372d7a0bd914a221b51fb9e0f2db81dc5fc9202f1b70ca502f11457c4dbaf0ee76777abfb48a58d31fc0fce923f91966e9f0afaeb944cd91eb443891a6405a0cf47d6b46c6e6f1ae9b7f1eedd8f90106c6e97493724459821e670c2a740a88f90abf22c15cfb77697d99685675130171f8d3d79322dd9aae2febfaba88f31eca08903f3242ff7a2a070a8f104d82dac59ba44348361a190085646dd0d44df7bfc03dd52a36f0e3d9c357711bf0e4ac4a1d089b315438e55abcb14d04a615a003ce437110a8666d7966a3f05f5faf6cebb05a9fdc3e333a8b6479227aff7e7f840288a807c38fe9b8f43cea6403e7eefe917b410e4f9a7cce7b0ec6a687d2b2cc6ca524b44ab6157d6a6226e82724a61890934b79d6f8a2298e8a8a4407613d3444f0281afdb0678bfded881e49c72ccdd11a7c3d5559e9d7cb51974a3408dd606ba7df51cdb2854a96ddaa15f381dbd35604a2a0f4f297a42ed126dd62deaaabd9dabf927f573fa513cdfcc45aa358a156c1ff0ecce0b6513d2c47a7573dd6b485e9c84eddd0beb8eef00a4d5c6d89d249a84cbb43d692009c3192dd804f24b96fd49a8b9d4c6436c1a359694562fc45b84f6f405c6736049005b85f76a18fe01321a182c6a89d0f32f9c73e72174ba6134d3088d16d92f04d5765297c3b9dc0ce31dbf4a46033ce295d77bade72372f54581a1c480a1d6a1ed9caf2887c2f9d83adc7378ebeab1d53ec21a47823df481a0e7cab4b223381e32f74d326fcc1ae6902284c6916a6564b790fb92db1a0a38e499681265ff54721cbf387bbbc643032a78dfcc6df2051a5097a68788a927081786cddfbcf0ecf2d1a99652b584f8ee9f7c6b988f73e53e386861aee621bc55d063803a8bdd6c3c36ad5236f55854222b16c7dcd2c7be207e2f7cab1d4c62f339058854b33c7dddde4089d399a663a708993f3050adafae4cec123240f0a466ce6873dabcc2564a5fd3dbd4d2be958871bdfee7dc3a08321a95476b585d4e1651df9c5a5fb2707b7fac88dae91880e3bdcb2c0018d931cdebd1c49e9c842c812c5bf5fc81265ddb5351839a1590bf193f46eef655c00a90f8e235d3ae8d1ede470e19daab018f388b5f53cae555e19472fd3ad65d737c132cbd328a082d29960354fe79157af0452bcc68b78c7e14a4bae1540709e7a3ce3875ef275f371748d22035eed80e7185910e5856098238f001c167d8d5705c59edfba3c2fa76c8a6f041adefe8692051ff7e0a11e2c0cfe76f87d22f87ab3d7c9b2c6f6ef5febe84e95d7310717b3f71b0ea7cb9669f1ffdb20bbb6e3e4e4f5008aa58515950f85907ead3c7cd49c9762e165e4189ad8b9fc01ee9cac3c3f3d3c5d507b0c5f69b7e73769322886e4147459c27ee03b92dc70d5e724e8c1e126957c856d093d49b10328b1fb2933c1a9651ca01ee0451385f59f36429c874cab3688c7f369a3bf2334dd868d08c9cf6c28c0a8a18d82ed71deb822829f9b09e64187c0c06bddae1c602241c0c09e729159c3419d739789bc9b0b55fe4453718bc0b5073fb2bc7ee4bd4e8faf50ca5549b81466f06d104bc6a6bce2e6941545340247591c0f1c7bd3456aaf865867966e9b38f64d51d33a50cf4f36073d6c28c0783608ddd2d86a41c9aa240cc949ea4e578e14622a3fd3d750609f1bf7493c14ed911702eb2b36e1e9ffc84a88d678d48c22547317a23f9997a7188c214d2cc6900ed1636b3bfb09575345f00d030e5ebc7a0fa63c1b19fdffe2b821e33cf19f04db005e1b04346b16cd9a58562020e61f747ea7c4d97545455f10518f5ba8b93a285be34c8dd6660d0a9cfb655a8f97076bb0ca4fef0dccdd63a984187ee7f6b46ef474743dd58ac3dced893d768de41f2f2e624754df48d6c55253e5280bdc245f86cc10b9efa176c8b51c6ba9aea7b46c2cb8dbecd512e7ec3b1289a2bcc218d2c072854cbbe41eb211dfde1c377471817ca6001dd7d427e976105b905834d6dfc0a8b3d2b3245dd2b7338210f276d255c3df498b40b5157f1b956a6ba2f0652e183ff993a193ab49e6424799fcc0bcf5eebbb56e7963cb2281f6c8c84090583eae7110f837a729dbe472b916b73b707b20096b5b1736bd05295141c1502411ef5c44d73f63aceabd0e319395b50fcdbfdfa4f90ab26db72ffbfc30efd1586f5601dc424bba38a35790baab813013d0a5c7ac6b9dc6a468da77732a061e7168f117169a6a786bb6b5b9087b43c6de28638d42732f50527c9d684a2a5aa3e6de839e884177bb87b5bf5c21fc6836aeef648cc484f5045f6eb6251150452c316d1c61bc033bf7d8ec547de4fa61194114d994e123ae92ad89fdebff7ddba4f2af1f64384d79b51d0c3b212564abd92f176b4ec4c953c6cc40e677ee025201e8e0059cb04a4bb05bf0ccaf4fd7341190da5b69ff5a7fe7793e46a8331a5dbb5db433566020e23b7182616e37dd8186460c03204c8dbeaac6ac5985e30678843d9ebfcaadf57dd77edcc45f0b544220ae1fa2c3de9aac6261d435836d2a476c66fe4b367a54a9b66fba227c4b25676c579a495851d9e23b47fcd3de56ba5eee1ac0cc2a9fe6ad13523a95f1ae34ed13923535ba4355d72e0d52feddfe1634f4f4e04343454025db94045b838e1b6e46ad99695755b98fa1f58c5be41f489dc83a61ea2bb084b5bb58825054b2b5bc0c155f3b5c1df4bdce539aeb5bf1609510f8402beafa7d5ac071b492d5e58058cdb8f748bbddaea43588e5e11cd868d9da319b2c2fe0cad4f9cb76f253891ccb7bd5f8af5b37c56a9e96a01b118c17f6722c71e991eaed2cb8a335d53494c209e84dbafb1e53d3e8fb0f68ab783cf84a12b3abeaa81ea232387f441c06726ecd94f5b85f704644030cacacf748fddabe27d5b09f3754605eac668e4bd34fefbcc9d3810350e7e681e00aab09983c42a554670ebcc7e2266f5914bfe3e28c5e38da925c92f2cb62adcb339537048ac53aeb64151091f34acea3b38aa97688a4c923e2ece3f54256e921994c63a6e3bb031424df3b512c09b8312e46fd1c0b22d031ef531bf283c7a9305759687b2adbf4d4e182a3a22e8c9164b644a8e4d4362bd4571742e626d16006bb6075947a896c2013b0bfab371a3d81dddbd8edcadb84bee3fa0d20fdd857cfb2ff4e46bd4bfa0de7ebe4c2623e1a2bcb1ad1fe3bce594ed19848a0b86b682fa43e53a93178d07fe7c448f49acc201af203523eefbcb0e892248afc815f0fec9bbc7e1d8fda47b4f8d35dc20a4cb3b069e11c360148ba3b1d3b5d7bd8b52f54ff62df9a07ad7d0b977e0dcc78952779d618fef6c5ff5b3c059359c7093a09fe9cdf4e5aa6b516d1f974506da2747d8feb343a1ab54de0417b15cbd6aaa0b05df99255718c9ce165925e81534033ff7bb96e777342836a5404f35f23c312e134f0813057ce84740d252086bf5095d82a07c0f2ea3f92903bc42d6f59f68e5d0ecceb7c226772533918bf19ad327513b2489c6c7a0f6c00266475877332032b9d07b4a32eae9ca8a5637c8eeceb403804aa4dcfb4152236dd14867cf1a2c1d1603b01d9cafa4f9d574e5a94d323fc75915f5d50980636c52ea0bd96648e4053deb1ce36020f0e71d0ac152cc464c188218957bb87723747cf005ae52d6b582c5cd8fd4fa356db1d27f54d08c3feeb850472119abdbcfcd06c92b9bb0f055e48ef2fcd5e44efb0555d01f589a967cc7b1a5318a16cddb53a3933d5bdf6d1ca210fe10d6575ed241892a0c09911796c93a609807dbe8b4b2fe92826262a543b15e35246d60b85ff6bfc9f2919d4c873632e376e45fb87e4317646def2a56e35aa3795760772c71f28a3fde25a7d0b942941d9ef2587122e61936910f920b30a8892dd4cef20ef97eb042703159ad608489d3a27787981f9488f63b03dadaac8b5f340b71dd9b8a1b7b592dfc6ca5be7df766ab0a8546adf2a0d608c41b7750b38fe061173f6a1953c6f2ab201dff7404ea61083868b291936a436e4de38b127551c38453ea42bc0a2d31b17103780be3d5aeeb0e5bfca07a1656e05b8a391e80ac630de266a91f37358dae740816e890a124f56c23ceb16726153bebf697b7f3958aa465e7655ed9edd17b996fb307941a167f242f902948cf1436511f8b77a320f2e7ed796ae574a660c637f4a76273f5836ba9b0f203dfcfd5d0ad3915662d06c027b83afb0e0b94406a972a4dc40438e30f8084504c955624b0b1b4115e21cd07bfce25eacaf948f5ba7ab596a6a678e1765ba6dfb7de1deb157886ae06867b3b25fdfb0394567d608183966cb21b5d4d7d3571fd45a80450c6f786500847d101dc6a8d6d00b700324e18e980b507442a702d2edb9f321f02a8f093e48927cf05cf625dbea402c731f15eb51d18044b08ad117607baa58ef4e8fd8d026646288074568b3bf5a29f60f625d7a5814620674ad44c76085000aada93c6b09a93fbb59e1d9e54eb2294a54019e9822e6d25047caf21b35bae7218c6035175c9fc4ffbcebc8248362dd4fd7d87c18e6b23cd897394ccc5283e5572e2421232cc280285797c9677a3a678aceded0409e3f6e7b9808593d022b6cc057ef503a96acbaf5d235adce8423d772819d3d10bd382afcbd25c2a8e10087a172745916f8e8cc34ba5d699d4e655f15624a0f5e0e0d3bf2c232a5379ea09a900f81bb2b1235862c62f419ede82ba4007d40a79f38e1c3d00cbaea1475e2c285919af060187eb43f860e10f02b2cc29f58abd1cdf0806e9fe1159a66a0cfb085782b77f44de6f4cd508f184524dd67e140bc9a104e06ceb85cd6baa37b2d7b12de560c614b8ca2f287d7a7c1bcbf2777ba2221dd7fbe90e5590e0da6d213000d4c00d11a805beaa23a448eec532df1ae304bc5856e154739cdd7f46fcd11dac380b4ed1c6b4f427b7c12dc8f9ffcee5f0b1013ed13201ed1ad0178f8a97e8ec4b894758a74482e25907074c7c1d2b5ceabe1ffdd552ffa38160de652413395edeb12c2cfd9360d27112e8927d52f87a7cd5d938573f7a2c0d94e614867d74333d02f64518016cd7bb3e0d91685e3f40a3bd64e6bad8350a5141bb9efec9cf5598afacf27be777d021daeb82e9735cc91ed704bd83c68359ebab2559f9e9a81f76cf56412cdbaef3b5e005e24eb25013eb5f981a7498b3c5612f9cddb194320a88100f5854b8a5da45a6bae424f04f24acc69451a0826058285f7f83ae4f0395562093af4dcd749893d7bf2b61aec5ef2506c62ec186e0e9aa4fb6e89cd494fd6f574009269498d36453844b7f58310fa470ca37fce6165c64ff09e524f9196e13395f259814d42a9bea5c107ee3d4f12a78ede3886be25b70a441e4d1e16b0a17c56bcba5d623044f77435199927d7a1ba5f8f123c468665c0d6215e492e1aace18516e1e1e16514df8b6b484c543a7a640654eabbf1115e57a95e6689dde813cb9275f8253e0c36190fdce129e6a836b437ddd6fb34472cf18bad2bc98d5b1a111ce2a0c3da44d6f795c1381a0208c3988c2751ffd5add95ecab139d15397d976af3bbd426cfdee3c08d17bc9fed6f980470955ca5528d1da5d10cb4a3412f5643d66c7dcfb75d0c5aeaa84038186b0fcc5faa6239d12ed99772bf4191c8d001905c03cf6a3399be3f20c249352cafe450a3f2483cb1daddba817fbb0d149110c01a1ee66e5f64643f071fe4354a2bfc7e5ab34ef12a51f6cb55382d9f1ce4e3eab2fcd733749262a01f06d006b85cf7e6206a929a2b118871a431531154f339b92895e65a10833f25e5dd1499efb575c5125fa3826c5966c5abf991ba0371c5b1cb284d34621366b193f79fb6ef787b0d3a458c483bb980ea83664439542a6ec576e03f4930766cf1d6bb019f9701be236eccbfef77e2233c0e62b0a46b76803555b1b265d47b42682aecd6e6cd17dcea01cade320eeb8cd1f88b4d911d4a25a57cb38bb5d62780898db81a95f409a22062c11c78e9e869b744d8e0d7335d5f171e6b42d2f73251f3d225bab9f1b5030a2e0c7d7eba12c20e777df4489270a963dbeb95a7e2d705cfc68c9fb3f74061104b016f8fb901af27cd065db60e04289c0f970063ae4e565e79e1e8a1f13aa829ffa47884da495470cae00872a7898ba56ece746e1ad7b6d8433022e7164bd9419343f8780e10e061b78d944f90ef7bfcb14bc8ddd8296e94965ab4d1380dfbedcbfeb9820be1737b18c6df04963322122b4da7d8e7b18c507789f007fad26826e7615a8ae2104336e2d0d87be34db42bc71dbf3853e69a30bb8daa95eb93fda12cf26b0d83c0a278bfd20d7d419e8ead3d0b281220a146e1bd099d1576a0cb2e7ad49092f3f1762a32de7f9eb6011f4927fd9075ab15cbea864195343e1389e65416ffa432f59d965c122e269285339683df8931d7f4f73965e8be6a2864a84f386499a358583a7e6cc90e6a8e798508160f810bcc89a12e7a0c13cef8058ab10cf2132a998abb0e065b190b8d6f91f707e9209fd3b6f7a1edddf64055b6942ac47e54d595c104f71df0ff686c1d9e8ffdc578f2069dbe573c22665b7c6179815f2a1200ae09c0056319536f3368329f984cf9026e24ffb5be280e8787cc8dc9bb74c6fa4ddffe17a220ffd510e87a89eb8a64123fa484b1b4e6e5f2e252b27ad5e63ac27f55e42612e70177983ee11a65595cde6cf0b539fac3fdeb230b3de07c702c6f8ed6a3a9979f2d1b11e3459325a0e3b986f30620ae7cedef8db81d57fdf70271dd351ff78c260631705c328c16d78be0a8e2539b9695d1127ca42b878d25053f799fb03aa816f20e9a984ee8f93aec5d993b069ddf3733c5feef7717fa5ec0c69a7d5021580f3814fc013b6941e3dadaac235e15d5fa0de48b0e214fab3a30fb829efac08b793d3249580b75c12be04d639b81ec0d6c926d1dcb0e07f7e3f8543533d3bbd2a71c085bdbf06a8b9bd80bf933ecae4ea630dd9b5d627b633b798d417aee61ede7d7be3b16d5edc813fdf252002958dd75261094310f6d8fa6fcb54850d05aa8d44ab8caa16f998ae50afc7207a80ce6c920ffb357e39e0d97af44cc512db4f453ce4eb225af508199bb1909a8a3dfc2a4341267710421aa46c5e34fadb01307155291a995dde5ff9673f8e932a6cfc7129d508a389a6e3d6264bf7c8020e9ab3ad9a07fc0f3c0ff8ff10d9a50c7507e4769314136b5228e60bebf36c5811770d13063e90487773ecb8dbf0978ebe0b459c0a5d7fbedd8ed11da049c57e72cec326a450b5fcc1e525923329c53a87bac78f1bd7a76ec0459181b5199f2af484c614dabe2bc4e17a7f6ed796550894601e51875ccd6093d210abd607551e173661324120cb40a55c801bdf8749ccaec7d4adcce34b35a8f57f05080421b297d0d6e07d16ef7106ab0ca43f14bd7f549f8ef51d4573cdbf0735ad0d1575a0d9b17d2c04747d87b406f9c6b397e447c901a20aaa32f81eb317f9f41b479b650cf1e6c0eeade115b0ab5a7e94b20e9d04cb99e122310b221384373acaa1d778a48e786894523cbca302d929b0296103d32212e864bf191b44251f96757e7ac1f434ad474e2df21a8d54f0d0f0f0a0cb21f31115744d81f9b1816091d7516ab99d584328d790ae4f85bf7aa4c86bd82af681b413983d31fe85eb06d7b313b4daba295b8dc61fd6770b9aab250f8b9df16dc485e38bbb2d19dddbf6f5282f352709ede1e144e36a4c6e9e2429b9122e62c60c66d4ce33885f17a4079333a21626059c70bcd6e55d2acfe9c37235b92669075b8bc70fd827171332a8b27cc685eea76bd2456d9b65cbb629eaa27444a3c32dc32c45beb7dfbcc7828d1be7c77235bdc57d3be4c85938513dc8ce1c502656c53a14110cfc28518123d338e84ac9dda16be923c7b8b0a36edf1671bc63d0c853be472e9038f25c31c5f5bbd6fcb796c6439b577b2934f7dd550d3fe11069ebbc4cae256f5ddbb615d362b1f2da2ae7271031bf391a97278950671117630899eb4e8c67948c768d861ce6de185ef5f360ff37ae2627e3345047a66160370566c9571848914f4e6a2268325f3fdb2be241c85f97ede99cb7f0adbad96435ccadd1f6a4897c67cc9a9a1dbb7e22b2ecc5b16111ba1436c43dc9f8d7d49e985f8f420e2ef8f815e87ee29b22acea19cd1aa83bf4af626c6d8d03bb7e95717c06f6fd7513b4adf5d10a22713c95bc7d2ae7cf1cdc5e0b5b770e252ae614ddaf4588086b1a5a1ec34941b2db914d1484af9bf3b25d01c9e2b2170c0919a2009540195235269e0c1f955ebc358341add28a640075bff6d9720c4dd051894c29d04c2c4592be955d9de6555149100ca8f12105934230e8eaf2428306843d6643ac6bafa61b39abe566f85ce08f21a8b8938fda443252ae6059264d0e130dd840326ea75b0daa3915db58fd10aee7ae281b1a6b96d77ab6931049af00e6e66592a7552f1d23b7bdbd71441719d8e0c4f9fa7f3a1de33a0bde2b53428c2c8ef280375559b2ff729479e56e3adcbc8b64d32c7f537a7f8fb4592e57ee7c813090f554101ba8d097d94fed63723edbb6df814b74f05e6047438bddce6a5e7f4ecfb0270c755174ac1381593e4b4401225dbd52387b604a3ff3da70b34d7add9459af92e3fb3d46101f206316cd7dab00c42c0543de578fe257fc7b3f124cf5d3ae9430af9d1719bf8f1229e0b21898572f4d4f60ce154e99d343e38d41409d8716c5f84035806dc8327a172eaa238dbdd8b8f0d93053d25e0df8ecc9ef2a90d4f786dc29b1e3f3d6a057a77fcb72a07c4754c11fa4d45c8589bd7886617dce2b0da85954cb0b22d6ebfad39c78409614305eb5f6f070abad17c4b8925f9cf149ac394fee869e61816d27e620cb401f016f3c1655a0ea8216272f6b59a7a9a5b47d308aa0e78432c6a5207d4ca22824d32e53697f380aa02184c1631578f9269f796fe76a116c234a8538a088e514273a2a5f13c50d3a0f1599d5fca747229804eca1201321a38e1228f3dd8f5059588cb4d8efa5e3f22b2fd131f9e6834aff1bf30d7bcecb4c6273001191e376cda7a398abd38ee5d4ebda26ed61960406321ee01c00e305baa7ce0a28d2d6c5e83351b9669e07e659305c4e96701f12d0b7b64b3c62946714bc77227ea698905446fc190bf764a20a6265a11202c6ba6e96867e82ed8654ad333d1ab25fa55988d15f683591a128c6ee5f0be6a0108a5e4d5309a86f891588e10f615ef114a72a7389e6f07258e9a1aa0a6b83ef4be1f6239d3b47e1692686897570729fda4081086ef67530dcd22651611dbdd8221f17dcab9828405dd1156a6fb1fb6862910870663ebcfb2fcde04359c5d2747e3804a885ec9dd1efa930cefb618a00621063157a7b567af403c14abb3cb12f1fe99ecf83a81db1f2faf4cb3c59be1561738261e8513ac6e0e4b445ad1d7e4e16b5c7f82f28a0a727420459bcb3aef43f2738a665f1270ea8e8598cfc62d9826e515e282df8a964745ab4886b5530d12cc4bc2ea7e86005bf8519f62bb85dd7396a7f41c613c952ee31b045fff20c15da2164a1170851b00a2790d67f91ba786b1b921c35a215cfc11bb8d27510336c0a0ed88a49d9470b15d2a17d5d563fb44e48a01565aa999e09f172e28fac34595ded0453a66bc438477b433ba0564bcf1538f76d3b7822696d56ba183e4b87a9c1c4aef8a639b119d764e2eaafe06fac85cc1e8974ab737d8be3baa72b25085238695dba9032e23d44252e1b4ed559cd34dcff5eccd0ca8a1f013ad7cebb0fbfa1f5a167493b677e4fdd4b0e5da00b793781c702bf4246cb91338308c9cf856f253f8535e7835674dd147c7bfff023969d7de5cdd7b8c4659965e6d265612bd61551853a6907ed8f723885d7e474a7bcc30f421ed0bec342038cf34d2058ee74f245ee448bc15b2263b48b24e23caca583605724b20ae23f8563692d663f48338c10699a75f4170fbbc4f228a4f07de442c3c3b9babe8286ff44d543ffd6231e3c3d853a4825e80ac6b02500714d2edc1aae18b44a43d261f65cf9686eb372cc1776de4a07c47748576518b503910f25e49f106dbed7d47105f0298b81cf3ff747ca27120bc43994b1dcc6308e52295d9fff4c860e80b50ddbd3f858f3679fe7a85b0857a9e5f72611339b7504d146da404277091510e7528d833fff2097fdf982bfd0c9962880e85ff805a4f345123d159134a97a5aad6e549f5119109277063f2e7e8c3e2bba6fcc63f15c4ecf027208d4527557cd0760fc6685edf0b959a6efd7b3cabb5541b125b13ab29782df153285921b67969d00e8c858b1b6176312d074557040ab6e54bbd24d17c0090ab25bde0025b513c62e06f038c0328d7248774718630eeaa03ff566e01e28c8988881b2c4ed9db4f14996c2cf017e1c8f04700db8445b7a2ae5664536be974b3f6617709a8ed1173430d9ef97ee6ed9358a9b6995d992025e23b8ce4075f790f5139e88b6bff79f71996eb4195ced410dc473990334f071a1018ff491e85a325dfa4328a5d08253007a9cc2fc83e26842b9283f3b38ef50d5cf5b00b2d1f0272005d126aef38d6b167ab7baa9209296a925c21f779a46f4ec771885afbff3cde1544bdea8468662569d003753f09f4cf381574fe59e736ea49590165338aded5bef7c4eb58007fce11ae6d318ae884014353c18a3788cb4f85b0a39c920381d795d9c297f7a3b6ee0d5d79f724b21c7e4c96d7bc0e119a6cd4d3b7f454a4d2ee1f74fe7bc34034e6b999940986007964bf8f0f80d1dfa3f0e6c6585519c7644ee2c03496ad4dd8fce0eadf283de61c74a09e193c61820d35b447e3e4d5b4fec756b9d58412b4526294e531ee16895d60d8b5e4a008cfd11b101a1942f91fb13980fc51af68dabec47fd41154b5e2b19596e44a934f7a125f29ca30a500fd483d09cd07fc7d60921ac88d0fa7bc5dbb83b84a471fb42396b1f47948c9d7f50c7cbca2cf87e399657119ccbd0a8231c984b059a8842ea5ce0b2079871ac248c3b104d7ca30dd8f9276025327ff98e80ad9803667a5a3d10af86df0f9b65029661161e50e6a4574127a7e9bb095c05e243cc3d1cff5130fa0a730821984360ae9e31285d4ed9e8ca299d060f0059a95e7c9c4603c30590391f8ec7e53f8c1db25e7725204c476920c192cb1ab56748019accb945880e904e9af1fd742f94a1faf1050d008d36401d639a39c360069be9cebb94272f293180c3ba319c3ab61342cadcd2be56062963542a3ca28b49a4ef84a95dea1e2ced6fefe85848e621fd415bbabd803d655b748d108f3c8d08dcdd99b0a6ead23276db7b2d69895820bba6ab66446c743add3620b0f209923eb0843b73e3c94bf899d8b5a1df3786ee4c917b24ea2d0639e629c0a2e070fb2dceff90c5bddaad62f2829c5495db05f539bbff9291c3ea68b0d582f83c864b53ce36a0bbf9ee95e7a4282a2abbb40ff5e194fa66b1bc600c2fcb2e92d81f089f5a96ed5f6968e6e4ef551c5efd4868b1f620a0d31c805f2da199498bb726d8970974078f8c7b252c7ad5bb8f0a4a7fbb65639c58db52a54e7fa054b82916b891ac14f9f8d93f1d9c78cf147058c2cd5f37248341e008ae413e1fb0f44bc9725f199b2e336eca7d6afc5664db2847b2f4f4e0219e23bcfb8c3eb4246efbae425958ce55af6c239692c0211622fb1310dc5485c153dcfc1bdae9de7c555acb6a3d5e7b873f06a1d23da5eed007302ef189259d751d270dda0f09f6be1116479d5fbc024ad21c9e84006a7810a6798b7b7f9d1948d4ad7daf3022d8dd203c295f626018e369d68dfb1d8613c3dd8c1d7f2bf67cc30222a637fe0f00265a454fd4d0fa33594ca268320e69ab16a35812d4f26cf040fe0cf8c24164063fd2e76a71a053e10ffe963e8e1adf6e54e0809cac37389db8f18e16b200e411edbfd9525f1d39e622cf121d389cc8b0173f612dd81efc055bfb77bd8cef448aeb143b587af29a3e0ff48c06e60f79b906365c71bc9cec9b737a9ee991786541665eb59f65d606da742d91fffdca03862afcbaa7999e34d433161f0c9d22ad6237aac2edc26e80defa83b1932120c44d07aa3c9dedddbc27aa2ad0d782062db66baa9167d33aea5c61846e82c65f2b1ac98aee03aa8866d2e9c7a7c776cb9ce8b52d7fbb8a84d227ad019943e07d33718900ad49628517dc383cd1f129f7754c10df93410454853a1fb8370e869175d06f3b811982b6422d8c1a5427103f16cf3a9c887a84e77ee7683e201aafed8920645d690e7a9023d1aae81e04e713d2b23fbfab6e9de130b1edec338873d2397591a908237a959d1b66261789b02700185fb763fd7f4ef4098dbb052aed6196b8d7f50940d992978655bab92b49122066f7491cfe6418d1acc519bf27c8bf1296fba99b2dd613a5f7b1007c8610f30f43b9ea288c7dcb07cc1391e802ec6941d098bfd7988182d8042edcebe1756b0bef4809c9ae6f5e60b9f939214689b445a8e279bdd76967de4a36ede486700744d009523739f9eebc9be36f0aa22f41f8925eed732f1fdab9aa47dc08b9e109f656f4ff74e057af7915fda0268673f3d3fec285ef18b0a511600995db36761fdb43b5e9d853e5bb78a8d1707881ddbd6e0d4032b86baa23ffa97f2e21c7b8c36e111a77da44d06835c013f2fb2032ce51520fa66bd2856449da290556c5a1a0cb9937ac24c4f676114abc5f32a65188ad74ce518c6f3baafc8581e4385c69f77da0a66f2234089cf338fe6420471c4e6303e657e38cae7d436500b244efeb6c6cf2fef6f4b8baf8263635291de62ca1ceaf94122336db536d0d1d05c0239d9501f967d29a663ca0c59321027dff4fa652fc8067cd990cac22b391364278bb70ce7bba460659b5468da8deec5fa017ea6fffd053b9d7be0d4536109cfb018fcef203165a5ed7c0e64638a1bb6a45478962d043ccd7501efed653e62836b5568a1e7acfe722241197c5c80ea9d1b2047caba97dfba77d295923c946282520bff42fdef7dfda0cda999ef7db655fe7c717b462db5d8ca47b97ed224779ce5f4e471b7f056b33aa88e3fc49191b044ce4a2ce33964ca090d2422bb8aae92f4d357e007b5943a29996e0e632c5abb0d3cc32e0ee2187a940aca79ff462361104d4dfded82f6462abf3945d3f149c7f8ea8f8a680e4ed1df6bfe7b22ba1e1ea90b26fa6fabcf564dd62c8108417799d0c424b9fae3575b8b71c489129b853df651608128dcade6b089c3e1997332360d682926d2e4ca2d6bb9c064b615f7fdf4acf0d091caf2a5901af3ebaaf529f63fc0654284dd3963e3794e5758f3701da38ab1aed01a794f0039a08bf8856c56db34000b5901bb98c9ab4d3385601d316825cf1f2993fbe39875c71482f7ba235987e777fe2b443fc3b5990f38cd745771396f03a7bb4fad123ecae711a9bb69e78b4e68c4435f1fd51973dfbd3ee633af3faa20cfd971508833cb121098cd69758163cf8f3f365f172a4e30ba8cc8cae6b3329071faa745d88ac59145b05155d747c4575e6a5657f173ddcf5fd21fdcd45dd7873d9d9c8dffe5f7a5516d98238a0f554bf30bf9abea20ad97ed4372b7b490fa6c1dd3ef8688c7da4d2040ce27923fe97dcbca678d9b124a5b39ca63fea4dbcde7967819cd847172321f7ba5fc659dcb27dba5aa29ae25ebc856013cde628cac867a3351622cc0451c31904d95ebd940a7aa6d954fd6e48026375be625d5fbc65c9599ff9918d44fc8763e27a7e0f8d951736d9646d850116acdbc2445d8b692de77e127265857b45e3e2d1436f7104ec2b0f923fe0456180bb9b3858f59d2173d1ea5f4cc1e4e39d534a1368e86a59a31a78f60effafc827efb8333ac914f8f14626ab5b5cb42ccdd763c45e86b21b357416286af9bb32ccedad4e16514d6fa45a9be3495d53e7310323b6f3fd442b22fc293237fbab63640ccca3d36bf03e964a845ff65b68dd06d8e4b3703d991ad52fc9bc13fbf4a7c83f3d55e112758e40ba3cc06a8865272c1416a69e6a2bae687381a7fc973e22bf95179107791b3b7c0d983ba6b884b95d1f2d452b7ec91539831cf5a8cd5a4e591a18dfc2e49bcb4ce0a287a302330752440f03a0697024b89b9c69c7d34fa5d6d5457032db6812d3b6937e1941f195353d3dce6caceb640b72f691b196d29582d63f718eac2fdb7660ebf7f3d2184396e154d4737df3fe59dac673e08a5b52d59df9bbf4c9700fe19b5c25cbee1bc1d45a3e1b23086aa8e4c76935f4e1bd680abcf439003f2b6460316a88ca1a8bc85f858bec7726025002eb2f38a55ca68564e8db585790f31f327376305696f5e82437785b837611436b08d0297dde8e400ccd7663dff322f6e8db5ad1d3b3804807f3c2d64fe76322d4d69a0d38a6cdc71d95a64eb7c0dc9a06cc0bc0da7e06d9d95ce8b32a33868ef3287bbf4482ea9778a892c77c966c0005d71f1b1b06082929563d5a920abb21e4d06fc30bd3376b4c6ec8ff9aaa6bc8fcafd51f8434d366243d66fc1797abcb2a2097441590f52da53a12f543eb57785adda567563cb0756443b1f8707645cf8b13a30f4ae5da90555c604c30eb8e3d4305c54c5b8015df8eadcf7406e579f04422a540e05125b297b5bc2175821fefb7c93bf1868166f13b008d79cb04a373b2eb699fe32b891646bd7291f99522b38dceb3e61e28d272f0e36ae89cd17dc85fdda0dbb7d508f30b1a4afcfa0b6e257e5a34dc221ca23db0359675fcb16343b288f4e49207a971c88fa86755a628e8370cfcf7ed74d25c2823bd1fa9bb57e1721e9eca2341dc033dabb71cb347483fa6521f9c9121a2ce5c4f9d464cc482d335c39d2166fdc1d865f445c0f4f9e94278666cd8875257b463bb80248ac3cdb5c02920cb8f8a22517500e8f65454641fea5f30a5386b5823eaacc2b92aec5652e031b641e9da8fb243488a3e4ae713a1161acc1c046b504cdc35d57a2cfb443e69ad3f1a77981fd95af9e92113f5236fbe66361b0c088432fa502c2f072794258b7db858db9b3cf9c030dbd0b9b92c8512e159a2f6f1969ba9e1b9a054ada86a55342d3af3bb69211c96fc6b9112a8c6526a107ca8892e5ef70133f4c721be01ee8da5b96c458f1216faf95eb9fd059c500e650dd0bf6f161d01794374c5e4a2058258f9cadefc6d2137a0e727ef933e0928f160ce52c6182fe8cb60e6ebadea096e38fd6c5b8bfe1ea65c254b99ac6a27695c5944558d9cb0111201937c7b833cf7b25af64fea85adbacc01b8398cdfee602c2bdbd1ea95a5db85f42df3cc655e12fdc4fe59a03e1a421eb94e01fc93e998437eb37cbde444a161bd2d4c71b1cec97a9591bccde9d5441ead721e9097f12f87131e701939089f7395c0ed21316f275ac74dc1b4d5ab6d382356dc9d6fa87fd79355fdbfd9b80ff6b97fefbabc100a462d0c4eace7b9df4144c58629ed0b92fdfa19db85bf965460cc1ec446eb1996d80f9bfba4cd7c8576d40bb8a4905dd244ad744e35aed4cf34a9b3e41956d5c56e88cc46a17dbf1a09ef9c15d33d37a779f20a7317f388b08d74588fb3337ac7a1d06161af4436ea466f1516afdd0b27cdf4654f248dcaaaee8ad16f53bea6642a6e9e578adb43df43867e01ed2fb0da779a47c5e096f2e7010036ae4029b172ec1009748868fc5b5d2beebf098fd2ecc31cafb60351cdcfcaafc3f714d95af9441e9a1859f6df06bba6ac9048ff7d3738771641e849da17c308310c653f20c5ce18596703f0cdfd4d06496c8dd601b2aebabb4d5c7b54d05962ad999072934de0f0516c6aa506d8dbf439509cb99ceb39acec666c35c21c960d6e76c7b63e3579b5eb7273bfc431a2867d6e5f1fd60d18129d7d839ef957c10bcb0bd9ae0e3ce877f6bd036b9c2e95af884ad6016457bb8cdfcf9b676305bc3a0229a7b5e7b1db7f913ef33e4a46ee2cb162709967530bae9dcce4ef242a343eb81156acbb09184569d3eabd56cdc70acbc1cf0ffe2ae039d7bdaa221924e9112bbe7a31f56d7bae7880973684ce8126112d20e2c045653130c038a647f09c1a85fedb926c40a7ec59ea4e2a2c32e8964ec0d0c3074e06639c1927edd12e430be874bb014be18643c5325a293e88c119671ca9b1ba53b64e37f12f2ebfd159172ed0bd3295cbec7549377ec2cad9028e4b76dc8356d2ec0f2959031d50e5e7bf7923db7316440f3e4f52c4a303b682b6e40003593289c140c86565be4274008297dec332a5a5294ef0fd49a1e9a2dfc2d573d91a324c36362e514775ee41368b8e43544dd0703434a0af9654393a0d572328537052c9709f5af28592c4e8abd2b0c67d3e9c37a5fe3705d83cf92cd626f5ae182abf75bc0fe53e2b7fddae76c25ddc718513ea79e1b5c0866c2f266173dc05c56db8af0cb850c4d71776cb29f33052779f529ad5a284ede9891a0b5205cafefcf39fe905c842d18252d2164484945acec26845b816abe5eb6652b5caca4ffde03f429691fd3defe76ca80fcf38d21679464c703e687c934e53ca7f88dea3f4a868650e825c9c14956d030b23ef1ff16ffdd4410a41b0aa371407a780223d86ef1fdc7cc61be56c09997e7ded8173bb68979a28e0963b2a26995ac99a97629539a4887e9dce7bd1cdfd33cc57a1d54df45f748d5f9a4df4f0f139d240b43ca674c38189a50fcbd7f4e9e3e8941cc44cb8a8539276af82b27f837e3f0ac88bbe6fe002a10758ad5e8205b2d5b018a460e9606d8386744e87e07e9844a5e224272e86d231ba4c2dc8763b372eedab92e90ec0dbce45343f485020bbdb89a7de84a81d1db64c341e8ff9c25c5594bc72781c6ed36c424899035527cfc57168d99acb28b1e671095827a32168addfad01c904addafea780793aaa5683948255dbb785e4e8bdaffaf06b89c608324fc070174f762a6089d149ebe242c7cf37a0009e2c6397bd09381cd71ec098a3f33c330902c48b25ee315d1debcf8639c1d5de78c646feab95f486e8c6822fdbaa7811d92c29954a3d5e83593bad231ed115d6b76a8267c217455682f2f2bde5110c8500c42eb1513424e4614adb29075c6667bdd7e1ca0bce753741c91b40068507b10d38c2368f2956781c7d1d46b619d73c3905bef1ccedae0b648d92840160958ed955dffe25ef2897b62a1b4001636baac87b862cc22b39db2cd9014e737e8c047d762419c0a975d52cceefa054167ababb0e85ecac18ce99bcf2d247ff35a638d3838022bf7edea688a94d71def859faf4b89e559ee770d55e1e5f21dd37ec14320d472e5726981bb4ce4e5bf97804577dcbfd2188d2fd192c60a26f5a59592afb246ea45c13cb22c4c9d22913ae016a8e5047b25c4688cdaee203152042b9c5dcbb1995069998d4b9a50e1312597d75ef9687493f89bd84ae99095f277afbf23a6a613f8841346b1c58321720282c18546c962cd861d7ea41431c862ddbc20294235368db70804da67aa68e4bea0f1c0c670a9f8c7914d01332efbf01c7e58371f69ab50a9a71efa06254687735157cd7331c3766b3039a850536cc66adc41aa076dd9e1296f80b534f1d386c71c32290617171344b279b3e89a11c34ac7af726b6cca9766e8c5622c7bbb2098b82f0ceefe3c94a04b02028fd1d695cc010d392a7acf7ba9359f4d42b96a1cd5be80f5a9895c7d10f5ada993406590647820afb42100ec18b69f1430920b35693146d59db4a62610110c491075ce13b23c158f9b6cba8af29e5633cda7815d5cd3b3eb02596f4611da717be522d33fa73c2cca5058c956e6fbeeca416b492c775b20d0487d7f992d90fc0f2aa76e81c5008c959eebe676b070f8f9037013b63ce897088b685a70aa916c3af8338f0c204aa386a58458593a0547d00f2f5c23cf6ce4a4f1ab1183fb8f05d966d452846b8df35b76599ff7df3d7cfc04c9249837a963c391b6492450d0749635dfba85896e25e8272c2c188116cb6dee134aca8236dbac0787f182b61aac1cf0bcab74fa2477b84e8af2aceccfdec130952b961a3f11bcaa6cdbefcd96805bf4da2f758a5f664fd57ba126fbdd92627aae07428739ca9ce36fbd323cde647b5d9cc7369387f12ee4cb477d083d83cedd988931dbbbc761d64f640fa0ec71bbf4c9b7f27809eb99029a135f094a8f1542ebcd8146ed7f589bac5a7f4db308ed014ac944b2c8409c774074257aa026da80f285cc181b5c255b2fd1a4adbbb31138479e1b461d9cf62755848055404583232d18af030adf098d9122b60415ca287273b8e2dd5453944198a9b306ae2a3a1d682c85418515a234a6c3e68e457d9d8e9e2d126cae01ebdfb5e3311bc8b8cd62f09986560e952ad2087a7e81bfb1e084f5bb471f74cede44536ca268127a37af4b68524649c4e8d4cd01f521d8d397f73184539c458f3c8f862ef8ab34d35734c410554925c1d0b5aa01a224856e0fb8765c46b7dd25ffadb01698e7fcb154292dca33dbe0462937aab2ee6d85f407744f72abd60cb7f231f2801cac5caf566a4c1c2c31fefb0fd683cc8df2447dd5e65ddfaca54defd2dd6e514c30b61887257484b8e1ebe810184521cd9799bd3a776894f3e629f6fcffabe28c495f36b0f4846bb542cb1ec6be9f7662ce321d02705c51db51c64699255a9c4d446bfb882df2feb871391bdf58765d400c930df2146a870bb5725704dbe11c4ca68affeb6d044694246bce321c05d5d894123c2a98c814d0dc1af0c00c1ef90791d07747f0120ac4630efa0b791c1287261f48b7ed5141dc6d857b3d2d741ac2912d3971d9ae07d08ee288fb57409a62915c87ab14dc2cbbbc99e5ba9f69da08ed3ff70bd9e7a7d5053d65840ed292e7e3cc6f6bbc592e549cebcc3a66a0b3124704c1186aa87b03eaf845f8f4004374d5dcaface21e08127f4734fab41faed94123d28ec70a1aa57e887d464563cb3f9d50fdb0a7283e96ddf460ef45eb8b8e963cf8e1b4f515afa920c8b388895911149395dcf1a163944e19be342436911283d57e1329195b656a789b830b5161271b7fabaa654aedc18ebd6afc89eae1481cc79c1f53fe32e0c26b5242e6c3136a89451ee28dda08bbe7fa28b802de62f2d56c85b2efe74f161b9502d5022f007747716a588a7de96471983771385309b41e5c31c3fc3081e514c35c86a4ef742da99cd5a800e2d9fb09b50072daaceb12f92cd37d98d79f84200623465808e3ebc6cb78f71e7c93fd603edf839e3c390e5ff47d72c40f94b71f071a22f46c7b89ee846659a841a96baca19f2d744d93ba3cf0ebb9e83e1c9de8eee84cdb6a80d5d8891804c6f68cf68e6e1a21098fee55d2abed0436d6705b3efb23df261f878cba344a1b6b2128134c94e62c0e580fbc1974d1c406416deb0b87cdab66df2de144767dc6c8a4b87d4873ecc84268877ab237ee9acdc5a0377d534abc4d985d5f55b8f5b483ff840f5b7659ada58fa046b716b0637f279ef4f5b02eed7fc8a3ba332bd333ff7709ad4aefdb910db65de2b5242c9bb68e786d119928f16eafbab65eff295ea82cf6a637b79b5a12ead93ba491b0952a0f503d8cf96f6f2e212d70c619c2da0697873b921617a54d9558119545da48418da9e20fae6499801e824f5674b8b1adbd5736affa8d35df5f842bce64b8559ac00bdfeb1790c5725718beda1b70262be8812b21711fca093337592bf246033d7878f40b12a8bb6dbab5b6720f325d21ad88487f905275c8bbba1546f760eaed904533470df283ee8f58c532010c8eb234769e5fc1610afcc93a65abab6e79b309e62539163df352251bb78101c402500b400f216e6bea588eca10c040bcfbe2039fc32137b5e4d97320ff8df21d5ff3fee9c7449cb54a258ca0dcc484eb3f162653c9ff1bba73c4a1f19e5ff3f0db91a45c1717aea1e6321145109d3f9495d8f583311c59fc6ae59d6e4f72b7a8312304563cfc44150192294252ee1af352c393ca747ff593d9a3450168685ea0fee6160f8b612c40a84d4022411e33a20f1e04037bcb192dfc6db21d2f0f8bc6da33dbb730469ecb04f3111bcc36b421b7cb1a25b8fac2d9321f35a759750dae306062b68b1d5ad222ab8df6c1e5bce22c22bc150022fccadf699ac56e5e7b47989132b69cd75b5ea833dd1c00622106c87e104dfcb488954e59ba599fd56a91b36bafd4d43ba34d5d1090592932bfddb0962219c16382d85e1b50c0f32fb13278b6c5d371d1cd2de2a6e5118f5fbb2e6661d36477c78594b627890727c4ce21da2fa9e8562a9546dfd5e73fb49fd70f1704200f6813d032db6983854a4f7ec0500c9671be67af4bf3044cddbb28496ef47418d107dd26e6467038c4194627eb0e5ee4eac9856dad8931895fbfeffe7374bbb354f01440fda1f55b606f50f9182dc56cf405ee4d2d2cb2fa0ec847a0dd36c173bdd05e5df2b1adca7c0f93a23690247d4aeee18fa5dfb98f9c6dd775fd10dd1491ee7a8e62281ad69d6049ec61d4ff00c177f0c9a44f14cceee74aa24b7a7015073f924ab70dcbbad5e292c86786f0eeda4d40db5d2ee7a4bc5c0b1627776751e623a23ef124d4028a0d51b2fe6f64fcd8adcb465ad59fac9cee21e853592b01de786a93bcbaa6f0d11db2ba90ee3bc4bfc2f469009d9c022d626ef42d055cd71df5b663b0a136a19d58026e32827ff1cdc29627fa83c142e2615f9739b6a9030da326bac2de98887545d280f36b519f89e87842d63619b588d85be39e4a052158d1a6a438e74f64bc937836b3aa9461aeeb98976b85b50a24945ad67b08db65d7eedacc9585e6f5d168a95c93ed22a589acbf195d073f16b3fb750a0a6d6f1cd8585ab6c342a8adf58499af2a91ed578514f7c6c951a32427ba80cfa72b00e539be120c4090d6c78d6742f1fc320db175a4a815e2697af74fb042c404e87b85b51125c62c66d390a63d9e8c943108e76ff0f223fd285b25cc77a5203bec50393022d5387ec3f0af8f4c75490d523bd8b26a46c992bc6e2a3df4c8871582b67cd7edc1a695f656804e2186121dafc89bfad12aab3bba46b731678157a7882d4f982f7a464a382802d787719f0db44b3551fae2fe56585b3aa3254bde8c16fcb0d94e02f0aa55bdc367354d17282bb956873b58562c9f0ff16804d92f93957f4bfcf28ecc25252d342934074378e8fdfe1594e3ffaf4676086268feb9224f03244e3db4b661f34513fb7ac2db4e275686b20dca6ba21b984ef6368dffd82c236cd8cb58fc232f0bd74943171fbf646a33430815f96c4b8f6d0021ccce04f4e747e59ab6e565c7a2e57fe52659f9f311ea41df807e3e72e4a7f9ca3742fcaeba9d656d488d2ca486699aefa3cadd1e6e73dd945349b9e1cac40025fbd2bef46a75721480d1746f1e8102b2c7410689e77a281aa6106b5df67c9b7c712e66c348d3fbbb6b94d4160129e71ff5ac776223dc1e54ecdf3b807d4493f884b3bd0cedc58689400b0ba1dbc6fa17c721b2700fcf9878c033e415a0939bc4601a1717e76cd56885a809f912e48464ced17e1e767ebd10b669a27539f4ae7cda8b25ce59b3ea10a6ea5da3c69713d817b773516d93c61c2f59ddc7c4a7978463399d6f4265c806c8373b022e055c007bae8b8c70b3238aaa814dc485ae8353263dde78d558a261bb000518bc1ba6cfc2b2e72709a72d7247db53059bedd26dfda76805a2147bbdee253df0b0c00a3bff89fbce5a3dd78dbae33beb337e2d958b2a27435917bf99899ff5533b817542459aa1edbea13960583c0aa32099fac9bd1a4b325f10b1b3f828046214a2c75d9392155af2b8132b6bdcfc66074863ef6504d6f280a456e582d1513590be0fb498824b409ef509349fbe37ba3a31a96045bf682f19b66d2f955f84466ad16cf3bd727c67fae21ee03adf3900cb1ed8ec230070390b153676921380897cd1de7918386715b59a11181c4c25f21737a282ef4694fc76195ff4c0af565e124c1bf4ccd732cf01171bb9586ddae722bd826a51dfe65e806372a6784d177efba20bf691a6651d58b3c41db0df94715e34ca14d01fd7a8a2897cd4b04ee554f7fd4d3a2c92e2ba09c088e8a413d83ef971364b57d12f3c3e0518f701a00495c059af503717e9e1ef611eef867b847d7afe5086425ec77f7f20309fe3d073be0ecb1be7c308ffea4878a52052c8438d3018f27c8845078a0ff35882f4ed40b28b0b47509ba83ff4b8de88ae24aade273427d6839f31d73eb26084b6a595b091a560fdc07778a02724769ee724c765993e4b1bbc222723006826cc852dabc282a1975ce8086111ae01d310ff56bf8f793d591b2d151e2e2fccab38780c712da2284c296dc60834b3ffab2340ded3d0552b8991bd087d8d5d525f5e63fc9fba5d4958f654fa361ccb17f5f01e308ae496e5925fac5142a5c9fabf6f614301725f0031f3c3252b56ce186eeafcfebb53fb14d54bf40b8a5f5e61b769cf6c89f1cccb4fee09fa10b746e1a13df5f5589bc969fa996b7533754281dd4533f93013d4cdd204775299779dd961225515be0014ca6e0a7d501a7cb65eea8704ab60e36cb2de3b0ca94a93b7b09b09c423925054bd3a39f5d06998f2f12f8e4584806ae94ef19e29833ee5d143de5d83c7ac190d2d28a1d9665cccf0a0f542f47e22571a66bbe286303021f56304d8539915b9eca0374dd41ae33cf772906731b028614eaf5eaadedbc12800a25cd606601df95e077878de52ab0f84c06d895126d69df11c32155444427a04e9b8a986a6a22a7fff049029de2fab4728f9e73a6ddc0a82ca10522307e04eb302288caac1c6c2c03a0ae99daf163a5cc2193a1fd0ae8a4aa7ead90ce3536ad055912c550331da3d1d8d4f40f2c1c176bde7ed48d2ad88625e4c09ef5c13c0355f0e6625141c4a3ada099e79bee79833597f65c1e6a7e2eed8f1d14d685e8405f21a5706016f48fb6c7c4b14c717f97496d77b064121e2295254cae0fba12ade9fcd01f797bd53ef3c5d6d9fd95df800336b0faf2a876962e9873952572a707626db97e64057143170b672d1ca2d1b83784cbebc1dbfdda44822994bc905d9db3ad1a9f6054d2d6caaec779e1647f2e33b902b583a11d5b60adbddc9cd45f58d36f9f85026363a1339e6a91cdc381b5fa1046d362188b012a1228206a0ab7dc1c23936339d32099a0bedc89e4f8c69b6a733f388da60302fecff597b83c551c01b0388d077cf71d8858f1462db956673724e185b39c62bdd05e0335edb66db7a23f555cbe72fa925aa255195458d7b9f279067683980f46353a3ad78f0bf95bb5af87ad826eb065e4ff7f3ea2e27e47ac2b7f675fa8a6d51a7413388af2904d48b6ad6f5070ad2feac593fd0cae72409fe27f26f1220d3898b4d67a3b2b41219bad3174c1619f771a74d34fb976a1a30a3ca2942c6fbf5b3ca15bab039eaf1a4480fac1e95d666796ca270a72f16e06257d6d5bdd93f75ee97c534e408af49623aad41b20a910e4348e85514b52f3633afa92f543bdbb522da6b23952cb141d5403d73665884f53abe408a21cffe053dbef6cf5a6d0001eb0f5dd94c6ea040b04645194a6dac197974f24aef2d2362cece5995fd6fc7cf7d81c8d2437304c7fa3a96b809568826081f4bd1af5d44088905badc78fd4438ffc0fe41cf9debd275c1efb19276f4add77b1fdcdec7cfd9485152c21e1924b05775be53408c94f8a9fddd70f8d127f96806f6eb0db915a8981a97f7288b1fd2b5ee694294dd2b076e264e945be37f390e09ace56d95e593ec5b7847d7a1660ca88455253f3fe4310223c34ab8bfa333b0dba13f93bb47e7bf3723ca983ff4c08d5c46b602b4e7840c199ccb3f058108e2be74d9e235617199fda6b337242b2a5f9f2ff76f80fde505049a4279159a473d4efe551224cab8f6c27c40588eea7a12b9c27917bb6fdbed7c97815f1454090e86ff388a7c5c5630d460b0c2bf99dcf55c78cd5e1168a8a405685199d441f362c3d747012bdc5221b54ee2a6f3e14c321e2d905a35984b7cb44efe929bb564da432c40bd81e9b0a5674945883c97fd63aaa97a23af5e973200733ec76e712e93b4da7a02584a75027c48ceae8153075237e0e1b5b76246015db355159c87f09e8dcb549bdb4ef6252b18665e682c816f5d8e9386107320db50b86c18551445abda7e5a9e4728d836e96e14ae5c610c54fc4cdbf2ab65098260e5a7a46defdeb2e02118439170f26b40412a66282bacf71246eea844e2818e80c47469cb86ef414deae4249c6beb197726aff11e18bda6ff13a949a2bd78c7e8a104b92cae2b1cd445b7f354ba8dfec17fb129ec282135b3a9816db252db2dc8e4043cc6b8a1c452a0a3be9bafc3aea3d275ad76641ed31845c1076cec7ebbcb2e75c9e2487af5a32434869e78cc991dcca4f62c9c63fbaa721851f898ef3d2588661ccfab1e41e80257f61ebf043793a16e0f4f0dfe8b44e2cd1a37b9a99bcb7eed1a8bf482924baafacce47158b399e6834399990cacc38777b1287814f730b3d4278fe107857f308bcc413dabb5837ea5dba2c879d52f67f1e1d526f3cd2f8b6fc64549fc60a6d663fe6cc10a91c423f37a2c1c7fdd40b0a59d6d06284e223db6e2333025eff8b54450faca2f561f34c4bf8b8b93f0d255f2f76e3f7247d3cd76f5f15ee0481f1f17700cd2a19238255fae1ffae2bc4c76e763355195b6ffd38f3e596ef31c55a4d55932f455af294a2ce04894e6101f6ea599923321243171ece75fe96d6cf04d540c12c8913e513a1f6fb1176a0a78acc9d4a1f425110eb4e5b79a54d334e5986e246115544b2d0a5b0e74d8734696afbaebfdf67039551273a47580c4841e1d801b1fd8ea2d003c23325ee76d38d8d1243507de4da2311af34572b6782add7beb515b0b8f4b2a98c08233407799b1ee4bc5d0de56de6a73a171381fef5f0acff1f2cb1fd4638d1202fd3764df4801f33984cd5c49fcb0838ae7b994f1089b145c507b79cce64d82bebf8c5c080a9e613004a7da74f269e4b685466142d7972d501ec87c663648c7d27262fb0447b0c26ca2213b362b6bf4c62705497f7eee6e9b05d6f805245f0198ea4c1e23d4cadb2f408061244b9d8d32fcf3950933bea71b8a67287f60681d96da2be480c74fac25a277b97de1b27d05df5ea483e4f176fbeface3523eaebd1dc2110ebf3da79d1d12e383ec4ef5b45c9b45df73f58f9e95e66fb1beda3a3523cda028c84113f69439a2465098792b426c4e2177188d147ef991668443a97a34c2b5fc773e9d8aebabc36583cdd911e16f3a3a95d15bfc4ccc97b8f7dfd82058eac8e7e4c8ff65db47bcafb1431e7b3b22dce1699252d3eaadc6944f8a727eaad2cb028719cc823372453a4a4339076247d57ac528b034bdb81dd37f32619e02307a07ef1ff98b2d886195e649e756a52ad2178b9ada5556706bd5e4b856c55541596c8a39a0406eaab9adee76fd68695934313e71c760f861e20238f743162a28a8654d6a9f64e1c305598e22cb5c1bf3904f7caa8ac277c78aec8f2e8f38b22ba52797731e27c55fd6cfed9427382d87412d20ad4d15a6b0fb9c2a203911909b992de8e7337a08b23fdcc42955047784b930ab8905350f2596f5cc979064bdbbd9079976ea135926382cd0fef6f3f894c2632835ee27a75ba72e3aeb92229dcf18f3807c7d623eb11cb1c69431a4652aa4696aaa1a0389c683078ae997e493eb9615537a82f187d5c105fa897de5d4bb25b4c9a01fc1d7f2fad9a70f81fac6d0a92bf1a52a1d85fa1fffca9f275a411abd070e883c50f78a4005d82fd9f09053e7362b1eae8e35b5ab41401f0f8441372c527581f04b6784f1783e84c0d2aa940f2be1cc23669d997259a552c850612a7ffc7e7cb63e2e969abdb29616baafc89d8de805add9ce80a3d13ea0e2ceef734e6962a09539a03398d2e2e1d2a2bffb2b46635ec4d8d3109145a69dd2fae685dd631715bd44ff1149adf894d07001e6a94c3380b468164d97dd266d4bf65f59a4d5b0289905e317b7458145c5e849e5bf80ef0c84d4258e36affa823e9e5fb38546d07b0ad8e2f238dd566b3ff80fc2e62e887698ba06332440099ada0a08ee78d18a9791c0f1341bfcba13990806a89e725f5f703ad161110e04bb1b50f50abaa19b29fe05cd93a39adc4f2c93f8fd8b3c1570096cd73fe7ed5822c303473454bef60927ef58bc1137422e1088a46e294c6bf3bf018ff2d61cc362879ba33fa94107fa8856c78a8398f2a825c4b9b6da9493e83df18ea13feb1676a31e0f63bbfb48d0f62dfb0dfd957703e3668dd085d093072ed2d6f6d43cc3d21926439b89bf7663307a19c51f47500cee5026cbb6976b8e224898b4c3aa61d6b3b2062328ac0e5cc6fe056afe517deb5b478c3af7f50ae44fb5c5f0fd25ff6bba8999374084e8a898fded32c0a9a8527d227c25b8b46e066779aee4d14c5f32011cd363057c63a19ff8a68ab18fdd78a7e81c51859eda54cc1dd050052b8f7b1f1b303b68287a9a9dfc01e4b8e13ad8b3d8ee63d954885c4af972fb0cd1ce788404a6d1f3e4e0ccbe84f45f0a0381696e7bed4a930398d8eb5be83271e07a24d410ddab07c39edb7afd70413be3c75e707c7defb85e679bf14ed7d12b5fb98ff7ad8d2d581ce5007bf30d7f0cf5c3452aa2cd4dab08673631b3f87f87e27c28b23c2c569fa16b501f5948ebc066355d29bdec27a3a91398f381bc06b828a72cc49c214a15dca5aa07830df29642d038c3447e24a20833ce2615ade5b2344fddc547ce735746211486b60c5af28c4f4b032df95045f14faab2bbe5c68d2c5825a126f3526822576e108bd5061ebfe0e2594194de128b6c9da865347de98ef7a36122012e2c0be9fb2a408f38e5ccce31ad5e52da8ed38c7a8c529bb6c7a84805f08a27121e51e688c06de82ac1c31c69f4af323d8c616c51b3fc8a35f0460ecbd5579af78d77bc7e5b48bf039e41ba45044097702c645c71377fdb7aad7952284c8e1b1a638c8782932b936e579635e96726f70ba497f8a783dc9d5ad3f8757a028720dbb540083874a05fee7d5dddcf182fdb9af1f5619c2df0a3631cd6ada258a9dc3adb57c95b17e9f527a31ac61e09d60ed41dab6b8be75a3958e6b662dc27e52e6861e2a37250c5d4df849d1f501a8601faf73e38fd748290ab06764d787302e133f28eee13a5797b29e00042eda23ff2bdb41e1b06becf69a52118cfe7fe8b8eab245d642b2250da39e39cab12ab097b01b936ba792ada2af088c6bef781eab7bb74ae30b2923f3c77c42e74cc22725309b231e7b24383e5ba9463b647e779df7f566bf447216771e6c0405f7ed5621fa95c18397ff0141601350e228c1938746d1a12e02d0aa89d265da4ad14d57f4e37dbe11009d31cb34b5ec9586d0bd896e0ce3206cdd08da0b58652d5220396dbd11237c76c086d6b5839519819a909fe2533f655df2fdd4e490e5bc48fb42a9771af6bd970abc0b919c4ce3f12bde360fc1322f9d095003f3fe4dad1a74fa9239f88efe270b9ee1b1c1c79f6e5376b9afac3d4fae69e9fe8b62a6ff53b090c063a93a59041b637d4cce7651227ab1b019a9b3b31a3b60dbd900e8fa975ec083dec43a765e2fc747610c0244327dd2f03cbc362c7a5bba82ba59ec5ed88f0f1e6e3a134ac8be3a59b3c5d3739452e8c3873febf79533beecff81d3e2a39fa774344ff064c80d72cc1ca0039b1f642ea75618d4c569945b0112e84b37205fc329742d9eddc2b46875ddfaa59ef0f247922700a2b41d5d655eef3ca3cbcf6551ec56424fa4f9ca0dade807ad3133d9092dcdaddd73d651bfcfcf9e3a3f78e9aaa44cccef743468389126f02ae880d41471bbc017d625531fbd5fdce4b9214a22bc8a7ae19d4752ab98aba02cba0379dd212b5fd02cd3f6f6c975c514a06d175077a34a87d01a46c6ec6dc9b7f0320b33ac9cd4dae93aa083a8717b3d0990b67db2f10c8bee72c9fa2275fa7b1dd9eca5a8ed8c4b4555cf14d1e7d5c707678bb14316d29bffd92990c0d5319fa3ff8e7eb6a4b1f87687d3a2099d74c1628fb6be5fcc1be0969ae771481ee323e23c3257eaef4833db866d2f8803247ef37332169d810bf7f56eecc33b07ca5bbd31cdb1b9a605bf90edf380b1c5eced921f9783df8b53ef3a241a2e02a283d16c43b46b1584ed38e9e3877fdf55ad19471a32b08224cd3c34c21743ea779b0866c6fc976bfb6384c8c062cda3ede1095022d337c2a0dd1fbc602231443fcfdbae693d67afa4f18792d3759c47314014416460edec1bde7c24f61ea4ffdd30d2f87189a2af407894dbaa01fa8b45947cba22ab4f715af280d9273441c4ff1cb4957470b8a1a98c64bc55f7ebfb6c3dc530089680529aecc6038307d5c89f16dfd5b435550cc3965e515f5ceb245fe1d8f669de4b26165954e13a22f75373c4337e18c41d5add90420eb42fd611a53b8071a13df74c1dd449d81f5fd23e93bd455e156d0414757f4646362fa2e288627fe842ebc3b31481825fc5b95949574fa545adebd1a8deca2e14096bd545af977bbd5150fe86a4eee4669ffcd9f46bc6035263e9da40ac04e259d175db6b45dc5dc3d834c8a808e8af73309847a45a72c3455278238d05f227c6eba90583be6c386e1fcc937e4d26b5924e44590d431ca077cbefb87ea396683f601704ca28afe232f4d686997fb0782a8350eaae31f1f375d12fe40e80651d30a95d9b715319b1605194c94e6c986f7b3e2c9a50c1cf6b2369f9c1e27a622c1221eac03cd6cceee14ab5c7de01d46a5e20916c7938d5f016525c9778c2cc3048c4cefde4c56465842c721445a4c25bf7ab28b3c2af2d07fa8b83927d3d2262b240053be6478b9fa05c92ac30dbdf4404b124c9d3cde93be5eb620e01b23cbed6ac8aeb72019e6c10637f59455f83789539272440147336310eef816c2ec9b60980676f4f5b1e95349608bd3812abf7d20b8e9476eeca4e74ee17a8b376432a26032ce87437b6789254dd8ef9e8cfe2e3df3f9623bb9c8251b05580e2e2ada7be9422446ca75a35572b7b5b8d5e9f275d40a7d03bab401fea0fd8e33405d84f35ae5a729e25b1819ac362fae237bac02e75dcb15afc52795e17641d62752ec25fedfa5dd6433d854909d3685b3f25c794715edabeb7347f714bb2194c3bed0c9a9d6f96905540520a142a1c732f6b234a9fd0906dd8033bbf7e3220be28a036618507e8d1874e03202a5f37d123fd0ded2d3ad9bed02b3814ebf5549b79112f1768ad99c7abd43ebd97f9fc7706a5312ce98a1d1186d5e1a8e9f84a26e9b4f8413f82001bad21130597879341253315eda1c330b5db2b844b5bd14916a3ae85adaf7a7caac206cd3e71755a8ef22e4015efb7fe227e0c8dfdd07cf927da07452a80df11ca7b8deeeadff8cd12105e9d2c36474b48e3a2414c17c83fb8bb6646e51887830baa30c51e856fe1c029e18cfcb9ed90e808f83ef56c74b5be408441f8f036c57e56ea43c4fba561555096986e84f3b9ec3352ab0f62413602013a8917a3e514e8bf7e8bae5a9d1813f2a6db8a48754a0d08fa37953a7fa87c7d381e55d7090ffa26df09aa830595a28dec90fb23862e97baf63f0d65c70161adc7119d4a2b202827dc099e604b6e96e216681fa8f7438e1a8994f4f1336c2c1213c7dd8ab4c2997cb2cb6bc4ae636305518130082a0362009cc2e3fcc2b1bf684eb70daab7e8933cd3a96591ce603603310a96419a23010e3cd46581e0b7c4055fec3f54720111ed8846bef40f233f631b75b8f31b9a303d7581776216884695f3a1a980b6ff4801196ddcb7aa3fc8cdb8231f471f78b37b9477e5a369f850d47dd5b3d4f22dfacf4e87b2882582720501b5d217af497ccab3433bdbbee2c8565439f632d74f94a9a85b1ae2beaedb02e7da8abfe1c184cc46da3f0d74b7b2adcd67be0505e87784f37ccba5595d046bb8f2f5dbc00fa19f3b74f67dcab782916060f156cd55b6e3e50d7c9b39adb00829014db803e50c7ea17278eebb1dbf63c14052b67365eb26cf912c5c4ab35a68f9f4e843851fd7ce1e15c070e7c36146517474b511bdcadcf8d17a26079494675663d8bab10931791fec2b6f40d8ad4632758b1b86c7402d6c9a99069b45e9e54b7fb1098d92d8ea8fd46ae8f4868ebcf048375e824dc6db173b58d6946b11bd9ff044ecf4b3655ca9b8643c1e47b5d6a4c4fd816fa6592502697129ce58537e60fc485cc7a2a19a8212285c33cd66211129c7553b98be81e3d1250ff0f1c934fe3741bf91da51fbb3da8e78f32fef83c1998ba5febd31a1cff1e4ca1824e1502a7d33f1bc2e0fc8b1ee693a59cb432c73a8f0a63b0334cbc19452189b9b073e099c413443b61b3e9e6157d3b05e45374132b98568222ab4721274259627bcae1ab936ccaf06defc4c0f0260620cfd8a83ff61435ea7aea076adc5e670fae8457c26db86bff5e521b1a2f7b0c935bd5feabb9e4d19e694770a128438f4c75f11d29dab50523fe4d84d92249fa4f3aebf3876e9f9aa2e9864b53bbbaf056f37dc16d9088138164ed135127510ba20780a076619c64975eac5661be4119f0f3db1bd9f8344eba4992a63542abf73df6107da354a3482adcbf0a7bdf07f89405e52e4613d8ea0fe73c4d34ab8e2355b8a6e6ad8a9c3783be03624f7c41cdbc0c465e580f37ab7f8a38451ee0d72338c6341929e14f47dd80d7306065c8cb7a305f2348d91ca3560f3a44a454d9568a747f777faa8fe2b5bbf91813a41d0d2b73314ec1ec61a526b2e479247e69cc7d27050016eba18421bc1e1dcf6f7b76832f294c840e1e7203afdbeea2b3fb207b53d322507763a8aa8fc12e7791c2661c3b5ad1cc297acd8649760276c5f73af39e5b4ac3061025f434accc048b5ff6f019035f5be3f5e931de9a34c9df26d4b87903ffb380c7953cd2bd6651d3c71b68215bb8061e828c686b544b4461e4406374e216749c1ca5d2110a9887ff3bb2991920bf368d0721c9c66d91267697a16a6a42348072ef73943ecdb82611f52d319bdb47ae9b5405919570e972ed76804666f5f10b3c62c75bf2dd355ad46ba7427e48646499f44b8600721561f268b70aa2035e622f1856d801753bcef401eda8e2d020775624b306e71dbb2a93159df3b7b8507eea5534a8b9b40af2bf071f3f807b5136d9166f8c264741ef158bf3c17c8d9ec7049d77aa630a31f617a465a185087b56d47c9b8c31a47f0ceb99b5e01b57a39f0c97b62f069bdc1403294276283c2ec0239b420b024a4e575377c3ad8b0f178d95fb56c2d294f9d8b7be4d99439a4818526a0c36e4e7b1519c481b75ea1bd652f5925c7b7a5ca46009cab494ac5861d7a97008d05160f3927a1e3a9115a3a002e3a347178d5c825c5ff7880700af48236310cfa6605b40bccfb8dcf98c22a47ce0a4694ea23edb4ada74e78f288c10fb5da11ea23c3c1103d6c8615069880a91f071217171dadad0c3f2378f453f9d25a9560d592491822e862937bd82d9cfac51d7a0ba8984f23dbbf7926c9918ed25b2b205e3351465dcce8164b312db397d4bcaa4bd5367ca48469ae13fd66e989a34c97c374f1cafd76d1b108a923bf98c3a2f76cb90b28f0fb60976c89efcd8b1dbbb7858693924de7b53974b16f22f77fbbddf732e8e78ce8bbc2a505bfb44c4335093b42561914605a71f4afa52accb992f802032e58832d64902208812846e99e816eee3fe1897a63a9c40c1d17d6de9a45eac8afe79c93b9f549d5af63dc9f7f7009536e62026c652f68e4e8d1e6334eea24118b386c54796c905bedf04eafb1ba4ca815e450b9d6f70bf47a79df93875e48e72fef396b24d32973d112afe8704035872a274b9969be2648e135572409a139469bc07521c606e2e720015f12ef472db79ad964f17d19a0b98c0485b93606d53d4716366872616079d858285bf0e811b57ef243b5a4dc7a51e1f344fc748cd4b8e32af48edaf5b15cca83b0e9eff9c9d0497c864508438283d987ce0d0acba0ce354bc69085a1681cb7a5b1337364f50c3586aa669d7c210f17344106ef0333f30e6482fbc4d312f2be0c43f5d289920a2a03e2fa4be583e8bf2d13cff5b2d4cd8a3a44dab1b6e76ebcf4574caeb0f3b7e3121dc43aa45cc6e6475645976675e49659377b921dcf3f55b4156dd8fae0be30e2b41e07da792066eb7396426e900742b719a1c32d0f903afd1c45c483d484e006c90a6634f4d6acd1a896a3d74bb55f9e473562f4159cf63336bb32dd7da4b9c4f58f929d8c294c49cb9d67417e72fbe0ff9374568ef03fb54438840f6bc66527523f952d4479485c1011491429bfb2da6f1d038cf00961d068fcdf06e241b6d95f19dc1048be967af468360e8fab8aa2e1eacbc5f81834dd7fd9ebbc9b40789d378e80b7d9b4c1d48ae13e2304411cbe998d96c7fcab4cb79560bb86d95ef5348ef5c9311cf315c4134cac95da6e075b52700ba784dee80d59556a29f6dbdf7ccaee905c80e86afd9746679daf169c9d4c127d77fbe7f8d80ef54c36650039c7688b2d8110951d0fb4183158c35bddc162278306998cf48edff00136ca872049f221042cf09c71af3a0664c336a11dd7c5c331f440d40194654b4ff8ed669e9047c2c57259b4e4abd4564c2a352278bcdb17845aabc81f61e1e373dd47a3e0f3958052dea175cf7e1043479704c423ccff2361a230e49861b976f88aa462bef2ba031292732ac57b10fe304042d8229f4aeefacc2cfb4f7e62954e8f431c4340fba24daa06861013dc4ebd6aca27c81db5aad9fe8aa6724ecdd72a9abc12308723b25e12622b45aeeca5cb7f07db0ba9525fcb3179cf6ea070885e78b81bef92d84eb28feb80da1aacb7ecd0e20f84242bd96d5fea51bfc80323d29f7ecc122f901ad467a0248ca0870d7d52cc27987ee87c54234b8b6902f65b771dc85e60775585c543d569bf856ac166a1320e05662a733adce6861659c5002bc2c403fc9763d6b941ca19c831f73136c42046e5410ff470d82c7253d1b5598c469490c1bab5ecb6d017a62f7f34ed216292a11130d024ecb34cfab49be85eb1e7977a524a97d863c0909df2925dc5cebba76310f6a82fc57da19cecbd7b02f7f6350c8194a18d0a6e67b0d9f775cb6ff6bef1e9605c188fc8c0355b0516c24e3641268aed7d594e6ced6adda2908f06aa2a58a77d8555a426bc62f13d55233a5ded692724693398582a6567f4c81b547bdf8ff5f9adbf43067022c1e7e200de6aae4337e2765a906573218560273bf242975502dd07f9e40e9846272bed6cfe047e779583ba652a7696863428197124e63c3ff6797da4b7a9d8a1e7b19b3145d4e7c2a68e5a437d6156a2385519854ed45e9fbb192c2eb0e7abc956dfd26d60aef0db64dc984887c6482b094de5d60e896920526c725f18d3c8b951ba49368f4f43f1a49d6686d733bce1f0002e96c56a986a7e43149adea61ef66daf6b8f888fb33df879df9de81e8d9a3ddfe62f6b15ab641d5244080e0a7bcf6037c95d2a97ba198d7cdc3bdec13350e510bb38a356f1a0796cf7a82cce6761779407baf4f49b86770a37fb49f3a516c6133f39d4213a3cac823f4edc6cb898bd134ddb70e112aa974da7c0298a0bdb35c881c1135c8be24811c8d763f04eed1bc5c8da77f26fc698257f52c2c9d02525a0d682e804335b7a27004af5783b41137b13dd251b8b7c49b3f320d5ac8e1da106ed7791b428f532d9524cb57cccd2cbb632ccb6611d81a56c8fdc00b3df25e0e32088c0690b5b9e15f5e8dc9c9f24ce147eede5c6c988f7db238dbc0defc7af3e68b55492c38132698682db34fa148c13fa0947e1e6f08c622a19f01ec0e1d224febf86c09fa51bdd900cfbf2e9a90b69a15394995e28eeeac9a2549e5a0c8f84055c087b4564133d63330f3823029f2d42f9557aa8be7b91b7e5fb38afd9b32b1eb9ea40cf81c174e7696a4f110a3c422becb36459d3f1efd75f160c2b3a1a3c3b47dd97c672636748aae95736659d940aa19bc3ad6b93c08ef3f038023042691d5dcb59ce634cc18ddeb5a2f94076be79db90e200302754d86bde9c2ff0c3b2551fc44ffffe3e1f8e0f8d0d705c4102450580efb8fd9f70e0a01bc59c09c796bdad63ac922a8c324ade3f738762672a84875b54acdbd936ae977b6a90087aeade59698c0947fbbc49c6a48a0db56646cd44dac95802d21491fad9d3574564a949484458a46f3ff7d9ab803f6bb2bba5a27b75b570f32c44805d9c8b431749108a97397829681a22317001c141a68adcc86db9e576d817cb7b735046e2f864c9b985c582d43a78004ca1255ab1f505eb6d8f256385d6898f2b715491160eeb8df721c31575c09235f4afa2c67ce1e25b4ae20960be333809298727638f623f6831e832738d409b2dbdd291ef8e48539ae522bb215f2fd2e85c1c6412741fc10415ab3606bfa1d18a4aa7e648025a4419fdfbaa4a5e202661bda841accc7bf53f387ca120071f0145d740fab0710550bf4d4e49fdfeb8c255fe3327ed335c0118ef7251244a9dd1903add5a9189436a336c37214c3fde7faa649558b9f3691fdaa9642a26cb6f50ea8b132903b0cead561c8fca045506baa5419f3c3cbd2c814a9aee7162aa85535285e6a529bdef1dbd7f820d1f2647012d238eab18253598f000b9a3cb1b96c8fab5c23b7dcb5da96688c5d37d02299f630158a8ed182c744007769e983c60d15e30f83510d5a7ed7fbdeae80708d108d3209f656dbd7623ede1e0db8a2972e462d0dc102d0e3a2b6b29a663e1e316839436a28e0d2b217b34287a8164fe466a7dfcde3f3664fbbfc1f2cbd6d41d5d3b1a15fc03577b2fe4d9adf86cdb366df3d120f784b114042c341cd586ce63919c9f83dcbcb0dc067f1a4df5beb4adfad6dd74c54050138d3bfc0a039ef85d6acce62e12ee19ae53c415a4b375fdc461546e6c1aa55a90ed83323b8e0b5685c6145ca780484995db4774c95f619af4f2da9efcccc451f528c9a7f053dcd1a1137b09f67158d001518783b4aff4775d587873be0a551dda59c193987d05b76fc0c9683fc9a8467c9e78d2874ff05367825eb161a386a118719ccd3eb8e311a248ca7c48c51436b5baface0c6002c43b436f446fce73e7f03eae11581d4b04d656f0d5013c3d0fdba47858b135ac33b4a4c40c9557512d7bd0a60c6841259f3ae930eb9691c79d16bccabed0ca101a6427d10ed7065d5400d313b097b57bf989a07bc467439c793abc81eccf98ced39fe4279159a472352801d14a0ab67feef0fbc3efb6acb0eb57294c1a33fe835948dc64cb81692ba71b7e8d646ee224b91725553f4021280fe08d099791f18d02581352497ad6c24d3e11150c484197856b9a3aaed7384df13bb9d6eb8304371efab3fbb1a4dbf6e785bdde30abb3bba80cabaf01c5e2503d15fc258979e706983287730ba420191def59a2654a253744549137ba7a2acb45cd83b0e745444df06179453e775ddda3d9012ced8b1087a3867cb3c868c83faf75631db18bf0e26fd0da854e1cb2c45875b578224a234abba1103cd0ca2d69393319141ecef60ee282ba058f4a135507aa11b6d364f26b43af5e2084fdcdaad4694713859248894ac978f60bbe094d8a5982664a59be41d6cb5be13067df832990c071dafc0815c83f1b8a6325596497f52e82648dfce586032981ccf20a33d96c4e31f9b2f07d0fd0fb81b5cb3ef89cbb4404bbd040e732b9b36675ffe76ddc220b07f7016d5c343c2b7f6325baf7c6dcffe470948f9e9a167f72d35308da18c2dc1bc7b91bc86d49ed86b676c0ebc6d826934a56ef83ceb58510e27a082420a2429442686b81bd4d55903ec7be28e1d49ccf4556a3f8ceb5a33ebbddf77fe500597ad276fb1d30cb1347e41edc05cdfd07b012eb4b4b3b3da2dfbae8ad610113b716f8f07acea32e05067062942c33c62070cd8b6469056bb5bcc0be650b7dc017832f954afaf91afcd85b2277eb3ddbba869e1b6b267848bcef5b4789f8f3f0bd86c5c59d01874476fd6654f5e8f774bb216f4a39a8469baf234012b9daf2135cab44bc6a2552a78a6b526019d4f7a576389984990bf886a73cfbc7dad86c84fda7ac5c47d6cf344e30b84815501fd737ad3a8cbc426775c1297ddf30e7c576c618477e077b118799b65b177ef1cf629973ba175176ae8e6ae1d046cd1658412e3653625b1293b6c80ceb9d34de3ade53e3ec85bf377a8cafd91f1f2cb12ccccdac8f3767b9cbb47888bf8d1abfe0f5b1233451055e653e431628cefd9ae5a5459536b7959ad8fa4c1e79a0821695c56596178940e160d659cf5cb9b68014507a01f5ce49b37c1543026322032e293c22a7578be8b28978b81c9864572ffd077efd41e46f5892e94b8272f6fe6d05b06b31030cdde8b38074296e1468c22a24cc46549ec8d8d6f4ce2407299a975976d55e743727f6e0297ab1223810ac97d4e35f51c4ce520f27d1ca53148eb9383674ca8cd2666fe9cc063f874e153a7c68a603bc410c20c24856b8c50be2fc58b80566516b2ff51a617fc7a30d16cfd80d3df277a43986581400204fd7ac81102608fec966016eedad85efb03994d68de3bf7b5e65a948c76698dee629bb81f48673e324c34d5915b9d36cfaef8d0bd3e8b49d019a8df4209589b52e355db20e22ba530adebfd5e99a31d8f75d37faccb5346b8335a5469caecd3c286008bfe1f3f52c143e1d64e8052f97eb3de5380b9f8e74f81bf32df632748c5aef2c346cabd8e604194033afa703883dc7e6a856e8b616b2e35c6ff3d26877e68d50150cd6995a0ec44691a2d84916040059a6fe95cd074a0017dc2e113f20e94fae2df46b78ad2d1be4315ec8c190c7fbb411008d7ec757db58a860a8f7af9de18d21590a9d6e8a64e1183e66191184e49871d92536a4be2c5dc8f9213fa56af4a99fa51b72cecef04da54fb70eef91443d47ba398be1e5294ab5c17aa075eb5f2f020683895da5ff40afd0799b1dd83b88b44481a956298a3a5457321a64eec3aede22e4c003a4fbae7fccd4942e1e5045dbae400349e96cbe48db8bfff6816914e97b2f6cba10b2907476df9e3944d6d8e45cb1a05a7d4c10dab48a9f5e20863d7bc9f9c530d817d7495aea04b8262f325482555fec257070ab1a088a2eba9e93873fabdc33568b17494b9c674dc77191e86281f0c9e7f01877ac3d3a353f37a771a36f768694f8dc96c22fbf35442e7d03c9db5cdd9e895a11b7ade3b99c49b0d75328e75d565e89d68d11bf15bf7d011f23b1d54b4a7293c2701f704f32edb65398531fb69c995544a415abb2deea0e724aa6ba793b4d12931ed78a8d75cbb639b84633cd48e0bb00afdf3e19a663729affc6a96649116fe0c40ace4511090df8aa83284ba788d2fdbe5d090975cf3e67cc083384c76e338922cdaaba106a7e4fc7b3d61d7cc3c587e40ee9844c4e9345647962d436b4981660572ec591245e848d0eb203d3126ea17274391becdba34eec1b3cdb0fba81547d7ed5dbff68f0cdbdd54c377f7a2d9468e3995d8d59211abdcb82d7a1f9d81b5f220720cda353b3cc10790d1757c4fb349f87c3dc90a2b72d342ea030505cb1eb58226c803a238310d9d57956c6ebd3a745308546c124507294523a8ba021eb61cd36be6b024c63b059c61e20a4e3d8215839fc571e163f2f8db71019f28ffc12e7c75f856949e23bc2d71a3b0aa6893304103bc289d9a9cc09a8d3eccfe44cdde4b0b546855ba1f8ed6915260d6bba4ef5c35ac29bf9a7ddcf44cb62ee4ea78a4a4413e9e93e90fd7cde96df76e7723d4589f57d59f7805ba0e71112ebcde52a4ab0f354e67c1e331b7adfd82f4cc11dc8ccdf0cc2c33738329ffaa358ea648ecc31250e275f51d6b867911bceb114246189ea8c7e7ee5c4477ecd149b7f5902caf7487bfb6f9ffc210c32371d4f2340fbc48ee567c3abee354e5de33af5513237c6a49303a3ee56087aea1f8c3ae8cda2cd4fd0432de7dec937f5a84eaf3004555bc543f70d1624e215f0d5a3fcd1183ff276a5d2cedda2b5f720ca2e1a2870f848ca4eb4d2a2c18c240aef76b493f56de2ae44c372e55dcb9bb9bcce46cd1f2099b11524ac14f97dd2be0565c9464ea466da8129c2b46d05eea050246a44f5edfc22bc78dca25e1cb4809ddceb308f00f3adbf96d4ebb6baaafc61a51353c10a047d29d8f32fc3912f16ec9ee4c1b3fb3f624ae46638d978276fcb583992197dc8cf3a23cc6aae01d258677f507de689109103723da8d8c361cda7f058c682c55d8d6a9e026c83967a4752448e06cfa5e710e828d6bc03c9f584d6e4a37e9f95ca07b125f252d6cc655f321f00853e15e95582319e228534dd2ba67409b907a56e7431a1dd5adf61dfaa7eb2aedb67b6522fd96c5dad453236fb88cb2cfb63b3476fdab36b431018997a3d8392fb216e8d4aba9e14046184c3b4d3c932cef7f167bc31cdbf0eb63d3c22c0d65f155eaa5dcd89909126bee3961164fe32e9c8013948ba38fc552802c64e6fb73a1dcaf0e273c18145c36e05278c0a092c7a68eb94151270f1c4d3f197d18bbc63ff71c97e6fd030c92502c8463a6d40493ead82336e5267b3ec5fa66537ce14b99484ca722e1511d8e29d0a33cebe87571baf53409a5397c7989ac96307702162eeeb0b206b0a29c901e12d72ee8de279737676ae40f818fdd558fc2c724c9330f4e7a64ecf731fb1cfcd0f74954355a8cb04df9acc805385adf6e6722a3280dac1e73d6e390c13f653a1a1c363d11e8e1928a345a724e6b318edc81d9273825d055c99b25d416c8b0236cabc4b72e96531e8085cc5caa013acf8cc6122eac8afefe033340f1128906f4b6d16cd261d91e8bc0996805bd00c5e0357b3c2f947a44bdb9aa5091dbe312aa159c2361d67424b4c371ec69585dc71e5b12ebe3904939d49e2155a4d07ddf84efe3488423b7ac0149739e85f2716fa0e7bdb5e5d0af6e8723c65c30fee72ba8151c47e3277b9c014a750b88e67e8c97bdda325b6992a920b9264fdbf409416bcb2d7309343bd08840ac4e33f15e602d837a1ba63e872e01302ece1f8a33f00312881621ec829dc5c322932cb517110d88d0b22a80343e7d6a08b9b02bd2d9f26b4f16b3f10d4cba5245ded7439a060f69416038e0210f75dce6db1d34a89d0fb2210d256fbf0b7262540a7decbd46ff9e4aaa64cca6c5d9e97511812eb4a1da36b587efdc554feb0952612571448762467b7c101a8e34a08bdd017440f11e2f3b5df1faa60ccf28ad4b6381e9bfd7ae3b492c4ffff7bc6d5a82e646caa9b03e86af0d17ab8e69e5d67726ab8d6eaad562ea9c1b1b1a68f240edfab55a17cd47eb0bbfc39641d1f46ddce43c928db8317137ece3ee12f0b84b71a7e3056be09de809c8eafc7f17eb2e0e669e55da3578b000749cb5c496c218cf90437a5d53025dff25b1e9a320b083db3923732cd7e700d264dba191797e7efbe3a1481b4226bde3b589334e966f2e10195c6c44e9c38c65effbf9bd2b66b19b2d67cfe7933c6520ff51798d6855ab2b02d4a605b59d4b10134f2295c518d87853469f2d0369920acda7d313d0cc5dbbae35f595b1f467b313982f93f7f37a3d6d591ac20f558c03bcf9cd0ae5f83595240de2f9d23e9a7d63cad69a17979906078204d20c9a5e5a0eba68454c45c4c23eb014d61d2210d0a9ab371f4fef2db2fd50df0624961c0fded382054ee76d98e87dab3dd583c63cd8f6206d901253dc9bebae3a82f991b81cf8593e0f0af71ffb4392f4ac05135698714a8a3332022498175ce62d523bc674cae6043132d90f70fa2b4ddd1dba2e188089fe34c94f5673342127fd9d06f6fb69d03396d6f557af08748b983d31d3399d5e1b78ea294bb838d18da9170f2a372d01a0cd17d387dd82d6b639cb47a7de661b89b45c864134ea81e445599d3fde4de661d012f8b836a70c015cfb1bb3591312a62dc10a94a98dd429385814106d6bed49571f56dd6cf025951d59156de58c4ff1040c65e737b41dec0322e1609bb49062c704714d022d2e0f1fc71d35925f88a06b5d5e9b500cc9568734dd4bef1693a1b22d56462a30f1395354e72907c7c55eb48202176e988f7f43b67cf3b4a4db406cc7ae79ffd3f7ebfdfd86ce6d0db3153138139367fa8fb4506981f4a0b3a18c066d56cf830819dc6c5e2e3ac169b1f555740547c5aec4791c15b0afd3ebe502dc847264fb3a62b9621577bf900f540c4f95e4dff0f30e234f3b150ed716b84e2432c9f04286d10de674034e574b60f4ddb04a5a966f66aff8740db4b185ab72eca504dd45a8adb1597577c25ec0e7cfded30fa857082a5211793a8ff15a6ced71f6db3b11085ff3844682baa60970a8d94b0636ab1a2319693d6d8228268860a86b62cd5f3dfcc71358eec3ac92e09e57f36a3b6238d4250cfb3fd3732b2c7cdfe689ed3fdce94ade1fe8039f0741c7efcba95680a4a90fbde34e6dbc264c636a477daf65490886a616dbb46d586563f05b97a6f7ea4e1bcc2074b92dbc5d1bb0ff4945261a40728642a74d354fa81b6bdc6dc50d269b1443fbea5afb376e822bd11252f2fc0e3912e61061964461f7ac717db8bd421d9f04a7aed3cb97a2c87ab8eb2cd5eb77f58d9a2081998dbdb7073dac756b8a1e3d9d0ef6394086ab0f00945e7085005626ca04140e7ea8b41b927c3a9fb710f0dcdd53dcff4078a26027878d39a5bce7fb06239c9c7891a912d2a1ca5c92653a97d22d8ca6fedefd6060e5ac8b9af1d2dffcf2d3b55c796b4710f50ba76ff86fb9691fb477d1b2942102e9cac43e0fbd898531364cae0893b17d73bdb49478e85dc62b777b3006b1cd71dbf41eaa48f50b864427e9c7892cf3c6f9f79fa5e72db572db94f59527e0e08b1d8918bf986535e9a02b6dd47d9e60cb72173e02cd148d50de1d4c49254908729ab66216287756fe4a804c3631465b6019380a54782e24c44ec5529ad14a43addbe1fc59a2d82f608cf22cbd91dfe82638107a2e63c4cf7fec110b24767d28386ad8964cfb5db5e33e028948a291b012a9ff3862fe8ad52127fe151e8cf540fff3e72ae3401036bb2707ebbc9c427d3331fb126a7ce07d9ef29edb53b35b2cd77e594d120e71aa67e1408004dccd0da6a7ff1f4c81d25f73e91780e355014af889d15ec21dace6095f6221cb7672a269cefd08ca770da2d7344de39e79b12b7dafe538c9a1fd228ca5a7d66869a59300f34383fe595bd1642309eff446593ce152d078e18933ccd7e67ca510be4d5e4371834eca55058f41c0d8bd35806bd08bc1a1bc3d59409ff99d1eedc993bc5716fa35e8f925ac3b2160f3f064bb5199e05e33945c2beb369ea0e3119be32aae0bd587e45f4773fd59b088816c83d15a781e4eca7a72d1e0586acb408d45dd2136afbe356d506fe924f0ab754b9c9a1ad024cae5afc154d77cc0e2bb7667af029cc4387dafddbf4975dd6f50c616ae60ab51532fe981b734fd7727f7a885f40bda6a87f2100c2459050e8c9369e38093b1907d6d5c4e8866deef92958cd8553e38dee0f1c00d5deb924dd940e6318940ed5951efee9e8374e524233d7fd027e1f607225a746654f97ec9806b88f5a06f8baf1d688c756cfedc063918ca05bc67be4ba7f574e2e3a12785b417c57c8498cb0cd4d4b793dd2679fa469ed91c1874d0effa8b32b0b06230bbbcfbceec91e958bb60403cd3f13640bbdd4645bf860c7edf842ea9b4f20423c0e415523521cdfc15653e9bc1e60b5ccbc99c52f38d372b02e55762b7b215b97372fc5b5fe008ab3dfc854a8b91cf84d4d98b24561b9b45035e9fdba6712f1fc1c5699b1afa597fa1530f2f96ebf08f1e4ff9dd1b11bd27cb794ef10a5e632f7ec77762a88043d27b2909fc936a7024693540f61075367e2a23f018de9bf5f1f9c5dcab65eeb006404b9eac9bfb6895ef6149c73b9b7480ea7417a246a3224750a3230c7b8e5f6dfbec21ea7775bf152003f204acb26b26a7ffa8940e2646b6a6b61723366ad51ffe3533d0eff2129ac1aee2d952bd1592e5258e7673dac771a2aa61d60caa62767ffbb6c79083dc67bb3a9e6af18fb0ffdc0f0dd2aba00bffa2161cfa6e383e908057198e9682b49bc856a3a610c4644491fbb9737de3ebff87198bec061df50f797871cc48802ec32bf9d5652006d19101a4a482162eb406966311324bc6b63d8350f9203d383953176ab1fee9111f34f5aa4de3f6cb30595282730dc8be7d21d40eb8412393326ef52f5b948661bca459ffa08f0b29a17726f1c7783e0b5485da051a3bfd5a31f8b9586a42bde6d0098f0476144147e4d1531b05c065e456bc1e954bbb7b38795f6feb9cbcc3119aadea3b2cd0632edb81c958c50a17606ee86596ccd67fef9d5ec4943e611c7df68f7df166ad58886cf6d8f53b6a39f7a0e1ab1271f6f1225b39fbac72f1906c233b23b996c52f3fa327fd28bd4afeee8fa07b32e0dfcd6285432a49b4d394b80a8e99053c61a38350454b12b012b501856851bad216365f491353cc52f2391e92b02ec2457487eaaeb9744fe5f57d529ed3a4196ff2e7f6926c4a2c0d5e522b4856f3919d9e8ade36494259582230de51baab371b37d314528f844fade61367ad0af9961df993b7310d96ca6e321d21a10599717390b848b0a419a817a678de7d01a618e7430c7c5fd00464a3c1e3f9c696179a750baa12e868f0d83e9184174745f9a53613daa5b0341fa46f614dfe09d92ad80c6b694fd8b4f80944b365532a8431f6542954766cfc6ff56abcd0526b8d0997e745c76def13471248cd77d9ed9b8abc853d4472fd6c24a62b5c477a3a7ee914c0ae487c4fac22ab2e69bebc8b65b0164126df05dd3e6d573e1ace3008ab83fc33ab0232ef3d838da42d11b2704a0a241c1d5019e63dd82ced9b2eae8e4c4629ae3ce2b1bf29ce3a5bf5951be242235f0ee51f862c2386bd2cdeae7f3bbf610371332cdd5934f23c5a836c37af392b8d59bbd12e0eb018e07ec5a519ef9e882b8f20098cef22e86d090fbb675f279ff17ab2d0af67cc6547c7ef7579ccf6957a638407d111b4968bda1c8553577ac7817485055d35086c658478cce707d1008127202c13f8e854b1b8df999dbca043323950496175f9bc911147ad82f4e95be29b9a45172f81b6d2d241758561e8a6e99d9f620acf55ab39edc150f6966fe85b1a242b6047d6ed600d8be94d315c98bcb12e52867ee49ea37c59661b6aec9fc1380f9290b88eb88986c398cefe5f08a23b2a7589fa99504ea4da53ccfe3a047226d5afaf6db9930dc23dddfe4ae1db82d9dd</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好，这里需要密码。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">摘要</summary>
    
    
    
    <category term="记录" scheme="https://changqingaas.github.io/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>论文黑话祛魅</title>
    <link href="https://changqingaas.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/Others/%E8%AE%BA%E6%96%87%E9%BB%91%E8%AF%9D%E7%A5%9B%E9%AD%85/"/>
    <id>https://changqingaas.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/Others/%E8%AE%BA%E6%96%87%E9%BB%91%E8%AF%9D%E7%A5%9B%E9%AD%85/</id>
    <published>2022-10-24T14:00:33.000Z</published>
    <updated>2022-10-24T09:07:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>feature：一个数组</p><p>representation：还是一个数组</p><p>embedding：把输入映射成数组</p><p>提高泛化性：预测更准了</p><p>过拟合：训练过头了</p><p>attention：加权</p><p>adaptive：还是加权</p><p>few-shot learning：看了几个样本就学</p><p>zero-shot learning：一个没看就开始瞎蒙</p><p>self-supervised：自学</p><p>semi-supervised：教一点自学一点</p><p>unsupervised：没人教了，跟谁学？</p><p>end-to-end：一套操作，行云流水搞到底</p><p>multi-stage：发现不行，还得一步一步来</p><p>domain：我圈起来一堆样本，就管他叫一个domain</p><p>transfer：我非得在这一堆样本上训练，用在另一堆样本上，就是不直接训练，就是玩～</p><p>adversarial：我加了一部分就是让loss增大</p><p>robust：很稳我不会让loss变大的（但也不容易变小了）</p><p>state of the art：我（吹nb）第一</p><p>outperform：我虽然没第一，但是我比baseline强</p><p>baseline：(故意)选出来的方法，让我能够outperform</p><p>empirically：我做实验了，不知道为啥work</p><p>theoretically：我以为我知道为啥work，但没做实验，或者只做了个toy model</p><h2 id="multi"><a href="#multi" class="headerlink" title="multi-"></a>multi-</h2><p>multi-task：把几个loss加一起，完事</p><p>multi-domain：把几堆儿样本混一块训练，完事</p><p>multi-modality：把视频语音文字图像graph点云xxx混一块训练，完事</p><p>multi-domain multi-modal multi-media model：mua～mua～mua～mua……</p><p>Transformer：拉成条儿加权</p><p>消融实验：控制变量法</p><p>n-fold 验证：数据切n份验证遍</p><p>集成学习：多训几个模型一起用</p><p>back propagation: 求导</p><p>Trade-off：两个需求都满足得不好，但都不太差  </p><p>Novel：把一个风马牛不相及的东西用在了这里  </p><p>Compared method：专门选出来的能打赢的对手  </p><p>Rethink：一竿子打翻一船人  </p><p>X is all you need：标题只是为了把你骗进来，其实你need lots of tricks  </p><p>Long-standing problem: 出现不超过五年的问题  </p><p>Efficient：少用了点儿时间或数据  </p><p>Intuitive：我想到了你一下子也能想到的东西</p>]]></content>
    
    
    <summary type="html">英文单词+解释</summary>
    
    
    
    <category term="论文阅读" scheme="https://changqingaas.github.io/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>书影记录</title>
    <link href="https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E4%B9%A6%E5%BD%B1%E8%AE%B0%E5%BD%95/"/>
    <id>https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E4%B9%A6%E5%BD%B1%E8%AE%B0%E5%BD%95/</id>
    <published>2022-10-24T08:00:00.000Z</published>
    <updated>2022-10-29T06:59:41.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="想看的综艺"><a href="#想看的综艺" class="headerlink" title="想看的综艺"></a>想看的综艺</h1><h2 id="凤凰卫视"><a href="#凤凰卫视" class="headerlink" title="凤凰卫视"></a>凤凰卫视</h2><ul><li>世纪大讲堂</li><li>锵锵三人行</li><li>凤凰大视野</li><li>冷暖人生<h2 id="演讲"><a href="#演讲" class="headerlink" title="演讲"></a>演讲</h2></li><li>一席<h2 id="访谈"><a href="#访谈" class="headerlink" title="访谈"></a>访谈</h2></li><li>十三邀<ul><li>看了四季了吧</li></ul></li><li>圆桌派</li><li>和陌生人说话</li></ul><h2 id="书信"><a href="#书信" class="headerlink" title="书信"></a>书信</h2><ul><li>见字如面</li><li>郎读者</li></ul><h1 id="我读"><a href="#我读" class="headerlink" title="我读"></a>我读</h1><div class="table-container"><table><thead><tr><th>标题</th><th>个人评分</th><th>打分日期</th><th>我的短评</th><th>出版日期</th><th>作者</th><th>条目链接</th></tr></thead><tbody><tr><td>“事实”</td><td>“3”</td><td>“2022/10/12”</td><td>“”</td><td>“2019/4”</td><td>“[瑞典] 汉斯·罗斯林”</td><td>“<a href="https://book.douban.com/subject/33385402/">https://book.douban.com/subject/33385402/</a>“</td></tr><tr><td>“Docker实战”</td><td>“4”</td><td>“2022/06/11”</td><td>“docker1.12有点过时了，运行第二章的一个命令就报错了，大家还是找一些更新的书籍学习吧”</td><td>“2017/1”</td><td>“【美】Jeff Nickoloff”</td><td>“<a href="https://book.douban.com/subject/26928415/">https://book.douban.com/subject/26928415/</a>“</td></tr><tr><td>“Go Web编程”</td><td>“3”</td><td>“2022/05/21”</td><td>“”</td><td>“2013/6/1”</td><td>“谢孟军”</td><td>“<a href="https://book.douban.com/subject/24316255/">https://book.douban.com/subject/24316255/</a>“</td></tr><tr><td>“Go程序设计语言”</td><td>“5”</td><td>“2022/05/14”</td><td>“”</td><td>“2017/5”</td><td>“艾伦 A. A. 多诺万”</td><td>“<a href="https://book.douban.com/subject/27044219/">https://book.douban.com/subject/27044219/</a>“</td></tr><tr><td>“Go语言高级编程”</td><td>“4”</td><td>“2022/05/14”</td><td>“感觉每个地方都没讲透”</td><td>“2019/7/9”</td><td>“柴树杉”</td><td>“<a href="https://book.douban.com/subject/34442131/">https://book.douban.com/subject/34442131/</a>“</td></tr><tr><td>“把时间当作朋友”</td><td>“4”</td><td>“2022/02/10”</td><td>“前半部分收获较多，后面感觉作者陷入鸡汤的感觉了”</td><td>“2009/6”</td><td>“李笑来”</td><td>“<a href="https://book.douban.com/subject/3609132/">https://book.douban.com/subject/3609132/</a>“</td></tr><tr><td>“深度学习的数学”</td><td>“4”</td><td>“2022/02/10”</td><td>“略有收获”</td><td>“2019/4”</td><td>“[日]涌井良幸”</td><td>“<a href="https://book.douban.com/subject/33414479/">https://book.douban.com/subject/33414479/</a>“</td></tr><tr><td>“上帝掷骰子吗”</td><td>“4”</td><td>“2021/09/15”</td><td>“”</td><td>“2006/1”</td><td>“曹天元”</td><td>“<a href="https://book.douban.com/subject/1467022/">https://book.douban.com/subject/1467022/</a>“</td></tr><tr><td>“浪潮之巅”</td><td>“5”</td><td>“2021/09/15”</td><td>“”</td><td>“2011/8”</td><td>“吴军”</td><td>“<a href="https://book.douban.com/subject/6709783/">https://book.douban.com/subject/6709783/</a>“</td></tr><tr><td>“这些人，那些事”</td><td>“4”</td><td>“2021/09/15”</td><td>“”</td><td>“2011/9”</td><td>“吴念真”</td><td>“<a href="https://book.douban.com/subject/6388661/">https://book.douban.com/subject/6388661/</a>“</td></tr><tr><td>“沉默的大多数”</td><td>“5”</td><td>“2021/02/19”</td><td>“”</td><td>“2016/1/1”</td><td>“王小波”</td><td>“<a href="https://book.douban.com/subject/26738729/">https://book.douban.com/subject/26738729/</a>“</td></tr><tr><td>“读者”</td><td>“5”</td><td>“2021/02/19”</td><td>“”</td><td>“2009/9”</td><td>“梁文道”</td><td>“<a href="https://book.douban.com/subject/4031698/">https://book.douban.com/subject/4031698/</a>“</td></tr><tr><td>“病隙碎笔”</td><td>“5”</td><td>“2021/02/19”</td><td>“”</td><td>“2008/1/1”</td><td>“史铁生”</td><td>“<a href="https://book.douban.com/subject/2976685/">https://book.douban.com/subject/2976685/</a>“</td></tr><tr><td>“亲爱的安德烈（插图第2版）”</td><td>“4”</td><td>“2021/02/19”</td><td>“”</td><td>“2015/4”</td><td>“龙应台”</td><td>“<a href="https://book.douban.com/subject/26371102/">https://book.douban.com/subject/26371102/</a>“</td></tr><tr><td>“一个叫欧维的男人决定去死”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“2015/12”</td><td>“[瑞典] 弗雷德里克·巴克曼”</td><td>“<a href="https://book.douban.com/subject/26672693/">https://book.douban.com/subject/26672693/</a>“</td></tr><tr><td>“占星术杀人魔法”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“2008/9”</td><td>“[日] 岛田庄司”</td><td>“<a href="https://book.douban.com/subject/3187737/">https://book.douban.com/subject/3187737/</a>“</td></tr><tr><td>“钢铁是怎样炼成的”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“1996/10”</td><td>“[苏] 尼·奥斯特洛夫斯基”</td><td>“<a href="https://book.douban.com/subject/1013502/">https://book.douban.com/subject/1013502/</a>“</td></tr><tr><td>“悲惨世界（上下）”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“2011/12”</td><td>“雨果”</td><td>“<a href="https://book.douban.com/subject/6828854/">https://book.douban.com/subject/6828854/</a>“</td></tr><tr><td>“高智商犯罪”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2013/8”</td><td>“紫金陈”</td><td>“<a href="https://book.douban.com/subject/25663137/">https://book.douban.com/subject/25663137/</a>“</td></tr><tr><td>“高智商犯罪2”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“2014/3”</td><td>“紫金陈”</td><td>“<a href="https://book.douban.com/subject/25827236/">https://book.douban.com/subject/25827236/</a>“</td></tr><tr><td>“高智商犯罪3”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2017”</td><td>“紫金陈”</td><td>“<a href="https://book.douban.com/subject/26895196/">https://book.douban.com/subject/26895196/</a>“</td></tr><tr><td>“我承认我不曾历经沧桑”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2013/10”</td><td>“蒋方舟”</td><td>“<a href="https://book.douban.com/subject/25741244/">https://book.douban.com/subject/25741244/</a>“</td></tr><tr><td>“心理罪”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2012/12”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/20382491/">https://book.douban.com/subject/20382491/</a>“</td></tr><tr><td>“心理罪”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2011/2”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/5904212/">https://book.douban.com/subject/5904212/</a>“</td></tr><tr><td>“心理罪之画像”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2012/1”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/6977651/">https://book.douban.com/subject/6977651/</a>“</td></tr><tr><td>“心理罪之第七个读者”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2015/3”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/26277676/">https://book.douban.com/subject/26277676/</a>“</td></tr><tr><td>“心理罪”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2012/1”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/4732150/">https://book.douban.com/subject/4732150/</a>“</td></tr><tr><td>“第七个读者”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2010/4”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/26378909/">https://book.douban.com/subject/26378909/</a>“</td></tr><tr><td>“心理罪”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2007/11”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/2303588/">https://book.douban.com/subject/2303588/</a>“</td></tr><tr><td>“心理罪2：教化场”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2008/10/1”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/3238242/">https://book.douban.com/subject/3238242/</a>“</td></tr><tr><td>“心理罪之畫像”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2009年01月21日”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/3861553/">https://book.douban.com/subject/3861553/</a>“</td></tr><tr><td>“心理罪之教化場”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2009年03月05日”</td><td>“雷米”</td><td>“<a href="https://book.douban.com/subject/3921627/">https://book.douban.com/subject/3921627/</a>“</td></tr><tr><td>“怪诞行为学”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2008/10”</td><td>“[美] 丹·艾瑞里”</td><td>“<a href="https://book.douban.com/subject/3223711/">https://book.douban.com/subject/3223711/</a>“</td></tr><tr><td>“怪诞行为学”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2010/9”</td><td>“[美] 丹·艾瑞里”</td><td>“<a href="https://book.douban.com/subject/4929844/">https://book.douban.com/subject/4929844/</a>“</td></tr><tr><td>“怪诞行为学”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2017/12/20”</td><td>“[美] 丹·艾瑞里”</td><td>“<a href="https://book.douban.com/subject/27599381/">https://book.douban.com/subject/27599381/</a>“</td></tr><tr><td>“魔鬼经济学”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2007/7”</td><td>“[美] 史蒂芬·列维特”</td><td>“<a href="https://book.douban.com/subject/1473250/">https://book.douban.com/subject/1473250/</a>“</td></tr><tr><td>“魔鬼经济学（罗辑思维独家定制版）”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2016/6”</td><td>“[美]史蒂芬 · 列维特”</td><td>“<a href="https://book.douban.com/subject/26799211/">https://book.douban.com/subject/26799211/</a>“</td></tr><tr><td>“魔鬼经济学4”</td><td>“5”</td><td>“2021/02/07”</td><td>“”</td><td>“2016/9”</td><td>“Steven D. Levitt”</td><td>“<a href="https://book.douban.com/subject/26853104/">https://book.douban.com/subject/26853104/</a>“</td></tr><tr><td>“魔鬼经济学2”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2016/6”</td><td>“[美] 史蒂芬·列维特”</td><td>“<a href="https://book.douban.com/subject/26841940/">https://book.douban.com/subject/26841940/</a>“</td></tr><tr><td>“超爆魔鬼经济学”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2010/4”</td><td>“史蒂芬•列维特”</td><td>“<a href="https://book.douban.com/subject/4720572/">https://book.douban.com/subject/4720572/</a>“</td></tr><tr><td>“魔鬼经济学3”</td><td>“4”</td><td>“2021/02/07”</td><td>“”</td><td>“2016/9”</td><td>“[美] 史蒂芬·列维特”</td><td>“<a href="https://book.douban.com/subject/26853102/">https://book.douban.com/subject/26853102/</a>“</td></tr><tr><td>“黑客与画家”</td><td>“5”</td><td>“2020/03/17”</td><td>“”</td><td>“2011/4”</td><td>“[美] Paul Graham”</td><td>“<a href="https://book.douban.com/subject/6021440/">https://book.douban.com/subject/6021440/</a>“</td></tr><tr><td>“强风吹拂”</td><td>“4”</td><td>“2020/03/17”</td><td>“”</td><td>“2015/1/1”</td><td>“三浦紫苑”</td><td>“<a href="https://book.douban.com/subject/26210487/">https://book.douban.com/subject/26210487/</a>“</td></tr><tr><td>“不思议图书馆”</td><td>“4”</td><td>“2020/02/11”</td><td>“”</td><td>“2017/6”</td><td>“[日] 寺山修司”</td><td>“<a href="https://book.douban.com/subject/27026325/">https://book.douban.com/subject/27026325/</a>“</td></tr><tr><td>“祖国的名称”</td><td>“5”</td><td>“2020/02/11”</td><td>“”</td><td>“2017/1”</td><td>“高等教育出版社”</td><td>“<a href="https://book.douban.com/subject/26980935/">https://book.douban.com/subject/26980935/</a>“</td></tr><tr><td>“世界经典推理小说”</td><td>“4”</td><td>“2020/02/11”</td><td>“”</td><td>“2018/2”</td><td>“杨永胜”</td><td>“<a href="https://book.douban.com/subject/30296089/">https://book.douban.com/subject/30296089/</a>“</td></tr><tr><td>“世界悬念惊悚大师希区柯克故事集”</td><td>“5”</td><td>“2020/02/11”</td><td>“”</td><td>“2018/2”</td><td>“阿尔弗莱德·希区柯克”</td><td>“<a href="https://book.douban.com/subject/34851976/">https://book.douban.com/subject/34851976/</a>“</td></tr><tr><td>“世界经典悬疑小说”</td><td>“4”</td><td>“2020/02/11”</td><td>“”</td><td>“2018/2”</td><td>“爱伦坡”</td><td>“<a href="https://book.douban.com/subject/30311805/">https://book.douban.com/subject/30311805/</a>“</td></tr><tr><td>“今日简史”</td><td>“1”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/8”</td><td>“[以] 尤瓦尔·赫拉利”</td><td>“<a href="https://book.douban.com/subject/30259720/">https://book.douban.com/subject/30259720/</a>“</td></tr><tr><td>“盗墓笔记”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/1”</td><td>“南派三叔”</td><td>“<a href="https://book.douban.com/subject/1948901/">https://book.douban.com/subject/1948901/</a>“</td></tr><tr><td>“肖申克的救赎”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/7”</td><td>“[美] 斯蒂芬·金”</td><td>“<a href="https://book.douban.com/subject/1829226/">https://book.douban.com/subject/1829226/</a>“</td></tr><tr><td>“万历十五年”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1997/5”</td><td>“[美] 黄仁宇”</td><td>“<a href="https://book.douban.com/subject/1041482/">https://book.douban.com/subject/1041482/</a>“</td></tr><tr><td>“巴黎圣母院”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/7/1”</td><td>“雨果”</td><td>“<a href="https://book.douban.com/subject/2253413/">https://book.douban.com/subject/2253413/</a>“</td></tr><tr><td>“海子的诗”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1999/04”</td><td>“海子”</td><td>“<a href="https://book.douban.com/subject/1011754/">https://book.douban.com/subject/1011754/</a>“</td></tr><tr><td>“斯通纳”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/1”</td><td>“[美] 约翰·威廉斯”</td><td>“<a href="https://book.douban.com/subject/26425831/">https://book.douban.com/subject/26425831/</a>“</td></tr><tr><td>“资治通鉴”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/1”</td><td>“司马光”</td><td>“<a href="https://book.douban.com/subject/2029680/">https://book.douban.com/subject/2029680/</a>“</td></tr><tr><td>“呐喊”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1973/3”</td><td>“鲁迅”</td><td>“<a href="https://book.douban.com/subject/1449351/">https://book.douban.com/subject/1449351/</a>“</td></tr><tr><td>“2001：太空漫游”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/5/10”</td><td>“[英] 阿瑟·克拉克”</td><td>“<a href="https://book.douban.com/subject/30471298/">https://book.douban.com/subject/30471298/</a>“</td></tr><tr><td>“三国演义（全二册）”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1998/05”</td><td>“[明] 罗贯中”</td><td>“<a href="https://book.douban.com/subject/1019568/">https://book.douban.com/subject/1019568/</a>“</td></tr><tr><td>“我的精神家园”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1997”</td><td>“王小波”</td><td>“<a href="https://book.douban.com/subject/1014578/">https://book.douban.com/subject/1014578/</a>“</td></tr><tr><td>“钢铁是怎样炼成的”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/8/1”</td><td>“奥斯特洛夫斯基”</td><td>“<a href="https://book.douban.com/subject/1894744/">https://book.douban.com/subject/1894744/</a>“</td></tr><tr><td>“常识”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/1”</td><td>“梁文道”</td><td>“<a href="https://book.douban.com/subject/3344676/">https://book.douban.com/subject/3344676/</a>“</td></tr><tr><td>“孩子你慢慢来”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/12/1”</td><td>“龙应台”</td><td>“<a href="https://book.douban.com/subject/4207781/">https://book.douban.com/subject/4207781/</a>“</td></tr><tr><td>“我执”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/10”</td><td>“梁文道”</td><td>“<a href="https://book.douban.com/subject/3642673/">https://book.douban.com/subject/3642673/</a>“</td></tr><tr><td>“三体Ⅱ”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/5”</td><td>“刘慈欣”</td><td>“<a href="https://book.douban.com/subject/3066477/">https://book.douban.com/subject/3066477/</a>“</td></tr><tr><td>“不能承受的生命之轻”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2003/7”</td><td>“[捷克] 米兰·昆德拉”</td><td>“<a href="https://book.douban.com/subject/1017143/">https://book.douban.com/subject/1017143/</a>“</td></tr><tr><td>“目送”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/10”</td><td>“龙应台”</td><td>“<a href="https://book.douban.com/subject/3995526/">https://book.douban.com/subject/3995526/</a>“</td></tr><tr><td>“民主的细节”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/6”</td><td>“刘瑜”</td><td>“<a href="https://book.douban.com/subject/3813669/">https://book.douban.com/subject/3813669/</a>“</td></tr><tr><td>“三体”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/1”</td><td>“刘慈欣”</td><td>“<a href="https://book.douban.com/subject/2567698/">https://book.douban.com/subject/2567698/</a>“</td></tr><tr><td>“看见”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/1/1”</td><td>“柴静”</td><td>“<a href="https://book.douban.com/subject/20427187/">https://book.douban.com/subject/20427187/</a>“</td></tr><tr><td>“天才在左 疯子在右”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/2”</td><td>“高铭”</td><td>“<a href="https://book.douban.com/subject/4242172/">https://book.douban.com/subject/4242172/</a>“</td></tr><tr><td>“霍乱时期的爱情”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/9/1”</td><td>“[哥伦比亚] 加西亚·马尔克斯”</td><td>“<a href="https://book.douban.com/subject/10594787/">https://book.douban.com/subject/10594787/</a>“</td></tr><tr><td>“送你一颗子弹”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/1”</td><td>“刘瑜”</td><td>“<a href="https://book.douban.com/subject/4238362/">https://book.douban.com/subject/4238362/</a>“</td></tr><tr><td>“亲爱的安德烈”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/12”</td><td>“龙应台”</td><td>“<a href="https://book.douban.com/subject/3369793/">https://book.douban.com/subject/3369793/</a>“</td></tr><tr><td>“沉默的大多数”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1997/10”</td><td>“王小波”</td><td>“<a href="https://book.douban.com/subject/1054685/">https://book.douban.com/subject/1054685/</a>“</td></tr><tr><td>“鬼吹灯之精绝古城”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2006”</td><td>“天下霸唱”</td><td>“<a href="https://book.douban.com/subject/1882933/">https://book.douban.com/subject/1882933/</a>“</td></tr><tr><td>“一只特立独行的猪”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/4”</td><td>“王小波”</td><td>“<a href="https://book.douban.com/subject/1767945/">https://book.douban.com/subject/1767945/</a>“</td></tr><tr><td>“菊与刀”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1990/6”</td><td>“[美] 鲁思·本尼迪克特”</td><td>“<a href="https://book.douban.com/subject/1022238/">https://book.douban.com/subject/1022238/</a>“</td></tr><tr><td>“我与地坛”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2002/5”</td><td>“史铁生”</td><td>“<a href="https://book.douban.com/subject/1209899/">https://book.douban.com/subject/1209899/</a>“</td></tr><tr><td>“悲惨世界（上中下）”</td><td>“5”</td><td>“2020/02/08”</td><td>“累，”</td><td>“1992/6”</td><td>“[法] 雨果”</td><td>“<a href="https://book.douban.com/subject/1205054/">https://book.douban.com/subject/1205054/</a>“</td></tr><tr><td>“未来简史”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/2”</td><td>“[以色列] 尤瓦尔·赫拉利”</td><td>“<a href="https://book.douban.com/subject/26943161/">https://book.douban.com/subject/26943161/</a>“</td></tr><tr><td>“观念的水位”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/1”</td><td>“刘瑜”</td><td>“<a href="https://book.douban.com/subject/20463108/">https://book.douban.com/subject/20463108/</a>“</td></tr><tr><td>“悲惨世界”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1992/6”</td><td>“雨果”</td><td>“<a href="https://book.douban.com/subject/3200760/">https://book.douban.com/subject/3200760/</a>“</td></tr><tr><td>“钢铁是怎样炼成的”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/6/1”</td><td>“尼•奥斯特洛夫斯基”</td><td>“<a href="https://book.douban.com/subject/4881638/">https://book.douban.com/subject/4881638/</a>“</td></tr><tr><td>“悲惨世界（上下）”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/8”</td><td>“雨果”</td><td>“<a href="https://book.douban.com/subject/1880986/">https://book.douban.com/subject/1880986/</a>“</td></tr><tr><td>“思考，快与慢”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/7”</td><td>“[美] 丹尼尔·卡尼曼”</td><td>“<a href="https://book.douban.com/subject/10785583/">https://book.douban.com/subject/10785583/</a>“</td></tr><tr><td>“悲惨世界（上下）”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/11”</td><td>“（法）雨果”</td><td>“<a href="https://book.douban.com/subject/5407295/">https://book.douban.com/subject/5407295/</a>“</td></tr><tr><td>“皮囊”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/12/1”</td><td>“蔡崇达”</td><td>“<a href="https://book.douban.com/subject/26278687/">https://book.douban.com/subject/26278687/</a>“</td></tr><tr><td>“盗墓笔记”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2011/12/1”</td><td>“南派三叔”</td><td>“<a href="https://book.douban.com/subject/6953273/">https://book.douban.com/subject/6953273/</a>“</td></tr></tbody></table></div><h1 id="我待读"><a href="#我待读" class="headerlink" title="我待读"></a>我待读</h1><div class="table-container"><table><thead><tr><th>标题</th><th>出版日期</th><th>作者</th><th>条目链接</th></tr></thead><tbody><tr><td>“如何阅读一本书”</td><td>“2004/1”</td><td>“[美] 莫提默·J. 艾德勒”</td><td>“<a href="https://book.douban.com/subject/1013208/">https://book.douban.com/subject/1013208/</a>“</td></tr><tr><td>“从一到无穷大”</td><td>“2019/9”</td><td>“[美] 乔治·伽莫夫”</td><td>“<a href="https://book.douban.com/subject/34782541/">https://book.douban.com/subject/34782541/</a>“</td></tr><tr><td>“从一到无穷大”</td><td>“2002/11”</td><td>“[美] G. 伽莫夫”</td><td>“<a href="https://book.douban.com/subject/1102715/">https://book.douban.com/subject/1102715/</a>“</td></tr><tr><td>“失恋33天”</td><td>“2010/1”</td><td>“鲍鲸鲸”</td><td>“<a href="https://book.douban.com/subject/4238754/">https://book.douban.com/subject/4238754/</a>“</td></tr><tr><td>“毛泽东选集 第一卷”</td><td>“1991/5”</td><td>“毛泽东”</td><td>“<a href="https://book.douban.com/subject/1139360/">https://book.douban.com/subject/1139360/</a>“</td></tr><tr><td>“台北人”</td><td>“2010/10”</td><td>“白先勇”</td><td>“<a href="https://book.douban.com/subject/5337248/">https://book.douban.com/subject/5337248/</a>“</td></tr><tr><td>“查拉图斯特拉如是说”</td><td>“2007/12”</td><td>“[德] 尼采”</td><td>“<a href="https://book.douban.com/subject/2359052/">https://book.douban.com/subject/2359052/</a>“</td></tr><tr><td>“受戒”</td><td>“1987/10”</td><td>“汪曾祺”</td><td>“<a href="https://book.douban.com/subject/1760432/">https://book.douban.com/subject/1760432/</a>“</td></tr><tr><td>“设计中的设计”</td><td>“2006/11”</td><td>“[日] 原研哉”</td><td>“<a href="https://book.douban.com/subject/1941558/">https://book.douban.com/subject/1941558/</a>“</td></tr><tr><td>“编码”</td><td>“2010”</td><td>“[美] Charles Petzold”</td><td>“<a href="https://book.douban.com/subject/4822685/">https://book.douban.com/subject/4822685/</a>“</td></tr><tr><td>“尤利西斯”</td><td>“2012/5”</td><td>“[爱尔兰] 乔伊斯”</td><td>“<a href="https://book.douban.com/subject/5958737/">https://book.douban.com/subject/5958737/</a>“</td></tr><tr><td>“穷查理宝典”</td><td>“2010/10/01”</td><td>“[美]彼得·考夫曼 (编)”</td><td>“<a href="https://book.douban.com/subject/5346110/">https://book.douban.com/subject/5346110/</a>“</td></tr><tr><td>“默读”</td><td>“2018/1”</td><td>“Priest”</td><td>“<a href="https://book.douban.com/subject/27608412/">https://book.douban.com/subject/27608412/</a>“</td></tr><tr><td>“大象席地而坐”</td><td>“2019/11”</td><td>“胡迁”</td><td>“<a href="https://book.douban.com/subject/34866400/">https://book.douban.com/subject/34866400/</a>“</td></tr></tbody></table></div><h1 id="我看"><a href="#我看" class="headerlink" title="我看"></a>我看</h1><div class="table-container"><table><thead><tr><th>标题</th><th>个人评分</th><th>打分日期</th><th>我的短评</th><th>上映日期</th><th>制片国家</th><th>条目链接</th></tr></thead><tbody><tr><td>“巴斯特·斯克鲁格斯的歌谣 / The Ballad of Buster Scruggs”</td><td>“4”</td><td>“2022/10/08”</td><td>“”</td><td>“2018/08/31”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/26952704/">https://movie.douban.com/subject/26952704/</a>“</td></tr><tr><td>“一一”</td><td>“3”</td><td>“2022/09/24”</td><td>“”</td><td>“2000/05/14”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/1292434/">https://movie.douban.com/subject/1292434/</a>“</td></tr><tr><td>“追风筝的人 / The Kite Runner”</td><td>“4”</td><td>“2022/09/23”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1937502/">https://movie.douban.com/subject/1937502/</a>“</td></tr><tr><td>“一天 / One Day”</td><td>“3”</td><td>“2022/09/22”</td><td>“”</td><td>“2011/08/19”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/4191644/">https://movie.douban.com/subject/4191644/</a>“</td></tr><tr><td>“鸟人 / Birdman or (The Unexpected Virtue of Ignorance)”</td><td>“5”</td><td>“2022/09/22”</td><td>“”</td><td>“2014/08/27”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/20438962/">https://movie.douban.com/subject/20438962/</a>“</td></tr><tr><td>“间谍过家家 / SPY×FAMILY”</td><td>“5”</td><td>“2022/09/21”</td><td>“”</td><td>“2022/04/09”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/35258427/">https://movie.douban.com/subject/35258427/</a>“</td></tr><tr><td>“侧耳倾听 / 耳をすませば”</td><td>“4”</td><td>“2022/09/21”</td><td>“”</td><td>“1995/07/15”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1297052/">https://movie.douban.com/subject/1297052/</a>“</td></tr><tr><td>“无耻之徒(美版) 第五季 / Shameless Season 5”</td><td>“4”</td><td>“2022/09/19”</td><td>“”</td><td>“2015/01/11”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/25831924/">https://movie.douban.com/subject/25831924/</a>“</td></tr><tr><td>“东八区的先生们”</td><td>“1”</td><td>“2022/09/14”</td><td>“”</td><td>“2022/08/31”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35160920/">https://movie.douban.com/subject/35160920/</a>“</td></tr><tr><td>“紫日”</td><td>“5”</td><td>“2022/09/06”</td><td>“”</td><td>“2001/04/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1308078/">https://movie.douban.com/subject/1308078/</a>“</td></tr><tr><td>“浪潮 / Die Welle”</td><td>“4”</td><td>“2022/07/30”</td><td>“”</td><td>“2008/03/13”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/2297265/">https://movie.douban.com/subject/2297265/</a>“</td></tr><tr><td>“激辩风云 / The Great Debaters”</td><td>“4”</td><td>“2022/07/28”</td><td>“”</td><td>“2007/12/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2077287/">https://movie.douban.com/subject/2077287/</a>“</td></tr><tr><td>“西部世界 第四季 / Westworld Season 4”</td><td>“4”</td><td>“2022/07/26”</td><td>“”</td><td>“2022/06/26”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/35042913/">https://movie.douban.com/subject/35042913/</a>“</td></tr><tr><td>“人生切割术 第一季 / Severance Season 1”</td><td>“4”</td><td>“2022/07/23”</td><td>“剧情有点干瘪”</td><td>“2022/02/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/34885342/">https://movie.douban.com/subject/34885342/</a>“</td></tr><tr><td>“硅谷 第四季 / Silicon Valley Season 4”</td><td>“4”</td><td>“2022/07/13”</td><td>“”</td><td>“2017/04/23”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26776807/">https://movie.douban.com/subject/26776807/</a>“</td></tr><tr><td>“硅谷 第三季 / Silicon Valley Season 3”</td><td>“4”</td><td>“2022/06/24”</td><td>“”</td><td>“2016/04/24”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26366492/">https://movie.douban.com/subject/26366492/</a>“</td></tr><tr><td>“人生大事”</td><td>“4”</td><td>“2022/06/22”</td><td>“”</td><td>“2022/06/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35460157/">https://movie.douban.com/subject/35460157/</a>“</td></tr><tr><td>“侏罗纪世界3 / Jurassic World: Dominion”</td><td>“4”</td><td>“2022/06/19”</td><td>“”</td><td>“2022/06/01”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/26873582/">https://movie.douban.com/subject/26873582/</a>“</td></tr><tr><td>“硅谷 第二季 / Silicon Valley Season 2”</td><td>“5”</td><td>“2022/06/17”</td><td>“”</td><td>“2015/04/12”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/25871679/">https://movie.douban.com/subject/25871679/</a>“</td></tr><tr><td>“我们与恶的距离 / 我們與惡的距離”</td><td>“5”</td><td>“2022/06/16”</td><td>“”</td><td>“2019/03/24”</td><td>“中国台湾”</td><td>“<a href="https://movie.douban.com/subject/30181230/">https://movie.douban.com/subject/30181230/</a>“</td></tr><tr><td>“无依之地 / Nomadland”</td><td>“4”</td><td>“2022/06/12”</td><td>“”</td><td>“2020/09/11”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/30458949/">https://movie.douban.com/subject/30458949/</a>“</td></tr><tr><td>“怪奇物语 第四季 / Stranger Things Season 4”</td><td>“5”</td><td>“2022/06/09”</td><td>“”</td><td>“2022/05/27”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/27194292/">https://movie.douban.com/subject/27194292/</a>“</td></tr><tr><td>“怪奇物语 第一季 / Stranger Things Season 1”</td><td>“4”</td><td>“2022/06/09”</td><td>“”</td><td>“2016/07/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26359270/">https://movie.douban.com/subject/26359270/</a>“</td></tr><tr><td>“怪奇物语 第二季 / Stranger Things Season 2”</td><td>“5”</td><td>“2022/06/09”</td><td>“”</td><td>“2017/10/27”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26844438/">https://movie.douban.com/subject/26844438/</a>“</td></tr><tr><td>“怪奇物语 第三季 / Stranger Things Season 3”</td><td>“5”</td><td>“2022/06/09”</td><td>“”</td><td>“2019/07/04”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/27119156/">https://movie.douban.com/subject/27119156/</a>“</td></tr><tr><td>“秦时明月之君临天下”</td><td>“5”</td><td>“2022/06/02”</td><td>“”</td><td>“2014/12/25”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/20501094/">https://movie.douban.com/subject/20501094/</a>“</td></tr><tr><td>“扬名立万”</td><td>“4”</td><td>“2022/06/02”</td><td>“”</td><td>“2021/11/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35422807/">https://movie.douban.com/subject/35422807/</a>“</td></tr><tr><td>“无耻之徒(美版) 第四季 / Shameless Season 4”</td><td>“4”</td><td>“2022/05/25”</td><td>“”</td><td>“2014/01/12”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/21332521/">https://movie.douban.com/subject/21332521/</a>“</td></tr><tr><td>“爱，死亡和机器人 第三季 / Love, Death &amp; Robots Season 3”</td><td>“4”</td><td>“2022/05/23”</td><td>“”</td><td>“2022/05/20”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/35436582/">https://movie.douban.com/subject/35436582/</a>“</td></tr><tr><td>“无耻之徒(美版) 第一季 / Shameless Season 1”</td><td>“5”</td><td>“2022/05/14”</td><td>“”</td><td>“2011/01/09”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/4729738/">https://movie.douban.com/subject/4729738/</a>“</td></tr><tr><td>“无耻之徒(美版)  第二季 / Shameless Season 2”</td><td>“5”</td><td>“2022/05/14”</td><td>“”</td><td>“2012/01/08”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/6727679/">https://movie.douban.com/subject/6727679/</a>“</td></tr><tr><td>“无耻之徒(美版) 第三季 / Shameless Season 3”</td><td>“5”</td><td>“2022/05/14”</td><td>“”</td><td>“2013/01/13”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/10759851/">https://movie.douban.com/subject/10759851/</a>“</td></tr><tr><td>“进击的巨人 第三季 Part.2 / 進撃の巨人 Season 3 Part.2”</td><td>“5”</td><td>“2022/05/14”</td><td>“”</td><td>“2019/04/28”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30353357/">https://movie.douban.com/subject/30353357/</a>“</td></tr><tr><td>“秦时明月之诸子百家”</td><td>“5”</td><td>“2022/02/22”</td><td>“”</td><td>“2010/05/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4246437/">https://movie.douban.com/subject/4246437/</a>“</td></tr><tr><td>“秦时明月之万里长城”</td><td>“5”</td><td>“2022/02/22”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/5951340/">https://movie.douban.com/subject/5951340/</a>“</td></tr><tr><td>“秦时明月之百步飞剑”</td><td>“5”</td><td>“2022/02/15”</td><td>“”</td><td>“2007/02/18”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3074717/">https://movie.douban.com/subject/3074717/</a>“</td></tr><tr><td>“秦时明月之夜尽天明”</td><td>“5”</td><td>“2022/02/15”</td><td>“”</td><td>“2008/07/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3151809/">https://movie.douban.com/subject/3151809/</a>“</td></tr><tr><td>“青春期猪头少年不做兔女郎学姐的梦 / 青春ブタ野郎はバニーガール…”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2018/10/03”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30166978/">https://movie.douban.com/subject/30166978/</a>“</td></tr><tr><td>“青春期猪头少年不做怀梦少女的梦 / 青春ブタ野郎はゆめみる少女の…”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2019/06/15”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30329902/">https://movie.douban.com/subject/30329902/</a>“</td></tr><tr><td>“路人女主的养成方法 / 冴えない彼女の育てかた”</td><td>“4”</td><td>“2022/02/10”</td><td>“”</td><td>“2015/01/08”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/25850625/">https://movie.douban.com/subject/25850625/</a>“</td></tr><tr><td>“更衣人偶坠入爱河 / その着せ替え人形は恋をする”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2022/01/08”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/35437623/">https://movie.douban.com/subject/35437623/</a>“</td></tr><tr><td>“明日酱的水手服 / 明日ちゃんのセーラー服”</td><td>“4”</td><td>“2022/02/10”</td><td>“”</td><td>“2022/01/08”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/35417836/">https://movie.douban.com/subject/35417836/</a>“</td></tr><tr><td>“穿过寒冬拥抱你”</td><td>“3”</td><td>“2022/02/10”</td><td>“太水了吧，剧情都连不到一起(1 有用)”</td><td>“2021/12/31”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35307456/">https://movie.douban.com/subject/35307456/</a>“</td></tr><tr><td>“进击的巨人 / 進撃の巨人”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2013/04/06”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/23748525/">https://movie.douban.com/subject/23748525/</a>“</td></tr><tr><td>“进击的巨人 第二季 / 進撃の巨人 Season 2”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2017/04/01”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26268494/">https://movie.douban.com/subject/26268494/</a>“</td></tr><tr><td>“进击的巨人 第三季 / 進撃の巨人 Season 3”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2018/07/22”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/27072327/">https://movie.douban.com/subject/27072327/</a>“</td></tr><tr><td>“进击的巨人 最终季 / 進撃の巨人 The Final Season Part.1”</td><td>“5”</td><td>“2022/02/10”</td><td>“”</td><td>“2020/12/07”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/33440021/">https://movie.douban.com/subject/33440021/</a>“</td></tr><tr><td>“爱，死亡和机器人 第一季 / Love, Death &amp; Robots Season 1”</td><td>“5”</td><td>“2021/10/11”</td><td>“”</td><td>“2019/03/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/30424374/">https://movie.douban.com/subject/30424374/</a>“</td></tr><tr><td>“硅谷 第一季 / Silicon Valley Season 1”</td><td>“5”</td><td>“2021/10/04”</td><td>“”</td><td>“2014/04/06”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/20644938/">https://movie.douban.com/subject/20644938/</a>“</td></tr><tr><td>“长津湖”</td><td>“5”</td><td>“2021/10/01”</td><td>“”</td><td>“2021/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25845392/">https://movie.douban.com/subject/25845392/</a>“</td></tr><tr><td>“性爱自修室 第三季 / Sex Education Season 3”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“2021/09/17”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/34966169/">https://movie.douban.com/subject/34966169/</a>“</td></tr><tr><td>“白日梦想家 / The Secret Life of Walter Mitty”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“2013/12/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2133323/">https://movie.douban.com/subject/2133323/</a>“</td></tr><tr><td>“圣山 / La montaña sagrada”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1401905/">https://movie.douban.com/subject/1401905/</a>“</td></tr><tr><td>“爱尔兰人 / The Irishman”</td><td>“4”</td><td>“2021/09/28”</td><td>“”</td><td>“2019/09/27”</td><td>“纽约电影节”</td><td>“<a href="https://movie.douban.com/subject/6981153/">https://movie.douban.com/subject/6981153/</a>“</td></tr><tr><td>“出租车 / تاکسی”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“2015/02/06”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/26304167/">https://movie.douban.com/subject/26304167/</a>“</td></tr><tr><td>“八月迷情 / August Rush”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“2007/11/21”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1844413/">https://movie.douban.com/subject/1844413/</a>“</td></tr><tr><td>“逃避虽可耻但有用 / 逃げるは恥だが役に立つ”</td><td>“5”</td><td>“2021/09/28”</td><td>“”</td><td>“2016/10/11”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26816519/">https://movie.douban.com/subject/26816519/</a>“</td></tr><tr><td>“去他<em>的世界 第二季 / The End of the F**</em>ing World Season 2”</td><td>“5”</td><td>“2021/09/15”</td><td>“”</td><td>“2019/11/04”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/27625457/">https://movie.douban.com/subject/27625457/</a>“</td></tr><tr><td>“狩猎 / The Hunt”</td><td>“4”</td><td>“2021/07/21”</td><td>“”</td><td>“2020/03/13”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/30182726/">https://movie.douban.com/subject/30182726/</a>“</td></tr><tr><td>“去他<em>的世界 第一季 / The End of the F**</em>ing World Season 1”</td><td>“5”</td><td>“2021/07/20”</td><td>“”</td><td>“2017/10/24”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/27031389/">https://movie.douban.com/subject/27031389/</a>“</td></tr><tr><td>“超脱 / Detachment”</td><td>“5”</td><td>“2021/07/09”</td><td>“”</td><td>“2011/04/25”</td><td>“翠贝卡电影节”</td><td>“<a href="https://movie.douban.com/subject/5322596/">https://movie.douban.com/subject/5322596/</a>“</td></tr><tr><td>“明日的我与昨日的你约会 / ぼくは明日、昨日のきみとデートする”</td><td>“4”</td><td>“2021/06/19”</td><td>“”</td><td>“2016/12/17”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26707472/">https://movie.douban.com/subject/26707472/</a>“</td></tr><tr><td>“横道世之介”</td><td>“5”</td><td>“2021/06/19”</td><td>“”</td><td>“2013/02/23”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/10484041/">https://movie.douban.com/subject/10484041/</a>“</td></tr><tr><td>“性爱自修室 第一季 / Sex Education Season 1”</td><td>“5”</td><td>“2021/06/19”</td><td>“”</td><td>“2019/01/11”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/27594217/">https://movie.douban.com/subject/27594217/</a>“</td></tr><tr><td>“性爱自修室 第二季 / Sex Education Season 2”</td><td>“5”</td><td>“2021/06/19”</td><td>“”</td><td>“2020/01/17”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/30438115/">https://movie.douban.com/subject/30438115/</a>“</td></tr><tr><td>“恋途未卜 / 思い、思われ、ふり、ふられ”</td><td>“5”</td><td>“2021/05/26”</td><td>“大爱老婆滨边美波”</td><td>“2020/08/14”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/33371681/">https://movie.douban.com/subject/33371681/</a>“</td></tr><tr><td>“假面饭店 / マスカレード・ホテル”</td><td>“3”</td><td>“2021/02/21”</td><td>“”</td><td>“2019/01/18”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/27126336/">https://movie.douban.com/subject/27126336/</a>“</td></tr><tr><td>“卡拉是条狗”</td><td>“4”</td><td>“2021/02/17”</td><td>“”</td><td>“2003/02/02”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1308573/">https://movie.douban.com/subject/1308573/</a>“</td></tr><tr><td>“大白鲨 / Jaws”</td><td>“4”</td><td>“2021/02/17”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1294941/">https://movie.douban.com/subject/1294941/</a>“</td></tr><tr><td>“少林寺”</td><td>“4”</td><td>“2021/02/17”</td><td>“”</td><td>“1982/01/21”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1301198/">https://movie.douban.com/subject/1301198/</a>“</td></tr><tr><td>“中华小当家 / 中華一番!”</td><td>“”</td><td>“2021/02/16”</td><td>“”</td><td>“1997/04/27”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/2993424/">https://movie.douban.com/subject/2993424/</a>“</td></tr><tr><td>“浪客剑心：京都大火篇 / るろうに剣心 京都大火編”</td><td>“”</td><td>“2021/02/16”</td><td>“”</td><td>“2014/08/01”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/24845115/">https://movie.douban.com/subject/24845115/</a>“</td></tr><tr><td>“奇门遁甲 / 奇門遁甲”</td><td>“”</td><td>“2021/02/15”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1302654/">https://movie.douban.com/subject/1302654/</a>“</td></tr><tr><td>“无间道(正序版)”</td><td>“”</td><td>“2021/02/15”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4860078/">https://movie.douban.com/subject/4860078/</a>“</td></tr><tr><td>“唐人街探案3”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2021/02/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27619748/">https://movie.douban.com/subject/27619748/</a>“</td></tr><tr><td>“希特勒回来了 / Er ist wieder da”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2015/10/08”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/26585014/">https://movie.douban.com/subject/26585014/</a>“</td></tr><tr><td>“非自然死亡 / アンナチュラル”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/01/12”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/27140017/">https://movie.douban.com/subject/27140017/</a>“</td></tr><tr><td>“唐人街探案”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/01/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30354606/">https://movie.douban.com/subject/30354606/</a>“</td></tr><tr><td>“我是大哥大 / 今日から俺は！！”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/10/14”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30183785/">https://movie.douban.com/subject/30183785/</a>“</td></tr><tr><td>“胜者即是正义 / リーガル・ハイ”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2012/04/17”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/10491666/">https://movie.douban.com/subject/10491666/</a>“</td></tr><tr><td>“胜者即是正义2 / リーガルハイ2”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2013/10/09”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/23997724/">https://movie.douban.com/subject/23997724/</a>“</td></tr><tr><td>“信号 / 시그널”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2016/01/22”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/26310143/">https://movie.douban.com/subject/26310143/</a>“</td></tr><tr><td>“西部世界 第三季 / Westworld Season 3”</td><td>“4”</td><td>“2021/02/14”</td><td>“前面还行，后面女主真是美式白左，难怪有位知名女演员说“他们失去了生命，但他们获得了自由”(原话我忘了），真是给我一种美国向伊拉克输出战争的感觉。莫名其妙的文化自信，其实不过是霸权罢了”</td><td>“2020/03/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/30206389/">https://movie.douban.com/subject/30206389/</a>“</td></tr><tr><td>“三生三世十里桃花”</td><td>“3”</td><td>“2021/02/14”</td><td>“”</td><td>“2017/01/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25975243/">https://movie.douban.com/subject/25975243/</a>“</td></tr><tr><td>“沙海”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/07/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26785790/">https://movie.douban.com/subject/26785790/</a>“</td></tr><tr><td>“重启之极海听雷 第二季”</td><td>“3”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/09/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35182499/">https://movie.douban.com/subject/35182499/</a>“</td></tr><tr><td>“西游记”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/2156663/">https://movie.douban.com/subject/2156663/</a>“</td></tr><tr><td>“西游记续集”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2000/02/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2156667/">https://movie.douban.com/subject/2156667/</a>“</td></tr><tr><td>“谭谈交通”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/34840290/">https://movie.douban.com/subject/34840290/</a>“</td></tr><tr><td>“老九门”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2016/07/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26614088/">https://movie.douban.com/subject/26614088/</a>“</td></tr><tr><td>“轮到你了 / あなたの番です”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2019/04/14”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30446788/">https://movie.douban.com/subject/30446788/</a>“</td></tr><tr><td>“轮到你了 番外篇 房门之内 / あなたの番です 扉の向こう”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2019/04/21”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/33435891/">https://movie.douban.com/subject/33435891/</a>“</td></tr><tr><td>“乘风破浪的姐姐 第一季”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/06/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/34894589/">https://movie.douban.com/subject/34894589/</a>“</td></tr><tr><td>“仙剑奇侠传三”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2009/06/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3227335/">https://movie.douban.com/subject/3227335/</a>“</td></tr><tr><td>“是，首相  第二季 / Yes, Prime Minister Season 2”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“1987/11/26”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/5359940/">https://movie.douban.com/subject/5359940/</a>“</td></tr><tr><td>“是，首相 第一季 / Yes, Prime Minister Season 1”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“1986/01/09”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/1441948/">https://movie.douban.com/subject/1441948/</a>“</td></tr><tr><td>“神探夏洛克 第一季 / Sherlock Season 1”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2010/07/25”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/3986493/">https://movie.douban.com/subject/3986493/</a>“</td></tr><tr><td>“来自星星的你 / 별에서 온 그대”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2013/12/18”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/25698722/">https://movie.douban.com/subject/25698722/</a>“</td></tr><tr><td>“神探夏洛克  第二季 / Sherlock Season 2”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2012/01/01”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/6522269/">https://movie.douban.com/subject/6522269/</a>“</td></tr><tr><td>“神探夏洛克 第三季 / Sherlock Season 3”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2014/01/01”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/10455629/">https://movie.douban.com/subject/10455629/</a>“</td></tr><tr><td>“神探夏洛克 第四季 / Sherlock Season 4”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2017/01/01”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/25750923/">https://movie.douban.com/subject/25750923/</a>“</td></tr><tr><td>“神探夏洛克：最后的誓言 / Sherlock: His Last Vow”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2014/01/12”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/25804790/">https://movie.douban.com/subject/25804790/</a>“</td></tr><tr><td>“神探夏洛克：福至如归 / Sherlock Mini Episode - Many Happy Returns”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2013/12/24”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/25798411/">https://movie.douban.com/subject/25798411/</a>“</td></tr><tr><td>“爱情公寓5”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/01/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25931446/">https://movie.douban.com/subject/25931446/</a>“</td></tr><tr><td>“爱情公寓4”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2014/01/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10793510/">https://movie.douban.com/subject/10793510/</a>“</td></tr><tr><td>“爱情公寓3”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2012/07/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6312211/">https://movie.douban.com/subject/6312211/</a>“</td></tr><tr><td>“龙门镖局”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2013/07/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/11627047/">https://movie.douban.com/subject/11627047/</a>“</td></tr><tr><td>“爱情公寓2”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2011/01/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4707205/">https://movie.douban.com/subject/4707205/</a>“</td></tr><tr><td>“爱情公寓”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2009/08/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3926132/">https://movie.douban.com/subject/3926132/</a>“</td></tr><tr><td>“请回答1988 / 응답하라 1988”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2015/11/06”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/26302614/">https://movie.douban.com/subject/26302614/</a>“</td></tr><tr><td>“中华小子”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/2244765/">https://movie.douban.com/subject/2244765/</a>“</td></tr><tr><td>“洛洛历险记”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4117005/">https://movie.douban.com/subject/4117005/</a>“</td></tr><tr><td>“铠甲勇士”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2009/03/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3636301/">https://movie.douban.com/subject/3636301/</a>“</td></tr><tr><td>“爆丸小子”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4718282/">https://movie.douban.com/subject/4718282/</a>“</td></tr><tr><td>“机甲兽神”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/5282437/">https://movie.douban.com/subject/5282437/</a>“</td></tr><tr><td>“圣石奇兵”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4328454/">https://movie.douban.com/subject/4328454/</a>“</td></tr><tr><td>“斗龙战士”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2011/07/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6971309/">https://movie.douban.com/subject/6971309/</a>“</td></tr><tr><td>“雷速登闪电冲线2”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/10728467/">https://movie.douban.com/subject/10728467/</a>“</td></tr><tr><td>“雷速登闪电冲线”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4824963/">https://movie.douban.com/subject/4824963/</a>“</td></tr><tr><td>“蛋神奇踪”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4312196/">https://movie.douban.com/subject/4312196/</a>“</td></tr><tr><td>“哈皮父子与水金刚”</td><td>“5”</td><td>“2021/02/14”</td><td>“看的不全系列”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/24294846/">https://movie.douban.com/subject/24294846/</a>“</td></tr><tr><td>“电击小子”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2009/02/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4328475/">https://movie.douban.com/subject/4328475/</a>“</td></tr><tr><td>“弹珠传说”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2010/10/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5683891/">https://movie.douban.com/subject/5683891/</a>“</td></tr><tr><td>“小鲤鱼历险记”</td><td>“5”</td><td>“2021/02/14”</td><td>“看的不全系列”</td><td>“2007/06/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3098725/">https://movie.douban.com/subject/3098725/</a>“</td></tr><tr><td>“哪吒传奇”</td><td>“5”</td><td>“2021/02/14”</td><td>“看的不全系列”</td><td>“2003/06/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2156771/">https://movie.douban.com/subject/2156771/</a>“</td></tr><tr><td>“神厨小福贵”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3025311/">https://movie.douban.com/subject/3025311/</a>“</td></tr><tr><td>“神兵小将1 上部”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2007/10/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/22735528/">https://movie.douban.com/subject/22735528/</a>“</td></tr><tr><td>“超兽武装之勇者无惧”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2011/11/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10728463/">https://movie.douban.com/subject/10728463/</a>“</td></tr><tr><td>“超兽武装之仁者无敌”</td><td>“5”</td><td>“2021/02/14”</td><td>“对于小时候的我，台词满深刻的，很有启发意义（挺装逼的，比如那个如今我已学会逆风前行”</td><td>“2011/04/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6126501/">https://movie.douban.com/subject/6126501/</a>“</td></tr><tr><td>“极限挑战 第一季”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2015/06/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26387728/">https://movie.douban.com/subject/26387728/</a>“</td></tr><tr><td>“西游记”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“1999/07/23”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2156775/">https://movie.douban.com/subject/2156775/</a>“</td></tr><tr><td>“一本好书”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/10/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30337114/">https://movie.douban.com/subject/30337114/</a>“</td></tr><tr><td>“胜者即是正义 2014SP / リーガルハイ・スペシャル”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2014/11/22”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26020814/">https://movie.douban.com/subject/26020814/</a>“</td></tr><tr><td>“隐秘的角落”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/06/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/33404425/">https://movie.douban.com/subject/33404425/</a>“</td></tr><tr><td>“无证之罪”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2017/09/06”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26930540/">https://movie.douban.com/subject/26930540/</a>“</td></tr><tr><td>“摩天大楼”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/08/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/33393274/">https://movie.douban.com/subject/33393274/</a>“</td></tr><tr><td>“九品芝麻官”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“1994/03/31”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297518/">https://movie.douban.com/subject/1297518/</a>“</td></tr><tr><td>“弥留之国的爱丽丝 第一季 / 今際の国のアリス”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2020/12/10”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/34477588/">https://movie.douban.com/subject/34477588/</a>“</td></tr><tr><td>“黑社会 / 黑社會”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2005/10/20”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1309220/">https://movie.douban.com/subject/1309220/</a>“</td></tr><tr><td>“黑社会2：以和为贵 / 黑社會以和為貴”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2006/04/27”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1484760/">https://movie.douban.com/subject/1484760/</a>“</td></tr><tr><td>“无人生还 / And Then There Were None”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2015/12/26”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/25839052/">https://movie.douban.com/subject/25839052/</a>“</td></tr><tr><td>“狩猎 / Jagten”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2012/05/20”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/6985810/">https://movie.douban.com/subject/6985810/</a>“</td></tr><tr><td>“黄海 / 황해”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2010/12/22”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/3743114/">https://movie.douban.com/subject/3743114/</a>“</td></tr><tr><td>“海市蜃楼 / Durante la tormenta”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/11/30”</td><td>“西班牙”</td><td>“<a href="https://movie.douban.com/subject/30164448/">https://movie.douban.com/subject/30164448/</a>“</td></tr><tr><td>“燃烧 / 버닝”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/05/16”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26842702/">https://movie.douban.com/subject/26842702/</a>“</td></tr><tr><td>“东京教父 / 東京ゴッドファーザーズ”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2003/11/08”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1310177/">https://movie.douban.com/subject/1310177/</a>“</td></tr><tr><td>“西部世界 第一季 / Westworld Season 1”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2016/10/02”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2338055/">https://movie.douban.com/subject/2338055/</a>“</td></tr><tr><td>“西部世界 第二季 / Westworld Season 2”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“2018/04/22”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26887174/">https://movie.douban.com/subject/26887174/</a>“</td></tr><tr><td>“垫底辣妹 / ビリギャル”</td><td>“4”</td><td>“2021/02/14”</td><td>“”</td><td>“2015/05/01”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26259677/">https://movie.douban.com/subject/26259677/</a>“</td></tr><tr><td>“侏罗纪公园 / Jurassic Park”</td><td>“5”</td><td>“2021/02/14”</td><td>“”</td><td>“1993/06/11”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292523/">https://movie.douban.com/subject/1292523/</a>“</td></tr><tr><td>“移动迷宫 / The Maze Runner”</td><td>“3”</td><td>“2021/02/09”</td><td>“”</td><td>“2014/09/19”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/21349345/">https://movie.douban.com/subject/21349345/</a>“</td></tr><tr><td>“移动迷宫2 / Maze Runner: The Scorch Trials”</td><td>“3”</td><td>“2021/02/09”</td><td>“”</td><td>“2015/09/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/25995508/">https://movie.douban.com/subject/25995508/</a>“</td></tr><tr><td>“移动迷宫3：死亡解药 / Maze Runner: The Death Cure”</td><td>“2”</td><td>“2021/02/09”</td><td>“”</td><td>“2018/01/26”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26004132/">https://movie.douban.com/subject/26004132/</a>“</td></tr><tr><td>“老无所依 / No Country for Old Men”</td><td>“”</td><td>“2021/02/07”</td><td>“”</td><td>“2007/05/19”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/1857099/">https://movie.douban.com/subject/1857099/</a>“</td></tr><tr><td>“万物理论 / The Theory of Everything”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2014/09/07”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/24815950/">https://movie.douban.com/subject/24815950/</a>“</td></tr><tr><td>“社交网络 / The Social Network”</td><td>“4”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/09/24”</td><td>“纽约电影节”</td><td>“<a href="https://movie.douban.com/subject/3205624/">https://movie.douban.com/subject/3205624/</a>“</td></tr><tr><td>“岁月神偷 / 歲月神偷”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/02/14”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/3792799/">https://movie.douban.com/subject/3792799/</a>“</td></tr><tr><td>“心灵捕手 / Good Will Hunting”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“1997/12/05”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292656/">https://movie.douban.com/subject/1292656/</a>“</td></tr><tr><td>“一个叫欧维的男人决定去死 / En man som heter Ove”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2015/12/25”</td><td>“瑞典”</td><td>“<a href="https://movie.douban.com/subject/26628357/">https://movie.douban.com/subject/26628357/</a>“</td></tr><tr><td>“追凶者也”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/09/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26284621/">https://movie.douban.com/subject/26284621/</a>“</td></tr><tr><td>“钢的琴”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/09/11”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/4876722/">https://movie.douban.com/subject/4876722/</a>“</td></tr><tr><td>“步履不停 / 歩いても 歩いても”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2008/06/28”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/2222996/">https://movie.douban.com/subject/2222996/</a>“</td></tr><tr><td>“杀生”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2012/04/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4176542/">https://movie.douban.com/subject/4176542/</a>“</td></tr><tr><td>“胜者即是正义SP / リーガル・ハイSP”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/04/13”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/21332518/">https://movie.douban.com/subject/21332518/</a>“</td></tr><tr><td>“脱口秀反跨年”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2020/12/25”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35165372/">https://movie.douban.com/subject/35165372/</a>“</td></tr><tr><td>“流感 / 감기”</td><td>“3”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/08/14”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/10432911/">https://movie.douban.com/subject/10432911/</a>“</td></tr><tr><td>“龙虾 / The Lobster”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2015/05/15”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/20514947/">https://movie.douban.com/subject/20514947/</a>“</td></tr><tr><td>“我和我的家乡”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2020/10/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35051512/">https://movie.douban.com/subject/35051512/</a>“</td></tr><tr><td>“土拨鼠之日 / Groundhog Day”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“1993/02/12”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1300613/">https://movie.douban.com/subject/1300613/</a>“</td></tr><tr><td>“北京爱情故事”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2014/02/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24736566/">https://movie.douban.com/subject/24736566/</a>“</td></tr><tr><td>“银河补习班”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/07/13”</td><td>“大规模点映”</td><td>“<a href="https://movie.douban.com/subject/30282387/">https://movie.douban.com/subject/30282387/</a>“</td></tr><tr><td>“单身男女 / 單身男女”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/03/31”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/4724739/">https://movie.douban.com/subject/4724739/</a>“</td></tr><tr><td>“闺蜜”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2014/07/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25777330/">https://movie.douban.com/subject/25777330/</a>“</td></tr><tr><td>“全城热恋”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/02/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4066206/">https://movie.douban.com/subject/4066206/</a>“</td></tr><tr><td>“全球热恋”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/09/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5290729/">https://movie.douban.com/subject/5290729/</a>“</td></tr><tr><td>“拆弹专家”</td><td>“4”</td><td>“2021/02/06”</td><td>“”</td><td>“2017/04/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26748673/">https://movie.douban.com/subject/26748673/</a>“</td></tr><tr><td>“拆弹专家2”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2020/12/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30171424/">https://movie.douban.com/subject/30171424/</a>“</td></tr><tr><td>“闲人马大姐”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2000/08/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2568018/">https://movie.douban.com/subject/2568018/</a>“</td></tr><tr><td>“小时代2：青木时代”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/08/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24721493/">https://movie.douban.com/subject/24721493/</a>“</td></tr><tr><td>“一路顺疯”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/09/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/20452308/">https://movie.douban.com/subject/20452308/</a>“</td></tr><tr><td>“妖铃铃”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2017/12/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26966580/">https://movie.douban.com/subject/26966580/</a>“</td></tr><tr><td>“盗墓笔记”</td><td>“3”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/08/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24827387/">https://movie.douban.com/subject/24827387/</a>“</td></tr><tr><td>“第12届中国金鹰电视艺术节颁奖典礼”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/10/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30352998/">https://movie.douban.com/subject/30352998/</a>“</td></tr><tr><td>“画壁”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/09/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5194471/">https://movie.douban.com/subject/5194471/</a>“</td></tr><tr><td>“澳门风云 / 賭城風雲”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2014/01/31”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/11625097/">https://movie.douban.com/subject/11625097/</a>“</td></tr><tr><td>“我的特工爷爷 / 特工爺爺”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/04/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25945280/">https://movie.douban.com/subject/25945280/</a>“</td></tr><tr><td>“画皮2 / 畫皮Ⅱ”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2012/06/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4218768/">https://movie.douban.com/subject/4218768/</a>“</td></tr><tr><td>“河东狮吼2”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2012/08/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6221409/">https://movie.douban.com/subject/6221409/</a>“</td></tr><tr><td>“云南虫谷”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/12/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26744597/">https://movie.douban.com/subject/26744597/</a>“</td></tr><tr><td>“新喜剧之王”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/02/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4840388/">https://movie.douban.com/subject/4840388/</a>“</td></tr><tr><td>“第28届中国金鸡百花电影节闭幕式暨第32届金鸡奖典礼”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/11/23”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/34446715/">https://movie.douban.com/subject/34446715/</a>“</td></tr><tr><td>“饭局也疯狂”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2012/01/23”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6788265/">https://movie.douban.com/subject/6788265/</a>“</td></tr><tr><td>“狄仁杰之神都龙王”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/09/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5996801/">https://movie.douban.com/subject/5996801/</a>“</td></tr><tr><td>“战国”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/04/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4707585/">https://movie.douban.com/subject/4707585/</a>“</td></tr><tr><td>“鸿门宴传奇”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/11/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5908477/">https://movie.douban.com/subject/5908477/</a>“</td></tr><tr><td>“举起手来2：追击阿多丸号”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/09/09”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4926002/">https://movie.douban.com/subject/4926002/</a>“</td></tr><tr><td>“大魔术师 / 大魔術師”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/12/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4913200/">https://movie.douban.com/subject/4913200/</a>“</td></tr><tr><td>“新少林寺”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/01/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4097023/">https://movie.douban.com/subject/4097023/</a>“</td></tr><tr><td>“三笑之才子佳人”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/05/07”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3993553/">https://movie.douban.com/subject/3993553/</a>“</td></tr><tr><td>“剑雨”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2010/09/03”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/3813779/">https://movie.douban.com/subject/3813779/</a>“</td></tr><tr><td>“龙门飞甲”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2011/12/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4896304/">https://movie.douban.com/subject/4896304/</a>“</td></tr><tr><td>“复仇者联盟4：终局之战 / Avengers: Endgame”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/04/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26100958/">https://movie.douban.com/subject/26100958/</a>“</td></tr><tr><td>“环太平洋：雷霆再起 / Pacific Rim: Uprising”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/03/23”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/20435622/">https://movie.douban.com/subject/20435622/</a>“</td></tr><tr><td>“神探夏洛克：可恶的新娘 / Sherlock: The Abominable Bride”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/01/01”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/25920885/">https://movie.douban.com/subject/25920885/</a>“</td></tr><tr><td>“碟中谍6：全面瓦解 / Mission: Impossible - Fallout”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/07/27”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26336252/">https://movie.douban.com/subject/26336252/</a>“</td></tr><tr><td>“赤裸特工”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2002/11/15”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1307762/">https://movie.douban.com/subject/1307762/</a>“</td></tr><tr><td>“功夫熊猫3 / Kung Fu Panda 3”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/01/29”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/11589036/">https://movie.douban.com/subject/11589036/</a>“</td></tr><tr><td>“寂静之地 / A Quiet Place”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/03/09”</td><td>“西南偏南电影节”</td><td>“<a href="https://movie.douban.com/subject/26997663/">https://movie.douban.com/subject/26997663/</a>“</td></tr><tr><td>“赤壁(下)”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2009/01/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3291930/">https://movie.douban.com/subject/3291930/</a>“</td></tr><tr><td>“湮灭 / Annihilation”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2018/02/23”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26384741/">https://movie.douban.com/subject/26384741/</a>“</td></tr><tr><td>“侏罗纪世界 / Jurassic World”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2015/06/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10440138/">https://movie.douban.com/subject/10440138/</a>“</td></tr><tr><td>“隐形人 / The Invisible Man”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2020/02/28”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2364086/">https://movie.douban.com/subject/2364086/</a>“</td></tr><tr><td>“惊天魔盗团 / Now You See Me”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/05/21”</td><td>“纽约首映”</td><td>“<a href="https://movie.douban.com/subject/6517421/">https://movie.douban.com/subject/6517421/</a>“</td></tr><tr><td>“超体 / Lucy”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2014/07/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/24404677/">https://movie.douban.com/subject/24404677/</a>“</td></tr><tr><td>“金陵神捕”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/09/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/34834828/">https://movie.douban.com/subject/34834828/</a>“</td></tr><tr><td>“降临 / Arrival”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/09/01”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/21324900/">https://movie.douban.com/subject/21324900/</a>“</td></tr><tr><td>“碟中谍5：神秘国度 / Mission: Impossible - Rogue Nation”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2015/07/31”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/10727641/">https://movie.douban.com/subject/10727641/</a>“</td></tr><tr><td>“饥饿站台 / El hoyo”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2019/09/06”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/34805219/">https://movie.douban.com/subject/34805219/</a>“</td></tr><tr><td>“维多利亚的秘密2016时装秀 / The Victoria’s Secret Fashion Show …”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/12/05”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26928204/">https://movie.douban.com/subject/26928204/</a>“</td></tr><tr><td>“环太平洋 / Pacific Rim”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/07/12”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/5323968/">https://movie.douban.com/subject/5323968/</a>“</td></tr><tr><td>“老九门番外之二月花开”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2016/10/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26838466/">https://movie.douban.com/subject/26838466/</a>“</td></tr><tr><td>“仙剑奇侠传”</td><td>“5”</td><td>“2021/02/06”</td><td>“”</td><td>“2005/01/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2210031/">https://movie.douban.com/subject/2210031/</a>“</td></tr><tr><td>“海绵宝宝 / The SpongeBob Movie: Sponge Out of Water”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2015/02/06”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/11808948/">https://movie.douban.com/subject/11808948/</a>“</td></tr><tr><td>“地心引力 / Gravity”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2013/08/28”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/3793783/">https://movie.douban.com/subject/3793783/</a>“</td></tr><tr><td>“钢铁侠 / Iron Man”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2008/04/14”</td><td>“悉尼首映”</td><td>“<a href="https://movie.douban.com/subject/1432146/">https://movie.douban.com/subject/1432146/</a>“</td></tr><tr><td>“林中小屋 / The Cabin in the Woods”</td><td>“”</td><td>“2021/02/06”</td><td>“”</td><td>“2012/03/09”</td><td>“西南偏南电影节”</td><td>“<a href="https://movie.douban.com/subject/3143676/">https://movie.douban.com/subject/3143676/</a>“</td></tr><tr><td>“无间道3：终极无间 / 無間道III 終極無間”</td><td>“4”</td><td>“2021/01/24”</td><td>“”</td><td>“2003/12/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1307694/">https://movie.douban.com/subject/1307694/</a>“</td></tr><tr><td>“无间道 / 無間道”</td><td>“”</td><td>“2021/01/24”</td><td>“”</td><td>“2002/12/12”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1307914/">https://movie.douban.com/subject/1307914/</a>“</td></tr><tr><td>“无间道2 / 無間道II”</td><td>“”</td><td>“2021/01/24”</td><td>“”</td><td>“2003/10/01”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1307106/">https://movie.douban.com/subject/1307106/</a>“</td></tr><tr><td>“情书 / Love Letter”</td><td>“5”</td><td>“2020/12/29”</td><td>“”</td><td>“1995/03/25”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1292220/">https://movie.douban.com/subject/1292220/</a>“</td></tr><tr><td>“你的名字。 / 君の名は。”</td><td>“5”</td><td>“2020/12/29”</td><td>“”</td><td>“2016/08/26”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26683290/">https://movie.douban.com/subject/26683290/</a>“</td></tr><tr><td>“嫌疑人X的献身 / 容疑者Xの献身”</td><td>“4”</td><td>“2020/12/29”</td><td>“”</td><td>“2008/10/04”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/2369845/">https://movie.douban.com/subject/2369845/</a>“</td></tr><tr><td>“八佰”</td><td>“1”</td><td>“2020/08/26”</td><td>“”</td><td>“2020/08/14”</td><td>“大规模点映”</td><td>“<a href="https://movie.douban.com/subject/26754233/">https://movie.douban.com/subject/26754233/</a>“</td></tr><tr><td>“契克 / Tschick”</td><td>“5”</td><td>“2020/08/24”</td><td>“”</td><td>“2016/09/15”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/26586432/">https://movie.douban.com/subject/26586432/</a>“</td></tr><tr><td>“千与千寻 / 千と千尋の神隠し”</td><td>“5”</td><td>“2020/08/24”</td><td>“”</td><td>“2001/07/20”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1291561/">https://movie.douban.com/subject/1291561/</a>“</td></tr><tr><td>“比海更深 / 海よりもまだ深く”</td><td>“4”</td><td>“2020/08/24”</td><td>“”</td><td>“2016/05/18”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26694988/">https://movie.douban.com/subject/26694988/</a>“</td></tr><tr><td>“猎谎者”</td><td>“5”</td><td>“2020/08/19”</td><td>“”</td><td>“2020/06/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/35027709/">https://movie.douban.com/subject/35027709/</a>“</td></tr><tr><td>“湄公河行动”</td><td>“”</td><td>“2020/07/13”</td><td>“”</td><td>“2016/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25815034/">https://movie.douban.com/subject/25815034/</a>“</td></tr><tr><td>“不可思异”</td><td>“”</td><td>“2020/07/13”</td><td>“”</td><td>“2015/12/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26277156/">https://movie.douban.com/subject/26277156/</a>“</td></tr><tr><td>“断片之险途夺宝”</td><td>“”</td><td>“2020/07/13”</td><td>“”</td><td>“2018/12/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26882457/">https://movie.douban.com/subject/26882457/</a>“</td></tr><tr><td>“推理笔记”</td><td>“”</td><td>“2020/07/13”</td><td>“”</td><td>“2017/11/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26890502/">https://movie.douban.com/subject/26890502/</a>“</td></tr><tr><td>“澳门风云2 / 賭城風雲II”</td><td>“”</td><td>“2020/07/13”</td><td>“”</td><td>“2015/02/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25858785/">https://movie.douban.com/subject/25858785/</a>“</td></tr><tr><td>“烈日灼心”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/06/15”</td><td>“上海电影节”</td><td>“<a href="https://movie.douban.com/subject/24719063/">https://movie.douban.com/subject/24719063/</a>“</td></tr><tr><td>“乘风破浪”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/01/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26862259/">https://movie.douban.com/subject/26862259/</a>“</td></tr><tr><td>“解救吾先生”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/09/26”</td><td>“丝绸之路电影节”</td><td>“<a href="https://movie.douban.com/subject/25798448/">https://movie.douban.com/subject/25798448/</a>“</td></tr><tr><td>“唐人街探案”</td><td>“5”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/12/31”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26311973/">https://movie.douban.com/subject/26311973/</a>“</td></tr><tr><td>“火锅英雄”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/04/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25662327/">https://movie.douban.com/subject/25662327/</a>“</td></tr><tr><td>“夏洛特烦恼”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25964071/">https://movie.douban.com/subject/25964071/</a>“</td></tr><tr><td>“缝纫机乐队”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/09/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26926321/">https://movie.douban.com/subject/26926321/</a>“</td></tr><tr><td>“不成问题的问题”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/10/29”</td><td>“东京电影节”</td><td>“<a href="https://movie.douban.com/subject/26657126/">https://movie.douban.com/subject/26657126/</a>“</td></tr><tr><td>“大护法”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/07/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26811587/">https://movie.douban.com/subject/26811587/</a>“</td></tr><tr><td>“西虹市首富”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2018/07/27”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27605698/">https://movie.douban.com/subject/27605698/</a>“</td></tr><tr><td>“唐人街探案2”</td><td>“5”</td><td>“2020/04/27”</td><td>“”</td><td>“2018/02/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26698897/">https://movie.douban.com/subject/26698897/</a>“</td></tr><tr><td>“飞驰人生”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2019/02/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30163509/">https://movie.douban.com/subject/30163509/</a>“</td></tr><tr><td>“看不见的客人 / Contratiempo”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/09/23”</td><td>“奇幻电影节”</td><td>“<a href="https://movie.douban.com/subject/26580232/">https://movie.douban.com/subject/26580232/</a>“</td></tr><tr><td>“妖猫传”</td><td>“4”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/12/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5350027/">https://movie.douban.com/subject/5350027/</a>“</td></tr><tr><td>“少年班”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/06/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26219652/">https://movie.douban.com/subject/26219652/</a>“</td></tr><tr><td>“战狼”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/04/02”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24753810/">https://movie.douban.com/subject/24753810/</a>“</td></tr><tr><td>“破风 / 破風”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/08/07”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25853727/">https://movie.douban.com/subject/25853727/</a>“</td></tr><tr><td>“寄生虫 / 기생충”</td><td>“5”</td><td>“2020/04/27”</td><td>“”</td><td>“2019/05/21”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/27010768/">https://movie.douban.com/subject/27010768/</a>“</td></tr><tr><td>“捉妖记”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/07/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25723907/">https://movie.douban.com/subject/25723907/</a>“</td></tr><tr><td>“被光抓走的人”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2019/12/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30394535/">https://movie.douban.com/subject/30394535/</a>“</td></tr><tr><td>“后会无期”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2014/07/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25805741/">https://movie.douban.com/subject/25805741/</a>“</td></tr><tr><td>“煎饼侠”</td><td>“4”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/07/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25895276/">https://movie.douban.com/subject/25895276/</a>“</td></tr><tr><td>“长城 / The Great Wall”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/12/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6982558/">https://movie.douban.com/subject/6982558/</a>“</td></tr><tr><td>“全民目击”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2013/09/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/11510624/">https://movie.douban.com/subject/11510624/</a>“</td></tr><tr><td>“道士下山”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2015/07/03”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24879839/">https://movie.douban.com/subject/24879839/</a>“</td></tr><tr><td>“摆渡人”</td><td>“3”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/12/23”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25911694/">https://movie.douban.com/subject/25911694/</a>“</td></tr><tr><td>“北京遇上西雅图之不二情书”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/04/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26322792/">https://movie.douban.com/subject/26322792/</a>“</td></tr><tr><td>“心理罪之城市之光”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/12/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26774722/">https://movie.douban.com/subject/26774722/</a>“</td></tr><tr><td>“布达佩斯大饭店 / The Grand Budapest Hotel”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2014/02/06”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/11525673/">https://movie.douban.com/subject/11525673/</a>“</td></tr><tr><td>“囧妈”</td><td>“3”</td><td>“2020/04/27”</td><td>“”</td><td>“2020/01/25”</td><td>“中国大陆网络”</td><td>“<a href="https://movie.douban.com/subject/30306570/">https://movie.douban.com/subject/30306570/</a>“</td></tr><tr><td>“长安道”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2019/11/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25747204/">https://movie.douban.com/subject/25747204/</a>“</td></tr><tr><td>“监狱风云2：逃犯 / 監獄風雲II逃犯”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1294019/">https://movie.douban.com/subject/1294019/</a>“</td></tr><tr><td>“爱乐之城 / La La Land”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2016/08/31”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/25934014/">https://movie.douban.com/subject/25934014/</a>“</td></tr><tr><td>“中国合伙人”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2013/05/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/11529526/">https://movie.douban.com/subject/11529526/</a>“</td></tr><tr><td>“巴霍巴利王2：终结 / Baahubali 2: The Conclusion”</td><td>“”</td><td>“2020/04/27”</td><td>“”</td><td>“2017/04/28”</td><td>“印度”</td><td>“<a href="https://movie.douban.com/subject/26420932/">https://movie.douban.com/subject/26420932/</a>“</td></tr><tr><td>“肖申克的救赎 / The Shawshank Redemption”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1994/09/10”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/1292052/">https://movie.douban.com/subject/1292052/</a>“</td></tr><tr><td>“阿甘正传 / Forrest Gump”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1994/06/23”</td><td>“洛杉矶首映”</td><td>“<a href="https://movie.douban.com/subject/1292720/">https://movie.douban.com/subject/1292720/</a>“</td></tr><tr><td>“当幸福来敲门 / The Pursuit of Happyness”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/12/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1849031/">https://movie.douban.com/subject/1849031/</a>“</td></tr><tr><td>“泰坦尼克号 / Titanic”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1997/11/01”</td><td>“东京电影节”</td><td>“<a href="https://movie.douban.com/subject/1292722/">https://movie.douban.com/subject/1292722/</a>“</td></tr><tr><td>“霸王别姬”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1993/01/01”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1291546/">https://movie.douban.com/subject/1291546/</a>“</td></tr><tr><td>“大话西游之大圣娶亲 / 西遊記大結局之仙履奇緣”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1995/02/04”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1292213/">https://movie.douban.com/subject/1292213/</a>“</td></tr><tr><td>“盗梦空间 / Inception”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/07/16”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3541415/">https://movie.douban.com/subject/3541415/</a>“</td></tr><tr><td>“机器人总动员 / WALL·E”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/06/27”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2131459/">https://movie.douban.com/subject/2131459/</a>“</td></tr><tr><td>“阿凡达 / Avatar”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/12/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1652587/">https://movie.douban.com/subject/1652587/</a>“</td></tr><tr><td>“大话西游之月光宝盒 / 西遊記第壹佰零壹回之月光寶盒”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1995/01/21”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1299398/">https://movie.douban.com/subject/1299398/</a>“</td></tr><tr><td>“飞屋环游记 / Up”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/05/13”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/2129039/">https://movie.douban.com/subject/2129039/</a>“</td></tr><tr><td>“怦然心动 / Flipped”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/07/26”</td><td>“好莱坞首映”</td><td>“<a href="https://movie.douban.com/subject/3319755/">https://movie.douban.com/subject/3319755/</a>“</td></tr><tr><td>“让子弹飞”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/12/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3742360/">https://movie.douban.com/subject/3742360/</a>“</td></tr><tr><td>“本杰明·巴顿奇事 / The Curious Case of Benjamin Button”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/12/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1485260/">https://movie.douban.com/subject/1485260/</a>“</td></tr><tr><td>“教父 / The Godfather”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1972/03/15”</td><td>“纽约首映”</td><td>“<a href="https://movie.douban.com/subject/1291841/">https://movie.douban.com/subject/1291841/</a>“</td></tr><tr><td>“死亡诗社 / Dead Poets Society”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1989/06/02”</td><td>“多伦多首映”</td><td>“<a href="https://movie.douban.com/subject/1291548/">https://movie.douban.com/subject/1291548/</a>“</td></tr><tr><td>“飞越疯人院 / One Flew Over the Cuckoo’s Nest”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1975/11/19”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292224/">https://movie.douban.com/subject/1292224/</a>“</td></tr><tr><td>“唐伯虎点秋香 / 唐伯虎點秋香”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1993/07/01”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1306249/">https://movie.douban.com/subject/1306249/</a>“</td></tr><tr><td>“喜剧之王 / 喜劇之王”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1999/02/13”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1302425/">https://movie.douban.com/subject/1302425/</a>“</td></tr><tr><td>“少年派的奇幻漂流 / Life of Pi”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/09/28”</td><td>“纽约电影节”</td><td>“<a href="https://movie.douban.com/subject/1929463/">https://movie.douban.com/subject/1929463/</a>“</td></tr><tr><td>“禁闭岛 / Shutter Island”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/02/13”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/2334904/">https://movie.douban.com/subject/2334904/</a>“</td></tr><tr><td>“大闹天宫”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1418019/">https://movie.douban.com/subject/1418019/</a>“</td></tr><tr><td>“功夫”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2004/09/14”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/1291543/">https://movie.douban.com/subject/1291543/</a>“</td></tr><tr><td>“血钻 / Blood Diamond”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/12/08”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1428175/">https://movie.douban.com/subject/1428175/</a>“</td></tr><tr><td>“英雄本色”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1986/08/02”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297574/">https://movie.douban.com/subject/1297574/</a>“</td></tr><tr><td>“搏击俱乐部 / Fight Club”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1999/09/10”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/1292000/">https://movie.douban.com/subject/1292000/</a>“</td></tr><tr><td>“变脸 / Face/Off”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1997/06/27”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292659/">https://movie.douban.com/subject/1292659/</a>“</td></tr><tr><td>“后天 / The Day After Tomorrow”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2004/05/17”</td><td>“墨西哥城首映”</td><td>“<a href="https://movie.douban.com/subject/1308779/">https://movie.douban.com/subject/1308779/</a>“</td></tr><tr><td>“致命ID / Identity”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2003/04/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1297192/">https://movie.douban.com/subject/1297192/</a>“</td></tr><tr><td>“7号房的礼物 / 7번방의 선물”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/01/23”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/10777687/">https://movie.douban.com/subject/10777687/</a>“</td></tr><tr><td>“唐山大地震”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/07/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3596502/">https://movie.douban.com/subject/3596502/</a>“</td></tr><tr><td>“那些年，我们一起追的女孩 / 那些年，我們一起追的女孩”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2011/08/19”</td><td>“中国台湾”</td><td>“<a href="https://movie.douban.com/subject/4920528/">https://movie.douban.com/subject/4920528/</a>“</td></tr><tr><td>“上帝之城 / Cidade de Deus”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2002/05/18”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/1292208/">https://movie.douban.com/subject/1292208/</a>“</td></tr><tr><td>“星际穿越 / Interstellar”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/11/07”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1889243/">https://movie.douban.com/subject/1889243/</a>“</td></tr><tr><td>“2012”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/11/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3005875/">https://movie.douban.com/subject/3005875/</a>“</td></tr><tr><td>“举起手来！”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1394968/">https://movie.douban.com/subject/1394968/</a>“</td></tr><tr><td>“长江七号”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/01/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1961963/">https://movie.douban.com/subject/1961963/</a>“</td></tr><tr><td>“何以为家 / كفرناحوم”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/05/17”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/30170448/">https://movie.douban.com/subject/30170448/</a>“</td></tr><tr><td>“妈妈再爱我一次 / 媽媽再愛我一次”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1432972/">https://movie.douban.com/subject/1432972/</a>“</td></tr><tr><td>“金刚 / King Kong”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2005/12/05”</td><td>“纽约首映”</td><td>“<a href="https://movie.douban.com/subject/1309043/">https://movie.douban.com/subject/1309043/</a>“</td></tr><tr><td>“天下无贼”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2004/12/09”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1291550/">https://movie.douban.com/subject/1291550/</a>“</td></tr><tr><td>“小森林 夏秋篇 / リトル・フォレスト 夏・秋”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/08/30”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/25814705/">https://movie.douban.com/subject/25814705/</a>“</td></tr><tr><td>“人在囧途”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/06/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4237879/">https://movie.douban.com/subject/4237879/</a>“</td></tr><tr><td>“我是传奇 / I Am Legend”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/12/14”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1820156/">https://movie.douban.com/subject/1820156/</a>“</td></tr><tr><td>“爱情公寓”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/08/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24852545/">https://movie.douban.com/subject/24852545/</a>“</td></tr><tr><td>“上海堡垒”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/08/09”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26581837/">https://movie.douban.com/subject/26581837/</a>“</td></tr><tr><td>“变形金刚 / Transformers”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/07/03”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1794171/">https://movie.douban.com/subject/1794171/</a>“</td></tr><tr><td>“宝贝计划 / 寶貝計劃”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/09/08”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/1859036/">https://movie.douban.com/subject/1859036/</a>“</td></tr><tr><td>“神话”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2005/09/15”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/1307023/">https://movie.douban.com/subject/1307023/</a>“</td></tr><tr><td>“画皮 / 畫皮”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/09/25”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/2135981/">https://movie.douban.com/subject/2135981/</a>“</td></tr><tr><td>“大约在冬季”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/11/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30362186/">https://movie.douban.com/subject/30362186/</a>“</td></tr><tr><td>“大闹天竺”</td><td>“2”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/01/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26389696/">https://movie.douban.com/subject/26389696/</a>“</td></tr><tr><td>“比悲伤更悲伤的故事 / 比悲傷更悲傷的故事”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/11/30”</td><td>“中国台湾”</td><td>“<a href="https://movie.douban.com/subject/27624661/">https://movie.douban.com/subject/27624661/</a>“</td></tr><tr><td>“栀子花开”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/07/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26021055/">https://movie.douban.com/subject/26021055/</a>“</td></tr><tr><td>“独立日 / Independence Day”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1996/07/02”</td><td>“加拿大”</td><td>“<a href="https://movie.douban.com/subject/1293013/">https://movie.douban.com/subject/1293013/</a>“</td></tr><tr><td>“小森林 冬春篇 / リトル・フォレスト 冬・春”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/02/14”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/25814707/">https://movie.douban.com/subject/25814707/</a>“</td></tr><tr><td>“无问西东”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/01/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6874741/">https://movie.douban.com/subject/6874741/</a>“</td></tr><tr><td>“功夫之王 / The Forbidden Kingdom”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/04/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1939414/">https://movie.douban.com/subject/1939414/</a>“</td></tr><tr><td>“第九区 / District 9”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/08/14”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3006772/">https://movie.douban.com/subject/3006772/</a>“</td></tr><tr><td>“刺陵”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/12/09”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3305722/">https://movie.douban.com/subject/3305722/</a>“</td></tr><tr><td>“老师·好”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/03/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27663742/">https://movie.douban.com/subject/27663742/</a>“</td></tr><tr><td>“恶棍天使”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/12/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26290365/">https://movie.douban.com/subject/26290365/</a>“</td></tr><tr><td>“死神来了 / Final Destination”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2000/03/17”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1300300/">https://movie.douban.com/subject/1300300/</a>“</td></tr><tr><td>“从你的全世界路过”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/09/29”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26280528/">https://movie.douban.com/subject/26280528/</a>“</td></tr><tr><td>“西游记女儿国”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/02/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25829175/">https://movie.douban.com/subject/25829175/</a>“</td></tr><tr><td>“功夫瑜伽”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/01/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26182910/">https://movie.douban.com/subject/26182910/</a>“</td></tr><tr><td>“只有芸知道”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/12/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/33436135/">https://movie.douban.com/subject/33436135/</a>“</td></tr><tr><td>“何以笙箫默”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/04/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26259634/">https://movie.douban.com/subject/26259634/</a>“</td></tr><tr><td>“蜘蛛侠 / Spider-Man”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2002/05/03”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1306612/">https://movie.douban.com/subject/1306612/</a>“</td></tr><tr><td>“快乐到家”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/01/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/11610693/">https://movie.douban.com/subject/11610693/</a>“</td></tr><tr><td>“大笑江湖”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/12/03”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4323732/">https://movie.douban.com/subject/4323732/</a>“</td></tr><tr><td>“武状元苏乞儿 / 武狀元蘇乞兒”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1992/12/17”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297863/">https://movie.douban.com/subject/1297863/</a>“</td></tr><tr><td>“我和我的祖国”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/32659890/">https://movie.douban.com/subject/32659890/</a>“</td></tr><tr><td>“无极”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2005/12/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1419969/">https://movie.douban.com/subject/1419969/</a>“</td></tr><tr><td>“我不是药神”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/06/30”</td><td>“大规模点映”</td><td>“<a href="https://movie.douban.com/subject/26752088/">https://movie.douban.com/subject/26752088/</a>“</td></tr><tr><td>“满城尽带黄金甲”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/12/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1499008/">https://movie.douban.com/subject/1499008/</a>“</td></tr><tr><td>“左耳”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/04/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25745752/">https://movie.douban.com/subject/25745752/</a>“</td></tr><tr><td>“九龙不败 / 九龍不敗”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/06/20”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/26796665/">https://movie.douban.com/subject/26796665/</a>“</td></tr><tr><td>“狗十三”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/10/11”</td><td>“华语青年影像论坛”</td><td>“<a href="https://movie.douban.com/subject/25716096/">https://movie.douban.com/subject/25716096/</a>“</td></tr><tr><td>“战狼2”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/07/27”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26363254/">https://movie.douban.com/subject/26363254/</a>“</td></tr><tr><td>“大兵小将”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/02/14”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3279107/">https://movie.douban.com/subject/3279107/</a>“</td></tr><tr><td>“少林足球”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2001/07/12”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297747/">https://movie.douban.com/subject/1297747/</a>“</td></tr><tr><td>“新娘大作战”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/08/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25849475/">https://movie.douban.com/subject/25849475/</a>“</td></tr><tr><td>“赌神 / 賭神”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1989/12/14”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1300883/">https://movie.douban.com/subject/1300883/</a>“</td></tr><tr><td>“龙虾刑警”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/06/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26992383/">https://movie.douban.com/subject/26992383/</a>“</td></tr><tr><td>“碟中谍 / Mission: Impossible”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1996/05/22”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292484/">https://movie.douban.com/subject/1292484/</a>“</td></tr><tr><td>“小时代3：刺金时代”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/07/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24847340/">https://movie.douban.com/subject/24847340/</a>“</td></tr><tr><td>“灵魂战车 / Ghost Rider”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/02/16”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1482077/">https://movie.douban.com/subject/1482077/</a>“</td></tr><tr><td>“逃学威龙 / 逃學威龍”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1991/07/18”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1302090/">https://movie.douban.com/subject/1302090/</a>“</td></tr><tr><td>“落叶归根”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/01/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1853621/">https://movie.douban.com/subject/1853621/</a>“</td></tr><tr><td>“调音师 / Andhadhun”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/10/05”</td><td>“印度”</td><td>“<a href="https://movie.douban.com/subject/30334073/">https://movie.douban.com/subject/30334073/</a>“</td></tr><tr><td>“小时代”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/06/27”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/20376577/">https://movie.douban.com/subject/20376577/</a>“</td></tr><tr><td>“国产凌凌漆 / 國產凌凌漆”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1994/10/13”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1307739/">https://movie.douban.com/subject/1307739/</a>“</td></tr><tr><td>“非诚勿扰”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/12/18”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3313801/">https://movie.douban.com/subject/3313801/</a>“</td></tr><tr><td>“祖宗十九代”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/02/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27114417/">https://movie.douban.com/subject/27114417/</a>“</td></tr><tr><td>“澳门风云3 / 賭城風雲III”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/02/06”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/26334559/">https://movie.douban.com/subject/26334559/</a>“</td></tr><tr><td>“釜山行 / 부산행”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/05/13”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/25986180/">https://movie.douban.com/subject/25986180/</a>“</td></tr><tr><td>“博物馆奇妙夜 / Night at the Museum”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/12/17”</td><td>“纽约首映”</td><td>“<a href="https://movie.douban.com/subject/1835843/">https://movie.douban.com/subject/1835843/</a>“</td></tr><tr><td>“地心历险记 / Journey to the Center of the Earth”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/07/11”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2037833/">https://movie.douban.com/subject/2037833/</a>“</td></tr><tr><td>“变形金刚2 / Transformers: Revenge of the Fallen”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/06/19”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/2146991/">https://movie.douban.com/subject/2146991/</a>“</td></tr><tr><td>“变形金刚5：最后的骑士 / Transformers: The Last Knight”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/06/21”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/25824686/">https://movie.douban.com/subject/25824686/</a>“</td></tr><tr><td>“鹬 / Piper”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/06/17”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26766869/">https://movie.douban.com/subject/26766869/</a>“</td></tr><tr><td>“越光宝盒”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/03/18”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3928370/">https://movie.douban.com/subject/3928370/</a>“</td></tr><tr><td>“木乃伊3 / The Mummy: Tomb of the Dragon Emperor”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/08/01”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1997679/">https://movie.douban.com/subject/1997679/</a>“</td></tr><tr><td>“泰山 / Tarzan”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1999/06/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1294766/">https://movie.douban.com/subject/1294766/</a>“</td></tr><tr><td>“心理罪”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/08/11”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26698000/">https://movie.douban.com/subject/26698000/</a>“</td></tr><tr><td>“无名之辈”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/11/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27110296/">https://movie.douban.com/subject/27110296/</a>“</td></tr><tr><td>“鹿鼎记 / 鹿鼎記”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1992/07/30”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297223/">https://movie.douban.com/subject/1297223/</a>“</td></tr><tr><td>“极速60秒 / Gone in 60 Seconds”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2000/06/08”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1298189/">https://movie.douban.com/subject/1298189/</a>“</td></tr><tr><td>“食神”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1996/12/21”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1293351/">https://movie.douban.com/subject/1293351/</a>“</td></tr><tr><td>“杜拉拉升职记”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/04/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3820191/">https://movie.douban.com/subject/3820191/</a>“</td></tr><tr><td>“赌圣 / 賭聖”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1990/08/18”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1298644/">https://movie.douban.com/subject/1298644/</a>“</td></tr><tr><td>“赌神2 / 賭神2”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1994/12/15”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1292506/">https://movie.douban.com/subject/1292506/</a>“</td></tr><tr><td>“赌神3之少年赌神 / 賭神3之少年賭神”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1301381/">https://movie.douban.com/subject/1301381/</a>“</td></tr><tr><td>“赌圣2：街头赌圣 / 賭聖2街頭賭聖”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1433602/">https://movie.douban.com/subject/1433602/</a>“</td></tr><tr><td>“赌侠 / 賭俠”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1990/12/13”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1300566/">https://movie.douban.com/subject/1300566/</a>“</td></tr><tr><td>“赌侠2：上海滩赌圣 / 賭俠II上海灘賭聖”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1991/08/21”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1302977/">https://movie.douban.com/subject/1302977/</a>“</td></tr><tr><td>“半个喜剧”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/12/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/30269016/">https://movie.douban.com/subject/30269016/</a>“</td></tr><tr><td>“反贪风暴4 / P風暴”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/04/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27202819/">https://movie.douban.com/subject/27202819/</a>“</td></tr><tr><td>“2001太空漫游 / 2001: A Space Odyssey”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1968/04/02”</td><td>“华盛顿首映”</td><td>“<a href="https://movie.douban.com/subject/1292226/">https://movie.douban.com/subject/1292226/</a>“</td></tr><tr><td>“人再囧途之泰囧”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/12/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10574622/">https://movie.douban.com/subject/10574622/</a>“</td></tr><tr><td>“分手大师”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/06/27”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24879858/">https://movie.douban.com/subject/24879858/</a>“</td></tr><tr><td>“A计划 / A計劃”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1983/12/22”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297909/">https://movie.douban.com/subject/1297909/</a>“</td></tr><tr><td>“尖峰时刻3 / Rush Hour 3”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2007/08/10”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1422106/">https://movie.douban.com/subject/1422106/</a>“</td></tr><tr><td>“九层妖塔”</td><td>“3”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/24827406/">https://movie.douban.com/subject/24827406/</a>“</td></tr><tr><td>“木乃伊 / The Mummy”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1999/04/16”</td><td>“葡萄牙”</td><td>“<a href="https://movie.douban.com/subject/1295229/">https://movie.douban.com/subject/1295229/</a>“</td></tr><tr><td>“变形金刚3 / Transformers: Dark of the Moon”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2011/06/29”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3610047/">https://movie.douban.com/subject/3610047/</a>“</td></tr><tr><td>“变形金刚4：绝迹重生 / Transformers: Age of Extinction”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/06/19”</td><td>“中国香港首映”</td><td>“<a href="https://movie.douban.com/subject/7054604/">https://movie.douban.com/subject/7054604/</a>“</td></tr><tr><td>“西游记之大闹天宫”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/01/31”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5317291/">https://movie.douban.com/subject/5317291/</a>“</td></tr><tr><td>“墨攻”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/11/23”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1455979/">https://movie.douban.com/subject/1455979/</a>“</td></tr><tr><td>“河东狮吼 / 我家有一隻河東獅”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2002/09/28”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1305265/">https://movie.douban.com/subject/1305265/</a>“</td></tr><tr><td>“彗星来的那一夜 / Coherence”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/09/19”</td><td>“奇幻电影节”</td><td>“<a href="https://movie.douban.com/subject/25807345/">https://movie.douban.com/subject/25807345/</a>“</td></tr><tr><td>“猩球崛起 / Rise of the Planet of the Apes”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2011/08/05”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3274505/">https://movie.douban.com/subject/3274505/</a>“</td></tr><tr><td>“咱们结婚吧”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/04/02”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26140241/">https://movie.douban.com/subject/26140241/</a>“</td></tr><tr><td>“古墓丽影2 / Lara Croft Tomb Raider: The Cradle of Life”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2003/07/21”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1307657/">https://movie.douban.com/subject/1307657/</a>“</td></tr><tr><td>“木乃伊归来 / The Mummy Returns”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2001/05/04”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1298586/">https://movie.douban.com/subject/1298586/</a>“</td></tr><tr><td>“美人鱼”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/02/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/19944106/">https://movie.douban.com/subject/19944106/</a>“</td></tr><tr><td>“北京遇上西雅图”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/03/21”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10574468/">https://movie.douban.com/subject/10574468/</a>“</td></tr><tr><td>“羞羞的铁拳”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27038183/">https://movie.douban.com/subject/27038183/</a>“</td></tr><tr><td>“芳华”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/09/07”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/26862829/">https://movie.douban.com/subject/26862829/</a>“</td></tr><tr><td>“黄飞鸿之二：男儿当自强 / 黃飛鴻之二男兒當自強”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1293475/">https://movie.douban.com/subject/1293475/</a>“</td></tr><tr><td>“逃学威龙3之龙过鸡年 / 逃學威龍III之龍過雞年”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1302678/">https://movie.douban.com/subject/1302678/</a>“</td></tr><tr><td>“逃学威龙2 / 逃學威龍2”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1992/04/09”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1296201/">https://movie.douban.com/subject/1296201/</a>“</td></tr><tr><td>“手机”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2003/12/18”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1308747/">https://movie.douban.com/subject/1308747/</a>“</td></tr><tr><td>“太极张三丰 / 太極張三豐”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1993/11/18”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1294561/">https://movie.douban.com/subject/1294561/</a>“</td></tr><tr><td>“美女与野兽 / Beauty and the Beast”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/03/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25900945/">https://movie.douban.com/subject/25900945/</a>“</td></tr><tr><td>“东方不败之风云再起 / 東方不敗之風雲再起”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1993/01/21”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1394324/">https://movie.douban.com/subject/1394324/</a>“</td></tr><tr><td>“西游记之大圣归来”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/07/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26277313/">https://movie.douban.com/subject/26277313/</a>“</td></tr><tr><td>“虎胆龙威2 / Die Hard 2”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1990/07/04”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1300537/">https://movie.douban.com/subject/1300537/</a>“</td></tr><tr><td>“影”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/09/06”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/4864908/">https://movie.douban.com/subject/4864908/</a>“</td></tr><tr><td>“全球风暴 / Geostorm”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/10/20”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/22266012/">https://movie.douban.com/subject/22266012/</a>“</td></tr><tr><td>“荒蛮故事 / Relatos salvajes”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/05/17”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/24750126/">https://movie.douban.com/subject/24750126/</a>“</td></tr><tr><td>“反贪风暴 / Z風暴”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/06/19”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/25792690/">https://movie.douban.com/subject/25792690/</a>“</td></tr><tr><td>“即日启程”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3250377/">https://movie.douban.com/subject/3250377/</a>“</td></tr><tr><td>“黑夜传说2：进化 / Underworld: Evolution”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2006/01/20”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1422920/">https://movie.douban.com/subject/1422920/</a>“</td></tr><tr><td>“盗火线 / Heat”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1995/12/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1295686/">https://movie.douban.com/subject/1295686/</a>“</td></tr><tr><td>“虎胆龙威 / Die Hard”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“1988/07/20”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1292697/">https://movie.douban.com/subject/1292697/</a>“</td></tr><tr><td>“尖峰时刻2 / Rush Hour 2”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2001/08/03”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1304642/">https://movie.douban.com/subject/1304642/</a>“</td></tr><tr><td>“古墓丽影 / Lara Croft: Tomb Raider”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2001/06/15”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1293173/">https://movie.douban.com/subject/1293173/</a>“</td></tr><tr><td>“古墓丽影：源起之战 / Tomb Raider”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/03/16”</td><td>“美国/中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3445906/">https://movie.douban.com/subject/3445906/</a>“</td></tr><tr><td>“黑衣人2 / Men in Black II”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1295280/">https://movie.douban.com/subject/1295280/</a>“</td></tr><tr><td>“无双 / 無雙”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/09/30”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26425063/">https://movie.douban.com/subject/26425063/</a>“</td></tr><tr><td>“血滴子”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/12/20”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2994851/">https://movie.douban.com/subject/2994851/</a>“</td></tr><tr><td>“守望者：罪恶迷途”</td><td>“”</td><td>“2020/02/08”</td><td>“”</td><td>“2011/03/25”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4821015/">https://movie.douban.com/subject/4821015/</a>“</td></tr><tr><td>“壮志凌云 / Top Gun”</td><td>“3”</td><td>“2020/02/08”</td><td>“”</td><td>“1986/05/16”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1293799/">https://movie.douban.com/subject/1293799/</a>“</td></tr><tr><td>“倩女幽魂”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“1987/07/18”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1297447/">https://movie.douban.com/subject/1297447/</a>“</td></tr><tr><td>“家有喜事 / 家有囍事”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1992/01/25”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1300064/">https://movie.douban.com/subject/1300064/</a>“</td></tr><tr><td>“一代宗师 / 一代宗師”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/01/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3821067/">https://movie.douban.com/subject/3821067/</a>“</td></tr><tr><td>“赤壁(上)”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2008/07/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1465829/">https://movie.douban.com/subject/1465829/</a>“</td></tr><tr><td>“非诚勿扰2”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2010/12/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4271894/">https://movie.douban.com/subject/4271894/</a>“</td></tr><tr><td>“私人订制”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/12/19”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10605978/">https://movie.douban.com/subject/10605978/</a>“</td></tr><tr><td>“不见不散”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“1998/12/24”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1307014/">https://movie.douban.com/subject/1307014/</a>“</td></tr><tr><td>“一出好戏”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/08/10”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26985127/">https://movie.douban.com/subject/26985127/</a>“</td></tr><tr><td>“疯狂的外星人”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/02/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25986662/">https://movie.douban.com/subject/25986662/</a>“</td></tr><tr><td>“西游降魔篇”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/02/07”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/5308265/">https://movie.douban.com/subject/5308265/</a>“</td></tr><tr><td>“寻龙诀”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/12/18”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3077412/">https://movie.douban.com/subject/3077412/</a>“</td></tr><tr><td>“心花路放”</td><td>“3”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/09/06”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/25717233/">https://movie.douban.com/subject/25717233/</a>“</td></tr><tr><td>“记忆大师”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2017/04/23”</td><td>“北京电影节”</td><td>“<a href="https://movie.douban.com/subject/25884801/">https://movie.douban.com/subject/25884801/</a>“</td></tr><tr><td>“101次求婚”</td><td>“3”</td><td>“2020/02/08”</td><td>“”</td><td>“2013/02/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5319835/">https://movie.douban.com/subject/5319835/</a>“</td></tr><tr><td>“寒战 / 寒戰”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2012/11/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/6890730/">https://movie.douban.com/subject/6890730/</a>“</td></tr><tr><td>“寒战2 / 寒戰II”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/07/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/20505982/">https://movie.douban.com/subject/20505982/</a>“</td></tr><tr><td>“监狱风云 / 監獄風雲”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1987/11/13”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1293422/">https://movie.douban.com/subject/1293422/</a>“</td></tr><tr><td>“海上钢琴师 / La leggenda del pianista sull’oceano”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“1998/10/28”</td><td>“意大利”</td><td>“<a href="https://movie.douban.com/subject/1292001/">https://movie.douban.com/subject/1292001/</a>“</td></tr><tr><td>“三傻大闹宝莱坞 / 3 Idiots”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2009/12/25”</td><td>“印度”</td><td>“<a href="https://movie.douban.com/subject/3793023/">https://movie.douban.com/subject/3793023/</a>“</td></tr><tr><td>“甜蜜蜜”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“1996/11/02”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1305164/">https://movie.douban.com/subject/1305164/</a>“</td></tr><tr><td>“爆裂鼓手 / Whiplash”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2014/01/16”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/25773932/">https://movie.douban.com/subject/25773932/</a>“</td></tr><tr><td>“头号玩家 / Ready Player One”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2018/03/11”</td><td>“西南偏南电影节”</td><td>“<a href="https://movie.douban.com/subject/4920389/">https://movie.douban.com/subject/4920389/</a>“</td></tr><tr><td>“海边的曼彻斯特 / Manchester by the Sea”</td><td>“3”</td><td>“2020/02/08”</td><td>“”</td><td>“2016/01/23”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/25980443/">https://movie.douban.com/subject/25980443/</a>“</td></tr><tr><td>“疯狂的麦克斯4：狂暴之路 / Mad Max: Fury Road”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/05/14”</td><td>“澳大利亚”</td><td>“<a href="https://movie.douban.com/subject/3592854/">https://movie.douban.com/subject/3592854/</a>“</td></tr><tr><td>“哪吒之魔童降世”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/07/13”</td><td>“大规模点映”</td><td>“<a href="https://movie.douban.com/subject/26794435/">https://movie.douban.com/subject/26794435/</a>“</td></tr><tr><td>“流浪地球”</td><td>“5”</td><td>“2020/02/08”</td><td>“”</td><td>“2019/02/05”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26266893/">https://movie.douban.com/subject/26266893/</a>“</td></tr><tr><td>“老炮儿”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/09/09”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/24751756/">https://movie.douban.com/subject/24751756/</a>“</td></tr><tr><td>“港囧”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“2015/09/25”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25710912/">https://movie.douban.com/subject/25710912/</a>“</td></tr><tr><td>“整蛊专家 / 整蠱專家”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“1991/02/02”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1299680/">https://movie.douban.com/subject/1299680/</a>“</td></tr><tr><td>“大内密探零零发 / 大內密探零零發”</td><td>“4”</td><td>“2020/02/08”</td><td>“”</td><td>“1996/02/16”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1329936/">https://movie.douban.com/subject/1329936/</a>“</td></tr></tbody></table></div><h1 id="我想看"><a href="#我想看" class="headerlink" title="我想看"></a>我想看</h1><div class="table-container"><table><thead><tr><th>标题</th><th>上映日期</th><th>制片国家</th><th>条目链接</th></tr></thead><tbody><tr><td>“真探 第一季 / True Detective Season 1”</td><td>“2014/01/12”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/10748120/">https://movie.douban.com/subject/10748120/</a>“</td></tr><tr><td>“挖眼睛”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/25866887/">https://movie.douban.com/subject/25866887/</a>“</td></tr><tr><td>“算命”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/4073872/">https://movie.douban.com/subject/4073872/</a>“</td></tr><tr><td>“书记”</td><td>“2009/03/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3629230/">https://movie.douban.com/subject/3629230/</a>“</td></tr><tr><td>“铁路沿线”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1421469/">https://movie.douban.com/subject/1421469/</a>“</td></tr><tr><td>“我的天才女友 第一季 / L’amica geniale Season 1”</td><td>“2018/09/01”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/28427782/">https://movie.douban.com/subject/28427782/</a>“</td></tr><tr><td>“羞耻 第三季 / Skam Sesong 3”</td><td>“2016/10/07”</td><td>“挪威”</td><td>“<a href="https://movie.douban.com/subject/26811832/">https://movie.douban.com/subject/26811832/</a>“</td></tr><tr><td>“酷儿们 / Queers”</td><td>“2017/07/31”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/27032266/">https://movie.douban.com/subject/27032266/</a>“</td></tr><tr><td>“女性瘾者：第二部 / Nymphomaniac: Volume II”</td><td>“2013/12/25”</td><td>“丹麦”</td><td>“<a href="https://movie.douban.com/subject/10792650/">https://movie.douban.com/subject/10792650/</a>“</td></tr><tr><td>“全裸导演 第一季 / 全裸監督 シーズン1”</td><td>“2019/08/08”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30360724/">https://movie.douban.com/subject/30360724/</a>“</td></tr><tr><td>“女巫 / Churails”</td><td>“2020/08/11”</td><td>“巴基斯坦”</td><td>“<a href="https://movie.douban.com/subject/35205002/">https://movie.douban.com/subject/35205002/</a>“</td></tr><tr><td>“3年A班：从现在起，大家都是人质 / 3年A組 -今から皆さんは、人質…”</td><td>“2019/01/06”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/30377729/">https://movie.douban.com/subject/30377729/</a>“</td></tr><tr><td>“走向共和”</td><td>“2003/04/12”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/1441794/">https://movie.douban.com/subject/1441794/</a>“</td></tr><tr><td>“天道”</td><td>“2008/06/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2347485/">https://movie.douban.com/subject/2347485/</a>“</td></tr><tr><td>“僵尸肖恩 / Shaun of the Dead”</td><td>“2004/04/09”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/1308755/">https://movie.douban.com/subject/1308755/</a>“</td></tr><tr><td>“隐秘的生活 / A Hidden Life”</td><td>“2019/05/19”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26823502/">https://movie.douban.com/subject/26823502/</a>“</td></tr><tr><td>“科洛弗档案 / Cloverfield”</td><td>“2008/01/18”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2144242/">https://movie.douban.com/subject/2144242/</a>“</td></tr><tr><td>“大地惊雷 / True Grit”</td><td>“2010/12/22”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3626372/">https://movie.douban.com/subject/3626372/</a>“</td></tr><tr><td>“藏品 / The Collection”</td><td>“2012/11/30”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/6021917/">https://movie.douban.com/subject/6021917/</a>“</td></tr><tr><td>“候鸟 / Pájaros de verano”</td><td>“2018/05/09”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26682914/">https://movie.douban.com/subject/26682914/</a>“</td></tr><tr><td>“橘色 / Tangerine”</td><td>“2015/01/23”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/26275494/">https://movie.douban.com/subject/26275494/</a>“</td></tr><tr><td>“水滴 / Waterdrop”</td><td>“2015/09/15”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26613444/">https://movie.douban.com/subject/26613444/</a>“</td></tr><tr><td>“边境 / Frontera”</td><td>“2014/04/05”</td><td>“凤凰城电影节”</td><td>“<a href="https://movie.douban.com/subject/20436812/">https://movie.douban.com/subject/20436812/</a>“</td></tr><tr><td>“曲面 / Curve”</td><td>“2016/04/16”</td><td>“翠贝卡电影节”</td><td>“<a href="https://movie.douban.com/subject/26823498/">https://movie.douban.com/subject/26823498/</a>“</td></tr><tr><td>“丹尼·科林斯 / Danny Collins”</td><td>“2015/03/20”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/10440069/">https://movie.douban.com/subject/10440069/</a>“</td></tr><tr><td>“布拉格秘境 / Mystic Prague”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/26785787/">https://movie.douban.com/subject/26785787/</a>“</td></tr><tr><td>“阴影之下 / Under the Shadow”</td><td>“2016/01/22”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/26700688/">https://movie.douban.com/subject/26700688/</a>“</td></tr><tr><td>“消失的西德尼·豪尔 / The Vanishing of Sidney Hall”</td><td>“2017/01/25”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/3217166/">https://movie.douban.com/subject/3217166/</a>“</td></tr><tr><td>“白色上帝 / Fehér isten”</td><td>“2014/05/17”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/23011206/">https://movie.douban.com/subject/23011206/</a>“</td></tr><tr><td>“普罗米修斯 / Prometheus”</td><td>“2012/06/08”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3771562/">https://movie.douban.com/subject/3771562/</a>“</td></tr><tr><td>“夜色人生 / Live by Night”</td><td>“2016/12/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/10752547/">https://movie.douban.com/subject/10752547/</a>“</td></tr><tr><td>“安德的游戏 / Ender’s Game”</td><td>“2013/10/24”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/5323957/">https://movie.douban.com/subject/5323957/</a>“</td></tr><tr><td>“思维空间 / Anna”</td><td>“2013/10/13”</td><td>“锡切斯电影节”</td><td>“<a href="https://movie.douban.com/subject/10432181/">https://movie.douban.com/subject/10432181/</a>“</td></tr><tr><td>“彩券 / The Ticket”</td><td>“2016/04/16”</td><td>“翠贝卡电影节”</td><td>“<a href="https://movie.douban.com/subject/25937856/">https://movie.douban.com/subject/25937856/</a>“</td></tr><tr><td>“瘦长鬼影 / Slender Man”</td><td>“2018/08/10”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26787571/">https://movie.douban.com/subject/26787571/</a>“</td></tr><tr><td>“分裂 / Split”</td><td>“2016/12/26”</td><td>“奇幻电影节”</td><td>“<a href="https://movie.douban.com/subject/26600660/">https://movie.douban.com/subject/26600660/</a>“</td></tr><tr><td>“拉普拉斯的魔女 / ラプラスの魔女”</td><td>“2018/05/04”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26999488/">https://movie.douban.com/subject/26999488/</a>“</td></tr><tr><td>“SPEC：结 前篇 / 劇場版 SPEC～結～漸ノ篇”</td><td>“2013/11/01”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/19975104/">https://movie.douban.com/subject/19975104/</a>“</td></tr><tr><td>“SPEC：天 / 劇場版 SPEC〜天〜”</td><td>“2012/04/07”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/6717573/">https://movie.douban.com/subject/6717573/</a>“</td></tr><tr><td>“狂野生活 / Wildlife”</td><td>“2018/01/20”</td><td>“圣丹斯电影节”</td><td>“<a href="https://movie.douban.com/subject/26847068/">https://movie.douban.com/subject/26847068/</a>“</td></tr><tr><td>“隧道尽头 / Al final del túnel”</td><td>“2016/04/21”</td><td>“阿根廷”</td><td>“<a href="https://movie.douban.com/subject/26661229/">https://movie.douban.com/subject/26661229/</a>“</td></tr><tr><td>“人类清除计划4 / The First Purge”</td><td>“2018/07/04”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/26905717/">https://movie.douban.com/subject/26905717/</a>“</td></tr><tr><td>“SPEC：结 后篇 / 劇場版 SPEC～結～ 爻の篇”</td><td>“2013/11/29”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/22736358/">https://movie.douban.com/subject/22736358/</a>“</td></tr><tr><td>“同等族群 / Equals”</td><td>“2015/09/05”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/25774688/">https://movie.douban.com/subject/25774688/</a>“</td></tr><tr><td>“金蝉脱壳2：冥府 / Escape Plan 2: Hades”</td><td>“2018/06/13”</td><td>“菲律宾”</td><td>“<a href="https://movie.douban.com/subject/26905469/">https://movie.douban.com/subject/26905469/</a>“</td></tr><tr><td>“金蝉脱壳3：恶魔车站 / Escape Plan: The Extractors”</td><td>“2019/07/02”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/27018354/">https://movie.douban.com/subject/27018354/</a>“</td></tr><tr><td>“过年好”</td><td>“2016/02/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26698301/">https://movie.douban.com/subject/26698301/</a>“</td></tr><tr><td>“你是凶手”</td><td>“2019/11/22”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26762744/">https://movie.douban.com/subject/26762744/</a>“</td></tr><tr><td>“喜宝”</td><td>“2020/10/16”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27611667/">https://movie.douban.com/subject/27611667/</a>“</td></tr><tr><td>“天使之恋 / 天使の恋”</td><td>“2009/11/07”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/4196129/">https://movie.douban.com/subject/4196129/</a>“</td></tr><tr><td>“午夜巴塞罗那 / Vicky Cristina Barcelona”</td><td>“2008/05/17”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/1981242/">https://movie.douban.com/subject/1981242/</a>“</td></tr><tr><td>“猜火车 / Trainspotting”</td><td>“1996/02/23”</td><td>“英国”</td><td>“<a href="https://movie.douban.com/subject/1292528/">https://movie.douban.com/subject/1292528/</a>“</td></tr><tr><td>“夺宝联盟 / 도둑들”</td><td>“2012/07/25”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/5502697/">https://movie.douban.com/subject/5502697/</a>“</td></tr><tr><td>“无理之人 / Irrational Man”</td><td>“2015/05/15”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/25881888/">https://movie.douban.com/subject/25881888/</a>“</td></tr><tr><td>“棋王”</td><td>“1991/09/06”</td><td>“中国香港”</td><td>“<a href="https://movie.douban.com/subject/1307163/">https://movie.douban.com/subject/1307163/</a>“</td></tr><tr><td>“在路上 / On the Road”</td><td>“2012/05/23”</td><td>“法国”</td><td>“<a href="https://movie.douban.com/subject/1907465/">https://movie.douban.com/subject/1907465/</a>“</td></tr><tr><td>“双食记”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/2052978/">https://movie.douban.com/subject/2052978/</a>“</td></tr><tr><td>“失恋33天”</td><td>“2011/11/08”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/4873490/">https://movie.douban.com/subject/4873490/</a>“</td></tr><tr><td>“鸟人 / Birdy”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1298638/">https://movie.douban.com/subject/1298638/</a>“</td></tr><tr><td>“放大 / Blow-Up”</td><td>“1966/12/18”</td><td>“纽约首映”</td><td>“<a href="https://movie.douban.com/subject/1310176/">https://movie.douban.com/subject/1310176/</a>“</td></tr><tr><td>“镜子 / Зеркало”</td><td>“1975/03/07”</td><td>“苏联”</td><td>“<a href="https://movie.douban.com/subject/1299248/">https://movie.douban.com/subject/1299248/</a>“</td></tr><tr><td>“伊豆的舞女 / 伊豆の踊子”</td><td>“1974/12/28”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1421733/">https://movie.douban.com/subject/1421733/</a>“</td></tr><tr><td>“英国病人 / The English Patient”</td><td>“1996/12/06”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1291853/">https://movie.douban.com/subject/1291853/</a>“</td></tr><tr><td>“耳朵大有福”</td><td>“2008/01/04”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/2272222/">https://movie.douban.com/subject/2272222/</a>“</td></tr><tr><td>“顽主”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1307690/">https://movie.douban.com/subject/1307690/</a>“</td></tr><tr><td>“小亚细亚往事 / Bir Zamanlar Anadolu’da”</td><td>“2011/05/21”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/5959260/">https://movie.douban.com/subject/5959260/</a>“</td></tr><tr><td>“都灵之马 / A torinói ló”</td><td>“2011/02/15”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/3285632/">https://movie.douban.com/subject/3285632/</a>“</td></tr><tr><td>“狗镇 / Dogville”</td><td>“2003/05/19”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/1298759/">https://movie.douban.com/subject/1298759/</a>“</td></tr><tr><td>“有完没完”</td><td>“2017/04/01”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26828019/">https://movie.douban.com/subject/26828019/</a>“</td></tr><tr><td>“四月物语 / 四月物語”</td><td>“1998/03/14”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1292371/">https://movie.douban.com/subject/1292371/</a>“</td></tr><tr><td>“雏菊 / 데이지”</td><td>“2006/03/09”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/1433360/">https://movie.douban.com/subject/1433360/</a>“</td></tr><tr><td>“站台”</td><td>“2000/09/04”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/1291850/">https://movie.douban.com/subject/1291850/</a>“</td></tr><tr><td>“晚秋 / 만추”</td><td>“2010/09/10”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/4136036/">https://movie.douban.com/subject/4136036/</a>“</td></tr><tr><td>“花与爱丽丝 / 花とアリス”</td><td>“2004/03/13”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1308820/">https://movie.douban.com/subject/1308820/</a>“</td></tr><tr><td>“骡子 / The Mule”</td><td>“2018/12/14”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/30135113/">https://movie.douban.com/subject/30135113/</a>“</td></tr><tr><td>“必是天堂 / إن شئت كما في ا…”</td><td>“2019/05/24”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26923111/">https://movie.douban.com/subject/26923111/</a>“</td></tr><tr><td>“三峡好人”</td><td>“2006/09/06”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/1872133/">https://movie.douban.com/subject/1872133/</a>“</td></tr><tr><td>“春风沉醉的夜晚”</td><td>“2009/05/14”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/3690289/">https://movie.douban.com/subject/3690289/</a>“</td></tr><tr><td>“哭声 / 곡성”</td><td>“2016/05/11”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/25817534/">https://movie.douban.com/subject/25817534/</a>“</td></tr><tr><td>“气球 / Ballon”</td><td>“2018/09/27”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/30192401/">https://movie.douban.com/subject/30192401/</a>“</td></tr><tr><td>“白雪公主杀人事件 / 白ゆき姫殺人事件”</td><td>“2014/03/29”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/24858414/">https://movie.douban.com/subject/24858414/</a>“</td></tr><tr><td>“坏蛋必须死”</td><td>“2015/11/27”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26289126/">https://movie.douban.com/subject/26289126/</a>“</td></tr><tr><td>“村庄 / The Village”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1901613/">https://movie.douban.com/subject/1901613/</a>“</td></tr><tr><td>“东北偏北”</td><td>“2014/10/25”</td><td>“东京电影节”</td><td>“<a href="https://movie.douban.com/subject/26061902/">https://movie.douban.com/subject/26061902/</a>“</td></tr><tr><td>“花牌情缘 上之句 / ちはやふる 上の句”</td><td>“2016/03/19”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/26365262/">https://movie.douban.com/subject/26365262/</a>“</td></tr><tr><td>“燃烧女子的肖像 / Portrait de la jeune fille en feu”</td><td>“2019/05/19”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/30257175/">https://movie.douban.com/subject/30257175/</a>“</td></tr><tr><td>“浮生一日 / Life in a Day”</td><td>“2011/07/24”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/5387041/">https://movie.douban.com/subject/5387041/</a>“</td></tr><tr><td>“滚蛋吧！肿瘤君”</td><td>“2015/08/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/26289144/">https://movie.douban.com/subject/26289144/</a>“</td></tr><tr><td>“濑户内海 / セトウツミ”</td><td>“2016/06/12”</td><td>“上海电影节”</td><td>“<a href="https://movie.douban.com/subject/26362351/">https://movie.douban.com/subject/26362351/</a>“</td></tr><tr><td>“少年巴比伦”</td><td>“2015/06/18”</td><td>“上海电影节”</td><td>“<a href="https://movie.douban.com/subject/25876760/">https://movie.douban.com/subject/25876760/</a>“</td></tr><tr><td>“处子之山 / Fúsi”</td><td>“2015/02/09”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/26304901/">https://movie.douban.com/subject/26304901/</a>“</td></tr><tr><td>“罗生门 / 羅生門”</td><td>“1950/08/26”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/1291879/">https://movie.douban.com/subject/1291879/</a>“</td></tr><tr><td>“我是山姆 / I Am Sam”</td><td>“2001/12/03”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1306861/">https://movie.douban.com/subject/1306861/</a>“</td></tr><tr><td>“一念无明 / 一念無明”</td><td>“2016/09/08”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/26704590/">https://movie.douban.com/subject/26704590/</a>“</td></tr><tr><td>“假如爱有天意 / 클래식”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/1304073/">https://movie.douban.com/subject/1304073/</a>“</td></tr><tr><td>“牯岭街少年杀人事件 / 牯嶺街少年殺人事件”</td><td>“1991/07/27”</td><td>“中国台湾”</td><td>“<a href="https://movie.douban.com/subject/1292329/">https://movie.douban.com/subject/1292329/</a>“</td></tr><tr><td>“危楼愚夫 / Дурак”</td><td>“2014/08/09”</td><td>“洛迦诺电影节”</td><td>“<a href="https://movie.douban.com/subject/25882861/">https://movie.douban.com/subject/25882861/</a>“</td></tr><tr><td>“山河故人”</td><td>“2015/05/20”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/25890005/">https://movie.douban.com/subject/25890005/</a>“</td></tr><tr><td>“遥望南方的童年”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3037329/">https://movie.douban.com/subject/3037329/</a>“</td></tr><tr><td>“孙子从美国来”</td><td>“2012/02/02”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/10467774/">https://movie.douban.com/subject/10467774/</a>“</td></tr><tr><td>“爱在日落黄昏时 / Before Sunset”</td><td>“2004/02/10”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/1291990/">https://movie.douban.com/subject/1291990/</a>“</td></tr><tr><td>“荒野生存 / Into the Wild”</td><td>“2007/09/21”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/1905462/">https://movie.douban.com/subject/1905462/</a>“</td></tr><tr><td>“四个春天”</td><td>“2017/12/30”</td><td>“UCCA艺术放映”</td><td>“<a href="https://movie.douban.com/subject/27191492/">https://movie.douban.com/subject/27191492/</a>“</td></tr><tr><td>“驴得水”</td><td>“2016/10/28”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/25921812/">https://movie.douban.com/subject/25921812/</a>“</td></tr><tr><td>“聚焦 / Spotlight”</td><td>“2015/09/03”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/25954475/">https://movie.douban.com/subject/25954475/</a>“</td></tr><tr><td>“一次别离 / جدایی نادر از س…”</td><td>“2011/02/15”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/5964718/">https://movie.douban.com/subject/5964718/</a>“</td></tr><tr><td>“追随 / Following”</td><td>“1998/09/12”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/1397546/">https://movie.douban.com/subject/1397546/</a>“</td></tr><tr><td>“灾难艺术家 / The Disaster Artist”</td><td>“2017/09/11”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/25944886/">https://movie.douban.com/subject/25944886/</a>“</td></tr><tr><td>“维多利亚 / Victoria”</td><td>“2015/02/07”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/26303865/">https://movie.douban.com/subject/26303865/</a>“</td></tr><tr><td>“无限循环 / The Infinite Man”</td><td>“2014/09/18”</td><td>“澳大利亚”</td><td>“<a href="https://movie.douban.com/subject/25909770/">https://movie.douban.com/subject/25909770/</a>“</td></tr><tr><td>“不准忘了我 / Du hast es versprochen”</td><td>“2012/11/01”</td><td>“德国”</td><td>“<a href="https://movie.douban.com/subject/11591789/">https://movie.douban.com/subject/11591789/</a>“</td></tr><tr><td>“羞辱 / قضية رقم ٢٣”</td><td>“2017/08/31”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/27098888/">https://movie.douban.com/subject/27098888/</a>“</td></tr><tr><td>“窒息 / A martfüi rém”</td><td>“2016/11/10”</td><td>“匈牙利”</td><td>“<a href="https://movie.douban.com/subject/26879159/">https://movie.douban.com/subject/26879159/</a>“</td></tr><tr><td>“百年情书”</td><td>“2011/05/13”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/5915794/">https://movie.douban.com/subject/5915794/</a>“</td></tr><tr><td>“狱中困斗 / R”</td><td>“2010/04/22”</td><td>“丹麦”</td><td>“<a href="https://movie.douban.com/subject/4288471/">https://movie.douban.com/subject/4288471/</a>“</td></tr><tr><td>“青春冒险王 / Microbe et Gasoil”</td><td>“2015/07/08”</td><td>“法国”</td><td>“<a href="https://movie.douban.com/subject/26163480/">https://movie.douban.com/subject/26163480/</a>“</td></tr><tr><td>“晚餐 / I nostri ragazzi”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/25877782/">https://movie.douban.com/subject/25877782/</a>“</td></tr><tr><td>“小屁孩日记 / Diary of a Wimpy Kid”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3003836/">https://movie.douban.com/subject/3003836/</a>“</td></tr><tr><td>“钱在路上跑”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/26200601/">https://movie.douban.com/subject/26200601/</a>“</td></tr><tr><td>“追踪长尾豹马修 / Sur la piste du Marsupilami”</td><td>“2012/04/04”</td><td>“法国”</td><td>“<a href="https://movie.douban.com/subject/6030611/">https://movie.douban.com/subject/6030611/</a>“</td></tr><tr><td>“冬天里”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/26820840/">https://movie.douban.com/subject/26820840/</a>“</td></tr><tr><td>“等着你 / 널 기다리며”</td><td>“2016/03/10”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/25890079/">https://movie.douban.com/subject/25890079/</a>“</td></tr><tr><td>“卒迹”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/24737161/">https://movie.douban.com/subject/24737161/</a>“</td></tr><tr><td>“大婚告急 / Something Borrowed”</td><td>“2011/05/06”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/2996625/">https://movie.douban.com/subject/2996625/</a>“</td></tr><tr><td>“奋斗的乔伊 / Joy”</td><td>“2015/12/25”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/25901741/">https://movie.douban.com/subject/25901741/</a>“</td></tr><tr><td>“流浪巴黎 / Paris pieds nus”</td><td>“2016/09/02”</td><td>“特柳赖德电影节”</td><td>“<a href="https://movie.douban.com/subject/26457368/">https://movie.douban.com/subject/26457368/</a>“</td></tr><tr><td>“脑男 / 脳男”</td><td>“2013/02/09”</td><td>“日本”</td><td>“<a href="https://movie.douban.com/subject/10796594/">https://movie.douban.com/subject/10796594/</a>“</td></tr><tr><td>“冲绳豆腐之恋 / Jimami Tofu”</td><td>“2018/03/28”</td><td>“新加坡”</td><td>“<a href="https://movie.douban.com/subject/30176488/">https://movie.douban.com/subject/30176488/</a>“</td></tr><tr><td>“守边人”</td><td>“2017/10/17”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/27175974/">https://movie.douban.com/subject/27175974/</a>“</td></tr><tr><td>“杀死信使 / Kill the Messenger”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3036472/">https://movie.douban.com/subject/3036472/</a>“</td></tr><tr><td>“天堂：信仰 / Paradies: Glaube”</td><td>“2012/08/30”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/19894195/">https://movie.douban.com/subject/19894195/</a>“</td></tr><tr><td>“斩蛇 / Cut Snake”</td><td>“2014/08/09”</td><td>“墨尔本电影节”</td><td>“<a href="https://movie.douban.com/subject/25767323/">https://movie.douban.com/subject/25767323/</a>“</td></tr><tr><td>“大象之歌 / Elephant Song”</td><td>“2014/09/10”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/25920098/">https://movie.douban.com/subject/25920098/</a>“</td></tr><tr><td>“三个臭皮匠 / The Three Stooges”</td><td>“2012/04/13”</td><td>“美国”</td><td>“<a href="https://movie.douban.com/subject/3156032/">https://movie.douban.com/subject/3156032/</a>“</td></tr><tr><td>“你能原谅我吗？ / Can You Ever Forgive Me?”</td><td>“2018/09/01”</td><td>“特柳赖德电影节”</td><td>“<a href="https://movie.douban.com/subject/26363987/">https://movie.douban.com/subject/26363987/</a>“</td></tr><tr><td>“误闯疯人院”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/26924108/">https://movie.douban.com/subject/26924108/</a>“</td></tr><tr><td>“打工老板”</td><td>“2014/10/21”</td><td>“广东地区”</td><td>“<a href="https://movie.douban.com/subject/25899691/">https://movie.douban.com/subject/25899691/</a>“</td></tr><tr><td>“自由之丘 / 자유의 언덕”</td><td>“2014/09/04”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/10796578/">https://movie.douban.com/subject/10796578/</a>“</td></tr><tr><td>“自由的探戈 / Tango Libre”</td><td>“2012/08/29”</td><td>“威尼斯电影节”</td><td>“<a href="https://movie.douban.com/subject/6835291/">https://movie.douban.com/subject/6835291/</a>“</td></tr><tr><td>“最后的旗帜 / Last Flag Flying”</td><td>“2017/09/28”</td><td>“纽约电影节”</td><td>“<a href="https://movie.douban.com/subject/26865177/">https://movie.douban.com/subject/26865177/</a>“</td></tr><tr><td>“心律失常 / Аритмия”</td><td>“2017/06/13”</td><td>“Kinotavr电影节”</td><td>“<a href="https://movie.douban.com/subject/27047917/">https://movie.douban.com/subject/27047917/</a>“</td></tr><tr><td>“额吉”</td><td>“2010/05/09”</td><td>“中国大陆”</td><td>“<a href="https://movie.douban.com/subject/3993565/">https://movie.douban.com/subject/3993565/</a>“</td></tr><tr><td>“时间脱离者 / 시간이탈자”</td><td>“2016/04/13”</td><td>“韩国”</td><td>“<a href="https://movie.douban.com/subject/25885827/">https://movie.douban.com/subject/25885827/</a>“</td></tr><tr><td>“北方一片苍茫”</td><td>“2017/07/23”</td><td>“FIRST青年影展”</td><td>“<a href="https://movie.douban.com/subject/27079318/">https://movie.douban.com/subject/27079318/</a>“</td></tr><tr><td>“大地与阴影 / La tierra y la sombra”</td><td>“2015/05/18”</td><td>“戛纳电影节”</td><td>“<a href="https://movie.douban.com/subject/26371553/">https://movie.douban.com/subject/26371553/</a>“</td></tr><tr><td>“异教徒 / The Infidel”</td><td>“”</td><td>“”</td><td>“<a href="https://movie.douban.com/subject/3718748/">https://movie.douban.com/subject/3718748/</a>“</td></tr><tr><td>“海洋深处 / In the Heart of the Sea”</td><td>“2015/12/03”</td><td>“澳大利亚”</td><td>“<a href="https://movie.douban.com/subject/3582181/">https://movie.douban.com/subject/3582181/</a>“</td></tr><tr><td>“作家 / El autor”</td><td>“2017/09/08”</td><td>“多伦多电影节”</td><td>“<a href="https://movie.douban.com/subject/27101749/">https://movie.douban.com/subject/27101749/</a>“</td></tr><tr><td>“天才捕手 / Genius”</td><td>“2016/02/16”</td><td>“柏林电影节”</td><td>“<a href="https://movie.douban.com/subject/5262339/">https://movie.douban.com/subject/5262339/</a>“</td></tr></tbody></table></div>]]></content>
    
    
    <summary type="html">数据来自豆瓣，这个脚本暂时不支持导出‘在读’功能，我就不折腾了。我会不断更新的。另外，听过的音乐怎么也5000+了，就不share了</summary>
    
    
    
    <category term="记录" scheme="https://changqingaas.github.io/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="生活" scheme="https://changqingaas.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
    <category term="书籍" scheme="https://changqingaas.github.io/tags/%E4%B9%A6%E7%B1%8D/"/>
    
    <category term="电影" scheme="https://changqingaas.github.io/tags/%E7%94%B5%E5%BD%B1/"/>
    
  </entry>
  
  <entry>
    <title>创新者的困境</title>
    <link href="https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E7%9A%84%E6%84%9F%E6%83%B3/"/>
    <id>https://changqingaas.github.io/%E8%AE%B0%E5%BD%95/Others/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E7%9A%84%E6%84%9F%E6%83%B3/</id>
    <published>2022-10-23T14:00:00.000Z</published>
    <updated>2022-10-24T10:55:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>在6月左右我换了个新电脑。</p><p>我把老电脑中的blog项目，保存到百度网盘中已进行迁移。</p><p>在把新电脑的各种环境配置的整整齐齐后（最新版本），我开始进行迁移blog到新电脑，我犯的最大错误就是上来就node install之类的指令，使得大量package产生了版本冲突，折腾几个小时后，没整明白（我对node不太熟，所以基本就是几个指令换着用，google报错说咋做我就直接照搬）。</p><p>因为当时在做别的作业，所以就把解决这个问题搁置了，后面因为准备找工作，卷毛概绩点都优先于这件事，所以连续搁置下去。</p><p>直到今天看新闻到晚上8点，觉得没啥学习动力，开始上网冲浪，无意中看到新人的博客，又激起了我的兴趣，我把项目又下载下来，这次我直接hexo d -g，竟然就成功了。</p><p>这充分意识到可能没必要要求‘版本最新’，这个我三年来对于软件，操作系统的洁癖，其实是有无形代价的。仔细一想，我这个我可也是当时配了很久的博客，除了评论功能没有，好像也不缺啥了（PS：我还煞有介事地配了个公益404的界面）。</p><p>对于创新、创业来说，是守成，还是继续创新，是一个重大的问题。有时，在一个波诡云谲的全球行业中，对于换届来说，可能守成是更优的选项，对于我的博客来说，现在的项目功能确实够用了（或者说经历教训后，我不开始追求更好的功能了，能用、稳定就行）</p><p>今天看新闻联播看到晚上8点，上面是我的借景抒情。</p>]]></content>
    
    
    <summary type="html">关于博客迁移的感想</summary>
    
    
    
    <category term="记录" scheme="https://changqingaas.github.io/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>阅读论文</title>
    <link href="https://changqingaas.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/Papers/%E9%98%85%E8%AF%BB%E8%AE%BA%E6%96%87/"/>
    <id>https://changqingaas.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/Papers/%E9%98%85%E8%AF%BB%E8%AE%BA%E6%96%87/</id>
    <published>2022-10-11T06:00:00.000Z</published>
    <updated>2022-10-26T14:19:45.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容">  <script id="hbeData" type="hbeData" data-hmacdigest="6c5b127566c7fe76c89fac9c089ced630028cf5626941c49fe7be45dfa2bce4c">655ff9f578eae0bdc5954cf0fe9f55cb44f7f24f38def3e486e19dfa79799259e267a41378bb2953ac12264338aa6e2daa6123fffeeef8dacf1990b242ca117e3f6107f8d1880893514c11acdde3b62aae3e1b7c48b3b7b80abf29a07606b678e1e04cce9537be55a1ac80fcac941c97d9679866edb32425f05a1bde6913ce1e4187b2a413354f7b9d3950f8fdb7c7e3e3dcc05a0d0e1ddfa1ca2e3ea6d4fe144aec28202b2a3889c9fd7381f66b670184b11e7080479116208404bbd5bcc91860f15792525b84a98ed8b1e5d9412b5807f60ffd882d326eed1c5aec25e182de7f9368d566cc97ebfbdef5b696210b9b6494a1927222737835b03c40dc7fd32ae7ecdcb3669dc19255311f7b52cc6e7f38c564f40c61e818b0351722dc7ebd60f4c8c40bdb2d317d7f8a2220d16eaea2c2e0f9cce749b6eb2059ee89f4378b264744984d2144a81993c79aec197d60bb67f315492fa14c65961700ab1ac98aa4bbbe8653bee99dcb518e9ab0b47b3366dd311a35ea7ebddee9a260e4ea13b4dd9743b325024e1907cf320002c22e0a9baea67b15b509b260a7b3029ba801a20ff2852e020f98857a854de21e639954a10cc37eedc5b77ef260e37a633dc1fd162dbe5fe4d190302a520aa31bccaa8104edccbf13dc913ae97b55295739fbae9546b1a28bc3f35a99cb627fda36bd3620a517ab5a255852009d7d41a758a475da69af8401452ae21b09b42cb512f5d55fc27b6fda25ac93828438b26dab6e491f49b63a28d2c80934665399c4c1504baacb3c794faa6193297e6f653968b276861e2a6aacf02654a68c90d9187c8f793c8b2879d154511559d4537884974087e3f522cc9c8489a75aa60cd77f97cf5d4d3ac4d15a16db7f34f42de5634b47c24b24654867360ade4da7390e47fcb95f099115b694a477b3dc77d5efef29be948e461585ab8971ea6b63c79cfcf08b9bd455ddf16ea601bed610fcdbf1a534e1aa60d599551e8ecfdfe58ad711c3e5f9b090d119347eec345a41e01acf9542c466728d66dcec2789d0381e5c32df4650aabc5ca7d7746653e9a8356207eaf8cd49dc6f1354090062ff4d8a9854538bbee97bbde59d05876d60081a30446ee27d986e2d3e9b7f208d13a164b775cacc8d6cd619fca0c508c0245ba98d5de5c232816145e8a1c6eeb09079378cb6b62d50a36e75537f1a91a894553593ee2af84e8cf935ba399dd3e3e81d58b64cef3fdaaa8515a72b6fd14540c302a17a01272556ff0fac3f7e2605851f83ccaede2cdf7c23061d8f6ce4662dafcd904cfcc2f1aa571fc7c2729914a4b4a314eaf0b43ae31f832287b6da6b2ebddcf4392cbe551438e362fc98233e25c2bf6fd115f79c1bc074b18589c4a7c4dc5ecfc84c44454ea3dec921350a3caeea365534c74ccf837d9208a3dc698a1f4f6cb528e6b5dfce76a11e0560a7114ba4ad0cc560fa70537daa3a3ea5e8f734343b6e5893697ba8e55a96835946a079b1e82daf5a317adf40280c1861509002c6bccf15b55d3d86383766e9dc4e4a8359ac6dd30d64eeb12f91391fa87988ccc4cb437a3ef1eba53982736a0737a1237172d3fc228a5d989cbbf8881a973c083bc77059020c96d995273f271dd090abeb1577a83f719427806941092aff7148b94a0a28196c8d4d24608bbe6fbdf94b598da7510991bfc1c15be1ae9dcb39ef857709643f7f588a3f315b5ce3933ea6343ad7a1017b74e20bced2809394a5e191bda43c4244eed02009f0c9261143c9d008944fdf585de868a26c29ac272ae9315adedaa4d47ba6e8d256293aa51461916ad4ae035f59f09eee1b6cc0f66c549410bb70417ae3f4c2a06f46434bcc8ee1495e931a0f9bda7b7652a0c0838bbb4b77c133e42353898f5632559f473516f56be5eacd08e6019bdc9456c1c9bddc5f3f8a55c64c3af9f0624a8de5cbd0b38104f1af5f5d11abd2c6b37248d628c0ab59ac78716d6db373d71b9f11ee4e98ad703f3daea4526f6deddb7865d32d01d54723bcd73d6aa734e891375bd8aa3347ff7eb67007f95f9de30279f3ec024ecd411541cda84924b49c813453f46621dca6b6cf369e57f1b1d5849cf17d6df4c0544a7d693360ff2561573082eecf16a3405e858cd31e4556a9b879dbaacf41e4135a677d5b1e32aca8d70cdf25b4b2962e178006998f8dc5473699966362aa5c3972f3a3bfc444409855f6bbc395913e3069a30c4c11489c3a395663e32b20bf47e77ce474322e0ec88e03185cc0686bc248fefe69164e30f459e68b821369256476448413af7e84dd09efcdcfde4bdbc32d0f2a75be86586399f9538a3338107268bd5ae2d76fedd9bbd1330a76ec3c0eca1bd6184991999b69f3ab586f9c0c4b0969a7c215e9b7861221f51553a407bc1aa97409ebdc1a0beb2f96a681a018327819351898d1f889f9f4bc8c80e69dd54bb1e1edbffd1b0a47872e807b83e41c73df119c17be4a26211827a39ec30187e02fa49ae3873c3c275e3ca45b4564440ba8fbad59c60d238da2e48fb53dbfa37597b4998a22939b2264fd318ff98a9e89baf389a8b1581c9db909463fc3d1edfd70f92b7361eedf5d911b11b59915367336595c358a837494f0acb8ff2f443717b95d47f04404329cb05aa1e5e54d19c1eb3641ea9f345c347c5103f13974f54c0fa53ee066b6e02f5d0a25021778f282ef127606ed1bed5f360082392e83e7a24eb53484ec4ddb1adae6f27fa0a2c19aa3c6dd06ec2aa74bd4c17fc4e7e1c3cba038c798cd99cf4a85371aa0862d9be77385f4e2e11432e851b800b72ce9b940f88be55a84d7530c4c95087d3fcb36ab4f76d3f2c6c5bab6a1f1ae5c5e93b36806ed002863fa5aba9d25c2cd3456e52fd4d3bfdb0b55e4915cf606eb8fd5d1d5644090ba27781808ea4ebdf82069edfcd4a93d92b1defab9bd173bdf20d9ee45a8095ea20371dac2635803d247ed821008465db826d6f00c2ae467eddf4b887146692dbb14cee95a8e8e2507243675f2513f33f3561f16318a4301000f7d35094fa9ec54bcb4ba51d0b504cbad77033548864248b723f07ff0e3039a67f794ed2097a065d0ca67fc6ffa389c4c48b0eee5d099e19c1dba7006376b29cb6a3afb78d2c2b561fd9f2e630edb52b402c1027b0b3c201315bf7abca93442c987b1d249a8cb35874d6d75d389c122172fe562f2fd4d43e8385b434f3a0d009fe4f313519647757c3d9cbfdb70918a0713e62824863a6a21fff0f0675431a23d596d42738c2a4a5a2b2b42047b85aaa50cd8de8712ba1954abcb166d0cb3655403a9431d61e983823b3f63357df40ecce6924e047de6e6c2a60d0d8b9401f91d1d559f706069e53f4b6c1973d03ffd3028e94ba6cd9ff118bd178d72bdf70d993e045563a81b25d2c2ddcd6506a7ba6e757e4f3ed08cdae88bf64adba93f7f31db601fbe046e1fd35510e95146491575167beeec580b03109dc17e9720292aacb783cef146c71095e247ea4ef225909fb7d302c24067eff2a8487749812bd719b2e00c4f254f53b221c31f2168c7120daf3e794bb2a15dbce9a7454eacf3c05e14b08c31e7ef5eac1834320ad4e8c35ac805ebdacd8eac2b1b8cafe162d92057071fe116e9c46ce838798fd75fd5dab0f66901a7b9726458bd47ba38ce7dab8d2e1f9e0db156255426a21af6184d537653631f8022918ed56afc464f4f5c7a01a0c239d814e286fc5bef5c50d10703276693c45fd8268ae81a4e07c0d13e0d5b4c8df8cbb4a4a39341242cf40f634db832d25bb77737eb0674f5d2d985e93ae906d10ea2b6fae9a271d56c864b273f2db365cba3cb163e341cca15652875b1bdf348681755707d936bac7a352e8fd0e5e1658d25c04bff8188dccd626bae8bbbfd009ff108678937cbb60b4369cde0e61caddcefd2ea32b39d116b6099ae6a50ed0e7477fb53b095b8d3486f7236d3df156cc1f66606b7567e02355952d78c631ce3f147630afef9279d887d2c393ab09159c29ab68ebaf162107c354b6943fc5056c97c07d0203b692b5241a560f1ea859765cab869db4bd0c3e869a64b7795c181a15e3b15c096481f2bf480eb7d975024ae0c58da382f1d042dac68e9d829d014f7df1d41cc915e045d0472653c56b8f19760cca31c06f6b3bc21dce67e13cde30f916fd87a0d99b9f9e2cf275cee45a684c6f44e3b38cf5e2de23d26108ceb211333c34c20c42e9a5f375f1d9789f513f27262045ce43c3d309de279720e594ee6d8bc5d30890839ab51d361722adad43d1982793888ea9189a7cc8b0117b6621ad3200628b5cef097253902c74df986fa9c92e15f682c84ba3b4d06a3af7be1755b22620fdb52d4518116c45cab6e41fb63a180addb7cbd5670d762e840e6a6f5b450dbff7f8a4b169e50144f245030cd1e72352a13d4ae20751031284162a630da7e721d78adf4b45672fc2cc04eb7b2c02b8f88b6a1b73c8c266a1cd926f4b84b23eddd4e768300cb18b6bcae62a7ce74be6e914db3f201181e26e60bb9e2cf8a57d912293ebf653155d5763d89d73076ba22bca08e157d84b5bc700784b953276ee89e710282ae15193c2ae95705be79b37b1683015a7a061138d8047d85f794880a045d122a1145410b9e33203706e8f75a373c69647c3aab56f55452502bbd9feb477056185c75fa80582d3c383564d78b51e1f9a5593a0afb0be5956ba6f88cb3bee593b16d4aed4de597ef4753d41f7300d489b5f58b80830129ca42801948041b49be5f86432c2a9e02de171ab24067f405870e43baa437932b18b987e0e0fd61b62d691e5a05e78ee767f8a050e4f254890e6e4926d13fb7e2114d14c3db7f32f137cc8a6afbfc49658faf8dbff79d516b947ee30ee6aee75e0c831f660f0fde60a07a9765213e0be52d6d60a3a6afa3c37231470153d59b831b9d35598d453bf1c2d6634f29c17829baefc321f10ddaf19b43da107ac061abe402d82822abe75160a816310d6fc215ba5a7cf3bd0969103e45682d45427f6e532132ad87f15df71a3d05c787e604aacea3e39ed91362b1bbb812004eb4c3f263eec1cc90ed2bbead29bff550d1538e7c1552b98ed0d6e205c289ebbbde7d459e1a93c45a92ab7a68a3a0a3ebaff47e981a4265e4f8a83b88dd203a19a32d9d1a88c36337f54eb79fdd2c06e1064ada225506e462b9179e220309d8b5e4ac9f771419a557b8f46eb54dbf0012cf1f5ecc9d5146d3f0762d4358208af904c4b930d74ecd8c8580c142d109c8ca31c4cf81e07bda193a54aa89c6e6d8a2603202653bf4fa37f827b6892144c413be77a278b1e56bfb5446c45b26f4a76f5c474d489875058ff782bdaf2ec0a0eaf5ed364800e12a50388068091206ce08aa7280863c0e1fc9b731a30f66db7953e627fd844a98f9b495835901ad1ec60781c3192ea48cb79b8edf41d4693a808c4dddd1080f213cf071f921893149c4a960018c8c3ee0e20a7c0c6f74f35de114a2342cc779471be12ae486c40d74c7341960f6818c013907b4c91c359b7d588a5cffe37e9ddd78308940910d53d6304fc9a661870b91dd61844032369f2931de23003644d172293d36958eac518ec3700e6e3d71454a703123fd0de29134d436206f42822fc15bdca9c97b344124f5768fe65f6fb87f7e37524a58ac9491b8b22c3ec31ed4ade2e9d3e091ff8acb726694d817c1bb0dc1607e0525ed6b983e34f579fc238da79ead7924248348c41e33e3ac5eb53cc1a5d06796f79a14567a1eb8e200342dc0cbfa98b1a2edbb004f8fe69244ca0ab31d84179f26e26e95bade10925524156bb573481118c83b45f28196abd47393b292e76163a83d9e3cda9a773c386b36762e2a2de0ecbfa0265f512603c8cf514229f022ae0f4ad06bba8a63e20153d189e081d382aa7bcdce5eff72f716e903dced77d811fd4de5ddcb29f64a7e39c59f20f77896d54fa2b5f2125a8c621ec2e669886c62c0e67afd877a1c13a07466af49d27139f619d6722d9943502f6cf26532b1d2cd1f3252b932f8a66eaadd88e9b54f61ac825f55031124fc8e18479ac1866ea86cec5f58d7e53664ae22a968490a8e7d6069baf3eea438ca73f6c07016df0e1c89af962a07f6c702bd79be36a25710ecb55fb3e7e8ec02905f4035455dfb5f7fe2c0a5aa8ffdb1d44bf1f4fe43da760b8752d5e25465fde6caa9c84fbf190b9cc8543d826d1f9444f0c8c30d9f651fbf31c0c8ccaef55bab881cb8ba3eed00a357f2d287e11e9fbca27818fe5dc2656f9167651c29e877076af936419354d848ce8f5dca3c8c4bcf029e619c75f2e7d3d9f3cab87b83f6f9e4b3163eab35f74801f3324b5ee1e75e8a0e02f3327ac510166cbab81fbfe340e3eb399fcb69260645f5fad1866567dc34517370aeb27613833c4edfdb9c606e138621d30dc7c793faf93163701c41aa6500e74a575d532140c4edf1cd79569f1231ab503d2997c228cebd225531a2490b5daf445bd265fe07c7dc9b60bf0ff7372f67c17db891b00f9e108c600f8f8e36386a57bf514a7077859b905b5fb3912df34495164dbc2656e9a297739aeeb668a009738d018654c5d78d72b3aaa5d4d8a265e57d345442c87bc2766de129f684a735bdd9c4ae0daeae2236bc1c55724e37549697e82e1da822d759ca8b713f221368074a38bc9f9581a7f8948f1d7da0b980b7ddedb37b19ad7f2e545920cba3c2e836f403cd290ee033d1fa8d8119c7e2aab30dbaac702bd9b5367d5e7f49886728597c48cc019a749ff547cabfeedf66382ac519ed3aa5b261e23dad62f35fa36fa5bcb8499c3d237087aa66e83990004bc51f3fa98564606c494a7a9ebb249f0550b189d02a405f800e3938ee97bc0670d5174406e2ea366dbc6314215429a7e50c9c7965ecd7816c455affce6a236eb91482671c3eec68b8cd102610401ae276d611997efd61afa78134cfc115e12f9e4ed5fe4387d6d1cc15132b288642279af706330b5cece7a1d8e01479a781aeb1dea8fc0d01ce584e4f4df4b425f7efa1df4f76570fd2f280350e28034f5b5bcf6dc8d0504b633b48f6c2f29dced8cabf48352d4c0874a3434ac3d24bd7c6e96674fd67568bb87dd517c4689f15d018529ff92e9ecbadeac01c38aeff20e92f87301ff479505ee8b0f9bd7608f176df3ad84a0bf79919f48e4c0029b81117f2e1fab0e4588f8b7abd82f0c0611dcc12d561387e6ec862ce8ed7e7cc0dfe4ccad4e9ecc72a86a71a1ecef258c4356a1d2ee4f850b0f6c400485e74b37f1544345995b66ffe6709053bbb474c4e5d2a0763a6e8a5abc22380cc3fe36f43214c249f87ad5b43ad7c73e7f70e55eac319c2ff138112556d7b3a307c9c42b7a0c01eeeac52498c49e5edd91f3a0834a66737676a018c89cd2f33ded03728d540becb079ded75be681b0e4e7a62ed12980b7b506a5dec62cffe4f687e904600c777bb8dc92d1aa2ca208d3905d5f4139c99fc3cafe1dbf15f432e8addb94883992c2209e8c52de1592f7a7aaeaaa2a36fea30126f6f7f69cefc6ebc342ae1544842f640d5da8d3cea37d2b790719e79c3fd7f4f1fdf6f6d48b8b6807054ce5913c5191700da203510e0d613963e204921482da25abbdff16fea1c12bceb8d113e74a0e984a6fb720394501bb37361214fe623481fca6abef5da97811fff5ba6a92aaaeaef4ce759f5b646b84670a7888ff368705a5a5eae516d1151f6428778e60d3febfbcf46c13fa956d0f6ec93a65d033d5a5520c0e4e43f55d614b2f7d785d06e4363461dc70459d47efa7b7cd76743411f57006e41924bb6b3daf731e925692998825ec9205929ef8fe763f31c4cbd9563a75f222adc8f647b105133ad2a6acb7e073230acc1a95ce68d68d148cadc9fe68a79594a559ac53b2717aef650f41ad228d4ea31b196409ba2f54e8ce192e5b65c2fac2367f3f4320d0f7b28ff2f9a09db44a794a2480f25cb08254259cfc0822e4373c37a862ae1d373fc54266e557fed5cd80265b99809b7ae8a2e935762289a587ec76fba142161648d625b30697dd3dba02d0ad836a57ce94a15c582d7afd5758a027bbdd677301dd89798a7be368de172abb4f15a54c0da6fcfc1d1004f6703b0c77c1fce8b8c44524d78fed5ed255239fa79c6776f15c23e5aa5c76b4f0218207d98f8e5f1b6c906d6942d55d307dd2d05f03fb1b8302204a2b0d4c313b34129cfdc3fc593d408c626acd11acea774d19fa28c143f05459fae0fbbd9328dc18a5ea868f5ceb55c75b966ac1cd46e83f928fac4537d41d4d6d05a6a318723e79d84209a71f5babc55dd9b6a90f0d58ef07d8a243b2df904ee5e8fa8d548140cb40d47b4ac5cd5585e23683cc8f5a33fd496b4cebd7e6030fe8dc714b8ceaab7cdfc9117f12b4ba4321ebf5898d829f3bd883526d032b504b36a69d0ecac1d8dce6285a5ad194165140a399d1d04b1c7e5810dd9ba06930e4fdb158853432ddc1117ac08acfdab484144f531e4cd884d3bdc2672e8ffd506cdd9503e63ac7146b249925566d8af082e176146051f602ad0d605689227cc72cd45066418668db4ad6357688a052ac4e14803c0b421c77b5897c5b1c39fad075ba3f9152e2827d1d29616bb96d8c78e69604e67bbd7ed275db1610007df54a3e5430468a6793a76613bf8d4aad336b97560b9aa40a1836ed585809bb6a6194d0fd90acd400bbd33ce78892ecf19446c3cc3b0c6f27def8d7e7c4659e9eaa8fe518c25458f89695dabcf71ad1884d9238ab4ab1865d97168ad84f0b95427a0af4c0e5f5840a25d0e4b16b49a905cb9eb6e82f4e1c042dbdf777e49ce3b3935323e93f2b777936f888c9629fe401b4eadbda6605664aae265d5fb2ff3a3b6c70beb00706174dfc8ec158b352ccac0d6f6c05597b8409321657f133d98ae3401cbd01f925fcc5adf7a45b53203fc0dc41623d419e5602ca680371a3e2ee21bd6584eb2f60ebd88c99e97d8868b509ca1b71a5da9512f6197b5833455fa68a4c13f1c7e4a003d9c0423916bccc00fcfc3ebb355224d77016fb529b791ba9a31b30c371974c43d64d1465c94db1b69f2adf901ac65ad68a3728cfe1422a9c018d19ad2993a630e843dfb0185e28930ff677717154fea2e562f28d5ca64d6099d5a060be37d10632fc60faebd7a4139317b36cf65a9dcfed8517b9a3b6d939e813b14a72b141d6ad678410338a34ab272df4ec84ddee53488fa6f80acc5b87c78fcd69af8790674c719543aa836754608eaada79a7b6215e29eca5c12c7066be4093bf3714c60a7543b0b0d38318aa9bd8aac5dbcc661e54c28b4a6725c14146c1174c1dc5070a946be46436b9c8866adf49f869771afc752e4798e770521955db03b500336d683290d6a652fccf626358afeb090fb45bfbf93acca7a8ae04f475d40b092a878b98fd05c712cf7843c2fb69099421abc8cb2345d387f4b288ecd3d72610c50a6cb760d75ccf7a5a4373b548f1e93b4b2ab1db4830d91b8c7adcc0f7338fa9d81b3f953f8adf46fc20304a2cf73639166bd0e0bd1ceb62ae3c4c8da2256e964faeec5008ad3c61b3171fead9c85b58234a08004f038d0e2171ca7a5fe7b4329adb0d10fd3ee724b0bafa85a715494e433d8f673510437e226bba9db5a33765be7a10a495e6b1145838dec1ead29331b7deb117cd91c2775ff8e1a04b1f566d2c00ed858baa277582e1b60cf453a8ddd8e7ff6c8e60ac03ec95a5e90eec4181cbf2a1fd251344c0c0c398901ecc4a33ba15e103cccc9a7e9ff6574d43fa3932892c933e1470da1f04aacb049ac3fcd51a930f1950e352b03de4f352d3ac954f6d1c6bd301720613e9e336d80200db5c080c579576d04529a91da2235cbc70ae02060e54e95bd753ded6c65c7c19443f1107a14ced67197bcd731f79c48f4cafa7330f7e6f7aaae0e4c4f9fda04d2eea39a9cae32e05848842a8daee19d6a8f5ade1f201bef9ac604846bd21528964c329b75428781d370ff1f3f66b10ccf794f7294fda381513908f8e55aa9bbdcb791cc81a08917ca80d1ad6cd21948c5d2c276d4ec8a57798bdca6f9ba1c854848311fbf7b215f05d843187b424bf40b22ae20a1a315db65f2e7c841d7d4894cb5b592499698b9e2fc16863ab6831986d54c75c9a2f90bca073123804659b8b41c62968d0836272007d56531122439e4cb4e22193c99da561c0184f5e1f5a08d3338b894c9822475ada68f872ebfda66dd64d4e047fe1407e863e5a44cd5bf3816f4dfabb43941660f626398c137b199dd7e15a9d576f89a2d501c4573a21ce32fc012908494515c2240986ddf45a6abd0ea4ba7531ca7684a4adf70b8f899fdbf32a96a5250ec0bc6e4cd463b64cb112a800c02319da0216591b12d6c663e58369c8e736fb386eadd61e4f077ed60da863bd73cad1d13897c408dd01413dbf3725b07a3c90432c666cdb1a6304624b31497d528aa6c9de1f3a23373dc86d57e14ace577d4547057d28a8186291fb3a5c516c5c1686aa312fbd89abc8dd8f152b87f14364eb6e0e731a52333eeb369dca97703f61c5004ab3071eba8b062c5abba44064ba0277dea862b794f35dde72c34dbfef4f70330e6b212bd0a9dec16fc55c38a9a2786f723555cc489e0052dbbeef5e74cbe2a6299edbe91850ede9dabd020fea0d6592adff6dc6ba46da424fa14b4069a9cdf084af4a57e3c6c916f9a51c9544beb52cdfdee2a66ed5cb5eb844e3f809418cf1258d344fafff773c5aa69f9443d89669fd526280cd58c642861e8970a8392e4b8854dfd043e5ae4c4de11b6dfd0b51e14953548cf8d83bacc4af0dd40136c0c0260198dc4fbdbf5d9d7e9ad8ca3f27ec9760d9473e1d49fa483bfb0733c22e904ab85f73789b5e60b9017bb442e894085baa166fcd3163d0b6fa9860afed8f36e250a3330f56d5776b8e4e4a8853b4a4001df3c753082ee26cc8d775b77672815ddaeeca65ae315feec485d7ff2e68d735ddbf6db608158b670a6ff9fdfbb480367eefad5935262d8bff0ece182d817b9b2abd544803d84d75826a35f1e91828bd84bc8eaec9869b276a71ab2cbb3d996f8b1f2dc316a9ed8da62ccfa5418697d946e9bafc6bcf3e045d1e761e7d6b739fff823b492e76d185e23f9df281ed1b445d3f0fd9f2d094f41ba1c34f0f1a2f5e2af0b71a3fab6c8fc11341862680c92e596ef8de997c628b2d74fb70a5a24b0fe3f7ca762d97ca91d5666557361ca38ec1618e23db67e78968c98da0898e82ab89ad65555c2c4757e674cff5f4fa4506db41049ed160fc9061a925bfd9d87f3e7fd735b2ca65e8dcc25c285ad01190ebd663d63c9b44f0606cae02193673d85f49a34deabd8e39fc954986ddffaf2d43234a83686072716bf58bcec9711e38e739c3ed708c09b0076867246392fad68c0febd7428936345e23a1998891858fdd36cb4fa908dc28e42dc4c3f2e6893abcd46cfe8f1a8af0ec19136f55308732e1c90966a3d0514cf02ce826a8d425834c778056eb517b4d80aba4e0592a1da599b8bb80c082d565f76ec0953169ab478f3efb9214e41cfa140732c35cd71c9d187c6fd1795230d0340fd9c5735c66f2d03d559e047a7e3cbb5f62c0949b475d88d0d6741d280477a1a381b3a5713ff7e6e4d1592dcc855db9d344c5a0cb2cd0a728a60d35c83679c3dabee26b6f20e9589a0d328384ec09826f3fb620b46f617f0aee467309b7522fe350b5d73ef42d06ac8ca26e37afa94e56281ff7f45d5e5028a4b01b2b7e9ac8a3bc2d1e12f2d0ec2a4fa3ce8a12f635673630f52004f7b4b6bca9105d98e63774cd1f0a4e4fe9c5751964d66a4646d98ae9766869a13b7965ed382cf1af21268fe007be2368e9b6c22143a2a17c3dc691861b2db6a97effc30b7e341dbf5f38a87355ef22ace507ad6a16ec9855415f8ddeb9ed9fa017438aa7bcee0bdfcd462cd1b65a355a5ef7d3bd4ade0a10979f553a6e4aa6f3b0442b7766cbe25427896dee128e060e09c0c8e0f93bfdf8c3b2c2afc5ea963ddcc33284de5374bd90c757d4047617dff849fb63322216b01c94813e4dd999520a19e920fe841a562bc34e107d8a74a30742b6927fd0081ae906cd4439a9d6387eca69074277f4836ea62a1f711a2528ed59ca00aa5a15eed58392ea0ca3f6bfac347360b01cff2e1af7e61c3cb905077a35a215a9d94882aab0a9b6f5a3a564752fb0830493660addb5591922444a93989b719efc2be6e5cb6c99bfeec4f0d6680b371cf73638021a8233b5cd660d64d5ead49c618e5c81c5da25b8705bf4f9cfd25ca98b7bdd45828bc2ecdb2b80dae261d060d41204525759f15e2a1301bd138228ceed4a495868ac6f0c045be3dc934f766420129f461508daa7c062de5c89e9587f1886d69d0ad909a19b0b61dba56cf8e096b76b4ad48c3c60318cbf054d10db6834cfbf2b373292fda22de47139278e6cefffcf67e97ebf083eddfcc0375cfcbe366e76b57144022888c61f18f0b6ed6322147afeb608565440f1bde0a86fd46d81af2e19190bd12477beee60fa2ccd5cc1d860868139a65965ab92ac263843c9f8529bb3f91f2dc1de92682ce957cea2397ea61364ccb8dabede726a10f1e77facad0b0b2549162177f2f9534f612a6efc0957e078daf9ec059ca028bcb33e12b12d1da4d99948702149be81262cd1ece94af0e4ad021de0a664062890856a0f400ea65691a7532af2df7e731de4543b46600669fb5892dcc53bbf85119bd0e236b0a146a9d3d0fb650a82597405bb414f2ef85ae2a410de4ea1391e845c6b6a3f09a8c634aeb0562227639166782d264ca992d6059a6985e89eab426a57cd4245e90ba83689f7be993c9f848e1b4b7fbc57523e55f8687380c5884ee22da0f1905580e10c8c8c6a80c9074464317747f23d1df847dde99429e4eaf1440f776cc851b62f4e18adcf8b9756f07259f1f753c28bc7ac1fa6029757dd0ee2bd10bc3ad327f56dc2184ea7a2d7cc1494fb53042ae17765780c5d5dc782db9e51a1387b26ec226a48a81db6070f11d047a90f1fdeee2ad9da75dbdeda3f531bcfdf3e3534b41b719b4ac63a7bc26c8fadd8ea7421ed3d58a4e6686dd551caa93d004902e9a4a7966b83bae849c19b0217f28c5a7a31dda077636abd187c9ba036fcc6925739aa21cc7255fb46bfa2e8bca591a883b9086f26fdb3a8963a40cd976b9d050cfa24c6b53494f89010cc7b3d9588e57a96d9cea7b329dbbf3f7a206ad045a1f554bc085b0f40ee232f835d5334039224226efe76dcad83085bd8c43458ac3bea486952dc2b5f560757cda39a140db88746159d8f3d7e20889433b26a6c3316ae653c03c582b488f70e7e84dd9139fa725174cacd8d9399e7b58d65d6762eef87f7c62a4b3fffdffd47eb7b6039b649b11ce98a4abd29acf75899d0dadbff35c0aa9877021992c49af7a1c9937b06be3ba09e62b3bca3dc23812428b4b14dd19f9f695551d0f73890852d965fb838454fd312ecda4638312ff2050079dcc2c863e4bfe5fd8602f361429ed10b2eaca0fb83eda1094c43a006894bb711fdce69179391593291f8ebd225f179a374da5889b9839060517962aa054c5b159f1c70d786e929064d8b8f9c487cc16be17eebf38897418c518458c264659af05733ebb398eb4de73e54187f38cf1ee2a577fc56b088fcc9afa4346be79f456dc20e37fe361968b4a1166f45bcfb5a9e39113909821f1ef8c4e2490cdbad26ea7e8c59fdb06e145daaba08666b90d44da51ae968c84e14a8d0ea441cb1db598f93f39e495ed81048d90296fed5c48968133367499c86f98d7acb96ac186136e484f47c30813b8f814fb0a50c8c883c28cff2770af4e975dff7daf6f64aba22ffa2c110267fdde280145e3141a5f51a3810c41d3f80618d466b9a2c28c8886ed01073f992ed8568f94f0de77eb94193f3258a477dd4b50bcf9b43e364f7adff1168f5d77a76af53f48ff9181d879967e0a4676cace41d0377e62db6c574ad353e709d69f0539f80d658dc023dcebb1f39ead695507e21c0f9a2f92e13cef2eabeb5daeeb7d4f89a122dd2f28f8ce6a359808b577e3f08689c41e8cb3912153df3a228549ec462ccfbd66c03be7378e565af05e71031550063e228ad60ba38bd137affca8fb8cbbcf7487a39fec780eaa6aae2fb3d683efa509da1a2c5e72066b144c13e37464a286d8636fd586657c41d0305faec74cfc07d7a3a0a37b3e5d28227c9716a7eacbdf3ddfdf2f31dda7e1c8096f8a75150b31d765cf2bd5cfddede4b625bdb06af9a26a8f7b57c8fee3d4e028435e324af899801bbf3a277f81a7fad1e61f03110e5d9148d6d4492be894d10fbdcce49b067cb4d85a59349897d8154eff561c3cf255cb6e439d89745494f6f0a61f7a3d6ee8bec5fecde0e072723cf5aba00fa6a9311926367445b6be3f8444a4648d4f2e8dd6dddf6eefa6bc574708b392441b1123bdb94b6e147091928db132abfd154cbb50cf3071a6af80dcf83010d9367dc139d28eb63a5a96fc9b14f7b286b2a855e1001658de0537d3ba9ca2a20ffcc9c1ec33d7e1444ec3911f7368a015aaecf5dcb831487bf2cced04d9db82f92dd32d405db98507a1240cfa94018b4aab46b0198a691ee4fd027407cfca4992c1d79a897b046f81c4080cdcfb98c3aa12950a300e9894a7c13394897c0c0d6a297e7d8c6bae9ca3b84175313172b4eb8d5dee02f5c7e444069dd6f6e8db7048db662ae25ea1c363e7393790d91235ca67966956a6cc7e543be9630c749dc348ffcd0fccfdbdbed2e721ac054654101f40b01cf26023e3c733ab022e65febae94672450dbe87e2a77c12cfceaac210f78e8b80f2411d7f60cfae63c3caa63dee788f42cb23e48b8a0dce664c1ed62377c2086f60f457398cef560f2f8b4a03ae6bf9de87f885fbdea99c8b60947d61e5c85ec0a80ecdd5da2d09cfbe92fdf5e51e63b4dc32826d31d661498fe0f5842090f7ae6cf195c7619c24d807baab9a6e8c06101df4bc9579d7d18777f9c23cadd125dc85f1efaa11274b5d02a0fbfa6e97cf6e55559e1e7b12cd5d5e80834d1ed2fcc18cf9fe2efafa5b865dc43ec73468d6e87a22a8c268cade8c59ab4fca81ea2ddc1d1715baab6f67b6085cb6ca25fb48de671b6e4685d7c6dbadf9f30d2e52b14e9dcfe160d053414f00747c77b72307b587e5fb02cc862d8c8feca9731e6d2fb66aa825bfc4cb0edd85ea82fbd0175e30fe71b293b2a4a5ce0685debb1e3732d0d57ef90eaf52d379705251d08ccd8f34d07e4f1415f6a5f88903ee1a755fee871a5fc0e21be02f5bf030c4712b923dfeafb9f32b11eefa20c255cb1b4ae50cd21f20309cccc4d08459847e2ca7360466e2c1446aca85f66c372ab2b974ac40a0654d53057a009ce84d00249385bd18e5c184acd0889554140e05ec70015bb317a83da13421480bb6a3a583e3e7b146492cb5abbb1fd8682d352eb4f40512228d15e2836d89a326e73e4dc34d31cf1c7ae41b2d79dfd39ffe37363dd1d8fa7a379cc8bf3400047b91c56488844e44f874ec3b9fdf43508667b081301a50c11b18c9daf0fe825f2bcc0bcca74af909d4aaa9708dbe5479042bcf8fe95ff8b810b6e5912e69f11171e26223f60750efee4c71f0ae633bbd1f125d3fd0d9235763cd373136bdd4f6fccde62e37b7d28f88c92207491032926be2f0d52ba6580e13a23f1d281558cd8d0b9c26c169d08c631ec43a2fff1680b3a69a72e04ddfa4a000037f60646d10f2a5c72b0be074b3711e01a8269ddcdae64d42d460c619c3e507bafceb2f38ab33b5ec1f711a7b9a209e532eff4c46538e1ad3c094fa21ab79fa3373edeca44572dd062d8cc307452d8676066167cf234e825fae269ae029f531a1da4347b7a93902a9ef3383a83c9225e236bfe3d5699c7ded0709c8105efb90d0ecaf021dd7e7e062be93913214486715486e8b82a988d11761df6d8649ba959543c7a21a081a9bef33d1ee5fc87e9384832c052a9d154a7b3790da906a7a13a7451979c447842338d2fdfb53fdb3cdde9f81d8f7738ab7dfa75b85fe083f34a9d7e9b3128bef007534f6d31760ef0525fe8e03f4880b9688c84b17630ad9ec55ecb8a99fef7cc928186661127ab3f54d961ee2aecf8b01af7325c337bbcedfdda469a4a5b94f3967005f69ba11e4088bf8c40bb2f0c38efd2872f09762038dfbda704bc0021f90c508bdd7f4226942e75e8d8faaf527a6eeb58f164c3053d5a672560824c77043731f6c45f4966d2c2e4be328efa1f275ac42647e7d5b4888239c170ba20cc407bd0d0cefe97bc4fb1ad1d27d0fdcd3a43a65ce9c9ba10654b0eeacfdc895bb835dea545eb52ea92d840350a8bc2fc7ef2092b922c56aa653a1e7c53f1e2f7a88790d4a7e49fa0c39e1c601e0f3ea9580e0463dbb61709bd0a893a82671de6ebc0a419955b5668518717ca3be850b63c5da54a460bb41703614297482e9ccf4d6a9e520688281c60d8fe663dea96e1d7a3ac3d04d3665a839761963d359ca621805db4d912e8f18c2d154aaa0a32f4d95741d58222b6256fd28b16327d01c7943b04cde6f4813a82fcf060ff2fa963a43291702e144d3ff073f427c955e4b9c65a5c6bea1935c61e2d731dbd17c618e01ece95559252afd0578892c3ddef45bb35c115e2ab50903d3ed114f36dc18fe002cf34e49efe772d57c8cee56ddb72b5c0680878aa81e06b12dd42ca5baef85667e6cfa19013b2a978ab09ac82027d1be2bbf381468b8395c79fd7dde300b92b9984b230d7423b83ab50a14a315c1340ac707b433a5be645d75aab0e83b4bba059deb0187a207b448a968e5c8f9aed320b1fda521dd2789bea5b3fe0156a2a33f6f1d8a5409587613d6749f5e4828ddb73cf821ab998b8911c0b2c461f7dea48b432aacaf882a8ef8c4d55702d60733f42720a4146416b3c5a6d36e2fe8e144eeb3a07c6bdf18c9c1dd33c28ad758722401a61a1f7f3945eac5492e264ac967df0b35d9c0862fea3ad7295478f42673caf19a52fa9e097339644bef90834710380a259c07282290cbdbc0ff05a7bff203b721c919756b97715ee9db25002e4109c524b680e05f3a564ff40d8c0ce1adcfdb186073ea8a4812efd88fc1ff6675a024538a890238a58e9d1b2fb2666b9911bc3db27718d269abfba7d55a6e14ac346fa4659cfd4efafbbbfd3555ab453c4241f861a967ad56d962f27ed1759534a18e981b490294cb8f1a3169f4acc29679033ee02d040605eec398e8816f36537a26b3ffc4d2aa8aa998d37454c4350e8360dac0162175787f134d92ae4f76099a80e19bbf033fd0757ae10d197af5a54944a486244810f2300fbacb6396d120266dbdaf351750dae1a76639a96a838cabe901e00af693b33ff439b473f9fe8241db3f557b494c20e75b14f91000fc1a883e92c556af6255defc394e5cd5a450d8c0c0433c940d13d31a9c2a30c31f6c1a1ed6a2e092aa86f24260562cd650a45177496aa31c332761d0018d8103b3c9be7443bbf3724c8c67a3eb99103ccfed83cf99c14014388dec207ced72de7f38205f6036574469703a24d96b61b778e79c53d429da0b0bfb7f6bee63a35d69c577bf95804f5be78a214cbd35f84dcb111467a57addfadce9b813cbb5bc71e91925e64deb22631b2ffd17a4affdb6907bfcc6ec450f10a27794b269c9482a2e142d0dff7da2f85b0c8ed96ef10e2ff73b75b30fef527758f84c1de20f4a020d5a54d2872d4ef112b13a42933bbc855d8beee0f429e1bf652ef2b2986ea56461a713d6d83faf51ac96b2bed8694b481589804c1d0a2e9e270d6bb6ea1c6d2bfcff77af197015ee2f22835b464902a1584b4357ea0f601304bedb04584df43accdad634a0cab98080be12862ca19de29c1971b2b857ae41030c0e7a3078acce5ec3c398ea56a50295f10092d8d7949141aaab1c44ccdbac335d7c4175710e2631dc2e784e70579cfb6aa4de6645e59adac3620a9ff7f2352fffffcf6082f8cbb4c547465a8e5b91f39f636dd3bf880d45ce5380262fbecd1bfc2cb69ff43f2df415abe441befb0a113aa589a50ddd58289d0303df2e6607bb7be59e58f880dbff7de893d927dbe856f5233b45eea2f6a2c481f1b52a507643e7ff6d7b00a9fce5ff718593fe5867f9adbed3b3e755cf489ab58f5d312261597c716cadf89cff86a63bae68510c4455271a80bef25909c65a785c88db4d99f231e554ade00835ff0d7a81473da49cdfd9f91e174f35dbe3d328d6efa79455e74e9be6602cbc1c8ea891ffb33cda463256419fa08f92265d6754b51da256ba6767d18cf07249fb30326cdfa070c9258152e7fd3fc5232339ad4c3f80d052157b8f0f55d397be1a075e27b618a83de3f9f3b7ce3e9a7accf93ddfc1ddea7a4660f02be0585bd1e7f2df3ead458c9d4091f6f970272cd4315370a30e209265e11e565513a2cb8aa3f5ec172e2d3b7e9d18267db84ebf9d0b02fe82ea28e2d6c3373d174b826e34fa3f46aa07785695471b2d9dd8ac8093119c5ea21375c77992a70a7ef9b9d5484b48738f083dddbb22ff88e17724bad7012eafc254b1f170f308ee4ca7f9377a5166d42c9c3bc7047b4d89046e3628dc2c1a306950564baaecf7ba1172fe29885b1367942354d5b82fdf9a5a9df48e7e30e8f820c22bde590cf7f0b298c20ba99cd8528fd3e7c89fda262abed0e426684e4b84519622567b914749f1701c8e49a4e67dfbacddb6d858301dfc7cdb404a74bf70ac9ca0bd9f6c6f93f5b143789af331bdfdb405700bc5dbbbe97f841e9279955be38c9f2acb19c4568e6d7b917056d5b4ac2055ae9f23b3728d5214207ee18ae87bc5a395a56556a99f20f235b869227f9ef3da2c0c8dd64b4b8de66e2812df035dce9ae0e15acf8287db05b8e4c17db22417a8c97ad61332dba52e910a7fef440327d101ff570daf40f98e9282bbe57ae1b82e26cad0805c785c9d53698de122af39b4bb759b678a54b7e5cf1a25295b5eb2ce81ad38b1212fa46829ed887d7f439026d8084928d9f2e76a2d9005b7d39abe07edde72d5e4e60f2663f4a2335eedfd39fa610fb9fb45b2b2e267d4a6c90671e6a2497e9af7b0525388b1dc90f40039e5cbab66bb29546fe8a9c099e6beb18e14ae501fdd3430fec55722ba7690e33a28340a6d3b761966a08accaec8456e0dc02c739f85076a4d86c12b4bad53bf2c401b3c270c167f5d7c5052784dda54c8bcf3126effd6c5af1acb786b4f0a26eade1289be481eb1715912920cde2a62981c11088e6bb2614208b8e348a2928a3c790506e3092aa953db15ec74e901dac0c93424aaa8518a257faa92878624a2ffaf3e4fba82eccfae962205c3ea1b2fe37ec39e6b85b5affa0d802b601960cc2882dd8f7ee32737eb8b446548e48e9e72805075d3af7b18c80d3fd266661e536a548ffa9ab3a60fddecb0bc7c01e059d227a13f593185444985a5f38dede86ddd4cfa9876a0ba371d6f413720f2d4fcbdc58b007d3d6b10f4aa989306ca498544e6a2c6e8b16bf0c888d0132ed40ea01fa9ef0b20fe566e43e899ddd7e0b7988642032f9ccfc205b85f8bfc84fa37f2f9a0d0ca2b4dfe3808daaaace3ab31a6ff21682d2bc944813745b9bc00b14e5a8ddffd0a9e08159a6d2c63349d8c040bedf5a4848ded70eaa314bee6774e4f58d435d8a78a465714127456a782f010203cebf515a0a4073b4b8a05158cc81010deec3d404ef23b7a7275748374e42532c5048b891dc2a5b1d7c8b2c49df386e527e8bc38090be08e3874f963ebe145e7d40788cfbe1d810905a01720e728f5534672d77a49c5d3e0535e73a2666ccb0e413613b0a8782ba169ea3fffc018aa590fac16aa801b618ced146868ff8ea6b4f7bbd411851f1d14abd1c7f4d70796d6d5fc05029c363468f70106104aa7beb9d9c8f8ac6b87a0fe398425a24d55e88f7956a7e109165fa7e2ed1db84631244e7ef1e6651df6aeb1c1df1377631e73975535398efb6fd34f19926598d17db6bea85ba4002e9b93e7482ed88add7b912068a169fd7c6afc088aee2b09db87bbe7eca00a8f4eae7cc54d6f6e4f80e71678a9697e33748dde793c26d60857fc0a74c9eb072bc7e014506cf9472f949612717440b3a91171bdd08d249ba188a3b4f6c36d541379e5fd1141cbe1245c9f94dcd5f8705282724460e41bda2e8cce745dbbb6b9d23db328cf642b4b952e196b7c983c3606da6f80bb2736a9043ff20a1317ff99d575ba2b790cea39f33bdcf78626890946f8f376c3cd09548ee211fe869b5142f9bff9c01ef486ff81faf89200bd5d0af4b9b56ab8108df86053c63615861fb7bd0c4580b61655bb491058f387c2f5b751cc2598b1dc468563f5973a34650b4a8ee0a0cdeea446dad08cd522b3be28f2f9720a7f40c22555db0ada512e0d9869af7ee38164e952ca24c7a16ed8caf4684ee7fd6d745312cec65f80e7858d7b27b64e2c24e3b6de43c53fdab725f345fb0541ecd552006c328bca184f34e3df5d467e54f7c3a6e2ec411f4f47d6c8103f6bea44da64e2a57fac07685c7883c0a3244927b8aa95fef9df3b11d45d97422379982b5dc76644d51de687da94df95a75796ab164173595a166b3eb3c3cbb17f258745e4783ccfe29af864db527cb6df69aa77a0c34dbc180a69617fce8c7f9d41513b5d186f8eecbec3fed80b408bd832eef393f4e198aaa3a0b8fc3388423f43239cd0f283bbfd227c6dbdc92a42b774e5ce7b8922797e1bc37031e06a0a00610ef1e1f48be84df1c4ec9ee6a58284205a0268ffd33ca58b8936c2d758258eaa624d5733de1f01e1bde164419eae0b241a4a4e853ebefdc0f11cc3427d7fbbb03b800238efdf3187e220630690fa789e28345fbcee68e359f9b5f376a3f2b5418f2a1dc9498d0206056cfc4b93c469e40cf41c0b9eec1e297ed11029b58cffb58e7fde5e3e0f994b7d8b69d2c036b73f8bc27089fbf96c1d9b49527d0ddc8eff47546122461d5d53ee80ca9363a05a2dd6048f2d9980fa81437035851c9f611457640feafc150e4c0f3e490c431aba886acd9def583b3ea0cfc1880358c3871e5c5bde18ccbd86a9117027fb0de2fb0b862577d5cb2f5cf748a0f669d2f8d3f19fd6703cb9b8350ce232780f1d0087fcc08926c4bb164736984e4e004ea7a9a78a841776f20329b5e0c38fd2b1e55d105d33585ab309fe8993d1859c8e0e704cc840a522e66e51a12fbd72c932057a80747501f1a5627d7f2214c00d9a51311e78bcc1a853d797ace7aa0da3d6b7fd5c867b4e53d92ee64e7592fdfbf5bfafe2c922d0c08c8bb0bff4f58d1d4788cf7e04f0d8ff661f683549104683b36ddfdebea7dc0b7d7896a467a37975dec129572e5afd9ee1a69c02653a60e9c747e66ab43ea0384903f2fa7cd8d572a85fcca26ebc803a4d5d25feb860900ba5ba2d5d68bded8d27066c13d51279dea1c46f172ea8c82310b1196288484c571b160c42f74a584813328d9693e699845bf4573e05eac046c1f260edc9bc40ccf7d3ea826a8e5f5230d7a3dacda7e2b79c7c98c037e630a870f3f72a4bd2eceb525a8def86d9e1a88ea5dcaeaf22394ee88f812c46d136fa81810b21e0c3c1f42f01ce0f8d715af4b9575e449b9aebb4fd862044de7da998e7e3e31436d47cab952d085c1e09cb9e100f9992905338e48464bdb021030e44b01bcae688805b955bcd713bb6daa9a11795f3a80ff453d454523faaac1c4344f2d820096b247d95c65b3aee19f067ca8025045d2731ffb90a4e7b0b17e8b2a452d98c2aa75ab23a8b4d29b4fb8f2892497eb2813921c8f541c444eb8093e71d15043acecd8865ee78a643dd0626e2b23e972f977231699ef2bf2d748684e63af65dcba96204e5671109f9c23e7f09c7adea1fbb7a85fc2b7c0d4530de0cf1810185ee9e9212dc352ee799214a5369aab150c346657a7ea3a22b176dedd403612ae718b307a31fc3d7c0d3deeb8b3485321f6e01599919b61e5d64c0ee96d7383e9b4d10027ecd1f2924cd969fb251068b6fb00756929f3f0037b08eaaa88b156e300027ff8f9a03eb5e3a9378e5e9a850c47a343bea3eaf2c3b235aa56fc604e544446c0bd56df8ddd2a8a2ba922265e62f174ddcbbb4390df2cfe5e38a037252aad1f36c56143110fb86fbf57e026ce75c1ef3b1d2dcf11b5218e6833ba6647980d337723869ec8c57a1bf104a888e3d7b54938c03560f3f0310c9a05e229db04e494fae0e4ea997e72bbec64ba421bf6de1c69527128d909225c8f266ca541bfefba5fc6a0f59863aad5bf43232e028bf3819c87e01d6268f5aae10e99d9ca94a76516309f17167a082a15604c8d6d1d1b162f8ff717d52137cc89f5c667b2c9dbac4adc8b02c29a534e4df0e67dc5d2b0778a7269ac5dddbb4ca32267ceecc777944de8b79a0c5a31ea49f1f00efcb4a17ab4b26b923675d1fa1ee58d715bcf6792000566bdc170a2c20c267c9a7d2f4f09f00b3f0c74eb32d63730e392ce4ee93defb3db022082d7f44ef39e49d0cf2573deeb22950c44c00c9cd5e47307b23f617125c8ea5dace16f322e4c6d79ce3e9f0e6cc3429ed413c1091fe20205c5aefd74b833e3bdda3e554eaea7ce6e1febc51755fd7004b92ebc368d2f1c86d1b85e3e4559637fba734aad3a66298a2a885a10fddd3f99c87f2793529d788d62de88ed24ad20d875750e0a8bb13e150eed8f2c30125e4ffb03e8d5bbdedf2bae568da8646f569bde42cca3131cdaf4ef2dcbfe988f640e0e51da266d2</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好, 这里需要密码.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">还没写好，先加密了</summary>
    
    
    
    <category term="论文阅读" scheme="https://changqingaas.github.io/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
    <category term="论文阅读" scheme="https://changqingaas.github.io/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>《Go Web编程》阅读笔记</title>
    <link href="https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/GoWeb%E7%BC%96%E7%A8%8B/"/>
    <id>https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/GoWeb%E7%BC%96%E7%A8%8B/</id>
    <published>2022-05-16T14:00:33.000Z</published>
    <updated>2022-10-24T03:41:08.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-环境配置"><a href="#1-环境配置" class="headerlink" title="1 环境配置"></a>1 环境配置</h1><p>Go 是一种新的语言，一种并发的、带垃圾回收的、快速编译的语言。它具有以下特点：</p><ul><li><p>它可以在一台计算机上用几秒钟的时间编译一个大型的 Go 程序。</p></li><li><p>Go 为软件构造提供了一种模型，它使依赖分析更加容易，且避免了大部分 C 风格 include 文件与库的开头。</p></li><li>Go 是静态类型的语言，它的类型系统没有层级。因此用户不需要在定义类型之间的关系上花费时间，这样感觉起来比典型的面向对象语言更轻量级。</li><li>Go 完全是垃圾回收型的语言，并为并发执行与通信提供了基本的支持。</li><li>按照其设计，Go 打算为多核机器上系统软件的构造提供一种方法。</li></ul><p>Go 是一种编译型语言，它结合了解释型语言的游刃有余，动态类型语言的开发效率，以及静态类型的安全性。它也打算成为现代的，支持网络与多核计算的语言。要满足这些目标，需要解决一些语言上的问题：一个富有表达能力但轻量级的类型系统，并发与垃圾回收机制，严格的依赖规范等等。这些无法通过库或工具解决好，因此 Go 也就应运而生了。 </p><p><img src="https://cdn.learnku.com/build-web-application-with-golang/images/navi1.png?raw=true" alt="img"></p><h2 id="1-1-安装-Go"><a href="#1-1-安装-Go" class="headerlink" title="1.1. 安装 Go"></a>1.1. 安装 Go</h2><h3 id="Go-源码安装"><a href="#Go-源码安装" class="headerlink" title="Go 源码安装"></a>Go 源码安装</h3><p>Go 1.5 彻底移除 C 代码，Runtime、Compiler、Linker 均由 Go 编写，实现自举。只需要安装了上一个版本，即可从源码安装。</p><p>在 Go 1.5 前，Go 的源代码中，有些部分是用 Plan 9 C 和 AT&amp;T 汇编写的，因此假如你要想从源码安装，就必须安装 C 的编译工具。 </p><h2 id="1-2-GOPATH-与工作空间"><a href="#1-2-GOPATH-与工作空间" class="headerlink" title="1.2. GOPATH 与工作空间"></a>1.2. GOPATH 与工作空间</h2><p>GOPATH 来存放 Go 源码，Go 的可运行文件，以及相应的编译之后的包文件。所以这个目录下面有三个子目录：src、bin、pkg</p><p>GOPATH 环境变量现在有一个默认值，如果它没有被设置。 它在 Unix 上默认为 <strong>$HOME/go</strong>，在 Windows 上默认为 <strong>%USERPROFILE%/go</strong>。</p><h3 id="GOPATH-设置"><a href="#GOPATH-设置" class="headerlink" title="GOPATH 设置"></a>GOPATH 设置</h3><p>GOPATH 允许多个目录，当有多个目录时，请注意分隔符，多个目录的时候 Windows 是分号，Linux 系统是冒号，当有多个 GOPATH 时，默认会将 go get 的内容放在第一个目录下。</p><p>以上 $GOPATH 目录约定有三个子目录：</p><ul><li>src 存放源代码（比如：.go .c .h .s 等）</li><li>pkg 编译后生成的文件（比如：.a）</li><li>bin 编译后生成的可执行文件（为了方便，可以把此目录加入到 $PATH 变量中，如果有多个 gopath，那么使用 ${GOPATH//://bin:}/bin 添加所有的 bin 目录）</li><li>以后我所有的例子都是以 mygo 作为我的 gopath 目录 </li></ul><h3 id="代码目录结构规划"><a href="#代码目录结构规划" class="headerlink" title="代码目录结构规划"></a>代码目录结构规划</h3><p>GOPATH 下的 src 目录就是接下来开发程序的主要目录，所有的源码都是放在这个目录下面，那么一般我们的做法就是一个目录一个项目，例如: $GOPATH/src/mymath 表示 mymath 这个应用包或者可执行应用，这个根据 package 是 main 还是其他来决定，main 的话就是可执行应用，其他的话就是应用包，这个会在后续详细介绍 package。</p><p> 所以当新建应用或者一个代码包时都是在 src 目录下新建一个文件夹，文件夹名称一般是代码包名称，当然也允许多级目录，例如在 src 下面新建了目录 $GOPATH/src/github.com/astaxie/beedb 那么这个包路径就是 “github.com/astaxie/beedb”，包名称是最后一个目录 beedb</p><p> <strong>注意：一般建议 package 的名称和目录名保持一致</strong></p><p>下面我就以mymath为例来讲述如何编写应用包，执行如下代码</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd $GOPATH&#x2F;srcmkdir mymath<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>新建文件sqrt.go，内容如下</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; $GOPATH&#x2F;src&#x2F;mymath&#x2F;sqrt.go源码如下：package mymathfunc Sqrt(x float64) float64 &#123;    z :&#x3D; 0.0    for i :&#x3D; 0; i &lt; 1000; i++ &#123;        z -&#x3D; (z*z - x) &#x2F; (2 * x)    &#125;    return z&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="编译应用"><a href="#编译应用" class="headerlink" title="编译应用"></a>编译应用</h2><p>1、只要进入对应的应用包目录，然后执行<code>go install</code>，就可以安装了</p><p>2、在任意的目录执行如下代码<code>go install mymath</code></p><p>安装完之后，我们可以进入如下目录</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd $GOPATH&#x2F;pkg&#x2F;$&#123;GOOS&#125;_$&#123;GOARCH&#125;&#x2F;&#x2F;可以看到如下文件mymath.a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这个.a文件是应用包，那么我们如何进行调用呢？</p><p>接下来我们新建一个应用程序来调用这个应用包</p><p>新建应用包mathapp</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd $GOPATH&#x2F;srcmkdir mathappcd mathappvim main.go<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>$GOPATH/src/mathapp/main.go</code>源码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (      &quot;mymath&quot;      &quot;fmt&quot;)func main() &#123;      fmt.Printf(&quot;Hello, world.  Sqrt(2) &#x3D; %v\n&quot;, mymath.Sqrt(2))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如何编译程序呢？进入该应用目录，然后执行<code>go build</code>，那么在该目录下面会生成一个mathapp的可执行文件</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">.&#x2F;mathapp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出如下内容</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">Hello, world.  Sqrt(2) &#x3D; 1.414213562373095<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如何安装该应用，进入该目录执行<code>go install</code>,那么在$GOPATH/bin/下增加了一个可执行文件mathapp, 还记得前面我们把<code>$GOPATH/bin</code>加到我们的PATH里面了，这样可以在命令行输入如下命令就可以执行</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">mathapp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="获取远程包"><a href="#获取远程包" class="headerlink" title="获取远程包"></a>获取远程包</h3><p>go语言有一个获取远程包的工具就是<code>go get</code>，目前go get支持多数开源社区(例如：github、googlecode、bitbucket、Launchpad)</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">go get github.com&#x2F;astaxie&#x2F;beedb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>go get -u 参数可以自动更新包，而且当go get的时候会自动获取该包依赖的其他第三方包</p></blockquote><p>通过这个命令可以获取相应的源码，对应的开源平台采用不同的源码控制工具，例如github采用git、googlecode采用hg，所以要想获取这些源码，必须先安装相应的源码控制工具</p><h2 id="1-3-Go-命令"><a href="#1-3-Go-命令" class="headerlink" title="1.3 Go 命令"></a>1.3 Go 命令</h2><p>略</p><h3 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h3><p>go还提供了其它很多的工具，例如下面的这些工具</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">go version 查看go当前的版本go env 查看当前go的环境变量go list 列出当前全部安装的packagego run 编译并运行Go程序<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-Web基础"><a href="#3-Web基础" class="headerlink" title="3 Web基础"></a>3 Web基础</h1><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220514221954.png" alt="img"></p><h2 id="3-1-Web工作方式"><a href="#3-1-Web工作方式" class="headerlink" title="3.1 Web工作方式"></a>3.1 Web工作方式</h2><p>对于普通的上网过程，系统其实是这样做的：浏览器本身是一个客户端，当你输入URL的时候，首先浏览器会去请求DNS服务器，通过DNS获取相应的域名对应的IP，然后通过IP地址找到IP对应的服务器后，要求建立TCP连接，等浏览器发送完HTTP Request（请求）包后，服务器接收到请求包之后才开始处理请求包，服务器调用自身服务，返回HTTP Response（响应）包；客户端收到来自服务器的响应后开始渲染这个Response包里的主体（body），等收到全部的内容随后断开与该服务器之间的TCP连接。</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220514222040.png" alt="img"></p><p>一个Web服务器也被称为HTTP服务器，它通过HTTP协议与客户端通信。这个客户端通常指的是Web浏览器(其实手机端客户端内部也是浏览器实现的)。</p><p>Web服务器的工作原理可以简单地归纳为：</p><ul><li>客户机通过TCP/IP协议建立到服务器的TCP连接</li><li>客户端向服务器发送HTTP协议请求包，请求服务器里的资源文档</li><li>服务器向客户机发送HTTP协议应答包，如果请求的资源包含有动态语言的内容，那么服务器会调用动态语言的解释引擎负责处理“动态内容”，并将处理得到的数据返回给客户端</li><li>客户机与服务器断开。由客户端解释HTML文档，在客户端屏幕上渲染图形结果</li></ul><h3 id="URL和DNS解析"><a href="#URL和DNS解析" class="headerlink" title="URL和DNS解析"></a>URL和DNS解析</h3><p>URL(Uniform Resource Locator)是“统一资源定位符”的英文缩写，用于描述一个网络上的资源, 基本格式如下</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">scheme:&#x2F;&#x2F;host[:port#]&#x2F;path&#x2F;...&#x2F;[?query-string][#anchor]scheme         指定低层使用的协议(例如：http, https, ftp)host           HTTP服务器的IP地址或者域名port#          HTTP服务器的默认端口是80，这种情况下端口号可以省略。如果使用了别的端口，必须指明，例如 http:&#x2F;&#x2F;www.cnblogs.com:8080&#x2F;path           访问资源的路径query-string   发送给http服务器的数据anchor         锚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>DNS(Domain Name System)是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统，它用于TCP/IP网络，它从事将主机名或域名转换为实际IP地址的工作。DNS就是这样的一位“翻译官”，它的基本工作原理可用下图来表示。</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220514222503.png" alt="img"></p><p>更详细的DNS解析的过程如下，这个过程有助于我们理解DNS的工作模式</p><ol><li>在浏览器中输入www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。</li><li>如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。</li><li>如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/IP参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。</li><li>如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。</li><li>如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至 “根DNS服务器”，“根DNS服务器”收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机。</li><li>如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。</li></ol><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220514222623.png" alt="img"></p><p>  DNS解析的整个流程（完成若干次迭代查询，即，问询者角色不变，但反复更替问询对象)</p><p>通过上面的步骤，我们最后获取的是IP地址，也就是浏览器最后发起请求的时候是基于IP来和服务器做信息交互的。</p><h3 id="HTTP协议详解"><a href="#HTTP协议详解" class="headerlink" title="HTTP协议详解"></a>HTTP协议详解</h3><p>HTTP是一种让Web服务器与浏览器(客户端)通过Internet发送与接收数据的协议,它建立在TCP协议之上，一般采用TCP的80端口。它是一个请求、响应协议—客户端发出一个请求，服务器响应这个请求。在HTTP中，客户端总是通过建立一个连接与发送一个HTTP请求来发起一个事务。服务器不能主动去与客户端联系，也不能给客户端发出一个回调连接。客户端与服务器端都可以提前中断一个连接。例如，当浏览器下载一个文件时，你可以通过点击“停止”键来中断文件的下载，关闭与服务器的HTTP连接。</p><p>HTTP协议是无状态的，同一个客户端的这次请求和上次请求是没有对应关系，对HTTP服务器来说，它并不知道这两个请求是否来自同一个客户端。为了解决这个问题， Web程序引入了Cookie机制来维护连接的可持续状态。</p><p>HTTP协议是建立在TCP协议之上的，因此TCP攻击一样会影响HTTP的通讯，例如比较常见的一些攻击：SYN Flood是当前最流行的DoS（拒绝服务攻击）与DdoS（分布式拒绝服务攻击）的方式之一，这是一种利用TCP协议缺陷，发送大量伪造的TCP连接请求，从而使得被攻击方资源耗尽（CPU满负荷或内存不足）的攻击方式。</p><h4 id="HTTP请求包（浏览器信息）"><a href="#HTTP请求包（浏览器信息）" class="headerlink" title="HTTP请求包（浏览器信息）"></a>HTTP请求包（浏览器信息）</h4><p>我们先来看看Request包的结构, Request包分为3部分，第一部分叫Request line（请求行）, 第二部分叫Request header（请求头）,第三部分是body（主体）。header和body之间有个空行，请求包的例子所示:</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">GET &#x2F;domains&#x2F;example&#x2F; HTTP&#x2F;1.1        &#x2F;&#x2F;请求行: 请求方法 请求URI HTTP协议&#x2F;协议版本Host：www.iana.org                &#x2F;&#x2F;服务端的主机名User-Agent：Mozilla&#x2F;5.0 (Windows NT 6.1) AppleWebKit&#x2F;537.4 (KHTML, like Gecko) Chrome&#x2F;22.0.1229.94 Safari&#x2F;537.4            &#x2F;&#x2F;浏览器信息Accept：text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8    &#x2F;&#x2F;客户端能接收的mineAccept-Encoding：gzip,deflate,sdch        &#x2F;&#x2F;是否支持流压缩Accept-Charset：UTF-8,*;q&#x3D;0.5        &#x2F;&#x2F;客户端字符编码集&#x2F;&#x2F;空行,用于分割请求头和消息体&#x2F;&#x2F;消息体,请求资源参数,例如POST传递的参数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>HTTP协议定义了很多与服务器交互的请求方法，最基本的有4种，分别是GET,POST,PUT,DELETE。一个URL地址用于描述一个网络上的资源，而HTTP中的GET, POST, PUT, DELETE就对应着对这个资源的查，改，增，删4个操作。我们最常见的就是GET和POST了。GET一般用于获取/查询资源信息，而POST一般用于更新资源信息。</p><p>我们看看GET和POST的区别:</p><ol><li>我们可以看到GET请求消息体为空，POST请求带有消息体。</li><li>GET提交的数据会放在URL之后，以<code>?</code>分割URL和传输数据，参数之间以<code>&amp;</code>相连，如<code>EditPosts.aspx?name=test1&amp;id=123456</code>。POST方法是把提交的数据放在HTTP包的body中。</li><li>GET提交的数据大小有限制（因为浏览器对URL的长度有限制），而POST方法提交的数据没有限制。</li><li>GET方式提交数据，会带来安全问题，比如一个登录页面，通过GET方式提交数据时，用户名和密码将出现在URL上，如果页面可以被缓存或者其他人可以访问这台机器，就可以从历史记录获得该用户的账号和密码。</li></ol><h4 id="HTTP响应包（服务器信息）"><a href="#HTTP响应包（服务器信息）" class="headerlink" title="HTTP响应包（服务器信息）"></a>HTTP响应包（服务器信息）</h4><p>我们再来看看HTTP的response包，他的结构如下：</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">HTTP&#x2F;1.1 200 OK                        &#x2F;&#x2F;状态行Server: nginx&#x2F;1.0.8                    &#x2F;&#x2F;服务器使用的WEB软件名及版本Date:Date: Tue, 30 Oct 2012 04:14:25 GMT        &#x2F;&#x2F;发送时间Content-Type: text&#x2F;html                &#x2F;&#x2F;服务器发送信息的类型Transfer-Encoding: chunked            &#x2F;&#x2F;表示发送HTTP包是分段发的Connection: keep-alive                &#x2F;&#x2F;保持连接状态Content-Length: 90                    &#x2F;&#x2F;主体内容长度&#x2F;&#x2F;空行 用来分割消息头和主体&lt;!DOCTYPE html PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN&quot;... &#x2F;&#x2F;消息体<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Response包中的第一行叫做状态行，由HTTP协议版本号， 状态码， 状态消息 三部分组成。</p><p>状态码用来告诉HTTP客户端,HTTP服务器是否产生了预期的Response。HTTP/1.1协议中定义了5类状态码， 状态码由三位数字组成，第一个数字定义了响应的类别</p><ul><li>1XX 提示信息 - 表示请求已被成功接收，继续处理</li><li>2XX 成功 - 表示请求已被成功接收，理解，接受</li><li>3XX 重定向 - 要完成请求必须进行更进一步的处理</li><li>4XX 客户端错误 - 请求有语法错误或请求无法实现</li><li>5XX 服务器端错误 - 服务器未能实现合法的请求</li></ul><h4 id="HTTP协议是无状态的和Connection-keep-alive的区别"><a href="#HTTP协议是无状态的和Connection-keep-alive的区别" class="headerlink" title="HTTP协议是无状态的和Connection: keep-alive的区别"></a>HTTP协议是无状态的和Connection: keep-alive的区别</h4><p>无状态是指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。从另一方面讲，打开一个服务器上的网页和你之前打开这个服务器上的网页之间没有任何联系。</p><p>HTTP是一个无状态的面向连接的协议，无状态不代表HTTP不能保持TCP连接，更不能代表HTTP使用的是UDP协议（面对无连接）。</p><p>从HTTP/1.1起，默认都开启了Keep-Alive保持连接特性，简单地说，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的TCP连接。</p><p>Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同服务器软件（如Apache）中设置这个时间。</p><h3 id="请求实例"><a href="#请求实例" class="headerlink" title="请求实例"></a>请求实例</h3><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220514224125.png" alt="img"></p><p>图3.7 一次请求的request和response</p><p>上面这张图我们可以了解到整个的通讯过程，同时细心的读者是否注意到了一点，一个URL请求但是左边栏里面为什么会有那么多的资源请求(这些都是静态文件，go对于静态文件有专门的处理方式)。</p><p>这个就是浏览器的一个功能，第一次请求url，服务器端返回的是html页面，然后浏览器开始渲染HTML：当解析到HTML DOM里面的图片连接，css脚本和js脚本的链接，浏览器就会自动发起一个请求静态资源的HTTP请求，获取相对应的静态资源，然后浏览器就会渲染出来，最终将所有资源整合、渲染，完整展现在我们面前的屏幕上。</p><blockquote><p>网页优化方面有一项措施是减少HTTP请求次数，就是把尽量多的css和js资源合并在一起，目的是尽量减少网页请求静态资源的次数，提高网页加载速度，同时减缓服务器的压力。</p></blockquote><h2 id="3-2-Go搭建一个Web服务器"><a href="#3-2-Go搭建一个Web服务器" class="headerlink" title="3.2 Go搭建一个Web服务器"></a>3.2 Go搭建一个Web服务器</h2><h3 id="http包建立Web服务器"><a href="#http包建立Web服务器" class="headerlink" title="http包建立Web服务器"></a>http包建立Web服务器</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;net&#x2F;http&quot;    &quot;strings&quot;    &quot;log&quot;)func sayhelloName(w http.ResponseWriter, r *http.Request) &#123;    r.ParseForm()  &#x2F;&#x2F;解析参数，默认是不会解析的    fmt.Println(r.Form)  &#x2F;&#x2F;这些信息是输出到服务器端的打印信息    fmt.Println(&quot;path&quot;, r.URL.Path)    fmt.Println(&quot;scheme&quot;, r.URL.Scheme)    fmt.Println(r.Form[&quot;url_long&quot;])    for k, v :&#x3D; range r.Form &#123;        fmt.Println(&quot;key:&quot;, k)        fmt.Println(&quot;val:&quot;, strings.Join(v, &quot;&quot;))    &#125;    fmt.Fprintf(w, &quot;Hello astaxie!&quot;) &#x2F;&#x2F;这个写入到w的是输出到客户端的&#125;func main() &#123;    http.HandleFunc(&quot;&#x2F;&quot;, sayhelloName) &#x2F;&#x2F;设置访问的路由    err :&#x3D; http.ListenAndServe(&quot;:9090&quot;, nil) &#x2F;&#x2F;设置监听的端口    if err !&#x3D; nil &#123;        log.Fatal(&quot;ListenAndServe: &quot;, err)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>浏览器输入：<a href="http://localhost:9090/?url_long=111&amp;url_long=222">http://localhost:9090/?url_long=111&amp;url_long=222</a> </p><p>输出如下：</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h2cb8l936yj20k80g4t94.jpg" alt="image-20220518094052940"></p><p>要编写一个Web服务器很简单，只要调用http包的两个函数就可以了。</p><blockquote><p>如果你以前是PHP程序员，那你也许就会问，我们的nginx、apache服务器不需要吗？Go就是不需要这些，因为他直接就监听tcp端口了，做了nginx做的事情，然后sayhelloName这个其实就是我们写的逻辑函数了，跟php里面的控制层（controller）函数类似。</p><p>如果你以前是Python程序员，那么你一定听说过tornado，这个代码和他是不是很像，对，没错，Go就是拥有类似Python这样动态语言的特性，写Web应用很方便。</p><p>如果你以前是Ruby程序员，会发现和ROR的/script/server启动有点类似。</p></blockquote><p>我们看到Go通过简单的几行代码就已经运行起来一个Web服务了，而且这个Web服务内部有支持高并发的特性，</p><h2 id="3-3-Go如何使得Web工作"><a href="#3-3-Go如何使得Web工作" class="headerlink" title="3.3 Go如何使得Web工作"></a>3.3 Go如何使得Web工作</h2><h3 id="web工作方式的几个概念"><a href="#web工作方式的几个概念" class="headerlink" title="web工作方式的几个概念"></a>web工作方式的几个概念</h3><p>以下均是服务器端的几个概念</p><p>Request：用户请求的信息，用来解析用户的请求信息，包括post、get、cookie、url等信息</p><p>Response：服务器需要反馈给客户端的信息</p><p>Conn：用户的每次请求链接</p><p>Handler：处理请求和生成返回信息的处理逻辑</p><h3 id="分析http包运行机制"><a href="#分析http包运行机制" class="headerlink" title="分析http包运行机制"></a>分析http包运行机制</h3><p>如下图所示，是Go实现Web服务的工作模式的流程图</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h2cbjl2w7ij20k40f0wfd.jpg" alt="img"></p><ol><li>创建Listen Socket, 监听指定的端口, 等待客户端请求到来。</li><li>Listen Socket接受客户端的请求, 得到Client Socket, 接下来通过Client Socket与客户端通信。</li><li>处理客户端的请求, 首先从Client Socket读取HTTP请求的协议头, 如果是POST方法, 还可能要读取客户端提交的数据, 然后交给相应的handler处理请求, handler处理完毕准备好客户端需要的数据, 通过Client Socket写给客户端。</li></ol><p>这整个的过程里面我们只要了解清楚下面三个问题，也就知道Go是如何让Web运行起来了</p><ul><li>如何监听端口？</li><li>如何接收客户端请求？</li><li>如何分配handler？</li></ul><p>前面小节的代码里面我们可以看到，Go是通过一个函数<code>ListenAndServe</code>来处理这些事情的，这个底层其实这样处理的：初始化一个server对象，然后调用了<code>net.Listen(&quot;tcp&quot;, addr)</code>，也就是底层用TCP协议搭建了一个服务，然后监控我们设置的端口。</p><p>下面代码来自Go的http包的源码，通过下面的代码我们可以看到整个的http处理过程：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func (srv *Server) Serve(l net.Listener) error &#123;    defer l.Close()    var tempDelay time.Duration &#x2F;&#x2F; how long to sleep on accept failure    for &#123;        rw, e :&#x3D; l.Accept()        if e !&#x3D; nil &#123;            if ne, ok :&#x3D; e.(net.Error); ok &amp;&amp; ne.Temporary() &#123;                if tempDelay &#x3D;&#x3D; 0 &#123;                    tempDelay &#x3D; 5 * time.Millisecond                &#125; else &#123;                    tempDelay *&#x3D; 2                &#125;                if max :&#x3D; 1 * time.Second; tempDelay &gt; max &#123;                    tempDelay &#x3D; max                &#125;                log.Printf(&quot;http: Accept error: %v; retrying in %v&quot;, e, tempDelay)                time.Sleep(tempDelay)                continue            &#125;            return e        &#125;        tempDelay &#x3D; 0        c, err :&#x3D; srv.newConn(rw)        if err !&#x3D; nil &#123;            continue        &#125;        go c.serve()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>监控之后如何接收客户端的请求呢？上面代码执行监控端口之后，调用了<code>srv.Serve(net.Listener)</code>函数，这个函数就是处理接收客户端的请求信息。这个函数里面起了一个<code>for&#123;&#125;</code>，首先通过Listener接收请求，其次创建一个Conn，最后单独开了一个goroutine，把这个请求的数据当做参数扔给这个conn去服务：<code>go c.serve()</code>。这个就是高并发体现了，用户的每一次请求都是在一个新的goroutine去服务，相互不影响。</p><p>那么如何具体分配到相应的函数来处理请求呢？conn首先会解析request:<code>c.readRequest()</code>,然后获取相应的handler:<code>handler := c.server.Handler</code>，也就是我们刚才在调用函数<code>ListenAndServe</code>时候的第二个参数，我们前面例子传递的是nil，也就是为空，那么默认获取<code>handler = DefaultServeMux</code>,那么这个变量用来做什么的呢？对，这个变量就是一个路由器，它用来匹配url跳转到其相应的handle函数，那么这个我们有设置过吗?有，我们调用的代码里面第一句不是调用了<code>http.HandleFunc(&quot;/&quot;, sayhelloName)</code>嘛。这个作用就是注册了请求<code>/</code>的路由规则，当请求uri为”/“，路由就会转到函数sayhelloName，DefaultServeMux会调用ServeHTTP方法，这个方法内部其实就是调用sayhelloName本身，最后通过写入response的信息反馈到客户端。</p><p>详细的整个流程如下图所示：</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h2cefv4idhj20f20ed0tp.jpg" alt="img"></p><h2 id="3-4-Go的http包详解"><a href="#3-4-Go的http包详解" class="headerlink" title="3.4 Go的http包详解"></a>3.4 Go的http包详解</h2><p>Go的http有两个核心功能：Conn、ServeMux</p><h3 id="Conn的goroutine"><a href="#Conn的goroutine" class="headerlink" title="Conn的goroutine"></a>Conn的goroutine</h3><p>Go为了实现高并发和高性能, 使用了goroutines来处理Conn的读写事件, 这样每个请求都能保持独立，相互不会阻塞，可以高效的响应网络事件。这是Go高效的保证。</p><p>Go在等待客户端请求里面是这样写的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">c, err :&#x3D; srv.newConn(rw)if err !&#x3D; nil &#123;  continue&#125;go c.serve()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们可以看到客户端的每次请求都会创建一个Conn，这个Conn里面保存了该次请求的信息，然后再传递到对应的handler，该handler中便可以读取到相应的header信息，这样保证了每个请求的独立性。</p><h3 id="ServeMux的自定义"><a href="#ServeMux的自定义" class="headerlink" title="ServeMux的自定义"></a>ServeMux的自定义</h3><p>conn.server内部是调用了http包默认的路由器，通过路由器把本次请求的信息传递到了后端的处理函数。那么这个路由器是怎么实现的呢？</p><p>它的结构如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type ServeMux struct &#123;    mu sync.RWMutex   &#x2F;&#x2F;锁，由于请求涉及到并发处理，因此这里需要一个锁机制    m  map[string]muxEntry  &#x2F;&#x2F; 路由规则，一个string对应一个mux实体，这里的string就是注册的路由表达式    hosts bool &#x2F;&#x2F; 是否在任意的规则中带有host信息&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面看一下muxEntry</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type muxEntry struct &#123;    explicit bool   &#x2F;&#x2F; 是否精确匹配    h        Handler &#x2F;&#x2F; 这个路由表达式对应哪个handler    pattern  string  &#x2F;&#x2F;匹配字符串&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着看一下Handler的定义</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Handler interface &#123;    ServeHTTP(ResponseWriter, *Request)  &#x2F;&#x2F; 路由实现器&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Handler是一个接口，但是前一小节中的<code>sayhelloName</code>函数并没有实现ServeHTTP这个接口，为什么能添加呢？原来在http包里面还定义了一个类型<code>HandlerFunc</code>,我们定义的函数<code>sayhelloName</code>就是这个HandlerFunc调用之后的结果，这个类型默认就实现了ServeHTTP这个接口，即我们调用了HandlerFunc(f),强制类型转换f成为HandlerFunc类型，这样f就拥有了ServeHTTP方法。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type HandlerFunc func(ResponseWriter, *Request)&#x2F;&#x2F; ServeHTTP calls f(w, r).func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) &#123;    f(w, r)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>路由器里面存储好了相应的路由规则之后，那么具体的请求又是怎么分发的呢？请看下面的代码，默认的路由器实现了<code>ServeHTTP</code>：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) &#123;    if r.RequestURI &#x3D;&#x3D; &quot;*&quot; &#123;        w.Header().Set(&quot;Connection&quot;, &quot;close&quot;)        w.WriteHeader(StatusBadRequest)        return    &#125;    h, _ :&#x3D; mux.Handler(r)    h.ServeHTTP(w, r)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如上所示路由器接收到请求之后，如果是<code>*</code>那么关闭链接，不然调用<code>mux.Handler(r)</code>返回对应设置路由的处理Handler，然后执行<code>h.ServeHTTP(w, r)</code></p><p>也就是调用对应路由的handler的ServerHTTP接口，那么mux.Handler(r)怎么处理的呢？</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func (mux *ServeMux) Handler(r *Request) (h Handler, pattern string) &#123;    if r.Method !&#x3D; &quot;CONNECT&quot; &#123;        if p :&#x3D; cleanPath(r.URL.Path); p !&#x3D; r.URL.Path &#123;            _, pattern &#x3D; mux.handler(r.Host, p)            return RedirectHandler(p, StatusMovedPermanently), pattern        &#125;    &#125;        return mux.handler(r.Host, r.URL.Path)&#125;func (mux *ServeMux) handler(host, path string) (h Handler, pattern string) &#123;    mux.mu.RLock()    defer mux.mu.RUnlock()    &#x2F;&#x2F; Host-specific pattern takes precedence over generic ones    if mux.hosts &#123;        h, pattern &#x3D; mux.match(host + path)    &#125;    if h &#x3D;&#x3D; nil &#123;        h, pattern &#x3D; mux.match(path)    &#125;    if h &#x3D;&#x3D; nil &#123;        h, pattern &#x3D; NotFoundHandler(), &quot;&quot;    &#125;    return&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>原来他是根据用户请求的URL和路由器里面存储的map去匹配的，当匹配到之后返回存储的handler，调用这个handler的ServeHTTP接口就可以执行到相应的函数了。</p><p>通过上面这个介绍，我们了解了整个路由过程，Go其实支持外部实现的路由器 <code>ListenAndServe</code>的第二个参数就是用以配置外部路由器的，它是一个Handler接口，即外部路由器只要实现了Handler接口就可以,我们可以在自己实现的路由器的ServeHTTP里面实现自定义路由功能。</p><p>如下代码所示，我们自己实现了一个简易的路由器</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;net&#x2F;http&quot;)type MyMux struct &#123;&#125;func (p *MyMux) ServeHTTP(w http.ResponseWriter, r *http.Request) &#123;    if r.URL.Path &#x3D;&#x3D; &quot;&#x2F;&quot; &#123;        sayhelloName(w, r)        return    &#125;    http.NotFound(w, r)    return&#125;func sayhelloName(w http.ResponseWriter, r *http.Request) &#123;    fmt.Fprintf(w, &quot;Hello myroute!&quot;)&#125;func main() &#123;    mux :&#x3D; &amp;MyMux&#123;&#125;    http.ListenAndServe(&quot;:9090&quot;, mux)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Go代码的执行流程"><a href="#Go代码的执行流程" class="headerlink" title="Go代码的执行流程"></a>Go代码的执行流程</h3><p>通过对http包的分析之后，现在让我们来梳理一下整个的代码执行过程。</p><ul><li><p>首先调用Http.HandleFunc</p><p>按顺序做了几件事：</p><p>1 调用了DefaultServeMux的HandleFunc</p><p>2 调用了DefaultServeMux的Handle</p><p>3 往DefaultServeMux的map[string]muxEntry中增加对应的handler和路由规则</p></li><li><p>其次调用http.ListenAndServe(“:9090”, nil)</p><p>按顺序做了几件事情：</p><p>1 实例化Server</p><p>2 调用Server的ListenAndServe()</p><p>3 调用net.Listen(“tcp”, addr)监听端口</p><p>4 启动一个for循环，在循环体中Accept请求</p><p>5 对每个请求实例化一个Conn，并且开启一个goroutine为这个请求进行服务go c.serve()</p><p>6 读取每个请求的内容w, err := c.readRequest()</p><p>7 判断handler是否为空，如果没有设置handler（这个例子就没有设置handler），handler就设置为DefaultServeMux</p><p>8 调用handler的ServeHttp</p><p>9 在这个例子中，下面就进入到DefaultServeMux.ServeHttp</p><p>10 根据request选择handler，并且进入到这个handler的ServeHTTP</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">mux.handler(r).ServeHTTP(w, r)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>11 选择handler：</p><p>A 判断是否有路由能满足这个request（循环遍历ServerMux的muxEntry）</p><p>B 如果有路由满足，调用这个路由handler的ServeHttp</p><p>C 如果没有路由满足，调用NotFoundHandler的ServeHttp</p></li></ul><h1 id="4-表单"><a href="#4-表单" class="headerlink" title="4 表单"></a>4 表单</h1><p>在Request里面的有专门的form处理，可以很方便的整合到Web开发里面来，4.1小节里面将讲解Go如何处理表单的输入。由于不能信任任何用户的输入，所以我们需要对这些输入进行有效性验证，4.2小节将就如何进行一些普通的验证进行详细的演示。</p><p>HTTP协议是一种无状态的协议，那么如何才能辨别是否是同一个用户呢？同时又如何保证一个表单不出现多次递交的情况呢？4.3和4.4小节里面将对cookie(cookie是存储在客户端的信息，能够每次通过header和服务器进行交互的数据)等进行详细讲解。</p><p>表单还有一个很大的功能就是能够上传文件，那么Go是如何处理文件上传的呢？针对大文件上传我们如何有效的处理呢？4.5小节我们将一起学习Go处理文件上传的知识。</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/navi4.png?raw=true" alt="img"></p><h2 id="4-1-处理表单的输入"><a href="#4-1-处理表单的输入" class="headerlink" title="4.1 处理表单的输入"></a>4.1 处理表单的输入</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;html&#x2F;template&quot;    &quot;log&quot;    &quot;net&#x2F;http&quot;    &quot;strings&quot;)func sayhelloName(w http.ResponseWriter, r *http.Request) &#123;    r.ParseForm()       &#x2F;&#x2F;解析url传递的参数，对于POST则解析响应包的主体（request body）    &#x2F;&#x2F;注意:如果没有调用ParseForm方法，下面无法获取表单的数据    fmt.Println(r.Form) &#x2F;&#x2F;这些信息是输出到服务器端的打印信息    fmt.Println(&quot;path&quot;, r.URL.Path)    fmt.Println(&quot;scheme&quot;, r.URL.Scheme)    fmt.Println(r.Form[&quot;url_long&quot;])    for k, v :&#x3D; range r.Form &#123;        fmt.Println(&quot;key:&quot;, k)        fmt.Println(&quot;val:&quot;, strings.Join(v, &quot;&quot;))    &#125;    fmt.Fprintf(w, &quot;Hello astaxie!&quot;) &#x2F;&#x2F;这个写入到w的是输出到客户端的&#125;func login(w http.ResponseWriter, r *http.Request) &#123;    fmt.Println(&quot;method:&quot;, r.Method) &#x2F;&#x2F;获取请求的方法    if r.Method &#x3D;&#x3D; &quot;GET&quot; &#123;        t, _ :&#x3D; template.ParseFiles(&quot;login.html&quot;)        t.Execute(w, nil)    &#125; else &#123;        &#x2F;&#x2F;请求的是登陆数据，那么执行登陆的逻辑判断        fmt.Println(&quot;username:&quot;, r.Form[&quot;username&quot;])        fmt.Println(&quot;password:&quot;, r.Form[&quot;password&quot;])    &#125;&#125;func main() &#123;    http.HandleFunc(&quot;&#x2F;&quot;, sayhelloName)       &#x2F;&#x2F;设置访问的路由    http.HandleFunc(&quot;&#x2F;login&quot;, login)         &#x2F;&#x2F;设置访问的路由    err :&#x3D; http.ListenAndServe(&quot;:9090&quot;, nil) &#x2F;&#x2F;设置监听的端口    if err !&#x3D; nil &#123;        log.Fatal(&quot;ListenAndServe: &quot;, err)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>登陆<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们输入用户名和密码之后发现在服务器端是不会打印出来任何输出的，为什么呢？默认情况下，Handler里面是不会自动解析form的，必须显式的调用<code>r.ParseForm()</code>后，你才能对这个表单数据进行操作。我们修改一下代码，在<code>fmt.Println(&quot;username:&quot;, r.Form[&quot;username&quot;])</code>之前加一行<code>r.ParseForm()</code>,重新编译，再次测试输入递交，现在是不是在服务器端有输出你的输入的用户名和密码了。</p><p><code>r.Form</code>里面包含了所有请求的参数，比如URL中query-string、POST的数据、PUT的数据，所有当你在URL的query-string字段和POST冲突时，会保存成一个slice，里面存储了多个值，Go官方文档中说在接下来的版本里面将会把POST、GET这些数据分离开来。</p><p>…….</p><p><code>request.Form</code>是一个url.Values类型，里面存储的是对应的类似<code>key=value</code>的信息，下面展示了可以对form数据进行的一些操作:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">v :&#x3D; url.Values&#123;&#125;v.Set(&quot;name&quot;, &quot;Ava&quot;)v.Add(&quot;friend&quot;, &quot;Jess&quot;)v.Add(&quot;friend&quot;, &quot;Sarah&quot;)v.Add(&quot;friend&quot;, &quot;Zoe&quot;)&#x2F;&#x2F; v.Encode() &#x3D;&#x3D; &quot;name&#x3D;Ava&amp;friend&#x3D;Jess&amp;friend&#x3D;Sarah&amp;friend&#x3D;Zoe&quot;fmt.Println(v.Get(&quot;name&quot;))fmt.Println(v.Get(&quot;friend&quot;))fmt.Println(v[&quot;friend&quot;])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>Tips</strong>: Request本身也提供了FormValue()函数来获取用户提交的参数。如r.Form[“username”]也可写成r.FormValue(“username”)。调用r.FormValue时会自动调用r.ParseForm，所以不必提前调用。r.FormValue只会返回同名参数中的第一个，若参数不存在则返回空字符串。</p></blockquote><h2 id="4-2-验证表单的输入"><a href="#4-2-验证表单的输入" class="headerlink" title="4.2 验证表单的输入"></a>4.2 验证表单的输入</h2><p>我们平常编写Web应用主要有两方面的数据验证，一个是在页面端的js验证(目前在这方面有很多的插件库，比如ValidationJS插件)，一个是在服务器端的验证，我们这小节讲解的是如何在服务器端验证。</p><h3 id="必填字段"><a href="#必填字段" class="headerlink" title="必填字段"></a>必填字段</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">if len(r.Form[&quot;username&quot;][0])&#x3D;&#x3D;0&#123;    &#x2F;&#x2F;为空的处理&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>r.Form</code>对不同类型的表单元素的留空有不同的处理， 对于空文本框、空文本区域以及文件上传，元素的值为空值,而如果是未选中的复选框和单选按钮，则根本不会在r.Form中产生相应条目，如果我们用上面例子中的方式去获取数据时程序就会报错。所以我们需要通过<code>r.Form.Get()</code>来获取值，因为如果字段不存在，通过该方式获取的是空值。但是通过<code>r.Form.Get()</code>只能获取单个的值，如果是map的值，必须通过上面的方式来获取。</p><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>如果我们是判断正整数，那么我们先转化成int类型，然后进行处理</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">getint,err:&#x3D;strconv.Atoi(r.Form.Get(&quot;age&quot;))if err!&#x3D;nil&#123;    &#x2F;&#x2F;数字转化出错了，那么可能就不是数字&#125;&#x2F;&#x2F;接下来就可以判断这个数字的大小范围了if getint &gt;100 &#123;    &#x2F;&#x2F;太大了&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有一种方式就是正则匹配的方式</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if m, _ :&#x3D; regexp.MatchString(&quot;^[0-9]+$&quot;, r.Form.Get(&quot;age&quot;)); !m &#123;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="中文"><a href="#中文" class="headerlink" title="中文"></a>中文</h3><p>对于中文我们目前有两种方式来验证，可以使用 <code>unicode</code> 包提供的 <code>func Is(rangeTab *RangeTable, r rune) bool</code> 来验证，也可以使用正则方式来验证，这里使用最简单的正则方式，如下代码所示</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if m, _ :&#x3D; regexp.MatchString(&quot;^\\p&#123;Han&#125;+$&quot;, r.Form.Get(&quot;realname&quot;)); !m &#123;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="电子邮件地址"><a href="#电子邮件地址" class="headerlink" title="电子邮件地址"></a>电子邮件地址</h3><p>你想知道用户输入的一个Email地址是否正确，通过如下这个方式可以验证：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if m, _ :&#x3D; regexp.MatchString(&#96;^([\w\.\_]&#123;2,10&#125;)@(\w&#123;1,&#125;).([a-z]&#123;2,4&#125;)$&#96;, r.Form.Get(&quot;email&quot;)); !m &#123;    fmt.Println(&quot;no&quot;)&#125;else&#123;    fmt.Println(&quot;yes&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="手机号码"><a href="#手机号码" class="headerlink" title="手机号码"></a>手机号码</h3><p>你想要判断用户输入的手机号码是否正确，通过正则也可以验证：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if m, _ :&#x3D; regexp.MatchString(&#96;^(1[3|4|5|8][0-9]\d&#123;4,8&#125;)$&#96;, r.Form.Get(&quot;mobile&quot;)); !m &#123;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="单选按钮"><a href="#单选按钮" class="headerlink" title="单选按钮"></a>单选按钮</h3><p>如果我们想要判断radio按钮是否有一个被选中了，我们页面的输出可能就是一个男、女性别的选择，但是也可能一个15岁大的无聊小孩，一手拿着http协议的书，另一只手通过telnet客户端向你的程序在发送请求呢，你设定的性别男值是1，女是2，他给你发送一个3，你的程序会出现异常吗？因此我们也需要像下拉菜单的判断方式类似，判断我们获取的值是我们预设的值，而不是额外的值。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>男<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>女<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>那我们也可以类似下拉菜单的做法一样</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">slice:&#x3D;[]int&#123;1,2&#125;for _, v :&#x3D; range slice &#123;    if v &#x3D;&#x3D; r.Form.Get(&quot;gender&quot;) &#123;        return true    &#125;&#125;return false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>复选框同理。</p><h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><p>你想确定用户填写的日期或时间是否有效。例如 ，用户在日程表中安排8月份的第45天开会，或者提供未来的某个时间作为生日。</p><p>Go里面提供了一个time的处理包，我们可以把用户的输入年月日转化成相应的时间，然后进行逻辑判断</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">t :&#x3D; time.Date(2009, time.November, 10, 23, 0, 0, 0, time.UTC)fmt.Printf(&quot;Go launched at %s\n&quot;, t.Local())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>获取time之后我们就可以进行很多时间函数的操作。具体的判断就根据自己的需求调整。</p><h3 id="身份证号码"><a href="#身份证号码" class="headerlink" title="身份证号码"></a>身份证号码</h3><p>如果我们想验证表单输入的是否是身份证，通过正则也可以方便的验证，但是身份证有15位和18位，我们两个都需要验证</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F;验证15位身份证，15位的是全部数字if m, _ :&#x3D; regexp.MatchString(&#96;^(\d&#123;15&#125;)$&#96;, r.Form.Get(&quot;usercard&quot;)); !m &#123;    return false&#125;&#x2F;&#x2F;验证18位身份证，18位前17位为数字，最后一位是校验位，可能为数字或字符X。if m, _ :&#x3D; regexp.MatchString(&#96;^(\d&#123;17&#125;)([0-9]|X)$&#96;, r.Form.Get(&quot;usercard&quot;)); !m &#123;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-3-预防跨站脚本"><a href="#4-3-预防跨站脚本" class="headerlink" title="4.3 预防跨站脚本"></a>4.3 预防跨站脚本</h2><p>cross-site-scripting （XSS）</p><p>攻击者通常会在有漏洞的程序中插入JavaScript、VBScript、 ActiveX或Flash以欺骗用户。一旦得手，他们可以盗取用户帐户信息，修改用户设置，盗取/污染cookie和植入恶意广告等。</p><p>对XSS最佳的防护应该结合以下两种方法：一是验证所有输入数据，有效检测攻击(这个我们前面小节已经有过介绍);另一个是对所有输出数据进行适当的处理，以防止任何已成功注入的脚本在浏览器端运行。</p><p>那么Go里面是怎么做这个有效防护的呢？Go的html/template里面带有下面几个函数可以帮你转义</p><ul><li>func HTMLEscape(w io.Writer, b []byte) //把b进行转义之后写到w</li><li>func HTMLEscapeString(s string) string //转义s之后返回结果字符串</li><li>func HTMLEscaper(args …interface{}) string //支持多个参数一起转义，返回结果字符串</li></ul><p>我们看4.1小节的例子</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(&quot;username:&quot;, template.HTMLEscapeString(r.Form.Get(&quot;username&quot;))) &#x2F;&#x2F;输出到服务器端fmt.Println(&quot;password:&quot;, template.HTMLEscapeString(r.Form.Get(&quot;password&quot;)))template.HTMLEscape(w, []byte(r.Form.Get(&quot;username&quot;))) &#x2F;&#x2F;输出到客户端<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果我们输入的username是<code>&lt;script&gt;alert()&lt;/script&gt;</code>,那么我们可以在浏览器上面看到输出如下所示：</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/4.3.escape.png?raw=true" alt="img"></p><p>图4.3 Javascript过滤之后的输出</p><p>Go的html/template包默认帮你过滤了html标签，但是有时候你只想要输出这个<code>&lt;script&gt;alert()&lt;/script&gt;</code>看起来正常的信息，该怎么处理？请使用text/template。请看下面的例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;text&#x2F;template&quot;...t, err :&#x3D; template.New(&quot;foo&quot;).Parse(&#96;&#123;&#123;define &quot;T&quot;&#125;&#125;Hello, &#123;&#123;.&#125;&#125;!&#123;&#123;end&#125;&#125;&#96;)err &#x3D; t.ExecuteTemplate(out, &quot;T&quot;, &quot;&lt;script&gt;alert(&#39;you have been pwned&#39;)&lt;&#x2F;script&gt;&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">Hello, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'you have been pwned'</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者使用template.HTML类型</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;html&#x2F;template&quot;...t, err :&#x3D; template.New(&quot;foo&quot;).Parse(&#96;&#123;&#123;define &quot;T&quot;&#125;&#125;Hello, &#123;&#123;.&#125;&#125;!&#123;&#123;end&#125;&#125;&#96;)err &#x3D; t.ExecuteTemplate(out, &quot;T&quot;, template.HTML(&quot;&lt;script&gt;alert(&#39;you have been pwned&#39;)&lt;&#x2F;script&gt;&quot;))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">Hello, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'you have been pwned'</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>转换成<code>template.HTML</code>后，变量的内容也不会被转义</p><h2 id="4-4-防止多次递交表单"><a href="#4-4-防止多次递交表单" class="headerlink" title="4.4 防止多次递交表单"></a>4.4 防止多次递交表单</h2><p>解决方案是在表单中添加一个带有唯一值的隐藏字段。在验证表单时，先检查带有该惟一值的表单是否已经递交过了。如果是，拒绝再次递交；如果不是，则处理表单进行逻辑处理。另外，如果是采用了Ajax模式递交表单的话，当表单递交后，通过javascript来禁用表单的递交按钮。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>token<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123;.&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>登陆<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>隐藏字段<code>token</code>，这个值我们通过MD5(时间戳)来获取惟一值，然后我们把这个值存储到服务器端(session来控制，</strong>我们将在第六章讲解如何保存)，以方便表单提交时比对判定。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func login(w http.ResponseWriter, r *http.Request) &#123;    fmt.Println(&quot;method:&quot;, r.Method) &#x2F;&#x2F;获取请求的方法    if r.Method &#x3D;&#x3D; &quot;GET&quot; &#123;        crutime :&#x3D; time.Now().Unix()        h :&#x3D; md5.New()        io.WriteString(h, strconv.FormatInt(crutime, 10))        token :&#x3D; fmt.Sprintf(&quot;%x&quot;, h.Sum(nil))        t, _ :&#x3D; template.ParseFiles(&quot;login.gtpl&quot;)        t.Execute(w, token)    &#125; else &#123;        &#x2F;&#x2F;请求的是登陆数据，那么执行登陆的逻辑判断        r.ParseForm()        token :&#x3D; r.Form.Get(&quot;token&quot;)        if token !&#x3D; &quot;&quot; &#123;            &#x2F;&#x2F;验证token的合法性        &#125; else &#123;            &#x2F;&#x2F;不存在token报错        &#125;        fmt.Println(&quot;username length:&quot;, len(r.Form[&quot;username&quot;][0]))        fmt.Println(&quot;username:&quot;, template.HTMLEscapeString(r.Form.Get(&quot;username&quot;))) &#x2F;&#x2F;输出到服务器端        fmt.Println(&quot;password:&quot;, template.HTMLEscapeString(r.Form.Get(&quot;password&quot;)))        template.HTMLEscape(w, []byte(r.Form.Get(&quot;username&quot;))) &#x2F;&#x2F;输出到客户端    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码输出到页面的源码如下：</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/4.4.token.png?raw=true" alt="img"></p><p>图4.4 增加token之后在客户端输出的源码信息</p><p>每次刷新这个token的value都会变化。这样就保证了每次显示Form表单的时候都是唯一的，用户递交的表单保持了唯一性</p><p>我们的解决方案可以防止非恶意的攻击，并能使恶意用户暂时不知所措，然后，它却不能排除所有的欺骗性的动机，对此类情况还需要更复杂的工作</p><h2 id="4-5-处理文件上传"><a href="#4-5-处理文件上传" class="headerlink" title="4.5 处理文件上传"></a>4.5 处理文件上传</h2><p>要使表单能够上传文件，首先第一步就是要添加form的<code>enctype</code>属性，<code>enctype</code>属性有如下三种情况:</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">application&#x2F;x-www-form-urlencoded   表示在发送前编码所有字符（默认）multipart&#x2F;form-data      不对字符编码。在使用包含文件上传控件的表单时，必须使用该值。text&#x2F;plain      空格转换为 &quot;+&quot; 加号，但不对特殊字符编码。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>所以，表单的html代码应该类似于:</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://127.0.0.1:9090/upload<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadfile<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>token<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123;.&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在服务器端，我们增加一个handlerFunc:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">http.HandleFunc(&quot;&#x2F;upload&quot;, upload)&#x2F;&#x2F; 处理&#x2F;upload 逻辑func upload(w http.ResponseWriter, r *http.Request) &#123;    fmt.Println(&quot;method:&quot;, r.Method) &#x2F;&#x2F;获取请求的方法    if r.Method &#x3D;&#x3D; &quot;GET&quot; &#123;        crutime :&#x3D; time.Now().Unix()        h :&#x3D; md5.New()        io.WriteString(h, strconv.FormatInt(crutime, 10))        token :&#x3D; fmt.Sprintf(&quot;%x&quot;, h.Sum(nil))        t, _ :&#x3D; template.ParseFiles(&quot;upload.gtpl&quot;)        t.Execute(w, token)    &#125; else &#123;        r.ParseMultipartForm(32 &lt;&lt; 20)        file, handler, err :&#x3D; r.FormFile(&quot;uploadfile&quot;)        if err !&#x3D; nil &#123;            fmt.Println(err)            return        &#125;        defer file.Close()        fmt.Fprintf(w, &quot;%v&quot;, handler.Header)        f, err :&#x3D; os.OpenFile(&quot;.&#x2F;test&#x2F;&quot;+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)        if err !&#x3D; nil &#123;            fmt.Println(err)            return        &#125;        defer f.Close()        io.Copy(f, file)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面的代码可以看到，处理文件上传我们需要调用<code>r.ParseMultipartForm</code>，里面的参数表示<code>maxMemory</code>，调用<code>ParseMultipartForm</code>之后，上传的文件存储在<code>maxMemory</code>大小的内存里面，如果文件大小超过了<code>maxMemory</code>，那么剩下的部分将存储在系统的临时文件中。我们可以通过<code>r.FormFile</code>获取上面的文件句柄，然后实例中使用了<code>io.Copy</code>来存储文件。</p><blockquote><p>获取其他非文件字段信息的时候就不需要调用<code>r.ParseForm</code>，因为在需要的时候Go自动会去调用。而且<code>ParseMultipartForm</code>调用一次之后，后面再次调用不会再有效果。</p></blockquote><p>通过上面的实例我们可以看到我们上传文件主要三步处理：</p><ol><li>表单中增加enctype=”multipart/form-data”</li><li>服务端调用<code>r.ParseMultipartForm</code>,把上传的文件存储在内存和临时文件中</li><li>使用<code>r.FormFile</code>获取文件句柄，然后对文件进行存储等处理。</li></ol><p>文件handler是multipart.FileHeader,里面存储了如下结构信息</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type FileHeader struct &#123;    Filename string    Header   textproto.MIMEHeader    &#x2F;&#x2F; contains filtered or unexported fields&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面的实例代码打印出来上传文件的信息如下</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/4.5.upload2.png?raw=true" alt="img"></p><p>图4.5 打印文件上传后服务器端接受的信息</p><h3 id="客户端上传文件"><a href="#客户端上传文件" class="headerlink" title="客户端上传文件"></a>客户端上传文件</h3><p>我们上面的例子演示了如何通过表单上传文件，然后在服务器端处理文件，其实Go支持模拟客户端表单功能支持文件上传，详细用法请看如下示例：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;bytes&quot;    &quot;fmt&quot;    &quot;io&quot;    &quot;io&#x2F;ioutil&quot;    &quot;mime&#x2F;multipart&quot;    &quot;net&#x2F;http&quot;    &quot;os&quot;)func postFile(filename string, targetUrl string) error &#123;    bodyBuf :&#x3D; &amp;bytes.Buffer&#123;&#125;    bodyWriter :&#x3D; multipart.NewWriter(bodyBuf)    &#x2F;&#x2F;关键的一步操作    fileWriter, err :&#x3D; bodyWriter.CreateFormFile(&quot;uploadfile&quot;, filename)    if err !&#x3D; nil &#123;        fmt.Println(&quot;error writing to buffer&quot;)        return err    &#125;    &#x2F;&#x2F;打开文件句柄操作    fh, err :&#x3D; os.Open(filename)    if err !&#x3D; nil &#123;        fmt.Println(&quot;error opening file&quot;)        return err    &#125;    defer fh.Close()    &#x2F;&#x2F;iocopy    _, err &#x3D; io.Copy(fileWriter, fh)    if err !&#x3D; nil &#123;        return err    &#125;    contentType :&#x3D; bodyWriter.FormDataContentType()    bodyWriter.Close()    resp, err :&#x3D; http.Post(targetUrl, contentType, bodyBuf)    if err !&#x3D; nil &#123;        return err    &#125;    defer resp.Body.Close()    resp_body, err :&#x3D; ioutil.ReadAll(resp.Body)    if err !&#x3D; nil &#123;        return err    &#125;    fmt.Println(resp.Status)    fmt.Println(string(resp_body))    return nil&#125;&#x2F;&#x2F; sample usagefunc main() &#123;    target_url :&#x3D; &quot;http:&#x2F;&#x2F;localhost:9090&#x2F;upload&quot;    filename :&#x3D; &quot;.&#x2F;astaxie.pdf&quot;    postFile(filename, target_url)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的例子详细展示了客户端如何向服务器上传一个文件的例子，客户端通过multipart.Write把文件的文本流写入一个缓存中，然后调用http的Post方法把缓存传到服务器。</p><blockquote><p>如果你还有其他普通字段例如username之类的需要同时写入，那么可以调用multipart的WriteField方法写很多其他类似的字段。</p></blockquote><h1 id="5-访问数据库"><a href="#5-访问数据库" class="headerlink" title="5 访问数据库"></a>5 访问数据库</h1><p>Go没有内置的驱动支持任何的数据库，但是Go定义了database/sql接口，用户可以基于驱动接口开发相应数据库的驱动，5.1小节里面介绍Go设计的一些驱动，介绍Go是如何设计数据库驱动接口的。5.2至5.4小节介绍目前使用的比较多的一些关系型数据驱动以及如何使用，5.5小节介绍我自己开发一个ORM库，基于database/sql标准接口开发的，可以兼容几乎所有支持database/sql的数据库驱动，可以方便的使用Go style来进行数据库操作。</p><p>目前NOSQL已经成为Web开发的一个潮流，很多应用采用了NOSQL作为数据库，而不是以前的缓存，5.6小节将介绍MongoDB和Redis两种NOSQL数据库。</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/navi5.png?raw=true" alt="img"></p><h2 id="5-1-database-sql接口"><a href="#5-1-database-sql接口" class="headerlink" title="5.1 database/sql接口"></a>5.1 database/sql接口</h2><p>开发者可以根据定义的接口来开发相应的数据库驱动，这样做有一个好处，只要是按照标准接口开发的代码， 以后需要迁移数据库时，不需要任何修改。</p><h3 id="SQL-Register"><a href="#SQL-Register" class="headerlink" title="SQL.Register"></a>SQL.Register</h3><p>这个存在于database/sql的函数是用来注册数据库驱动的，当第三方开发者开发数据库驱动时，都会实现init函数，在init里面会调用这个<code>Register(name string, driver driver.Driver)</code>完成本驱动的注册。</p><p>我们来看一下mymysql、sqlite3的驱动里面都是怎么调用的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F;https:&#x2F;&#x2F;github.com&#x2F;mattn&#x2F;go-sqlite3驱动func init() &#123;    sql.Register(&quot;sqlite3&quot;, &amp;SQLiteDriver&#123;&#125;)&#125;&#x2F;&#x2F;https:&#x2F;&#x2F;github.com&#x2F;mikespook&#x2F;mymysql驱动&#x2F;&#x2F; Driver automatically registered in database&#x2F;sqlvar d &#x3D; Driver&#123;proto: &quot;tcp&quot;, raddr: &quot;127.0.0.1:3306&quot;&#125;func init() &#123;    Register(&quot;SET NAMES utf8&quot;)    sql.Register(&quot;mymysql&quot;, &amp;d)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们看到第三方数据库驱动都是通过调用这个函数来注册自己的数据库驱动名称以及相应的driver实现。在database/sql内部通过一个map来存储用户定义的相应驱动。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var drivers &#x3D; make(map[string]driver.Driver)drivers[name] &#x3D; driver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>因此通过database/sql的注册函数可以同时注册多个数据库驱动，只要不重复。</p><blockquote><p>在我们使用database/sql接口和第三方库的时候经常看到如下:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;database&#x2F;sql&quot;     _ &quot;github.com&#x2F;mattn&#x2F;go-sqlite3&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>新手都会被这个<code>_</code>所迷惑，其实这个就是Go设计的巧妙之处，我们在变量赋值的时候经常看到这个符号，它是用来忽略变量赋值的占位符，那么包引入用到这个符号也是相似的作用，这儿使用<code>_</code>的意思是引入后面的包名而不直接使用这个包中定义的函数，变量等资源。</p><p>包在引入的时候会自动调用包的init函数以完成对包的初始化。因此，我们引入上面的数据库驱动包之后会自动去调用init函数，然后在init函数里面注册这个数据库驱动，这样我们就可以在接下来的代码中直接使用这个数据库驱动了。</p></blockquote><h3 id="driver-Driver"><a href="#driver-Driver" class="headerlink" title="driver.Driver"></a>driver.Driver</h3><p>Driver是一个数据库驱动的接口，他定义了一个method： Open(name string)，这个方法返回一个数据库的Conn接口。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Driver interface &#123;    Open(name string) (Conn, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>返回的Conn只能用来进行一次goroutine的操作，也就是说不能把这个Conn应用于Go的多个goroutine里面。如下代码会出现错误</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">...go goroutineA (Conn)  &#x2F;&#x2F;执行查询操作go goroutineB (Conn)  &#x2F;&#x2F;执行插入操作...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面这样的代码可能会使Go不知道某个操作究竟是由哪个goroutine发起的,从而导致数据混乱，比如可能会把goroutineA里面执行的查询操作的结果返回给goroutineB从而使B错误地把此结果当成自己执行的插入数据。</p><p>第三方驱动都会定义这个函数，它会解析name参数来获取相关数据库的连接信息，解析完成后，它将使用此信息来初始化一个Conn并返回它。</p><h3 id="driver-Conn"><a href="#driver-Conn" class="headerlink" title="driver.Conn"></a>driver.Conn</h3><p>Conn是一个数据库连接的接口定义，他定义了一系列方法，这个Conn只能应用在一个goroutine里面，不能使用在多个goroutine里面，</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Conn interface &#123;    Prepare(query string) (Stmt, error)    Close() error    Begin() (Tx, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Prepare函数返回与当前连接相关的执行Sql语句的准备状态，可以进行查询、删除等操作。</p><p>Close函数关闭当前的连接，执行释放连接拥有的资源等清理工作。因为驱动实现了database/sql里面建议的conn pool，所以你不用再去实现缓存conn之类的，这样会容易引起问题。</p><p>Begin函数返回一个代表事务处理的Tx，通过它你可以进行查询,更新等操作，或者对事务进行回滚、递交。</p><h3 id="driver-Stmt"><a href="#driver-Stmt" class="headerlink" title="driver.Stmt"></a>driver.Stmt</h3><p>Stmt是一种准备好的状态，和Conn相关联，而且只能应用于一个goroutine中，不能应用于多个goroutine。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Stmt interface &#123;    Close() error    NumInput() int    Exec(args []Value) (Result, error)    Query(args []Value) (Rows, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Close函数关闭当前的链接状态，但是如果当前正在执行query，query还是有效返回rows数据。</p><p>NumInput函数返回当前预留参数的个数，当返回&gt;=0时数据库驱动就会智能检查调用者的参数。当数据库驱动包不知道预留参数的时候，返回-1。</p><p>Exec函数执行Prepare准备好的sql，传入参数执行update/insert等操作，返回Result数据</p><p>Query函数执行Prepare准备好的sql，传入需要的参数执行select操作，返回Rows结果集</p><h3 id="Driver-Tx"><a href="#Driver-Tx" class="headerlink" title="Driver.Tx"></a>Driver.Tx</h3><p>事务处理一般就两个过程，递交或者回滚。数据库驱动里面也只需要实现这两个函数就可以</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Tx interface &#123;    Commit() error    Rollback() error&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这两个函数一个用来递交一个事务，一个用来回滚事务。</p><h3 id="driver-Execer"><a href="#driver-Execer" class="headerlink" title="driver.Execer"></a>driver.Execer</h3><p>这是一个Conn可选择实现的接口</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Execer interface &#123;    Exec(query string, args []Value) (Result, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果这个接口没有定义，那么在调用DB.Exec,就会首先调用Prepare返回Stmt，然后执行Stmt的Exec，然后关闭Stmt。</p><h3 id="driver-Result"><a href="#driver-Result" class="headerlink" title="driver.Result"></a>driver.Result</h3><p>这个是执行Update/Insert等操作返回的结果接口定义</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Result interface &#123;    LastInsertId() (int64, error)    RowsAffected() (int64, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>LastInsertId函数返回由数据库执行插入操作得到的自增ID号。</p><p>RowsAffected函数返回query操作影响的数据条目数。</p><h3 id="driver-Rows"><a href="#driver-Rows" class="headerlink" title="driver.Rows"></a>driver.Rows</h3><p>Rows是执行查询返回的结果集接口定义</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Rows interface &#123;    Columns() []string    Close() error    Next(dest []Value) error&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Columns函数返回查询数据库表的字段信息，这个返回的slice和sql查询的字段一一对应，而不是返回整个表的所有字段。</p><p>Close函数用来关闭Rows迭代器。</p><p>Next函数用来返回下一条数据，把数据赋值给dest。dest里面的元素必须是driver.Value的值除了string，返回的数据里面所有的string都必须要转换成[]byte。如果最后没数据了，Next函数最后返回io.EOF。</p><p>……..</p><h2 id="5-2-使用MySQL数据库"><a href="#5-2-使用MySQL数据库" class="headerlink" title="5.2 使用MySQL数据库"></a>5.2 使用MySQL数据库</h2><p>目前Internet上流行的网站构架方式是LAMP，其中的M即MySQL,</p><h3 id="MySQL驱动"><a href="#MySQL驱动" class="headerlink" title="MySQL驱动"></a>MySQL驱动</h3><p>通过上面的代码我们可以看出，Go操作Mysql数据库是很方便的。</p><p>关键的几个函数我解释一下：</p><p>sql.Open()函数用来打开一个注册过的数据库驱动，go-sql-driver中注册了mysql这个数据库驱动，第二个参数是DSN(Data Source Name)，它是go-sql-driver定义的一些数据库链接和配置信息。它支持如下格式：</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">[email protected](&#x2F;path&#x2F;to&#x2F;socket)&#x2F;dbname?charset&#x3D;utf8user:[email protected](localhost:5555)&#x2F;dbname?charset&#x3D;utf8user:[email protected]&#x2F;dbnameuser:[email protected]([de:ad:be:ef::ca:fe]:80)&#x2F;dbname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>db.Prepare()函数用来返回准备要执行的sql操作，然后返回准备完毕的执行状态。</p><p>db.Query()函数用来直接执行Sql返回Rows结果。</p><p>stmt.Exec()函数用来执行stmt准备好的SQL语句</p><p>我们可以看到我们传入的参数都是=?对应的数据，这样做的方式可以一定程度上防止SQL注入。</p><h2 id="5-3-使用SQLite数据库"><a href="#5-3-使用SQLite数据库" class="headerlink" title="5.3 使用SQLite数据库"></a>5.3 使用SQLite数据库</h2><p>SQLite 是一个开源的嵌入式关系数据库，实现自包容、零配置、支持事务的SQL数据库引擎。其特点是高度便携、使用方便、结构紧凑、高效、可靠。 与其他数据库管理系统不同，SQLite 的安装和运行非常简单，在大多数情况下,只要确保SQLite的二进制文件存在即可开始创建、连接和使用数据库。如果您正在寻找一个嵌入式数据库项目或解决方案，SQLite是绝对值得考虑。SQLite可以是说开源的Access</p><h2 id="5-4-使用PostgreSQL数据库"><a href="#5-4-使用PostgreSQL数据库" class="headerlink" title="5.4 使用PostgreSQL数据库"></a>5.4 使用PostgreSQL数据库</h2><p>PostgreSQL 是一个自由的对象-关系数据库服务器(数据库管理系统)，它在灵活的 BSD-风格许可证下发行。它提供了相对其他开放源代码数据库系统(比如 MySQL 和 Firebird)，和对专有系统比如 Oracle、Sybase、IBM 的 DB2 和 Microsoft SQL Server的一种选择。</p><p>PostgreSQL和MySQL比较，它更加庞大一点，因为它是用来替代Oracle而设计的。所以在企业应用中采用PostgreSQL是一个明智的选择。</p><p>MySQL被Oracle收购之后正在逐步的封闭（自MySQL 5.5.31以后的所有版本将不再遵循GPL协议），鉴于此，将来我们也许会选择PostgreSQL而不是MySQL作为项目的后端数据库。</p><h2 id="5-5-使用beedb库进行ORM开发"><a href="#5-5-使用beedb库进行ORM开发" class="headerlink" title="5.5 使用beedb库进行ORM开发"></a>5.5 使用beedb库进行ORM开发</h2><p>beedb是我开发的一个Go进行ORM操作的库，它采用了Go style方式对数据库进行操作，实现了struct到数据表记录的映射。beedb是一个十分轻量级的Go ORM框架，开发这个库的本意降低复杂的ORM学习曲线，尽可能在ORM的运行效率和功能之间寻求一个平衡，beedb是目前开源的Go ORM框架中实现比较完整的一个库，而且运行效率相当不错，功能也基本能满足需求。但是目前还不支持关系关联，这个是接下来版本升级的重点。</p><h2 id="5-6-NOSQL数据库操作"><a href="#5-6-NOSQL数据库操作" class="headerlink" title="5.6 NOSQL数据库操作"></a>5.6 NOSQL数据库操作</h2><p>NoSQL(Not Only SQL)，指的是非关系型的数据库。随着Web2.0的兴起，传统的关系数据库在应付Web2.0网站，特别是超大规模和高并发的SNS类型的Web2.0纯动态网站已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。</p><p>而Go语言作为21世纪的C语言，对NOSQL的支持也是很好，目前流行的NOSQL主要有redis、mongoDB、Cassandra和Membase等。这些数据库都有高性能、高并发读写等特点，目前已经广泛应用于各种应用中。我接下来主要讲解一下redis和mongoDB的操作。</p><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p>redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)和zset(有序集合)。</p><p>目前应用redis最广泛的应该是新浪微博平台，其次还有Facebook收购的图片社交网站instagram。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;github.com&#x2F;astaxie&#x2F;goredis&quot;    &quot;fmt&quot;)func main() &#123;    var client goredis.Client    &#x2F;&#x2F; 设置端口为redis默认端口    client.Addr &#x3D; &quot;127.0.0.1:6379&quot;    &#x2F;&#x2F;字符串操作    client.Set(&quot;a&quot;, []byte(&quot;hello&quot;))    val, _ :&#x3D; client.Get(&quot;a&quot;)    fmt.Println(string(val))    client.Del(&quot;a&quot;)    &#x2F;&#x2F;list操作    vals :&#x3D; []string&#123;&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;&#125;    for _, v :&#x3D; range vals &#123;        client.Rpush(&quot;l&quot;, []byte(v))    &#125;    dbvals,_ :&#x3D; client.Lrange(&quot;l&quot;, 0, 4)    for i, v :&#x3D; range dbvals &#123;        println(i,&quot;:&quot;,string(v))    &#125;    client.Del(&quot;l&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以看到操作redis非常的方便，而且我实际项目中应用下来性能也很高。client的命令和redis的命令基本保持一致。所以和原生态操作redis非常类似。</p><h3 id="mongoDB"><a href="#mongoDB" class="headerlink" title="mongoDB"></a>mongoDB</h3><p>MongoDB是一个高性能，开源，无模式的文档型数据库，是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，采用的是类似json的bjson格式来存储数据，因此可以存储比较复杂的数据类型。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</p><p>下图展示了mysql和mongoDB之间的对应关系，我们可以看出来非常的方便，但是mongoDB的性能非常好。</p><p> <img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/5.6.mongodb.png?raw=true" alt="img"></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;labix.org&#x2F;v2&#x2F;mgo&quot;    &quot;labix.org&#x2F;v2&#x2F;mgo&#x2F;bson&quot;)type Person struct &#123;    Name string    Phone string&#125;func main() &#123;    session, err :&#x3D; mgo.Dial(&quot;server1.example.com,server2.example.com&quot;)    if err !&#x3D; nil &#123;        panic(err)    &#125;    defer session.Close()    session.SetMode(mgo.Monotonic, true)    c :&#x3D; session.DB(&quot;test&quot;).C(&quot;people&quot;)    err &#x3D; c.Insert(&amp;Person&#123;&quot;Ale&quot;, &quot;+55 53 8116 9639&quot;&#125;,        &amp;Person&#123;&quot;Cla&quot;, &quot;+55 53 8402 8510&quot;&#125;)    if err !&#x3D; nil &#123;        panic(err)    &#125;    result :&#x3D; Person&#123;&#125;    err &#x3D; c.Find(bson.M&#123;&quot;name&quot;: &quot;Ale&quot;&#125;).One(&amp;result)    if err !&#x3D; nil &#123;        panic(err)    &#125;    fmt.Println(&quot;Phone:&quot;, result.Phone)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以看出来mgo的操作方式和beedb的操作方式几乎类似，都是基于struct的操作方式，这个就是Go Style。</p><h1 id="6-session和数据存储"><a href="#6-session和数据存储" class="headerlink" title="6 session和数据存储"></a>6 session和数据存储</h1><p>Web开发中一个很重要的议题就是如何做好用户的整个浏览过程的控制，因为HTTP协议是无状态的，所以用户的每一次请求都是无状态的，我们不知道在整个Web操作过程中哪些连接与该用户有关，我们应该如何来解决这个问题呢？Web里面经典的解决方案是cookie和session，cookie机制是一种客户端机制，把用户数据保存在客户端，而session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构来保存信息，每一个网站访客都会被分配给一个唯一的标志符,即sessionID,它的存放形式无非两种:要么经过url传递,要么保存在客户端的cookies里.当然,你也可以将Session保存到数据库里,这样会更安全,但效率方面会有所下降。</p><p>6.1小节里面讲介绍session机制和cookie机制的关系和区别，6.2讲解Go语言如何来实现session，里面讲实现一个简易的session管理器，6.3小节讲解如何防止session被劫持的情况，如何有效的保护session。我们知道session其实可以存储在任何地方，6.3小节里面实现的session是存储在内存中的，但是如果我们的应用进一步扩展了，要实现应用的session共享，那么我们可以把session存储在数据库中(memcache或者redis)，6.4小节将详细的讲解如何实现这些功能。</p><h2 id="6-1-Session-amp-amp-Cookie"><a href="#6-1-Session-amp-amp-Cookie" class="headerlink" title="6.1 Session&amp;&amp;Cookie"></a>6.1 Session&amp;&amp;Cookie</h2><p>当用户来到微博登陆页面，输入用户名和密码之后点击“登录”后浏览器将认证信息POST给远端的服务器，服务器执行验证逻辑，如果验证通过，则浏览器会跳转到登录用户的微博首页，在登录成功后，服务器如何验证我们对其他受限制页面的访问呢？因为HTTP协议是无状态的，所以很显然服务器不可能知道我们已经在上一次的HTTP请求中通过了验证。当然，最简单的解决方案就是所有的请求里面都带上用户名和密码，这样虽然可行，但大大加重了服务器的负担（对于每个request都需要到数据库验证），也大大降低了用户体验(每个页面都需要重新输入用户名密码，每个页面都带有登录表单)。既然直接在请求中带上用户名与密码不可行，那么就只有在服务器或客户端保存一些类似的可以代表身份的信息了，所以就有了cookie与session。</p><p>cookie，简而言之就是在本地计算机保存一些用户操作的历史信息（当然包括登录信息），并在用户再次访问该站点时浏览器通过HTTP协议将本地cookie内容发送给服务器，从而完成验证，或继续上一步操作。</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.1.cookie2.png?raw=true" alt="img"></p><p>session，简而言之就是在服务器上保存用户操作的历史信息。服务器使用session id来标识session，session id由服务器负责产生，保证随机性与唯一性，相当于一个随机密钥，避免在握手或传输中暴露用户真实密码。但该方式下，仍然需要将发送请求的客户端与session进行对应，所以可以借助cookie机制来获取客户端的标识（即session id），也可以通过GET方式将id提交给服务器。</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.1.session.png?raw=true" alt="img"></p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookie是由浏览器维持的，存储在客户端的一小段文本信息，伴随着用户请求和页面在Web服务器和浏览器之间传递。用户每次访问站点时，Web应用程序都可以读取cookie包含的信息。浏览器设置里面有cookie隐私数据选项，打开它，可以看到很多已访问网站的cookies，</p><p>cookie是有时间限制的，根据生命期不同分成两种：会话cookie和持久cookie；</p><p>如果不设置过期时间，则表示这个cookie生命周期为从创建到浏览器关闭止，只要关闭浏览器窗口，cookie就消失了。这种生命期为浏览会话期的cookie被称为会话cookie。会话cookie一般不保存在硬盘上而是保存在内存里。</p><p>如果设置了过期时间(setMaxAge(60<em>60</em>24))，浏览器就会把cookie保存到硬盘上，关闭后再次打开浏览器，这些cookie依然有效直到超过设定的过期时间。存储在硬盘上的cookie可以在不同的浏览器进程间共享，比如两个IE窗口。而对于保存在内存的cookie，不同的浏览器有不同的处理方式</p><p>Go语言中通过net/http包中的SetCookie来设置：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">http.SetCookie(w ResponseWriter, cookie *Cookie)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>w表示需要写入的response，cookie是一个struct，让我们来看一下cookie对象是怎么样的</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Cookie struct &#123;    Name       string    Value      string    Path       string    Domain     string    Expires    time.Time    RawExpires string&#x2F;&#x2F; MaxAge&#x3D;0 means no &#39;Max-Age&#39; attribute specified.&#x2F;&#x2F; MaxAge&lt;0 means delete cookie now, equivalently &#39;Max-Age: 0&#39;&#x2F;&#x2F; MaxAge&gt;0 means Max-Age attribute present and given in seconds    MaxAge   int    Secure   bool    HttpOnly bool    Raw      string    Unparsed []string &#x2F;&#x2F; Raw text of unparsed attribute-value pairs&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们来看一个例子，如何设置cookie</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">expiration :&#x3D; time.Now()expiration &#x3D; expiration.AddDate(1, 0, 0)cookie :&#x3D; http.Cookie&#123;Name: &quot;username&quot;, Value: &quot;astaxie&quot;, Expires: expiration&#125;http.SetCookie(w, &amp;cookie)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>　　</p><h4 id="Go读取cookie"><a href="#Go读取cookie" class="headerlink" title="Go读取cookie"></a>Go读取cookie</h4><p>上面的例子演示了如何设置cookie数据，我们这里来演示一下如何读取cookie</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">cookie, _ :&#x3D; r.Cookie(&quot;username&quot;)fmt.Fprint(w, cookie)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>还有另外一种读取方式 </p><pre class="line-numbers language-go" data-language="go"><code class="language-go">for _, cookie :&#x3D; range r.Cookies() &#123;    fmt.Fprint(w, cookie.Name)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可以看到通过request获取cookie非常方便。</p><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>当session一词与网络协议相关联时，它又往往隐含了“面向连接”和/或“保持状态”这样两个含义。</p><p>session在Web开发环境下的语义又有了新的扩展，它的含义是指一类用来在客户端与服务器端之间保持状态的解决方案。有时候Session也用来指这种解决方案的存储结构。</p><p>session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构(也可能就是使用散列表)来保存信息。</p><p>但程序需要为某个客户端的请求创建一个session的时候，服务器首先检查这个客户端的请求里是否包含了一个session标识－称为session id，如果已经包含一个session id则说明以前已经为此客户创建过session，服务器就按照session id把这个session检索出来使用(如果检索不到，可能会新建一个，这种情况可能出现在服务端已经删除了该用户对应的session对象，但用户人为地在请求的URL后面附加上一个JSESSION的参数)。如果客户请求不包含session id，则为此客户创建一个session并且同时生成一个与此session相关联的session id，这个session id将在本次响应中返回给客户端保存。</p><p>session机制本身并不复杂，然而其实现和配置上的灵活性却使得具体情况复杂多变。这也要求我们不能把仅仅某一次的经验或者某一个浏览器，服务器的经验当作普遍适用的</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>session和cookie的目的相同，都是为了克服http协议无状态的缺陷，但完成的方法不同。session通过cookie，在客户端保存session id，而将用户的其他会话消息保存在服务端的session对象中，与此相对的，cookie需要将所有信息都保存在客户端。因此cookie存在着一定的安全隐患，例如本地cookie中保存的用户名密码被破译，或cookie被其他网站收集（例如：1. appA主动设置域B cookie，让域B cookie获取；2. XSS，在appA上通过javascript获取document.cookie，并传递给自己的appB）。</p><h2 id="6-2-Go语言如何使用Session"><a href="#6-2-Go语言如何使用Session" class="headerlink" title="6.2 Go语言如何使用Session"></a>6.2 Go语言如何使用Session</h2><p>目前Go标准包没有为session提供任何支持，这小节我们将会自己动手来实现go版本的session管理和创建。</p><h3 id="Session创建过程"><a href="#Session创建过程" class="headerlink" title="Session创建过程"></a>Session创建过程</h3><p>ession的基本原理是由服务器为每个会话维护一份信息数据，客户端和服务端依靠一个全局唯一的标识来访问这份数据，以达到交互的目的。当用户访问Web应用时，服务端程序会随需要创建session，这个过程可以概括为三个步骤：</p><ul><li>生成全局唯一标识符（sessionid）；</li><li>开辟数据存储空间。一般会在内存中创建相应的数据结构，但这种情况下，系统一旦掉电，所有的会话数据就会丢失，如果是电子商务类网站，这将造成严重的后果。所以为了解决这类问题，你可以将会话数据写到文件里或存储在数据库中，当然这样会增加I/O开销，但是它可以实现某种程度的session持久化，也更有利于session的共享；</li><li>将session的全局唯一标示符发送给客户端。</li></ul><p>以上三个步骤中，最关键的是如何发送这个session的唯一标识这一步上。考虑到HTTP协议的定义，数据无非可以放到请求行、头域或Body里，所以一般来说会有两种常用的方式：cookie和URL重写。</p><ol><li>Cookie 服务端通过设置Set-cookie头就可以将session的标识符传送到客户端，而客户端此后的每一次请求都会带上这个标识符，另外一般包含session信息的cookie会将失效时间设置为0(会话cookie)，即浏览器进程有效时间。至于浏览器怎么处理这个0，每个浏览器都有自己的方案，但差别都不会太大(一般体现在新建浏览器窗口的时候)；</li><li>URL重写 所谓URL重写，就是在返回给用户的页面里的所有的URL后面追加session标识符，这样用户在收到响应之后，无论点击响应页面里的哪个链接或提交表单，都会自动带上session标识符，从而就实现了会话的保持。虽然这种做法比较麻烦，但是，如果客户端禁用了cookie的话，此种方案将会是首选。</li></ol><h3 id="Go实现session管理"><a href="#Go实现session管理" class="headerlink" title="Go实现session管理"></a>Go实现session管理</h3><p>下面我们将结合session的生命周期（lifecycle），来实现go语言版本的session管理。</p><h4 id="Session管理设计"><a href="#Session管理设计" class="headerlink" title="Session管理设计"></a>Session管理设计</h4><p>session管理涉及到如下几个因素</p><ul><li>全局session管理器</li><li>保证sessionid 的全局唯一性</li><li>为每个客户关联一个session</li><li>session 的存储(可以存储到内存、文件、数据库等)</li><li>session 过期处理</li></ul><p>有过Web开发经验的读者知道，对Session的处理基本就 设置值、读取值、删除值以及获取当前sessionID这四个操作，所以我们的Session接口也就实现这四个操作。</p><p><strong>这里有些代码跑不了（推测是修改了goroutine的部分），这本书是14年的用的go1.4，我在22年使用的是Go1.18，因此我决定从这里开始这本书就略读了，以后再用别的方式学习go web吧，有时候看书确实不如看视频合适，交互反馈太少了。其实这个属于我自己的判断错误，应该早点发现的！</strong></p><h2 id="6-4-预防session劫持"><a href="#6-4-预防session劫持" class="headerlink" title="6.4 预防session劫持"></a>6.4 预防session劫持</h2><p>session劫持是一种广泛存在的比较严重的安全威胁，在session技术中，客户端和服务端通过session的标识符来维护会话， 但这个标识符很容易就能被嗅探到，从而被其他人利用.它是中间人攻击的一种类型。</p><p>本节将通过一个实例来演示会话劫持，希望通过这个实例，能让读者更好地理解session的本质。</p><h3 id="session劫持过程"><a href="#session劫持过程" class="headerlink" title="session劫持过程"></a>session劫持过程</h3><p>我们写了如下的代码来展示一个count计数器：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func count(w http.ResponseWriter, r *http.Request) &#123;    sess :&#x3D; globalSessions.SessionStart(w, r)    ct :&#x3D; sess.Get(&quot;countnum&quot;)    if ct &#x3D;&#x3D; nil &#123;        sess.Set(&quot;countnum&quot;, 1)    &#125; else &#123;        sess.Set(&quot;countnum&quot;, (ct.(int) + 1))    &#125;    t, _ :&#x3D; template.ParseFiles(&quot;count.gtpl&quot;)    w.Header().Set(&quot;Content-Type&quot;, &quot;text&#x2F;html&quot;)    t.Execute(w, sess.Get(&quot;countnum&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>count.gtpl的代码如下所示：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">Hi. Now count:&#123;&#123;.&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后我们在浏览器里面刷新可以看到如下内容：</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.4.hijack.png?raw=true" alt="img"></p><p>图6.4 浏览器端显示count数</p><p>随着刷新，数字将不断增长，当数字显示为6的时候，打开浏览器(以chrome为例）的cookie管理器，可以看到类似如下的信息：</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.4.cookie.png?raw=true" alt="img"></p><p>图6.5 获取浏览器端保存的cookie</p><p>下面这个步骤最为关键: 打开另一个浏览器(这里我打开了firefox浏览器),复制chrome地址栏里的地址到新打开的浏览器的地址栏中。然后打开firefox的cookie模拟插件，新建一个cookie，把按上图中cookie内容原样在firefox中重建一份:</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.4.setcookie.png?raw=true" alt="img"></p><p>图6.6 模拟cookie</p><p>回车后，你将看到如下内容：</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/6.4.hijacksuccess.png?raw=true" alt="img"></p><p>图6.7 劫持session成功</p><p>可以看到虽然换了浏览器，但是我们却获得了sessionID，然后模拟了cookie存储的过程。这个例子是在同一台计算机上做的，不过即使换用两台来做，其结果仍然一样。此时如果交替点击两个浏览器里的链接你会发现它们其实操纵的是同一个计数器。不必惊讶，此处firefox盗用了chrome和goserver之间的维持会话的钥匙，即gosessionid，这是一种类型的“会话劫持”。在goserver看来，它从http请求中得到了一个gosessionid，由于HTTP协议的无状态性，它无法得知这个gosessionid是从chrome那里“劫持”来的，它依然会去查找对应的session，并执行相关计算。与此同时 chrome也无法得知自己保持的会话已经被“劫持”</p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><h2 id="7-4-模板处理"><a href="#7-4-模板处理" class="headerlink" title="7.4 模板处理"></a>7.4 模板处理</h2><p>在Go语言中，我们使用<code>template</code>包来进行模板处理，使用类似<code>Parse</code>、<code>ParseFile</code>、<code>Execute</code>等方法从文件或者字符串加载模板，然后执行类似上面图片展示的模板的merge操作。请看下面的例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func handler(w http.ResponseWriter, r *http.Request) &#123;    t :&#x3D; template.New(&quot;some template&quot;) &#x2F;&#x2F;创建一个模板    t, _ &#x3D; t.ParseFiles(&quot;tmpl&#x2F;welcome.html&quot;, nil)  &#x2F;&#x2F;解析模板文件    user :&#x3D; GetUser() &#x2F;&#x2F;获取当前用户信息    t.Execute(w, user)  &#x2F;&#x2F;执行模板的merger操作&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面的例子我们可以看到Go语言的模板操作非常的简单方便，和其他语言的模板处理类似，都是先获取数据，然后渲染数据。</p><p>为了演示和测试代码的方便，我们在接下来的例子中采用如下格式的代码</p><ul><li>使用Parse代替ParseFiles，因为Parse可以直接测试一个字符串，而不需要额外的文件</li><li>不使用handler来写演示代码，而是每个测试一个main，方便测试</li><li>使用<code>os.Stdout</code>代替<code>http.ResponseWriter</code>，因为<code>os.Stdout</code>实现了<code>io.Writer</code>接口</li></ul><h3 id="字段操作"><a href="#字段操作" class="headerlink" title="字段操作"></a>字段操作</h3><p>Go语言的模板通过<code>&#123;&#123;&#125;&#125;`来包含需要在渲染时被替换的字段，`&#123;&#123;.&#125;&#125;</code>表示当前的对象，这和Java或者C++中的this类似，如果要访问当前对象的字段通过<code>&#123;&#123;.FieldName&#125;&#125;</code>,但是需要注意一点：这个字段必须是导出的(字段首字母必须是大写的),否则在渲染的时候就会报错</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;html&#x2F;template&quot;    &quot;os&quot;)type Person struct &#123;    UserName string&#125;func main() &#123;    t :&#x3D; template.New(&quot;fieldname example&quot;)    t, _ &#x3D; t.Parse(&quot;hello &#123;&#123;.UserName&#125;&#125;!&quot;)    p :&#x3D; Person&#123;UserName: &quot;Astaxie&quot;&#125;    t.Execute(os.Stdout, p)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="输出嵌套字段内容"><a href="#输出嵌套字段内容" class="headerlink" title="输出嵌套字段内容"></a>输出嵌套字段内容</h3><p>上面我们例子展示了如何针对一个对象的字段输出，那么如果字段里面还有对象，如何来循环的输出这些内容呢？我们可以使用<code>&#123;&#123;with …&#125;&#125;…&#123;&#123;end&#125;&#125;</code>和<code>&#123;&#123;range …&#125;&#125;&#123;&#123;end&#125;&#125;</code>来进行数据的输出。</p><ul><li>function range(start, stop, step) {      if (typeof stop === 'undefined') {        stop = start;        start = 0;        step = 1;      } else if (!step) {        step = 1;      }      var arr = [];      if (step > 0) {        for (var i = start; i < stop; i += step) {          arr.push(i);        }      } else {        for (var _i = start; _i > stop; _i += step) {          // eslint-disable-line for-direction          arr.push(_i);        }      }      return arr;    } 这个和Go语法里面的range类似，循环操作数据</li><li>操作是指当前对象的值，类似上下文的概念</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;html&#x2F;template&quot;    &quot;os&quot;)type Friend struct &#123;    Fname string&#125;type Person struct &#123;    UserName string    Emails   []string    Friends  []*Friend&#125;func main() &#123;    f1 :&#x3D; Friend&#123;Fname: &quot;minux.ma&quot;&#125;    f2 :&#x3D; Friend&#123;Fname: &quot;xushiwei&quot;&#125;    t :&#x3D; template.New(&quot;fieldname example&quot;)    t, _ &#x3D; t.Parse(&#96;hello &#123;&#123;.UserName&#125;&#125;!            &#123;&#123;range .Emails&#125;&#125;                an email &#123;&#123;.&#125;&#125;            &#123;&#123;end&#125;&#125;            &#123;&#123;with .Friends&#125;&#125;            &#123;&#123;range .&#125;&#125;                my friend name is &#123;&#123;.Fname&#125;&#125;            &#123;&#123;end&#125;&#125;            &#123;&#123;end&#125;&#125;            &#96;)    p :&#x3D; Person&#123;UserName: &quot;Astaxie&quot;,        Emails:  []string&#123;&quot;astaxie@beego.me&quot;, &quot;astaxie@gmail.com&quot;&#125;,        Friends: []*Friend&#123;&amp;f1, &amp;f2&#125;&#125;    t.Execute(os.Stdout, p)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="条件处理"><a href="#条件处理" class="headerlink" title="条件处理"></a>条件处理</h3><p>在Go模板里面如果需要进行条件判断，那么我们可以使用和Go语言的<code>if-else</code>语法类似的方式来处理，如果pipeline为空，那么if就认为是false，下面的例子展示了如何使用<code>if-else</code>语法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;os&quot;    &quot;text&#x2F;template&quot;)func main() &#123;    tEmpty :&#x3D; template.New(&quot;template test&quot;)    tEmpty &#x3D; template.Must(tEmpty.Parse(&quot;空 pipeline if demo: &#123;&#123;if &#96;&#96;&#125;&#125; 不会输出. &#123;&#123;end&#125;&#125;\n&quot;))    tEmpty.Execute(os.Stdout, nil)    tWithValue :&#x3D; template.New(&quot;template test&quot;)    tWithValue &#x3D; template.Must(tWithValue.Parse(&quot;不为空的 pipeline if demo: &#123;&#123;if &#96;anything&#96;&#125;&#125; 我有内容，我会输出. &#123;&#123;end&#125;&#125;\n&quot;))    tWithValue.Execute(os.Stdout, nil)    tIfElse :&#x3D; template.New(&quot;template test&quot;)    tIfElse &#x3D; template.Must(tIfElse.Parse(&quot;if-else demo: &#123;&#123;if &#96;anything&#96;&#125;&#125; if部分 &#123;&#123;else&#125;&#125; else部分.&#123;&#123;end&#125;&#125;\n&quot;))    tIfElse.Execute(os.Stdout, nil)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面的演示代码我们知道<code>if-else</code>语法相当的简单，在使用过程中很容易集成到我们的模板代码中。</p><blockquote><p>注意：if里面无法使用条件判断，例如.Mail==”astaxie@gmail.com”，这样的判断是不正确的，if里面只能是bool值</p></blockquote><h3 id="pipelines"><a href="#pipelines" class="headerlink" title="pipelines"></a>pipelines</h3><p>Unix用户已经很熟悉什么是<code>pipe</code>了，<code>ls | grep &quot;beego&quot;</code>类似这样的语法你是不是经常使用，过滤当前目录下面的文件，显示含有”beego”的数据，表达的意思就是前面的输出可以当做后面的输入，最后显示我们想要的数据，而Go语言模板最强大的一点就是支持pipe数据，在Go语言里面任何<code>&#123;&#123;&#125;&#125;</code>里面的都是pipelines数据，例如我们上面输出的email里面如果还有一些可能引起XSS注入的，那么我们如何来进行转化呢？</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">&#123;&#123;. | html&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在email输出的地方我们可以采用如上方式可以把输出全部转化html的实体，上面的这种方式和我们平常写Unix的方式是不是一模一样，操作起来相当的简便，调用其他的函数也是类似的方式。</p><h3 id="模板函数"><a href="#模板函数" class="headerlink" title="模板函数"></a>模板函数</h3><p>模板在输出对象的字段值时，采用了<code>fmt</code>包把对象转化成了字符串。但是有时候我们的需求可能不是这样的，例如有时候我们为了防止垃圾邮件发送者通过采集网页的方式来发送给我们的邮箱信息，我们希望把<code>@</code>替换成<code>at</code>例如：<code>astaxie at beego.me</code>，如果要实现这样的功能，我们就需要自定义函数来做这个功能。</p><p>每一个模板函数都有一个唯一值的名字，然后与一个Go函数关联，通过如下的方式来关联</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type FuncMap map[string]interface&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>例如，如果我们想要的email函数的模板函数名是<code>emailDeal</code>，它关联的Go函数名称是<code>EmailDealWith</code>,那么我们可以通过下面的方式来注册这个函数</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">t &#x3D; t.Funcs(template.FuncMap&#123;&quot;emailDeal&quot;: EmailDealWith&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>EmailDealWith</code>这个函数的参数和返回值定义如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func EmailDealWith(args …interface&#123;&#125;) string<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们来看下面的实现例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;html&#x2F;template&quot;    &quot;os&quot;    &quot;strings&quot;)type Friend struct &#123;    Fname string&#125;type Person struct &#123;    UserName string    Emails   []string    Friends  []*Friend&#125;func EmailDealWith(args ...interface&#123;&#125;) string &#123;    ok :&#x3D; false    var s string    if len(args) &#x3D;&#x3D; 1 &#123;        s, ok &#x3D; args[0].(string)    &#125;    if !ok &#123;        s &#x3D; fmt.Sprint(args...)    &#125;    &#x2F;&#x2F; find the @ symbol    substrs :&#x3D; strings.Split(s, &quot;@&quot;)    if len(substrs) !&#x3D; 2 &#123;        return s    &#125;    &#x2F;&#x2F; replace the @ by &quot; at &quot;    return (substrs[0] + &quot; at &quot; + substrs[1])&#125;func main() &#123;    f1 :&#x3D; Friend&#123;Fname: &quot;minux.ma&quot;&#125;    f2 :&#x3D; Friend&#123;Fname: &quot;xushiwei&quot;&#125;    t :&#x3D; template.New(&quot;fieldname example&quot;)    t &#x3D; t.Funcs(template.FuncMap&#123;&quot;emailDeal&quot;: EmailDealWith&#125;)    t, _ &#x3D; t.Parse(&#96;hello &#123;&#123;.UserName&#125;&#125;!                &#123;&#123;range .Emails&#125;&#125;                    an emails &#123;&#123;.|emailDeal&#125;&#125;                &#123;&#123;end&#125;&#125;                &#123;&#123;with .Friends&#125;&#125;                &#123;&#123;range .&#125;&#125;                    my friend name is &#123;&#123;.Fname&#125;&#125;                &#123;&#123;end&#125;&#125;                &#123;&#123;end&#125;&#125;                &#96;)    p :&#x3D; Person&#123;UserName: &quot;Astaxie&quot;,        Emails:  []string&#123;&quot;astaxie@beego.me&quot;, &quot;astaxie@gmail.com&quot;&#125;,        Friends: []*Friend&#123;&amp;f1, &amp;f2&#125;&#125;    t.Execute(os.Stdout, p)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面演示了如何自定义函数，其实，在模板包内部已经有内置的实现函数，下面代码截取自模板包里面</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var builtins &#x3D; FuncMap&#123;    &quot;and&quot;:      and,    &quot;call&quot;:     call,    &quot;html&quot;:     HTMLEscaper,    &quot;index&quot;:    index,    &quot;js&quot;:       JSEscaper,    &quot;len&quot;:      length,    &quot;not&quot;:      not,    &quot;or&quot;:       or,    &quot;print&quot;:    fmt.Sprint,    &quot;printf&quot;:   fmt.Sprintf,    &quot;println&quot;:  fmt.Sprintln,    &quot;urlquery&quot;: URLQueryEscaper,&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Must操作"><a href="#Must操作" class="headerlink" title="Must操作"></a>Must操作</h2><p>模板包里面有一个函数<code>Must</code>，它的作用是检测模板是否正确，例如大括号是否匹配，注释是否正确的关闭，变量是否正确的书写。接下来我们演示一个例子，用Must来判断模板是否正确：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;text&#x2F;template&quot;)func main() &#123;    tOk :&#x3D; template.New(&quot;first&quot;)    template.Must(tOk.Parse(&quot; some static text &#x2F;* and a comment *&#x2F;&quot;))    fmt.Println(&quot;The first one parsed OK.&quot;)    template.Must(template.New(&quot;second&quot;).Parse(&quot;some static text &#123;&#123; .Name &#125;&#125;&quot;))    fmt.Println(&quot;The second one parsed OK.&quot;)    fmt.Println(&quot;The next one ought to fail.&quot;)    tErr :&#x3D; template.New(&quot;check parse error with Must&quot;)    template.Must(tErr.Parse(&quot; some static text &#123;&#123; .Name &#125;&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>讲输出如下内容</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">The first one parsed OK.The second one parsed OK.The next one ought to fail.panic: template: check parse error with Must:1: unexpected &quot;&#125;&quot; in command<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="8-Web服务"><a href="#8-Web服务" class="headerlink" title="8 Web服务"></a>8 Web服务</h1><p>Web服务背后的关键在于平台的无关性，你可以运行你的服务在Linux系统，可以与其他Windows的asp.net程序交互，同样的，也可以通过同一个接口和运行在FreeBSD上面的JSP无障碍地通信。</p><p>目前主流的有如下几种Web服务：REST、SOAP。</p><p>REST请求是很直观的，因为REST是基于HTTP协议的一个补充，他的每一次请求都是一个HTTP请求，然后根据不同的method来处理不同的逻辑，很多Web开发者都熟悉HTTP协议，所以学习REST是一件比较容易的事情。所以我们在8.3小节讲详细的讲解如何在Go语言中来实现REST方式。</p><p>SOAP是W3C在跨网络信息传递和远程计算机函数调用方面的一个标准。但是SOAP非常复杂，其完整的规范篇幅很长，而且内容仍然在增加。Go语言是以简单著称，所以我们不会介绍SOAP这样复杂的东西。而Go语言提供了一种天生性能很不错，开发起来很方便的RPC机制，我们将会在8.4小节详细介绍如何使用Go语言来实现RPC。</p><h2 id="8-3-REST"><a href="#8-3-REST" class="headerlink" title="8.3 REST"></a>8.3 REST</h2><p>RESTful，是目前最为流行的一种互联网软件架构。因为它结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用。</p><p>REST就是根据不同的method访问同一个资源的时候实现不同的逻辑处理。</p><h1 id="9-安全与加密"><a href="#9-安全与加密" class="headerlink" title="9 安全与加密"></a>9 安全与加密</h1><p>很多Web应用程序中的安全问题都是由于轻信了第三方提供的数据造成的。比如对于用户的输入数据，在对其进行验证之前都应该将其视为不安全的数据。如果直接把这些不安全的数据输出到客户端，就可能造成跨站脚本攻击(XSS)的问题。如果把不安全的数据用于数据库查询，那么就可能造成SQL注入问题，</p><p>在使用第三方提供的数据，包括用户提供的数据时，首先检验这些数据的合法性非常重要，这个过程叫做过滤，我们将在9.2小节介绍如何保证对所有输入的数据进行过滤处理。</p><p>过滤输入和转义输出并不能解决所有的安全问题，我们将会在9.1讲解的CSRF攻击，会导致受骗者发送攻击者指定的请求从而造成一些破坏。</p><p>与安全加密相关的，能够增强我们的Web应用程序的强大手段就是加密，CSDN泄密事件就是因为密码保存的是明文，使得攻击拿手库之后就可以直接实施一些破坏行为了。不过，和其他工具一样，加密手段也必须运用得当。我们将在9.5小节介绍如何存储密码，如何让密码存储的安全。</p><p>加密的本质就是扰乱数据，某些不可恢复的数据扰乱我们称为单向加密或者散列算法。另外还有一种双向加密方式，也就是可以对加密后的数据进行解密。我们将会在9.6小节介绍如何实现这种双向加密方式。</p><h2 id="9-1-预防CSRF攻击"><a href="#9-1-预防CSRF攻击" class="headerlink" title="9.1 预防CSRF攻击"></a>9.1 预防CSRF攻击</h2><h3 id="什么是CSRF"><a href="#什么是CSRF" class="headerlink" title="什么是CSRF"></a>什么是CSRF</h3><p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p><p>那么CSRF到底能够干嘛呢？你可以这样简单的理解：攻击者可以盗用你的登陆信息，以你的身份模拟发送各种请求。攻击者只要借助少许的社会工程学的诡计，例如通过QQ等聊天软件发送的链接(有些还伪装成短域名，用户无法分辨)，攻击者就能迫使Web应用的用户去执行攻击者预设的操作。例如，当用户登录网络银行去查看其存款余额，在他没有退出时，就点击了一个QQ好友发来的链接，那么该用户银行帐户中的资金就有可能被转移到攻击者指定的帐户中。</p><p>所以遇到CSRF攻击时，将对终端用户的数据和操作指令构成严重的威胁；当受攻击的终端用户具有管理员帐户的时候，CSRF攻击将危及整个Web应用程序。</p><h3 id="CSRF的原理"><a href="#CSRF的原理" class="headerlink" title="CSRF的原理"></a>CSRF的原理</h3><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/9.1.csrf.png?raw=true" alt="img"></p><p>从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤 ：</p><ul><li>1.登录受信任网站A，并在本地生成Cookie 。</li><li>2.在不退出A的情况下，访问危险网站B。</li></ul><p>读者也许会问：“如果我不满足以上两个条件中的任意一个，就不会受到CSRF的攻击”。是的，确实如此，但你不能保证以下情况不会发生：</p><ul><li>你不能保证你登录了一个网站后，不再打开一个tab页面并访问另外的网站，特别现在浏览器都是支持多tab的。</li><li>你不能保证你关闭浏览器了后，你本地的Cookie立刻过期，你上次的会话已经结束。</li><li>上图中所谓的攻击网站，可能是一个存在其他漏洞的可信任的经常被人访问的网站。</li></ul><p>CSRF攻击主要是因为Web的隐式身份验证机制，Web的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的。</p><h3 id="如何预防CSRF"><a href="#如何预防CSRF" class="headerlink" title="如何预防CSRF"></a>如何预防CSRF</h3><p>CSRF的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p><p>服务端的预防CSRF攻击的方式方法有多种，但思想上都是差不多的，主要从以下2个方面入手：</p><ul><li>1、正确使用GET,POST和Cookie；</li><li>2、在非GET请求中增加伪随机数；</li></ul><p>一般而言，普通的Web应用都是以GET、POST为主，还有一种请求是Cookie方式。我们一般都是按照如下方式设计应用：</p><p>1、GET常用在查看，列举，展示等不需要改变资源属性的时候；</p><p>2、POST常用在下达订单，改变一个资源的属性或者做其他一些事情；</p><h2 id="9-4-避免SQL注入"><a href="#9-4-避免SQL注入" class="headerlink" title="9.4 避免SQL注入"></a>9.4 避免SQL注入</h2><h3 id="什么是SQL注入"><a href="#什么是SQL注入" class="headerlink" title="什么是SQL注入"></a>什么是SQL注入</h3><p>SQL注入攻击（SQL Injection），简称注入攻击，是Web开发中最常见的一种安全漏洞。可以用它来从数据库获取敏感信息，或者利用数据库的特性执行添加用户，导出文件等一系列恶意操作，甚至有可能获取数据库乃至系统用户最高权限。</p><p>而造成SQL注入的原因是因为程序没有有效过滤用户的输入，使攻击者成功的向服务器提交恶意的SQL查询代码，程序在接收后错误的将攻击者的输入作为查询语句的一部分执行，导致原始的查询逻辑被改变，额外的执行了攻击者精心构造的恶意代码。</p><h3 id="SQL注入实例"><a href="#SQL注入实例" class="headerlink" title="SQL注入实例"></a>SQL注入实例</h3><p>很多Web开发者没有意识到SQL查询是可以被篡改的，从而把SQL查询当作可信任的命令。殊不知，SQL查询是可以绕开访问控制，从而绕过身份验证和权限检查的。更有甚者，有可能通过SQL查询去运行主机系统级的命令。</p><p>下面将通过一些真实的例子来详细讲解SQL注入的方式。</p><p>考虑以下简单的登录表单：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Username: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>登陆<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们的处理里面的SQL可能是这样的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">username:&#x3D;r.Form.Get(&quot;username&quot;)password:&#x3D;r.Form.Get(&quot;password&quot;)sql:&#x3D;&quot;SELECT * FROM user WHERE username&#x3D;&#39;&quot;+username+&quot;&#39; AND password&#x3D;&#39;&quot;+password+&quot;&#39;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果用户的输入的用户名如下，密码任意</p><blockquote><p>myuser’ or ‘foo’ = ‘foo’ —</p></blockquote><p>那么我们的SQL变成了如下所示：</p><blockquote><p>SELECT *<br>FROM user<br>WHERE username = ‘myuser’ or ‘foo’==’foo’ —‘’ AND password=’xxx’</p></blockquote><p>在SQL里面—是注释标记，所以查询语句会在此中断。这就让攻击者在不知道任何合法用户名和密码的情况下成功登录了。</p><p>PS：这行sql注入确实牛逼，hexo博客里的用来高亮代码的prismJs在这里报错了，查了很久才查出来，索性就在这句话里不用高亮了（狗头，看似半小时搞完，实则好几个月才解决掉）</p><h1 id="10-国际化与本地化"><a href="#10-国际化与本地化" class="headerlink" title="10 国际化与本地化"></a>10 国际化与本地化</h1><h2 id="10-1-设置默认地区"><a href="#10-1-设置默认地区" class="headerlink" title="10.1 设置默认地区"></a>10.1 设置默认地区</h2><p>Locale是一组描述世界上某一特定区域文本格式和语言习惯的设置的集合。locale名通常由三个部分组成：第一部分，是一个强制性的，表示语言的缩写，例如”en”表示英文或”zh”表示中文。第二部分，跟在一个下划线之后，是一个可选的国家说明符，用于区分讲同一种语言的不同国家，例如”en_US”表示美国英语，而”en_UK”表示英国英语。最后一部分，跟在一个句点之后，是可选的字符集说明符，例如”zh_CN.gb2312”表示中国使用gb2312字符集。</p><p>设置Locale的办法这一就是在应用运行的时候采用域名分级的方式，例如，我们采用www.asta.com当做我们的英文站(默认站)，而把域名www.asta.cn当做中文站。</p><p>但是我们一般开发Web应用的时候不会采用这种方式，因为首先域名成本比较高，开发一个Locale就需要一个域名，而且往往统一名称的域名不一定能申请的到，其次我们不愿意为每个站点去本地化一个配置，而更多的是采用url后面带参数的方式</p><h4 id="从域名参数设置Locale"><a href="#从域名参数设置Locale" class="headerlink" title="从域名参数设置Locale"></a>从域名参数设置Locale</h4><p>目前最常用的设置Locale的方式是在URL里面带上参数，例如www.asta.com/hello?locale=zh或者www.asta.com/zh/hello。这样我们就可以设置地区：<code>i18n.SetLocale(params[&quot;locale&quot;])</code></p><h3 id="本地化文本消息"><a href="#本地化文本消息" class="headerlink" title="本地化文本消息"></a>本地化文本消息</h3><p>本信息是编写Web应用中最常用到的，也是本地化资源中最多的信息，想要以适合本地语言的方式来显示文本信息，可行的一种方案是:建立需要的语言相应的map来维护一个key-value的关系，在输出之前按需从适合的map中去获取相应的文本，如下是一个简单的示例：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport &quot;fmt&quot;var locales map[string]map[string]stringfunc main() &#123;    locales &#x3D; make(map[string]map[string]string, 2)    en :&#x3D; make(map[string]string, 10)    en[&quot;pea&quot;] &#x3D; &quot;pea&quot;    en[&quot;bean&quot;] &#x3D; &quot;bean&quot;    locales[&quot;en&quot;] &#x3D; en    cn :&#x3D; make(map[string]string, 10)    cn[&quot;pea&quot;] &#x3D; &quot;豌豆&quot;    cn[&quot;bean&quot;] &#x3D; &quot;毛豆&quot;    locales[&quot;zh-CN&quot;] &#x3D; cn    lang :&#x3D; &quot;zh-CN&quot;    fmt.Println(msg(lang, &quot;pea&quot;))    fmt.Println(msg(lang, &quot;bean&quot;))&#125;func msg(locale, key string) string &#123;    if v, ok :&#x3D; locales[locale]; ok &#123;        if v2, ok :&#x3D; v[key]; ok &#123;            return v2        &#125;    &#125;    return &quot;&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="本地化视图和资源"><a href="#本地化视图和资源" class="headerlink" title="本地化视图和资源"></a>本地化视图和资源</h3><p>我们可能会根据Locale的不同来展示视图，这些视图包含不同的图片、css、js等各种静态资源。那么应如何来处理这些信息呢？首先我们应按locale来组织文件信息，请看下面的文件目录安排：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">views|--en  &#x2F;&#x2F;英文模板    |--images     &#x2F;&#x2F;存储图片信息    |--js         &#x2F;&#x2F;存储JS文件    |--css        &#x2F;&#x2F;存储css文件    index.tpl     &#x2F;&#x2F;用户首页    login.tpl     &#x2F;&#x2F;登陆首页|--zh-CN &#x2F;&#x2F;中文模板    |--images    |--js    |--css    index.tpl    login.tpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有了这个目录结构后我们就可以在渲染的地方这样来实现代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s1, _ :&#x3D; template.ParseFiles(&quot;views&quot;+lang+&quot;index.tpl&quot;)VV.Lang&#x3D;langs1.Execute(os.Stdout, VV)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>而对于里面的index.tpl里面的资源设置如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// js文件</span><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"views/&#123;&#123;.VV.Lang&#125;&#125;/js/jquery/jquery-1.8.0.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment">// css文件</span><span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"views/&#123;&#123;.VV.Lang&#125;&#125;/css/bootstrap-responsive.min.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span><span class="token comment">// 图片文件</span><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"views/&#123;&#123;.VV.Lang&#125;&#125;/images/btn.png"</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>采用这种方式来本地化视图以及资源时，我们就可以很容易的进行扩展了。</p><p>本小节介绍了如何使用及存储本地资源，有时需要通过转换函数来实现，有时通过lang来设置，但是最终都是通过key-value的方式来存储Locale对应的数据，在需要时取出相应于Locale的信息后，如果是文本信息就直接输出，如果是时间日期或者货币，则需要先通过<code>fmt.Printf</code>或其他格式化函数来处理，而对于不同Locale的视图和资源则是最简单的，只要在路径里面增加lang就可以实现了。</p><h2 id="10-3-国际化站点"><a href="#10-3-国际化站点" class="headerlink" title="10.3 国际化站点"></a>10.3 国际化站点</h2><h3 id="管理多个本地包"><a href="#管理多个本地包" class="headerlink" title="管理多个本地包"></a>管理多个本地包</h3><p>在开发一个应用的时候，首先我们要决定是只支持一种语言，还是多种语言，如果要支持多种语言，我们则需要制定一个组织结构，以方便将来更多语言的添加。在此我们设计如下：Locale有关的文件放置在config/locales下，假设你要支持中文和英文，那么你需要在这个文件夹下放置en.json和zh.json。大概的内容如下所示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># zh<span class="token punctuation">.</span>json<span class="token punctuation">&#123;</span><span class="token string">"zh"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"submit"</span><span class="token operator">:</span> <span class="token string">"提交"</span><span class="token punctuation">,</span>    <span class="token string">"create"</span><span class="token operator">:</span> <span class="token string">"创建"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>#en<span class="token punctuation">.</span>json<span class="token punctuation">&#123;</span><span class="token string">"en"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"submit"</span><span class="token operator">:</span> <span class="token string">"Submit"</span><span class="token punctuation">,</span>    <span class="token string">"create"</span><span class="token operator">:</span> <span class="token string">"Create"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了支持国际化，在此我们使用了一个国际化相关的包——<a href="https://github.com/astaxie/go-i18n">go-i18n</a>，首先我们向go-i18n包注册config/locales这个目录,以加载所有的locale文件</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">Tr:&#x3D;i18n.NewLocale()Tr.LoadPath(&quot;config&#x2F;locales&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="11-错误处理，调试和测试"><a href="#11-错误处理，调试和测试" class="headerlink" title="11 错误处理，调试和测试"></a>11 错误处理，调试和测试</h1><p>在C语言里面是通过返回-1或者NULL之类的信息来表示错误，但是对于使用者来说，不查看相应的API说明文档，根本搞不清楚这个返回值究竟代表什么意思，比如:返回0是成功，还是失败,而Go定义了一个叫做error的类型，来显式表达错误。在使用时，通过把返回的error变量与nil的比较，来判定操作是否成功</p><h2 id="11-2-使用GDB调试"><a href="#11-2-使用GDB调试" class="headerlink" title="11.2 使用GDB调试"></a>11.2 使用GDB调试</h2><p>开发程序过程中调试代码是开发者经常要做的一件事情，Go语言不像PHP、Python等动态语言，只要修改不需要编译就可以直接输出，而且可以动态的在运行环境下打印数据</p><h1 id="12-部署与维护"><a href="#12-部署与维护" class="headerlink" title="12 部署与维护"></a>12 部署与维护</h1><h1 id="13-如何设计一个WEB框架"><a href="#13-如何设计一个WEB框架" class="headerlink" title="13 如何设计一个WEB框架"></a>13 如何设计一个WEB框架</h1><h2 id="13-1-项目规划"><a href="#13-1-项目规划" class="headerlink" title="13.1 项目规划"></a>13.1 项目规划</h2><h2 id="应用程序流程图"><a href="#应用程序流程图" class="headerlink" title="应用程序流程图"></a>应用程序流程图</h2><p>博客系统是基于模型-视图-控制器这一设计模式的。MVC是一种将应用程序的逻辑层和表现层进行分离的结构方式。在实践中，由于表现层从Go中分离了出来，所以它允许你的网页中只包含很少的脚本。</p><ul><li>模型 (Model) 代表数据结构。通常来说，模型类将包含取出、插入、更新数据库资料等这些功能。</li><li>视图 (View) 是展示给用户的信息的结构及样式。一个视图通常是一个网页，但是在Go中，一个视图也可以是一个页面片段，如页头、页尾。它还可以是一个 RSS 页面，或其它类型的“页面”，Go实现的template包已经很好的实现了View层中的部分功能。</li><li>控制器 (Controller) 是模型、视图以及其他任何处理HTTP请求所必须的资源之间的中介，并生成网页。</li></ul><p>下图显示了项目设计中框架的数据流是如何贯穿整个系统:</p><p><img src="https://wizardforcel.gitbooks.io/build-web-application-with-golang/content/images/13.1.flow.png?raw=true" alt="img"></p><p>图13.3 框架的数据流</p><ol><li>main.go作为应用入口，初始化一些运行博客所需要的基本资源，配置信息，监听端口。</li><li>路由功能检查HTTP请求，根据URL以及method来确定谁(控制层)来处理请求的转发资源。</li><li>如果缓存文件存在，它将绕过通常的流程执行，被直接发送给浏览器。</li><li>安全检测：应用程序控制器调用之前，HTTP请求和任一用户提交的数据将被过滤。</li><li>控制器装载模型、核心库、辅助函数，以及任何处理特定请求所需的其它资源，控制器主要负责处理业务逻辑。</li><li>输出视图层中渲染好的即将发送到Web浏览器中的内容。如果开启缓存，视图首先被缓存，将用于以后的常规请求。</li></ol><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>根据上面的应用程序流程设计，博客的目录结构设计如下：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">|——main.go         入口文件|——conf            配置文件和处理模块|——controllers     控制器入口|——models          数据库处理模块|——utils           辅助函数库|——static          静态文件目录|——views           视图库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="框架设计"><a href="#框架设计" class="headerlink" title="框架设计"></a>框架设计</h3><p>为了实现博客的快速搭建，打算基于上面的流程设计开发一个最小化的框架，框架包括路由功能、支持REST的控制器、自动化的模板渲染，日志系统、配置管理等。</p><h2 id="13-2-自定义路由器设计"><a href="#13-2-自定义路由器设计" class="headerlink" title="13.2 自定义路由器设计"></a>13.2 自定义路由器设计</h2><p>Go默认的路由添加是通过函数<code>http.Handle</code>和<code>http.HandleFunc</code>等来添加，底层都是调用了<code>DefaultServeMux.Handle(pattern string, handler Handler)</code>,这个函数会把路由信息存储在一个map信息中<code>map[string]muxEntry</code></p><h2 id="13-3-controller设计"><a href="#13-3-controller设计" class="headerlink" title="13.3 controller设计"></a>13.3 controller设计</h2><h1 id="14-拓展Web框架"><a href="#14-拓展Web框架" class="headerlink" title="14 拓展Web框架"></a>14 拓展Web框架</h1><h2 id="14-1-静态文件支持"><a href="#14-1-静态文件支持" class="headerlink" title="14.1 静态文件支持"></a>14.1 静态文件支持</h2>]]></content>
    
    
    <summary type="html">《Go Web编程（谢）》阅读笔记，</summary>
    
    
    
    <category term="书摘" scheme="https://changqingaas.github.io/categories/%E4%B9%A6%E6%91%98/"/>
    
    
    <category term="Go" scheme="https://changqingaas.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>《Go语言高级编程》阅读笔记</title>
    <link href="https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/Go%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/"/>
    <id>https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/Go%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/</id>
    <published>2022-05-14T14:00:33.000Z</published>
    <updated>2022-10-24T03:54:49.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第一章-语言基础"><a href="#第一章-语言基础" class="headerlink" title="第一章 语言基础"></a>第一章 语言基础</h1><h2 id="1-1-Go语言创世纪"><a href="#1-1-Go语言创世纪" class="headerlink" title="1.1 Go语言创世纪"></a>1.1 Go语言创世纪</h2><p>Go语言是对C语言最彻底的一次扬弃，不仅仅是语法和C语言有着很多差异，最重要的是舍弃了C语言中灵活但是危险的指针运算。而且，Go语言还重新设计了C语言中部分不太合理运算符的优先级，并在很多细微的地方都做了必要的打磨和改变。</p><h2 id="1-5-面向并发的内存模型"><a href="#1-5-面向并发的内存模型" class="headerlink" title="1.5 面向并发的内存模型"></a>1.5 面向并发的内存模型</h2><p>在早期，CPU都是以单核的形式顺序执行机器指令。Go语言的祖先C语言正是这种顺序编程语言的代表。顺序编程语言中的顺序是指：所有的指令都是以串行的方式执行，在相同的时刻有且仅有一个CPU在顺序执行程序的指令。</p><p>Go语言正是在多核和网络化的时代背景下诞生的原生支持并发的编程语言。</p><p>常见的并行编程有多种模型，主要有多线程、消息传递等。从理论上来看，多线程和基于消息的并发编程是等价的。由于多线程并发模型可以自然对应到多核的处理器，主流的操作系统因此也都提供了系统级的多线程支持，同时从概念上讲多线程似乎也更直观，因此多线程编程模型逐步被吸纳到主流的编程语言特性或语言扩展库中。而主流编程语言对基于消息的并发编程模型支持则相比较少，Go语言是基于消息并发模型的集大成者，它将基于CSP模型的并发编程内置到了语言中，通过一个go关键字就可以轻易地启动一个Goroutine，与Erlang不同的是Go语言的Goroutine之间是共享内存的。</p><h3 id="1-5-1-Goroutine和系统线程"><a href="#1-5-1-Goroutine和系统线程" class="headerlink" title="1.5.1 Goroutine和系统线程"></a>1.5.1 Goroutine和系统线程</h3><p>Goroutine是Go语言特有的并发体，是一种轻量级的线程，由go关键字启动。在真实的Go语言的实现中，goroutine和系统线程也不是等价的。尽管两者的区别实际上只是一个量的区别，但正是这个量变引发了Go语言并发编程质的飞跃。</p><p>首先，每个系统级线程都会有一个固定大小的栈（一般默认可能是2MB），这个栈主要用来保存函数递归调用时参数和局部变量。固定了栈的大小导致了两个问题：一是对于很多只需要很小的栈空间的线程来说是一个巨大的浪费，二是对于少数需要巨大栈空间的线程来说又面临栈溢出的风险。针对这两个问题的解决方案是：要么降低固定的栈大小，提升空间的利用率；要么增大栈的大小以允许更深的函数递归调用，但这两者是没法同时兼得的。相反，一个Goroutine会以一个很小的栈启动（可能是2KB或4KB），当遇到深度递归导致当前栈空间不足时，Goroutine会根据需要动态地伸缩栈的大小（主流实现中栈的最大值可达到1GB）。因为启动的代价很小，所以我们可以轻易地启动成千上万个Goroutine。</p><p>Go的运行时还包含了其自己的调度器，这个调度器使用了一些技术手段，可以在n个操作系统线程上多工调度m个Goroutine。Go调度器的工作和内核的调度是相似的，但是这个调度器只关注单独的Go程序中的Goroutine。Goroutine采用的是半抢占式的协作调度，只有在当前Goroutine发生阻塞时才会导致调度；同时发生在用户态，调度器会根据具体函数只保存必要的寄存器，切换的代价要比系统线程低得多。运行时有一个<code>runtime.GOMAXPROCS</code>变量，用于控制当前运行正常非阻塞Goroutine的系统线程数目。</p><h3 id="1-5-2-原子操作"><a href="#1-5-2-原子操作" class="headerlink" title="1.5.2 原子操作"></a>1.5.2 原子操作</h3><p>所谓的原子操作就是并发编程中“最小的且不可并行化”的操作。通常，如果多个并发体对同一个共享资源进行的操作是原子的话，那么同一时刻最多只能有一个并发体对该资源进行操作。从线程角度看，在当前线程修改共享资源期间，其它的线程是不能访问该资源的。原子操作对于多线程并发编程模型来说，不会发生有别于单线程的意外情况，共享资源的完整性可以得到保证。</p><p>一般情况下，原子操作都是通过“互斥”访问来保证的，通常由特殊的CPU指令提供保护。当然，如果仅仅是想模拟下粗粒度的原子操作，我们可以借助于<code>sync.Mutex</code>来实现</p><p>用互斥锁来保护一个数值型的共享资源，麻烦且效率低下。标准库的<code>sync/atomic</code>包对原子操作提供了丰富的支持</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;sync&quot;    &quot;sync&#x2F;atomic&quot;)var total uint64func worker(wg *sync.WaitGroup) &#123;    defer wg.Done()    var i uint64    for i &#x3D; 0; i &lt;&#x3D; 100; i++ &#123;        atomic.AddUint64(&amp;total, i)        &#x2F;&#x2F; 但是atomic包下没有sub的操作，支持的操作有限    &#125;&#125;func main() &#123;    var wg sync.WaitGroup    wg.Add(2)    go worker(&amp;wg)    go worker(&amp;wg)    wg.Wait()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>原子操作配合互斥锁可以实现非常高效的单件模式。互斥锁的代价比普通整数的原子读写高很多，在性能敏感的地方可以增加一个数字型的标志位，通过原子检测标志位状态降低互斥锁的使用次数来提高性能。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type singleton struct &#123;&#125;var (    instance    *singleton    initialized uint32    mu          sync.Mutex)func Instance() *singleton &#123;    if atomic.LoadUint32(&amp;initialized) &#x3D;&#x3D; 1 &#123;        return instance    &#125;    mu.Lock()    defer mu.Unlock()    if instance &#x3D;&#x3D; nil &#123;        defer atomic.StoreUint32(&amp;initialized, 1)        instance &#x3D; &amp;singleton&#123;&#125;    &#125;    return instance&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以将通用的代码提取出来，就成了标准库中<code>sync.Once</code>的实现：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Once struct &#123;    m    Mutex    done uint32&#125;func (o *Once) Do(f func()) &#123;    if atomic.LoadUint32(&amp;o.done) &#x3D;&#x3D; 1 &#123;        return    &#125;    o.m.Lock()    defer o.m.Unlock()    if o.done &#x3D;&#x3D; 0 &#123;        defer atomic.StoreUint32(&amp;o.done, 1)        f()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>基于<code>sync.Once</code>重新实现单件模式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var (    instance *singleton    once     sync.Once)func Instance() *singleton &#123;    once.Do(func() &#123;        instance &#x3D; &amp;singleton&#123;&#125;    &#125;)    return instance&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>sync/atomic</code>包对基本的数值类型及复杂对象的读写都提供了原子操作的支持。<code>atomic.Value</code>原子对象提供了<code>Load</code>和<code>Store</code>两个原子方法，分别用于加载和保存数据，返回值和参数都是<code>interface&#123;&#125;</code>类型，因此可以用于任意的自定义复杂类型。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var config atomic.Value &#x2F;&#x2F; 保存当前配置信息&#x2F;&#x2F; 初始化配置信息config.Store(loadConfig())&#x2F;&#x2F; 启动一个后台线程, 加载更新后的配置信息go func() &#123;    for &#123;        time.Sleep(time.Second)        config.Store(loadConfig())    &#125;&#125;()&#x2F;&#x2F; 用于处理请求的工作者线程始终采用最新的配置信息for i :&#x3D; 0; i &lt; 10; i++ &#123;    go func() &#123;        for r :&#x3D; range requests() &#123;            c :&#x3D; config.Load()            &#x2F;&#x2F; ...        &#125;    &#125;()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是一个简化的生产者消费者模型：后台线程生成最新的配置信息；前台多个工作者线程获取最新的配置信息。所有线程共享配置信息资源。</p><h3 id="1-5-3-顺序一致性内存模型"><a href="#1-5-3-顺序一致性内存模型" class="headerlink" title="1.5.3 顺序一致性内存模型"></a>1.5.3 顺序一致性内存模型</h3><p>如果只是想简单地在线程之间进行数据同步的话，原子操作已经为编程人员提供了一些同步保障。不过这种保障有一个前提：顺序一致性的内存模型。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var a stringvar done boolfunc setup() &#123;    a &#x3D; &quot;hello, world&quot;    done &#x3D; true&#125;func main() &#123;    go setup()    for !done &#123;&#125;    print(a)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们创建了<code>setup</code>线程，用于对字符串<code>a</code>的初始化工作，初始化完成之后设置<code>done</code>标志为<code>true</code>。<code>main</code>函数所在的主线程中，通过<code>for !done &#123;&#125;</code>检测<code>done</code>变为<code>true</code>时，认为字符串初始化工作完成，然后进行字符串的打印工作。</p><p>但是Go语言并不保证在<code>main</code>函数中观测到的对<code>done</code>的写入操作发生在对字符串<code>a</code>的写入的操作之后，因此程序很可能打印一个空字符串。更糟糕的是，因为两个线程之间没有同步事件，<code>setup</code>线程对<code>done</code>的写入操作甚至无法被<code>main</code>线程看到，<code>main</code>函数有可能陷入死循环中。</p><p>在Go语言中，同一个Goroutine线程内部，顺序一致性内存模型是得到保证的。但是不同的Goroutine之间，并不满足顺序一致性内存模型，需要通过明确定义的同步事件来作为同步的参考。如果两个事件不可排序，那么就说这两个事件是并发的。为了最大化并行，Go语言的编译器和处理器在不影响上述规定的前提下可能会对执行语句重新排序（CPU也会对一些指令进行乱序执行）。</p><p>因此，如果在一个Goroutine中顺序执行<code>a = 1; b = 2;</code>两个语句，虽然在当前的Goroutine中可以认为<code>a = 1;</code>语句先于<code>b = 2;</code>语句执行，但是在另一个Goroutine中<code>b = 2;</code>语句可能会先于<code>a = 1;</code>语句执行，甚至在另一个Goroutine中无法看到它们的变化（可能始终在寄存器中）。也就是说在另一个Goroutine看来, <code>a = 1; b = 2;</code>两个语句的执行顺序是不确定的。如果一个并发程序无法确定事件的顺序关系，那么程序的运行结果往往会有不确定的结果。比如下面这个程序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    go println(&quot;你好, 世界&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>根据Go语言规范，<code>main</code>函数退出时程序结束，不会等待任何后台线程。因为Goroutine的执行和<code>main</code>函数的返回事件是并发的，谁都有可能先发生，所以什么时候打印，能否打印都是未知的。</p><p>用前面的原子操作并不能解决问题，因为我们无法确定两个原子操作之间的顺序。解决问题的办法就是通过同步原语来给两个事件明确排序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    done :&#x3D; make(chan int)    go func()&#123;        println(&quot;你好, 世界&quot;)        done &lt;- 1    &#125;()    &lt;-done&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-5-4-初始化顺序"><a href="#1-5-4-初始化顺序" class="headerlink" title="1.5.4 初始化顺序"></a>1.5.4 初始化顺序</h3><p><img src="https://chai2010.cn/advanced-go-programming-book/images/ch1-12-init.ditaa.png" alt="img"></p><p>（<code>init</code>不是普通函数，可以定义有多个，所以不能被其它函数调用）。</p><p>要注意的是，在<code>main.main</code>函数执行之前所有代码都运行在同一个Goroutine中，也是运行在程序的主系统线程中。如果某个<code>init</code>函数内部用go关键字启动了新的Goroutine的话，新的Goroutine和<code>main.main</code>函数是并发执行的。</p><p>因为所有的<code>init</code>函数和<code>main</code>函数都是在主线程完成，它们也是满足顺序一致性模型的。</p><h3 id="1-5-6-基于Channel的通信"><a href="#1-5-6-基于Channel的通信" class="headerlink" title="1.5.6 基于Channel的通信"></a>1.5.6 基于Channel的通信</h3><p>Channel通信是在Goroutine之间进行同步的主要方法。在无缓存的Channel上的每一次发送操作都有与其对应的接收操作相配对，发送和接收操作通常发生在不同的Goroutine上（在同一个Goroutine上执行2个操作很容易导致死锁。<strong>无缓存的Channel上的发送操作总在对应的接收操作完成前发生.</strong></p><p>若在关闭Channel后继续从中接收数据，接收者就会收到该Channel返回的零值。因此在这个例子中，用<code>close(c)</code>关闭管道代替<code>done &lt;- false</code>依然能保证该程序产生相同的行为。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var done &#x3D; make(chan bool)var msg stringfunc aGoroutine() &#123;    msg &#x3D; &quot;你好, 世界&quot;    close(done)&#125;func main() &#123;    go aGoroutine()    &lt;-done    println(msg)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>对于从无缓冲Channel进行的接收，发生在对该Channel进行的发送完成之前。</strong></p><p>基于上面这个规则可知，交换两个Goroutine中的接收和发送操作也是可以的（但是很危险）：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var done &#x3D; make(chan bool)var msg stringfunc aGoroutine() &#123;    msg &#x3D; &quot;hello, world&quot;    &lt;-done&#125;func main() &#123;    go aGoroutine()    done &lt;- true    println(msg)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可保证打印出“hello, world”。因为<code>main</code>线程中<code>done &lt;- true</code>发送完成前，后台线程<code>&lt;-done</code>接收已经开始，这保证<code>msg = &quot;hello, world&quot;</code>被执行了，所以之后<code>println(msg)</code>的msg已经被赋值过了。简而言之，后台线程首先对<code>msg</code>进行写入，然后从<code>done</code>中接收信号，随后<code>main</code>线程向<code>done</code>发送对应的信号，最后执行<code>println</code>函数完成。但是，若该Channel为带缓冲的（例如，<code>done = make(chan bool, 1)</code>），<code>main</code>线程的<code>done &lt;- true</code>接收操作将不会被后台线程的<code>&lt;-done</code>接收操作阻塞，该程序将无法保证打印出“hello, world”。</p><p>对于带缓冲的Channel，<strong>对于Channel的第<code>K</code>个接收完成操作发生在第<code>K+C</code>个发送操作完成之前，其中<code>C</code>是Channel的缓存大小。</strong> 如果将<code>C</code>设置为0自然就对应无缓存的Channel，也即使第K个接收完成在第K个发送完成之前。因为无缓存的Channel只能同步发1个，也就简化为前面无缓存Channel的规则：<strong>对于从无缓冲Channel进行的接收，发生在对该Channel进行的发送完成之前。</strong></p><p>我们可以根据控制Channel的缓存大小来控制并发执行的Goroutine的最大数目, 例如:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var limit &#x3D; make(chan int, 3)func main() &#123;    for _, w :&#x3D; range work &#123;        go func() &#123;            limit &lt;- 1            w()            &lt;-limit        &#125;()    &#125;    select&#123;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后一句<code>select&#123;&#125;</code>是一个空的管道选择语句，该语句会导致<code>main</code>线程阻塞，从而避免程序过早退出。还有<code>for&#123;&#125;</code>、<code>&lt;-make(chan int)</code>等诸多方法可以达到类似的效果。因为<code>main</code>线程被阻塞了，如果需要程序正常退出的话可以通过调用<code>os.Exit(0)</code>实现</p><h3 id="1-5-7-不靠谱的同步"><a href="#1-5-7-不靠谱的同步" class="headerlink" title="1.5.7 不靠谱的同步"></a>1.5.7 不靠谱的同步</h3><p>严谨的并发程序的正确性不应该是依赖于CPU的执行速度和休眠时间等不靠谱的因素的。严谨的并发也应该是可以静态推导出结果的：根据线程内顺序一致性，结合Channel或<code>sync</code>同步事件的可排序性来推导，最终完成各个线程各段代码的偏序关系排序。如果两个事件无法根据此规则来排序，那么它们就是并发的，也就是执行先后顺序不可靠的。</p><p><strong>解决同步问题的思路是相同的：使用显式的同步。</strong></p><h2 id="1-6-常见的并发模式"><a href="#1-6-常见的并发模式" class="headerlink" title="1.6 常见的并发模式"></a>1.6 常见的并发模式</h2><p>Go语言并发体系的理论是C.A.R Hoare在1978年提出的CSP（Communicating Sequential Process，通讯顺序进程）</p><p>作为Go并发编程核心的CSP理论的核心概念只有一个：同步通信。</p><p>首先要明确一个概念：并发不是并行。并发更关注的是程序的设计层面，并发的程序完全是可以顺序执行的，只有在真正的多核CPU上才可能真正地同时运行。并行更关注的是程序的运行层面，并行一般是简单的大量重复，例如GPU中对图像处理都会有大量的并行运算。为更好的编写并发程序，从设计之初Go语言就注重如何在编程语言层级上设计一个简洁安全高效的抽象模型，让程序员专注于分解问题和组合方案，而且不用被线程管理和信号互斥这些繁琐的操作分散精力。</p><p>在并发编程中，对共享资源的正确访问需要精确的控制，在目前的绝大多数语言中，都是通过加锁等线程同步方案来解决这一困难问题，而Go语言却另辟蹊径，它将共享的值通过Channel传递(实际上多个独立执行的线程很少主动共享资源)。在任意给定的时刻，最好只有一个Goroutine能够拥有该资源。数据竞争从设计层面上就被杜绝了。为了提倡这种思考方式，Go语言将其并发编程哲学化为一句口号：</p><blockquote><p>Do not communicate by sharing memory; instead, share memory by communicating.</p><p>不要通过共享内存来通信，而应通过通信来共享内存。</p></blockquote><p>这是更高层次的并发编程哲学(通过管道来传值是Go语言推荐的做法)。虽然像引用计数这类简单的并发问题通过原子操作或互斥锁就能很好地实现，但是通过Channel来控制访问能够让你写出更简洁正确的程序。</p><h3 id="1-6-1-并发版本的Hello-world"><a href="#1-6-1-并发版本的Hello-world" class="headerlink" title="1.6.1 并发版本的Hello world"></a>1.6.1 并发版本的Hello world</h3><p>我们先以在一个新的Goroutine中输出“Hello world”，<code>main</code>等待后台线程输出工作完成之后退出，这样一个简单的并发程序作为热身。</p><p>并发编程的核心概念是同步通信，但是同步的方式却有多种。我们先以大家熟悉的互斥量<code>sync.Mutex</code>来实现同步通信。根据文档，我们不能直接对一个未加锁状态的<code>sync.Mutex</code>进行解锁，这会导致运行时异常。下面这种方式并不能保证正常工作：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    var mu sync.Mutex    go func()&#123;        fmt.Println(&quot;你好, 世界&quot;)        mu.Lock()    &#125;()    mu.Unlock()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为<code>mu.Lock()</code>和<code>mu.Unlock()</code>并不在同一个Goroutine中，所以也就不满足顺序一致性内存模型。同时它们也没有其它的同步事件可以参考，这两个事件不可排序也就是可以并发的。因为可能是并发的事件，所以<code>main</code>函数中的<code>mu.Unlock()</code>很有可能先发生，而这个时刻<code>mu</code>互斥对象还处于未加锁的状态，从而会导致运行时异常。</p><p>下面是修复后的代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    var mu sync.Mutex    mu.Lock()    go func()&#123;        fmt.Println(&quot;你好, 世界&quot;)        mu.Unlock()    &#125;()    mu.Lock()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修复的方式是在<code>main</code>函数所在线程中执行两次<code>mu.Lock()</code>，当第二次加锁时会因为锁已经被占用（不是递归锁）而阻塞，<code>main</code>函数的阻塞状态驱动后台线程继续向前执行。</p><p>使用<code>sync.Mutex</code>互斥锁同步是比较低级的做法。我们现在改用无缓存的管道来实现同步：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    done :&#x3D; make(chan int)    go func()&#123;        fmt.Println(&quot;你好, 世界&quot;)        &lt;-done    &#125;()    done &lt;- 1&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码虽然可以正确同步，但是对管道的缓存大小太敏感：如果管道有缓存的话，就无法保证main退出之前后台线程能正常打印了。更好的做法是将管道的发送和接收方向调换一下，这样可以避免同步事件受管道缓存大小的影响：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    done :&#x3D; make(chan int, 1) &#x2F;&#x2F; 带缓存的管道    go func()&#123;        fmt.Println(&quot;你好, 世界&quot;)        done &lt;- 1    &#125;()    &lt;-done&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于带缓冲的Channel，对于Channel的第K个接收完成操作发生在第K+C个发送操作完成之前，其中C是Channel的缓存大小。虽然管道是带缓存的，<code>main</code>线程接收完成是在后台线程发送开始但还未完成的时刻，此时打印工作也是已经完成的。</p><p>基于带缓存的管道，我们可以很容易将打印线程扩展到N个。下面的例子是开启10个后台线程分别打印：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    done :&#x3D; make(chan int, 10) &#x2F;&#x2F; 带 10 个缓存    &#x2F;&#x2F; 开N个后台打印线程    for i :&#x3D; 0; i &lt; cap(done); i++ &#123;        go func()&#123;            fmt.Println(&quot;你好, 世界&quot;)            done &lt;- 1        &#125;()    &#125;    &#x2F;&#x2F; 等待N个后台线程完成    for i :&#x3D; 0; i &lt; cap(done); i++ &#123;        &lt;-done    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于这种要等待N个线程完成后再进行下一步的同步操作有一个简单的做法，就是使用<code>sync.WaitGroup</code>来等待一组事件：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    var wg sync.WaitGroup    &#x2F;&#x2F; 开N个后台打印线程    for i :&#x3D; 0; i &lt; 10; i++ &#123;        wg.Add(1)        go func() &#123;            fmt.Println(&quot;你好, 世界&quot;)            wg.Done()        &#125;()    &#125;    &#x2F;&#x2F; 等待N个后台线程完成    wg.Wait()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中<code>wg.Add(1)</code>用于增加等待事件的个数，必须确保在后台线程启动之前执行（如果放到后台线程之中执行则不能保证被正常执行到）。当后台线程完成打印工作之后，调用<code>wg.Done()</code>表示完成一个事件。<code>main</code>函数的<code>wg.Wait()</code>是等待全部的事件完成。</p><h3 id="1-6-4-控制并发数"><a href="#1-6-4-控制并发数" class="headerlink" title="1.6.4 控制并发数"></a>1.6.4 控制并发数</h3><p>在Go语言自带的godoc程序实现中有一个<code>vfs</code>的包对应虚拟的文件系统，在<code>vfs</code>包下面有一个<code>gatefs</code>的子包，<code>gatefs</code>子包的目的就是为了控制访问该虚拟文件系统的最大并发数。<code>gatefs</code>包的应用很简单：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;golang.org&#x2F;x&#x2F;tools&#x2F;godoc&#x2F;vfs&quot;    &quot;golang.org&#x2F;x&#x2F;tools&#x2F;godoc&#x2F;vfs&#x2F;gatefs&quot;)func main() &#123;    fs :&#x3D; gatefs.New(vfs.OS(&quot;&#x2F;path&quot;), make(chan bool, 8))    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中<code>vfs.OS(&quot;/path&quot;)</code>基于本地文件系统构造一个虚拟的文件系统，然后<code>gatefs.New</code>基于现有的虚拟文件系统构造一个并发受控的虚拟文件系统。并发数控制的原理在前面一节已经讲过，就是通过带缓存管道的发送和接收规则来实现最大并发阻塞：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var limit &#x3D; make(chan int, 3)func main() &#123;    for _, w :&#x3D; range work &#123;        go func() &#123;            limit &lt;- 1            w()            &lt;-limit        &#125;()    &#125;    select&#123;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不过<code>gatefs</code>对此做一个抽象类型<code>gate</code>，增加了<code>enter</code>和<code>leave</code>方法分别对应并发代码的进入和离开。当超出并发数目限制的时候，<code>enter</code>方法会阻塞直到并发数降下来为止。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type gate chan boolfunc (g gate) enter() &#123; g &lt;- true &#125;func (g gate) leave() &#123; &lt;-g &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>gatefs</code>包装的新的虚拟文件系统就是将需要控制并发的方法增加了<code>enter</code>和<code>leave</code>调用而已：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type gatefs struct &#123;    fs vfs.FileSystem    gate&#125;func (fs gatefs) Lstat(p string) (os.FileInfo, error) &#123;    fs.enter()    defer fs.leave()    return fs.fs.Lstat(p)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们不仅可以控制最大的并发数目，而且可以通过带缓存Channel的使用量和最大容量比例来判断程序运行的并发率。当管道为空的时候可以认为是空闲状态，当管道满了时任务是繁忙状态，这对于后台一些低级任务的运行是有参考价值的。</p><h2 id="1-6-5-赢者为王"><a href="#1-6-5-赢者为王" class="headerlink" title="1.6.5 赢者为王"></a>1.6.5 赢者为王</h2><p>假设我们想快速地搜索“golang”相关的主题，我们可能会同时打开Bing、Google或百度等多个检索引擎。当某个搜索最先返回结果后，就可以关闭其它搜索页面了。因为受网络环境和搜索引擎算法的影响，某些搜索引擎可能很快返回搜索结果，某些搜索引擎也可能等到他们公司倒闭也没有完成搜索。我们可以采用类似的策略来编写这个程序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    ch :&#x3D; make(chan string, 32)    go func() &#123;        ch &lt;- searchByBing(&quot;golang&quot;)    &#125;()    go func() &#123;        ch &lt;- searchByGoogle(&quot;golang&quot;)    &#125;()    go func() &#123;        ch &lt;- searchByBaidu(&quot;golang&quot;)    &#125;()    fmt.Println(&lt;-ch)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，我们创建了一个带缓存的管道，管道的缓存数目要足够大，保证不会因为缓存的容量引起不必要的阻塞。然后我们开启了多个后台线程，分别向不同的搜索引擎提交搜索请求。当任意一个搜索引擎最先有结果之后，都会马上将结果发到管道中（因为管道带了足够的缓存，这个过程不会阻塞）。但是最终我们只从管道取第一个结果，也就是最先返回的结果。</p><p>通过适当开启一些冗余的线程，尝试用不同途径去解决同样的问题，最终以赢者为王的方式提升了程序的相应性能。</p><h3 id="1-6-6-素数筛"><a href="#1-6-6-素数筛" class="headerlink" title="1.6.6 素数筛"></a>1.6.6 素数筛</h3><p>并发版本的素数筛是一个经典的并发例子，通过它我们可以更深刻地理解Go语言的并发特性。“素数筛”的原理如图：</p><p><img src="https://chai2010.cn/advanced-go-programming-book/images/ch1-13-prime-sieve.png" alt="img"></p><p><em>图 1-13 素数筛</em></p><p>我们需要先生成最初的<code>2, 3, 4, ...</code>自然数序列（不包含开头的0、1）：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; 返回生成自然数序列的管道: 2, 3, 4, ...func GenerateNatural() chan int &#123;    ch :&#x3D; make(chan int)    go func() &#123;        for i :&#x3D; 2; ; i++ &#123;            ch &lt;- i        &#125;    &#125;()    return ch&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>GenerateNatural</code>函数内部启动一个Goroutine生产序列，返回对应的管道。</p><p>然后是为每个素数构造一个筛子：将输入序列中是素数倍数的数提出，并返回新的序列，是一个新的管道。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; 管道过滤器: 删除能被素数整除的数func PrimeFilter(in &lt;-chan int, prime int) chan int &#123;    out :&#x3D; make(chan int)    go func() &#123;        for &#123;            if i :&#x3D; &lt;-in; i%prime !&#x3D; 0 &#123;                out &lt;- i            &#125;        &#125;    &#125;()    return out&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>PrimeFilter</code>函数也是内部启动一个Goroutine生产序列，返回过滤后序列对应的管道。</p><p>现在我们可以在<code>main</code>函数中驱动这个并发的素数筛了：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    ch :&#x3D; GenerateNatural() &#x2F;&#x2F; 自然数序列: 2, 3, 4, ...    for i :&#x3D; 0; i &lt; 100; i++ &#123;        prime :&#x3D; &lt;-ch &#x2F;&#x2F; 新出现的素数        fmt.Printf(&quot;%v: %v\n&quot;, i+1, prime)        ch &#x3D; PrimeFilter(ch, prime) &#x2F;&#x2F; 基于新素数构造的过滤器    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们先是调用<code>GenerateNatural()</code>生成最原始的从2开始的自然数序列。然后开始一个100次迭代的循环，希望生成100个素数。在每次循环迭代开始的时候，管道中的第一个数必定是素数，我们先读取并打印这个素数。然后基于管道中剩余的数列，并以当前取出的素数为筛子过滤后面的素数。不同的素数筛子对应的管道是串联在一起的。</p><p>素数筛展示了一种优雅的并发程序结构。但是因为每个并发体处理的任务粒度太细微，程序整体的性能并不理想。对于细粒度的并发程序，CSP模型中固有的消息传递的代价太高了（多线程并发模型同样要面临线程启动的代价）。</p><h3 id="1-6-7-并发的安全退出"><a href="#1-6-7-并发的安全退出" class="headerlink" title="1.6.7 并发的安全退出"></a>1.6.7 并发的安全退出</h3><p>有时候我们需要通知goroutine停止它正在干的事情，特别是当它工作在错误的方向上的时候。Go语言并没有提供在一个直接终止Goroutine的方法，由于这样会导致goroutine之间的共享变量处在未定义的状态上。但是如果我们想要退出两个或者任意多个Goroutine怎么办呢？</p><p>Go语言中不同Goroutine之间主要依靠管道进行通信和同步。要同时处理多个管道的发送或接收操作，我们需要使用<code>select</code>关键字（这个关键字和网络编程中的<code>select</code>函数的行为类似）。当<code>select</code>有多个分支时，会随机选择一个可用的管道分支，如果没有可用的管道分支则选择<code>default</code>分支，否则会一直保存阻塞状态。</p><p>基于<code>select</code>实现的管道的超时判断：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">select &#123;case v :&#x3D; &lt;-in:    fmt.Println(v)case &lt;-time.After(time.Second):    return &#x2F;&#x2F; 超时&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过<code>select</code>的<code>default</code>分支实现非阻塞的管道发送或接收操作：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">select &#123;case v :&#x3D; &lt;-in:    fmt.Println(v)default:    &#x2F;&#x2F; 没有数据&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过<code>select</code>来阻止<code>main</code>函数退出：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    &#x2F;&#x2F; do some thins    select&#123;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>当有多个管道均可操作时，<code>select</code>会随机选择一个管道。基于该特性我们可以用<code>select</code>实现一个生成随机数序列的程序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    ch :&#x3D; make(chan int)    go func() &#123;        for &#123;            select &#123;            case ch &lt;- 0:            case ch &lt;- 1:            &#125;        &#125;    &#125;()    for v :&#x3D; range ch &#123;        fmt.Println(v)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们通过<code>select</code>和<code>default</code>分支可以很容易实现一个Goroutine的退出控制:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func worker(cannel chan bool) &#123;    for &#123;        select &#123;        default:            fmt.Println(&quot;hello&quot;)            &#x2F;&#x2F; 正常工作        case &lt;-cannel:            &#x2F;&#x2F; 退出        &#125;    &#125;&#125;func main() &#123;    cannel :&#x3D; make(chan bool)    go worker(cannel)    time.Sleep(time.Second)    cannel &lt;- true&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是管道的发送操作和接收操作是一一对应的，如果要停止多个Goroutine那么可能需要创建同样数量的管道，这个代价太大了。其实我们可以通过<code>close</code>关闭一个管道来实现广播的效果，所有从关闭管道接收的操作均会收到一个零值和一个可选的失败标志。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func worker(cannel chan bool) &#123;    for &#123;        select &#123;        default:            fmt.Println(&quot;hello&quot;)            &#x2F;&#x2F; 正常工作        case &lt;-cannel:            &#x2F;&#x2F; 退出        &#125;    &#125;&#125;func main() &#123;    cancel :&#x3D; make(chan bool)    for i :&#x3D; 0; i &lt; 10; i++ &#123;        go worker(cancel)    &#125;    time.Sleep(time.Second)    close(cancel)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们通过<code>close</code>来关闭<code>cancel</code>管道向多个Goroutine广播退出的指令。不过这个程序依然不够稳健：当每个Goroutine收到退出指令退出时一般会进行一定的清理工作，但是退出的清理工作并不能保证被完成，因为<code>main</code>线程并没有等待各个工作Goroutine退出工作完成的机制。我们可以结合<code>sync.WaitGroup</code>来改进:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func worker(wg *sync.WaitGroup, cannel chan bool) &#123;    defer wg.Done()    for &#123;        select &#123;        default:            fmt.Println(&quot;hello&quot;)        case &lt;-cannel:            return        &#125;    &#125;&#125;func main() &#123;    cancel :&#x3D; make(chan bool)    var wg sync.WaitGroup    for i :&#x3D; 0; i &lt; 10; i++ &#123;        wg.Add(1)        go worker(&amp;wg, cancel)    &#125;    time.Sleep(time.Second)    close(cancel)    wg.Wait()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在每个工作者并发体的创建、运行、暂停和退出都是在<code>main</code>函数的安全控制之下了</p><h3 id="1-6-8-context包"><a href="#1-6-8-context包" class="headerlink" title="1.6.8 context包"></a>1.6.8 context包</h3><p>在Go1.7发布时，标准库增加了一个<code>context</code>包，用来简化对于处理单个请求的多个Goroutine之间与请求域的数据、超时和退出等操作，官方有博文对此做了专门介绍。我们可以用<code>context</code>包来重新实现前面的线程安全退出或超时的控制:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func worker(ctx context.Context, wg *sync.WaitGroup) error &#123;    defer wg.Done()    for &#123;        select &#123;        default:            fmt.Println(&quot;hello&quot;)        case &lt;-ctx.Done():            return ctx.Err()        &#125;    &#125;&#125;func main() &#123;    ctx, cancel :&#x3D; context.WithTimeout(context.Background(), 10*time.Second)    var wg sync.WaitGroup    for i :&#x3D; 0; i &lt; 10; i++ &#123;        wg.Add(1)        go worker(ctx, &amp;wg)    &#125;    time.Sleep(time.Second)    cancel()    wg.Wait()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当并发体超时或<code>main</code>主动停止工作者Goroutine时，每个工作者都可以安全退出。</p><p>Go语言是带内存自动回收特性的，因此内存一般不会泄漏。</p><p>在前面素数筛的例子中，<code>GenerateNatural</code>和<code>PrimeFilter</code>函数内部都启动了新的Goroutine，当<code>main</code>函数不再使用管道时后台Goroutine有泄漏的风险。我们可以通过<code>context</code>包来避免这个问题，下面是改进的素数筛实现：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; 返回生成自然数序列的管道: 2, 3, 4, ...func GenerateNatural(ctx context.Context) chan int &#123;    ch :&#x3D; make(chan int)    go func() &#123;        for i :&#x3D; 2; ; i++ &#123;            select &#123;            case &lt;- ctx.Done():                return            case ch &lt;- i:            &#125;        &#125;    &#125;()    return ch&#125;&#x2F;&#x2F; 管道过滤器: 删除能被素数整除的数func PrimeFilter(ctx context.Context, in &lt;-chan int, prime int) chan int &#123;    out :&#x3D; make(chan int)    go func() &#123;        for &#123;            if i :&#x3D; &lt;-in; i%prime !&#x3D; 0 &#123;                select &#123;                case &lt;- ctx.Done():                    return                case out &lt;- i:                &#125;            &#125;        &#125;    &#125;()    return out&#125;func main() &#123;    &#x2F;&#x2F; 通过 Context 控制后台Goroutine状态    ctx, cancel :&#x3D; context.WithCancel(context.Background())    ch :&#x3D; GenerateNatural(ctx) &#x2F;&#x2F; 自然数序列: 2, 3, 4, ...    for i :&#x3D; 0; i &lt; 100; i++ &#123;        prime :&#x3D; &lt;-ch &#x2F;&#x2F; 新出现的素数        fmt.Printf(&quot;%v: %v\n&quot;, i+1, prime)        ch &#x3D; PrimeFilter(ctx, ch, prime) &#x2F;&#x2F; 基于新素数构造的过滤器    &#125;    cancel()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-7-错误和异常"><a href="#1-7-错误和异常" class="headerlink" title="1.7 错误和异常"></a>1.7 错误和异常</h2><p>在Go语言中，错误被认为是一种可以预期的结果；而异常则是一种非预期的结果，发生异常可能表示程序中存在BUG或发生了其它不可控的问题。Go语言推荐使用<code>recover</code>函数将内部异常转为错误处理，这使得用户可以真正的关心业务相关的错误处理。</p><p>捕获异常不是最终的目的。如果异常不可预测，直接输出异常信息是最好的处理方式</p><h3 id="1-7-1-错误处理策略"><a href="#1-7-1-错误处理策略" class="headerlink" title="1.7.1 错误处理策略"></a>1.7.1 错误处理策略</h3><p>Go语言中的导出函数一般不抛出异常，一个未受控的异常可以看作是程序的BUG。但是对于那些提供类似Web服务的框架而言；它们经常需要接入第三方的中间件。因为第三方的中间件是否存在BUG是否会抛出异常，Web框架本身是不能确定的。为了提高系统的稳定性，Web框架一般会通过<code>recover</code>来防御性地捕获所有处理流程中可能产生的异常，然后将异常转为普通的错误返回。</p><p>让我们以JSON解析器为例，说明recover的使用场景。考虑到JSON解析器的复杂性，即使某个语言解析器目前工作正常，也无法肯定它没有漏洞。因此，当某个异常出现时，我们不会选择让解析器崩溃，而是会将panic异常当作普通的解析错误，并附加额外信息提醒用户报告此错误。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func ParseJSON(input string) (s *Syntax, err error) &#123;    defer func() &#123;        if p :&#x3D; recover(); p !&#x3D; nil &#123;            err &#x3D; fmt.Errorf(&quot;JSON: internal error: %v&quot;, p)        &#125;    &#125;()    &#x2F;&#x2F; ...parser...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>标准库中的<code>json</code>包，在内部递归解析JSON数据的时候如果遇到错误，会通过抛出异常的方式来快速跳出深度嵌套的函数调用，然后由最外一级的接口通过<code>recover</code>捕获<code>panic</code>，然后返回相应的错误信息。</p><p>Go语言库的实现习惯: 即使在包内部使用了<code>panic</code>，但是在导出函数时会被转化为明确的错误值。</p><h3 id="1-7-2-获取错误的上下文"><a href="#1-7-2-获取错误的上下文" class="headerlink" title="1.7.2 获取错误的上下文"></a>1.7.2 获取错误的上下文</h3><p>上层用户在遇到错误时，可以很容易从业务层面理解错误发生的原因。但是鱼和熊掌总是很难兼得，在上层用户获得新的错误的同时，我们也丢失了底层最原始的错误类型（只剩下错误描述信息了）。</p><p>为了记录这种错误类型在包装的变迁过程中的信息，我们一般会定义一个辅助的<code>WrapError</code>函数，用于包装原始的错误，同时保留完整的原始错误类型。为了问题定位的方便，同时也为了能记录错误发生时的函数调用状态，我们很多时候希望在出现致命错误的时候保存完整的函数调用信息。同时，为了支持RPC等跨网络的传输，我们可能要需要将错误序列化为类似JSON格式的数据，然后再从这些数据中将错误解码恢出来。</p><p>在Go语言中，错误处理也有一套独特的编码风格。检查某个子函数是否失败后，我们通常将处理失败的逻辑代码放在处理成功的代码之前。如果某个错误会导致函数返回，那么成功时的逻辑代码不应放在<code>else</code>语句块中，而应直接放在函数体中。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">f, err :&#x3D; os.Open(&quot;filename.ext&quot;)if err !&#x3D; nil &#123;    &#x2F;&#x2F; 失败的情形, 马上返回错误&#125;&#x2F;&#x2F; 正常的处理流程<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Go语言中大部分函数的代码结构几乎相同，首先是一系列的初始检查，用于防止错误发生，之后是函数的实际逻辑。</p><h3 id="1-7-3-错误的错误返回"><a href="#1-7-3-错误的错误返回" class="headerlink" title="1.7.3 错误的错误返回"></a>1.7.3 错误的错误返回</h3><p>Go语言作为一个强类型语言，不同类型之间必须要显式的转换（而且必须有相同的基础类型）。但是，Go语言中<code>interface</code>是一个例外：非接口类型到接口类型，或者是接口类型之间的转换都是隐式的。这是为了支持鸭子类型，当然会牺牲一定的安全性。</p><p>鸭子类型（英語：duck typing）在程序设计中是动态类型的一种风格。 在这种风格中，一个对象有效的语义，不是由继承自特定的类或实现特定的接口，而是由”当前方法和属性的集合”决定。</p><p><strong>后面没记了，现用现查吧！</strong></p><h1 id="第2章-CGO编程"><a href="#第2章-CGO编程" class="headerlink" title="第2章 CGO编程"></a>第2章 CGO编程</h1><p>C语言作为一个通用语言，很多库会选择提供一个C兼容的API，然后用其他不同的编程语言实现。Go语言通过自带的一个叫CGO的工具来支持C语言函数调用，同时我们可以用Go语言导出C动态库接口给其它语言使用。</p><h2 id="2-1-快速入门"><a href="#2-1-快速入门" class="headerlink" title="2.1 快速入门"></a>2.1 快速入门</h2><p>通过<code>import &quot;C&quot;</code>语句启用CGO特性。即使没有调用CGO的相关函数，但是<code>go build</code>命令会在编译和链接阶段启动gcc编译器，这已经是一个完整的CGO程序了。</p><h2 id="2-1-2-基于C标准库函数输出字符串"><a href="#2-1-2-基于C标准库函数输出字符串" class="headerlink" title="2.1.2 基于C标准库函数输出字符串"></a>2.1.2 基于C标准库函数输出字符串</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; hello.gopackage main&#x2F;&#x2F;#include &lt;stdio.h&gt;import &quot;C&quot;func main() &#123;    C.puts(C.CString(&quot;Hello, World\n&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们不仅仅通过<code>import &quot;C&quot;</code>语句启用CGO特性，同时包含C语言的<code>&lt;stdio.h&gt;</code>头文件。然后通过CGO包的<code>C.CString</code>函数将Go语言字符串转为C语言字符串，最后调用CGO包的<code>C.puts</code>函数向标准输出窗口打印转换后的C字符串。</p><p>没有释放使用<code>C.CString</code>创建的C语言字符串会导致内存泄漏。但是对于这个小程序来说，这样是没有问题的，因为程序退出后操作系统会自动回收程序的所有资源。</p><h2 id="2-1-3-使用自己的C函数"><a href="#2-1-3-使用自己的C函数" class="headerlink" title="2.1.3 使用自己的C函数"></a>2.1.3 使用自己的C函数</h2><p>现在我们先自定义一个叫<code>SayHello</code>的C函数来实现打印，然后从Go语言环境中调用这个<code>SayHello</code>函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; hello.gopackage main&#x2F;*#include &lt;stdio.h&gt;static void SayHello(const char* s) &#123;    puts(s);&#125;*&#x2F;import &quot;C&quot;func main() &#123;    C.SayHello(C.CString(&quot;Hello, World\n&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>除了<code>SayHello</code>函数是我们自己实现的之外，其它的部分和前面的例子基本相似</p><p>我们也可以将<code>SayHello</code>函数放到当前目录下的一个C语言源文件中（后缀名必须是<code>.c</code>）。因为是编写在独立的C文件中，为了允许外部引用，所以需要去掉函数的<code>static</code>修饰符。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">&#x2F;&#x2F; hello.c#include &lt;stdio.h&gt;void SayHello(const char* s) &#123;    puts(s);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后在CGO部分先声明<code>SayHello</code>函数，其它部分不变：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; hello.gopackage main&#x2F;&#x2F;void SayHello(const char* s);import &quot;C&quot;func main() &#123;    C.SayHello(C.CString(&quot;Hello, World\n&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意，如果之前运行的命令是<code>go run hello.go</code>或<code>go build hello.go</code>的话，此处须使用<code>go run &quot;your/package&quot;</code>或<code>go build &quot;your/package&quot;</code>才可以。若本就在包路径下的话，也可以直接运行<code>go run .</code>或<code>go build</code>。</p><p>既然<code>SayHello</code>函数已经放到独立的C文件中了，我们自然可以将对应的C文件编译打包为静态库或动态库文件供使用。如果是以静态库或动态库方式引用<code>SayHello</code>函数的话，需要将对应的C源文件移出当前目录（CGO构建程序会自动构建当前目录下的C源文件，从而导致C函数名冲突）。</p><h2 id="2-1-4-C代码的模块化"><a href="#2-1-4-C代码的模块化" class="headerlink" title="2.1.4 C代码的模块化"></a>2.1.4 C代码的模块化</h2><p>模块化编程的核心是面向程序接口编程（这里的接口并不是Go语言的interface，而是API的概念）。</p><p>在前面的例子中，我们可以抽象一个名为hello的模块，模块的全部接口函数都在hello.h头文件定义：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">&#x2F;&#x2F; hello.hvoid SayHello(const char* s);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>其中只有一个SayHello函数的声明。但是作为hello模块的用户来说，就可以放心地使用SayHello函数，而无需关心函数的具体实现。而作为SayHello函数的实现者来说，函数的实现只要满足头文件中函数的声明的规范即可。</p><p>在采用面向C语言API接口编程之后，我们彻底解放了模块实现者的语言枷锁：实现者可以用任何编程语言实现模块，只要最终满足公开的API约定即可。我们可以用C语言实现SayHello函数，也可以使用更复杂的C++语言来实现SayHello函数，当然我们也可以用汇编语言甚至Go语言来重新实现SayHello函数。</p><h3 id="2-1-5用Go重新实现C函数"><a href="#2-1-5用Go重新实现C函数" class="headerlink" title="2.1.5用Go重新实现C函数"></a>2.1.5用Go重新实现C函数</h3><p>其实CGO不仅仅用于Go语言中调用C语言函数，还可以用于导出Go语言函数给C语言函数调用。在前面的例子中，我们已经抽象一个名为hello的模块，模块的全部接口函数都在hello.h头文件定义：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">&#x2F;&#x2F; hello.hvoid SayHello(&#x2F;*const*&#x2F; char* s);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>现在我们创建一个hello.go文件，用Go语言重新实现C语言接口的SayHello函数:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; hello.gopackage mainimport &quot;C&quot;import &quot;fmt&quot;&#x2F;&#x2F;export SayHellofunc SayHello(s *C.char) &#123;    fmt.Print(C.GoString(s))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们通过CGO的<code>//export SayHello</code>指令将Go语言实现的函数<code>SayHello</code>导出为C语言函数。为了适配CGO导出的C语言函数，我们禁止了在函数的声明语句中的const修饰符。需要注意的是，这里其实有两个版本的<code>SayHello</code>函数：一个Go语言环境的；另一个是C语言环境的。cgo生成的C语言版本SayHello函数最终会通过桥接代码调用Go语言版本的SayHello函数。</p><p>通过面向C语言接口的编程技术，我们不仅仅解放了函数的实现者，同时也简化的函数的使用者。现在我们可以将SayHello当作一个标准库的函数使用（和puts函数的使用方式类似）：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package main&#x2F;&#x2F;#include &lt;hello.h&gt;import &quot;C&quot;func main() &#123;    C.SayHello(C.CString(&quot;Hello, World\n&quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-1-6-面向C接口的Go编程"><a href="#2-1-6-面向C接口的Go编程" class="headerlink" title="2.1.6 面向C接口的Go编程"></a>2.1.6 面向C接口的Go编程</h3><p>正所谓合久必分、分久必合，我们现在尝试将例子中的几个文件重新合并到一个Go文件。下面是合并后的成果：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package main&#x2F;&#x2F;void SayHello(char* s);import &quot;C&quot;import (    &quot;fmt&quot;)func main() &#123;    C.SayHello(C.CString(&quot;Hello, World\n&quot;))&#125;&#x2F;&#x2F;export SayHellofunc SayHello(s *C.char) &#123;    fmt.Print(C.GoString(s))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过分析可以发现<code>SayHello</code>函数的参数如果可以直接使用Go字符串是最直接的。在Go1.10中CGO新增加了一个<code>_GoString_</code>预定义的C语言类型，用来表示Go语言字符串。下面是改进后的代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package main&#x2F;&#x2F;void SayHello(_GoString_ s);import &quot;C&quot;import (    &quot;fmt&quot;)func main() &#123;    C.SayHello(&quot;Hello, World\n&quot;)&#125;&#x2F;&#x2F;export SayHellofunc SayHello(s string) &#123;    fmt.Print(s)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然看起来全部是Go语言代码，但是执行的时候是先从Go语言的<code>main</code>函数，到CGO自动生成的C语言版本<code>SayHello</code>桥接函数，最后又回到了Go语言环境的<code>SayHello</code>函数。这个代码包含了CGO编程的精华，读者需要深入理解。</p><h2 id="2-2-CGO基础"><a href="#2-2-CGO基础" class="headerlink" title="2.2 CGO基础"></a>2.2 CGO基础</h2><p>要使用CGO特性，需要安装C/C++构建工具链，在macOS和Linux下是要安装GCC，在windows下是需要安装MinGW工具。同时需要保证环境变量<code>CGO_ENABLED</code>被设置为1，这表示CGO是被启用的状态。在本地构建时<code>CGO_ENABLED</code>默认是启用的，当交叉构建时CGO默认是禁止的。比如要交叉构建ARM环境运行的Go程序，需要手工设置好C/C++交叉构建的工具链，同时开启<code>CGO_ENABLED</code>环境变量。然后通过<code>import &quot;C&quot;</code>语句启用CGO特性。</p><h3 id="2-2-1-import-quot-C-quot-语句"><a href="#2-2-1-import-quot-C-quot-语句" class="headerlink" title="2.2.1 import &quot;C&quot;语句"></a>2.2.1 <code>import &quot;C&quot;</code>语句</h3><p>如果在Go代码中出现了<code>import &quot;C&quot;</code>语句则表示使用了CGO特性，紧跟在这行语句前面的注释是一种特殊语法，里面包含的是正常的C语言代码。当确保CGO启用的情况下，还可以在当前目录中包含C/C++对应的源文件。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package main&#x2F;*#include &lt;stdio.h&gt;void printint(int v) &#123;    printf(&quot;printint: %d\n&quot;, v);&#125;*&#x2F;import &quot;C&quot;func main() &#123;    v :&#x3D; 42    C.printint(C.int(v))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子展示了cgo的基本使用方法。开头的注释中写了要调用的C函数和相关的头文件，头文件被include之后里面的所有的C语言元素都会被加入到”C”这个虚拟的包中。需要注意的是，import “C”导入语句需要单独一行，不能与其他包一同import。向C函数传递参数也很简单，就直接转化成对应C语言类型传递就可以。如上例中<code>C.int(v)</code>用于将一个Go中的int类型值强制类型转换转化为C语言中的int类型值，然后调用C语言定义的printint函数进行打印。</p><p>需要注意的是，Go是强类型语言，所以cgo中传递的参数类型必须与声明的类型完全一致，而且传递前必须用”C”中的转化函数转换成对应的C类型，不能直接传入Go中类型的变量。同时通过虚拟的C包导入的C语言符号并不需要是大写字母开头，它们不受Go语言的导出规则约束。</p><p>cgo将当前包引用的C语言符号都放到了虚拟的C包中，同时当前包依赖的其它Go语言包内部可能也通过cgo引入了相似的虚拟C包，但是不同的Go语言包引入的虚拟的C包之间的类型是不能通用的。这个约束对于要自己构造一些cgo辅助函数时有可能会造成一点的影响。</p><p>比如我们希望在Go中定义一个C语言字符指针对应的CChar类型，然后增加一个GoString方法返回Go语言字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package cgo_helper&#x2F;&#x2F;#include &lt;stdio.h&gt;import &quot;C&quot;type CChar C.charfunc (p *CChar) GoString() string &#123;    return C.GoString((*C.char)(p))&#125;func PrintCString(cs *C.char) &#123;    C.puts(cs)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在我们可能会想在其它的Go语言包中也使用这个辅助函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package main&#x2F;&#x2F;static const char* cs &#x3D; &quot;hello&quot;;import &quot;C&quot;import &quot;.&#x2F;cgo_helper&quot;func main() &#123;    cgo_helper.PrintCString(C.cs)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码是不能正常工作的，因为当前main包引入的<code>C.cs</code>变量的类型是当前main包的cgo构造的虚拟的C包下的<em>char类型（具体点是`</em>C.char<code>，更具体点是</code><em>main.C.char<code>），它和cgo_helper包引入的</code></em>C.char<code>类型（具体点是</code><em>cgo_helper.C.char<code>）是不同的。在Go语言中方法是依附于类型存在的，不同Go包中引入的虚拟的C包的类型却是不同的（</code>main.C<code>不等</code>cgo_helper.C<code>），这导致从它们延伸出来的Go类型也是不同的类型（</code></em>main.C.char<code>不等</code>*cgo_helper.C.char`），这最终导致了前面代码不能正常工作。</p><p>有Go语言使用经验的用户可能会建议参数转型后再传入。但是这个方法似乎也是不可行的，因为<code>cgo_helper.PrintCString</code>的参数是它自身包引入的<code>*C.char</code>类型，在外部是无法直接获取这个类型的。换言之，一个包如果在公开的接口中直接使用了<code>*C.char</code>等类似的虚拟C包的类型，其它的Go包是无法直接使用这些类型的，除非这个Go包同时也提供了<code>*C.char</code>类型的构造函数。因为这些诸多因素，如果想在go test环境直接测试这些cgo导出的类型也会有相同的限制。</p><h3 id="2-2-2-cgo语句"><a href="#2-2-2-cgo语句" class="headerlink" title="2.2.2 #cgo语句"></a>2.2.2 <code>#cgo</code>语句</h3><p>在<code>import &quot;C&quot;</code>语句前的注释中可以通过<code>#cgo</code>语句设置编译阶段和链接阶段的相关参数。编译阶段的参数主要用于定义相关宏和指定头文件检索路径。链接阶段的参数主要是指定库文件检索路径和要链接的库文件。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; #cgo CFLAGS: -DPNG_DEBUG&#x3D;1 -I.&#x2F;include&#x2F;&#x2F; #cgo LDFLAGS: -L&#x2F;usr&#x2F;local&#x2F;lib -lpng&#x2F;&#x2F; #include &lt;png.h&gt;import &quot;C&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码中，CFLAGS部分，<code>-D</code>部分定义了宏PNG_DEBUG，值为1；<code>-I</code>定义了头文件包含的检索目录。LDFLAGS部分，<code>-L</code>指定了链接时库文件检索目录，<code>-l</code>指定了链接时需要链接png库。</p><p>因为C/C++遗留的问题，C头文件检索目录可以是相对目录，但是库文件检索目录则需要绝对路径。在库文件的检索目录中可以通过<code>$&#123;SRCDIR&#125;</code>变量表示当前包目录的绝对路径：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; #cgo LDFLAGS: -L$&#123;SRCDIR&#125;&#x2F;libs -lfoo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面的代码在链接时将被展开为：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; #cgo LDFLAGS: -L&#x2F;go&#x2F;src&#x2F;foo&#x2F;libs -lfoo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>#cgo</code>语句主要影响CFLAGS、CPPFLAGS、CXXFLAGS、FFLAGS和LDFLAGS几个编译器环境变量。LDFLAGS用于设置链接时的参数，除此之外的几个变量用于改变编译阶段的构建参数(CFLAGS用于针对C语言代码设置编译参数)。</p><p>对于在cgo环境混合使用C和C++的用户来说，可能有三种不同的编译选项：其中CFLAGS对应C语言特有的编译选项、CXXFLAGS对应是C++特有的编译选项、CPPFLAGS则对应C和C++共有的编译选项。但是在链接阶段，C和C++的链接选项是通用的，因此这个时候已经不再有C和C++语言的区别，它们的目标文件的类型是相同的。</p><h3 id="2-2-3-build-tag-条件编译"><a href="#2-2-3-build-tag-条件编译" class="headerlink" title="2.2.3 build tag 条件编译"></a>2.2.3 build tag 条件编译</h3><h2 id="2-3-类型转换"><a href="#2-3-类型转换" class="headerlink" title="2.3 类型转换"></a>2.3 类型转换</h2><h3 id="2-3-1-数值类型"><a href="#2-3-1-数值类型" class="headerlink" title="2.3.1 数值类型"></a>2.3.1 数值类型</h3><div class="table-container"><table><thead><tr><th>C语言类型</th><th>CGO类型</th><th>Go语言类型</th></tr></thead><tbody><tr><td>char</td><td>C.char</td><td>byte</td></tr><tr><td>singed char</td><td>C.schar</td><td>int8</td></tr><tr><td>unsigned char</td><td>C.uchar</td><td>uint8</td></tr><tr><td>short</td><td>C.short</td><td>int16</td></tr><tr><td>unsigned short</td><td>C.ushort</td><td>uint16</td></tr><tr><td>int</td><td>C.int</td><td>int32</td></tr><tr><td>unsigned int</td><td>C.uint</td><td>uint32</td></tr><tr><td>long</td><td>C.long</td><td>int32</td></tr><tr><td>unsigned long</td><td>C.ulong</td><td>uint32</td></tr><tr><td>long long int</td><td>C.longlong</td><td>int64</td></tr><tr><td>unsigned long long int</td><td>C.ulonglong</td><td>uint64</td></tr><tr><td>float</td><td>C.float</td><td>float32</td></tr><tr><td>double</td><td>C.double</td><td>float64</td></tr><tr><td>size_t</td><td>C.size_t</td><td>uint</td></tr></tbody></table></div><p>虽然在C语言中<code>int</code>、<code>short</code>等类型没有明确定义内存大小，但是在CGO中它们的内存大小是确定的。在CGO中，C语言的<code>int</code>和<code>long</code>类型都是对应4个字节的内存大小，<code>size_t</code>类型可以当作Go语言<code>uint</code>无符号整数类型对待。</p><h2 id="2-11-补充说明"><a href="#2-11-补充说明" class="headerlink" title="2.11 补充说明"></a>2.11 补充说明</h2><p> 为何要话费巨大的精力学习CGO是一个问题。任何技术和语言都有它自身的优点和不足，Go语言不是银弹，它无法解决全部问题。而通过CGO可以继承C/C++将近半个世纪的软件遗产，通过CGO可以用Go给其它系统写C接口的共享库，通过CGO技术可以让Go语言编写的代码可以很好地融入现有的软件生态——而现在的软件正式建立在C/C++语言之上的。因此说CGO是一个保底的后备技术，它是Go的一个重量级的替补技术，值得任何一个严肃的Go语言开发人员学习。</p><p><strong>感觉有点偏了，CGO暂时先不学了</strong></p><h1 id="第3章-Go汇编语言"><a href="#第3章-Go汇编语言" class="headerlink" title="第3章 Go汇编语言"></a>第3章 Go汇编语言</h1><p>无论高级语言如何发展，作为最接近CPU的汇编语言的地位依然是无法彻底被替代的。只有通过汇编语言才能彻底挖掘CPU芯片的全部功能，因此操作系统的引导过程必须要依赖汇编语言的帮助。只有通过汇编语言才能彻底榨干CPU芯片的性能，因此很多底层的加密解密等对性能敏感的算法会考虑通过汇编语言进行性能优化。</p><p><strong>感觉有点偏了，这部分暂时先不学了</strong></p><h1 id="第4章-RPC和Protobuf"><a href="#第4章-RPC和Protobuf" class="headerlink" title="第4章 RPC和Protobuf"></a>第4章 RPC和Protobuf</h1><p>RPC是远程过程调用的缩写（Remote Procedure Call），通俗地说就是调用远处的一个函数。因为RPC涉及的函数可能非常之远，远到它们之间说着完全不同的语言，语言就成了两边的沟通障碍。而Protobuf因为支持多种不同的语言（甚至不支持的语言也可以扩展支持），其本身特性也非常方便描述服务的接口（也就是方法列表），因此非常适合作为RPC世界的接口交流语言。本章将讨论RPC的基本用法，如何针对不同场景设计自己的RPC服务，以及围绕Protobuf构造的更为庞大的RPC生态。</p><h2 id="4-1-RPC入门"><a href="#4-1-RPC入门" class="headerlink" title="4.1 RPC入门"></a>4.1 RPC入门</h2><p>我们先构造一个HelloService类型，其中的Hello方法用于实现打印功能：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type HelloService struct &#123;&#125;func (p *HelloService) Hello(request string, reply *string) error &#123;    *reply &#x3D; &quot;hello:&quot; + request    return nil&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中Hello方法必须满足Go语言的RPC规则：方法只能有两个可序列化的参数，其中第二个参数是指针类型，并且返回一个error类型，同时必须是公开的方法。</p><p>然后就可以将HelloService类型的对象注册为一个RPC服务：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    rpc.RegisterName(&quot;HelloService&quot;, new(HelloService))    listener, err :&#x3D; net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)    if err !&#x3D; nil &#123;        log.Fatal(&quot;ListenTCP error:&quot;, err)    &#125;    conn, err :&#x3D; listener.Accept()    if err !&#x3D; nil &#123;        log.Fatal(&quot;Accept error:&quot;, err)    &#125;    rpc.ServeConn(conn)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中rpc.Register函数调用会将对象类型中所有满足RPC规则的对象方法注册为RPC函数，所有注册的方法会放在“HelloService”服务空间之下。然后我们建立一个唯一的TCP链接，并且通过rpc.ServeConn函数在该TCP链接上为对方提供RPC服务。</p><p>下面是客户端请求HelloService服务的代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    client, err :&#x3D; rpc.Dial(&quot;tcp&quot;, &quot;localhost:1234&quot;)    if err !&#x3D; nil &#123;        log.Fatal(&quot;dialing:&quot;, err)    &#125;    var reply string    err &#x3D; client.Call(&quot;HelloService.Hello&quot;, &quot;hello&quot;, &amp;reply)    if err !&#x3D; nil &#123;        log.Fatal(err)    &#125;    fmt.Println(reply)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首选是通过rpc.Dial拨号RPC服务，然后通过client.Call调用具体的RPC方法。在调用client.Call时，第一个参数是用点号链接的RPC服务名字和方法名字，第二和第三个参数分别我们定义RPC方法的两个参数。</p><h3 id="4-1-2-更安全的RPC接口"><a href="#4-1-2-更安全的RPC接口" class="headerlink" title="4.1.2 更安全的RPC接口"></a>4.1.2 更安全的RPC接口</h3><p>在涉及RPC的应用中，作为开发人员一般至少有三种角色：首选是服务端实现RPC方法的开发人员，其次是客户端调用RPC方法的人员，最后也是最重要的是制定服务端和客户端RPC接口规范的设计人员。</p><p>在前面的例子中我们为了简化将以上几种角色的工作全部放到了一起，虽然看似实现简单，但是不利于后期的维护和工作的切割。</p><h2 id="4-2-Protobuf"><a href="#4-2-Protobuf" class="headerlink" title="4.2 Protobuf"></a>4.2 Protobuf</h2><h3 id="4-2-1-Protobuf入门"><a href="#4-2-1-Protobuf入门" class="headerlink" title="4.2.1 Protobuf入门"></a>4.2.1 Protobuf入门</h3><p>对于没有用过Protobuf的读者，建议先从官网了解下基本用法。这里我们尝试将Protobuf和RPC结合在一起使用，通过Protobuf来最终保证RPC的接口规范和安全。Protobuf中最基本的数据单元是message，是类似Go语言中结构体的存在。在message中可以嵌套message或其它的基础数据类型的成员。</p><p>首先创建hello.proto文件，其中包装HelloService服务中用到的字符串类型：</p><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf">syntax &#x3D; &quot;proto3&quot;;package main;message String &#123;    string value &#x3D; 1;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>开头的syntax语句表示采用proto3的语法。第三版的Protobuf对语言进行了提炼简化，所有成员均采用类似Go语言中的零值初始化（不再支持自定义默认值），因此消息成员也不再需要支持required特性。然后package指令指明当前是main包（这样可以和Go的包名保持一致，简化例子代码），当然用户也可以针对不同的语言定制对应的包路径和名称。最后message关键字定义一个新的String类型，在最终生成的Go语言代码中对应一个String结构体。String类型中只有一个字符串类型的value成员，该成员编码时用1编号代替名字。</p><p>在XML或JSON等数据描述语言中，一般通过成员的名字来绑定对应的数据。但是Protobuf编码却是通过成员的唯一编号来绑定对应的数据，因此Protobuf编码后数据的体积会比较小，但是也非常不便于人类查阅。我们目前并不关注Protobuf的编码技术，最终生成的Go结构体可以自由采用JSON或gob等编码格式，因此大家可以暂时忽略Protobuf的成员编码部分。</p><p>Protobuf核心的工具集是C++语言开发的，在官方的protoc编译器中并不支持Go语言。要想基于上面的hello.proto文件生成相应的Go代码，需要安装相应的插件。首先是安装官方的protoc工具，可以从 <a href="https://github.com/google/protobuf/releases">https://github.com/google/protobuf/releases</a> 下载。然后是安装针对Go语言的代码生成插件，可以通过<code>go get github.com/golang/protobuf/protoc-gen-go</code>命令安装。</p><p><strong>感觉这一章也不是很实用，暂且搁置了</strong></p><h1 id="第五章-go-web"><a href="#第五章-go-web" class="headerlink" title="第五章 go web"></a>第五章 go web</h1><h2 id="5-1-web-开发简介"><a href="#5-1-web-开发简介" class="headerlink" title="5.1 web 开发简介"></a>5.1 web 开发简介</h2><p>因为Go的 <code>net/http</code>包提供了基础的路由函数组合与丰富的功能函数。所以在社区里流行一种用Go编写api不需要框架的观点;在我们看来，如果你的项目的路由在个位数、URI 固定且不通过 URI 来传递参数，那么确实使用官方库也就足够。但在复杂场景下，官方的 http 库还是有些力有不逮。例如下面这样的路由：</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">GET   &#x2F;card&#x2F;:idPOST  &#x2F;card&#x2F;:idDELTE &#x2F;card&#x2F;:idGET   &#x2F;card&#x2F;:id&#x2F;name...GET   &#x2F;card&#x2F;:id&#x2F;relations<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可见是否使用框架还是要具体问题具体分析的。</p><p>Go的Web框架大致可以分为这么两类：</p><ol><li>Router框架</li><li>MVC类框架</li></ol><p>在框架的选择上，大多数情况下都是依照个人的喜好和公司的技术栈。例如公司有很多技术人员是PHP出身，那么他们一定会非常喜欢像beego 这样的框架，但如果公司有很多 C 程序员，那么他们的想法可能是越简单越好。比如很多大厂的 C 程序员甚至可能都会去用 C 去写很小的 CGI 程序，他们可能本身并没有什么意愿去学习MVC或者更复杂的 web 框架，他们需要的只是一个非常简单的路由(甚至连路由都不需要，只需要一个基础的HTTP协议处理库来帮他省掉没什么意思的体力劳动)。</p><p>根据我们的经验，简单地来说，只要你的路由带有参数，并且这个项目的 api 数目超过了 10，就尽量不要使用 net/http 中默认的路由。在Go开源界应用最广泛的 router 是 httpRouter，很多开源的 router 框架都是基于 httpRouter 进行一定程度的改造的成果。</p><p>再来回顾一下文章开头说的，开源界有这么几种框架，第一种是对 httpRouter 进行简单的封装，然后提供定制的 middleware 和一些简单的小工具集成比如 gin，主打轻量，易学，高性能。第二种是借鉴其它语言的编程风格的一些 MVC 类框架，例如 beego，方便从其它语言迁移过来的程序员快速上手，快速开发。还有一些框架功能更为强大，除了 db 设计，大部分代码直接生成，例如 goa。不管哪种框架，适合开发者背景的就是最好的。</p><h2 id="5-2-router-请求路由"><a href="#5-2-router-请求路由" class="headerlink" title="5.2 router 请求路由"></a>5.2 router 请求路由</h2><p>在常见的 web 框架中，router 是必备的组件。golang 圈子里 router 也时常被称为 http 的 multiplexer。在上一节中我们通过对 Burrow 代码的简单学习，已经知道如何用 http 标准库中内置的 mux 来完成简单的路由功能了。如果开发 web 系统对路径中带参数没什么兴趣的话，用 http 标准库中的 mux 就可以。</p><p>restful 是几年前刮起的 API 设计风潮，在 restful 中除了 GET 和 POST 之外，还使用了 http 协议定义的几种其它的标准化语义。具体包括：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">const (    MethodGet     &#x3D; &quot;GET&quot;    MethodHead    &#x3D; &quot;HEAD&quot;    MethodPost    &#x3D; &quot;POST&quot;    MethodPut     &#x3D; &quot;PUT&quot;    MethodPatch   &#x3D; &quot;PATCH&quot; &#x2F;&#x2F; RFC 5789    MethodDelete  &#x3D; &quot;DELETE&quot;    MethodConnect &#x3D; &quot;CONNECT&quot;    MethodOptions &#x3D; &quot;OPTIONS&quot;    MethodTrace   &#x3D; &quot;TRACE&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  restful 中常见的请求路径：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">GET &#x2F;repos&#x2F;:owner&#x2F;:repo&#x2F;comments&#x2F;:id&#x2F;reactionsPOST &#x2F;projects&#x2F;:project_id&#x2F;columnsPUT &#x2F;user&#x2F;starred&#x2F;:owner&#x2F;:repoDELETE &#x2F;user&#x2F;starred&#x2F;:owner&#x2F;:repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相信聪明的你已经猜出来了，这是 github 官方文档中挑出来的几个 api 设计。restful 风格的 API 重度依赖请求路径。会将很多参数放在请求 URI 中。除此之外还会使用很多并不那么常见的 HTTP 状态码，不过本节只讨论路由，所以先略过不谈。</p><p>如果我们的系统也想要这样的 URI 设计，使用标准库的 mux 显然就力不从心了。</p><h3 id="5-2-1-httprouter"><a href="#5-2-1-httprouter" class="headerlink" title="5.2.1 httprouter"></a>5.2.1 httprouter</h3><p>较流行的开源 golang web 框架大多使用 httprouter，或是基于 httprouter 的变种对路由进行支持。前面提到的 github 的参数式路由在 httprouter 中都是可以支持的。</p><p>因为 httprouter 中使用的是显式匹配，所以在设计路由的时候需要规避一些会导致路由冲突的情况，例如：</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">conflict:GET &#x2F;user&#x2F;info&#x2F;:nameGET &#x2F;user&#x2F;:idno conflict:GET &#x2F;user&#x2F;info&#x2F;:namePOST &#x2F;user&#x2F;:id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>简单来讲的话，如果两个路由拥有一致的 http method (指 GET/POST/PUT/DELETE) 和请求路径前缀，且在某个位置出现了 A 路由是 wildcard (指 :id 这种形式) 参数，B 路由则是普通字符串，那么就会发生路由冲突。路由冲突会在初始化阶段直接 panic：</p><p>还有一点需要注意，因为 httprouter 考虑到字典树的深度，在初始化时会对参数的数量进行限制</p><p>除支持路径中的 wildcard 参数之外，httprouter 还可以支持 <code>*</code> 号来进行通配，不过 <code>*</code> 号开头的参数只能放在路由的结尾，例如下面这样：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Pattern: &#x2F;src&#x2F;*filepath &#x2F;src&#x2F;                     filepath &#x3D; &quot;&quot; &#x2F;src&#x2F;somefile.go          filepath &#x3D; &quot;somefile.go&quot; &#x2F;src&#x2F;subdir&#x2F;somefile.go   filepath &#x3D; &quot;subdir&#x2F;somefile.go&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种设计在 restful 中可能不太常见，主要是为了能够使用 httprouter 来做简单的 http 静态文件服务器。</p><p>除了正常情况下的路由支持，httprouter 也支持对一些特殊情况下的回调函数进行定制，例如 404 的时候：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">r :&#x3D; httprouter.New()r.NotFound &#x3D; http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) &#123;    w.Write([]byte(&quot;oh no, not found&quot;))&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>或者内部 panic 的时候：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">r.PanicHandler &#x3D; func(w http.ResponseWriter, r *http.Request, c interface&#123;&#125;) &#123;    log.Printf(&quot;Recovering from panic, Reason: %#v&quot;, c.(error))    w.WriteHeader(http.StatusInternalServerError)    w.Write([]byte(c.(error).Error()))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>目前开源界最为流行(star 数最多)的 web 框架 <a href="https://github.com/gin-gonic/gin">gin</a> 使用的就是 httprouter 的变种。</p><h3 id="5-2-2-原理"><a href="#5-2-2-原理" class="headerlink" title="5.2.2 原理"></a>5.2.2 原理</h3><p>httprouter 和众多衍生 router 使用的数据结构被称为 radix tree，压缩字典树。</p><p>如果不用字典树来完成上述功能，要对历史字符串进行排序，再利用二分查找之类的算法去搜索，时间复杂度只高不低。可认为字典树是一种空间换时间的典型做法。</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix.png" alt="radix tree"></p><h3 id="5-2-3-压缩字典树创建过程"><a href="#5-2-3-压缩字典树创建过程" class="headerlink" title="5.2.3 压缩字典树创建过程"></a>5.2.3 压缩字典树创建过程</h3><p>我们来跟踪一下 httprouter 中，一个典型的压缩字典树的创建过程，路由设定如下：</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">PUT &#x2F;user&#x2F;installations&#x2F;:installation_id&#x2F;repositories&#x2F;:repository_idGET &#x2F;marketplace_listing&#x2F;plans&#x2F;GET &#x2F;marketplace_listing&#x2F;plans&#x2F;:id&#x2F;accountsGET &#x2F;searchGET &#x2F;statusGET &#x2F;support补充路由：GET &#x2F;marketplace_listing&#x2F;plans&#x2F;ohyes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后一条补充路由是我们臆想的，除此之外所有 API 路由均来自于 api.github.com。</p><h4 id="5-2-3-1-root-节点创建"><a href="#5-2-3-1-root-节点创建" class="headerlink" title="5.2.3.1 root 节点创建"></a>5.2.3.1 root 节点创建</h4><p>httprouter 的 Router struct 中存储压缩字典树使用的是下述数据结构</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F; 略去了其它部分的 Router structtype Router struct &#123;    &#x2F;&#x2F; ...    trees map[string]*node    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>trees 中的 key 即为 http 1.1 的 RFC 中定义的各种 method，具体有：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">GETHEADOPTIONSPOSTPUTPATCHDELETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每一种 method 对应的都是一棵独立的压缩字典树，这些树彼此之间不共享数据。具体到我们上面用到的路由，PUT 和 GET 是两棵树而非一棵。</p><p>简单来讲，某个 method 第一次插入的路由就会导致对应字典树的根节点被创建，我们按顺序，先是一个 PUT：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">r :&#x3D; httprouter.New()r.PUT(&quot;&#x2F;user&#x2F;installations&#x2F;:installation_id&#x2F;repositories&#x2F;:reposit&quot;, Hello)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这样 PUT 对应的根节点就会被创建出来。把这棵 PUT 的树画出来： <img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix-put.png" alt="put radix tree"></p><p>radix 的节点类型为 <code>*httprouter.node</code>，为了说明方便，我们留下了目前关心的几个字段：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">path: 当前节点对应的路径中的字符串wildChild: 子节点是否为参数节点，即 wildcard node，或者说 :id 这种类型的节点nType: 当前节点类型，有四个枚举值: 分别为 static&#x2F;root&#x2F;param&#x2F;catchAll。    static                   &#x2F;&#x2F; 非根节点的普通字符串节点    root                     &#x2F;&#x2F; 根节点    param                    &#x2F;&#x2F; 参数节点，例如 :id    catchAll                 &#x2F;&#x2F; 通配符节点，例如 *anywayindices: 子节点索引，当子节点为非参数类型，即本节点的 wildChild 为 false 时，会将每个子节点的首字母放在该索引数组。说是数组，实际上是个 string。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然，PUT 路由只有唯一的一条路径。接下来，我们以后续的多条 GET 路径为例，讲解子节点的插入过程。</p><h4 id="5-2-3-2-子节点插入"><a href="#5-2-3-2-子节点插入" class="headerlink" title="5.2.3.2 子节点插入"></a>5.2.3.2 子节点插入</h4><p>当插入 <code>GET /marketplace_listing/plans</code> 时，类似前面 PUT 的过程，GET 树的结构如图所示：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix-get-1.png" alt="get radix step 1"></p><p>因为第一个路由没有参数，path 都被存储到根节点上了。所以只有一个节点。</p><p>然后插入 <code>GET /marketplace_listing/plans/:id/accounts</code>，新的路径与之前的路径有共同的前缀，且可以直接在之前叶子节点后进行插入，那么结果也很简单，插入后树变成了这样：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix-get-2.png" alt="get radix step 2"></p><p>由于 <code>:id</code> 这个节点只有一个字符串的普通子节点，所以 indices 还依然不需要处理。</p><p>上面这种情况比较简单，新的路由可以直接作为原路由的子节点进行插入。实际情况不会这么美好。</p><h4 id="5-2-3-3-边分裂"><a href="#5-2-3-3-边分裂" class="headerlink" title="5.2.3.3 边分裂"></a>5.2.3.3 边分裂</h4><p>我们插入 <code>GET /search</code>，这时会导致树的边分裂。</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix-get-3.png" alt="get radix step 3"></p><p>原有路径和新的路径在初始的 <code>/</code> 位置发生分裂，这样需要把原有的 root 节点内容下移，再将新路由 <code>search</code> 同样作为子节点挂在 root 节点之下。这时候因为子节点出现多个，root 节点的 indices 提供子节点索引，这时候该字段就需要派上用场了。”ms” 代表子节点的首字母分别为 m(marketplace) 和 s(search)。</p><p>我们一口作气，把 <code>GET /status</code> 和 <code>GET /support</code> 也插入到树中。这时候会导致在 <code>search</code> 节点上再次发生分裂，来看看最终的结果：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-02-radix-get-4.png" alt="get radix step 4"></p><h4 id="5-2-3-4-子节点冲突处理"><a href="#5-2-3-4-子节点冲突处理" class="headerlink" title="5.2.3.4 子节点冲突处理"></a>5.2.3.4 子节点冲突处理</h4><p>在路由本身只有字符串的情况下，不会发生任何冲突。只有当路由中含有 wildcard(类似 :id) 或者 catchAll 的情况下才可能冲突。这一点在前面已经提到了。</p><p>子节点的冲突处理很简单，分几种情况：</p><ol><li>在插入 wildcard 节点时，父节点的 children 数组非空且 wildChild 被设置为 false。例如：<code>GET /user/getAll</code> 和 <code>GET /user/:id/getAddr</code>，或者 <code>GET /user/*aaa</code> 和 <code>GET /user/:id</code>。</li><li>在插入 wildcard 节点时，父节点的 children 数组非空且 wildChild 被设置为 true，但该父节点的 wildcard 子节点要插入的 wildcard 名字不一样。例如：<code>GET /user/:id/info</code> 和 <code>GET /user/:name/info</code>。</li><li>在插入 catchAll 节点时，父节点的 children 非空。例如：<code>GET /src/abc</code> 和 <code>GET /src/*filename</code>，或者 <code>GET /src/:id</code> 和 <code>GET /src/*filename</code>。</li><li>在插入 static 节点时，父节点的 wildChild 字段被设置为 true。</li><li>在插入 static 节点时，父节点的 children 非空，且子节点 nType 为 catchAll。</li></ol><p>只要发生冲突，都会在初始化的时候 panic</p><h2 id="5-3-middleware-中间件"><a href="#5-3-middleware-中间件" class="headerlink" title="5.3 middleware 中间件"></a>5.3 middleware 中间件</h2><h3 id="5-3-1-代码泥潭"><a href="#5-3-1-代码泥潭" class="headerlink" title="5.3.1 代码泥潭"></a>5.3.1 代码泥潭</h3><h3 id="5-3-2-使用-middleware-剥离非业务逻辑"><a href="#5-3-2-使用-middleware-剥离非业务逻辑" class="headerlink" title="5.3.2 使用 middleware 剥离非业务逻辑"></a>5.3.2 使用 middleware 剥离非业务逻辑</h3><p>实际上，我们犯的最大的错误是把业务代码和非业务代码揉在了一起。对于大多数的场景来讲，非业务的需求都是在 http 请求处理前做一些事情，或者/并且在响应完成之后做一些事情。</p><p>我们需要给我们的 helloHandler 增加超时时间统计，我们可以使用一种叫 <code>function adapter</code> 的方法来对 helloHandler 进行包装：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func hello(wr http.ResponseWriter, r *http.Request) &#123;    wr.Write([]byte(&quot;hello&quot;))&#125;func timeMiddleware(next http.Handler) http.Handler &#123;    return http.HandlerFunc(func(wr http.ResponseWriter, r *http.Request) &#123;        timeStart :&#x3D; time.Now()        &#x2F;&#x2F; next handler        next.ServeHTTP(wr, r)        timeElapsed :&#x3D; time.Since(timeStart)        logger.Println(timeElapsed)    &#125;)&#125;func main() &#123;    http.Handle(&quot;&#x2F;&quot;, timeMiddleware(http.HandlerFunc(hello)))    err :&#x3D; http.ListenAndServe(&quot;:8080&quot;, nil)    ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就非常轻松地实现了业务与非业务之间的剥离，魔法就在于这个 timeMiddleware。可以从代码中看到，我们的 timeMiddleware 也是一个函数，其参数为 http.Handler，http.Handler 的定义在 net/http 包中：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Handler interface &#123;    ServeHTTP(ResponseWriter, *Request)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>任何方法实现了 ServeHTTP，即是一个合法的 http.Handler，</strong></p><p>梳理一下 http 库的 Handler，HandlerFunc 和 ServeHTTP 的关系：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Handler interface &#123;    ServeHTTP(ResponseWriter, *Request)&#125;type HandlerFunc func(ResponseWriter, *Request)func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request)    f(w, r)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实际上只要你的 handler 函数签名是：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func (ResponseWriter, *Request)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>那么这个 handler 和 http.HandlerFunc 就有了一致的函数签名，可以将该 handler 函数进行类型转换，转为 http.HandlerFunc。</p><p>而 http.HandlerFunc 实现了 http.Handler 这个接口。在 http 库需要调用你的 handler 函数来处理 http 请求时，会调用 HandlerFunc 的 ServeHTTP 函数，可见一个请求的基本调用链是这样的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">h &#x3D; getHandler() &#x3D;&gt; h.ServeHTTP(w, r) &#x3D;&gt; h(w, r)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面提到的把自定义 handler 转换为 http.HandlerFunc 这个过程是必须的，因为我们的 handler 没有直接实现 ServeHTTP 这个接口。上面的代码中我们看到的 HandleFunc(注意 HandlerFunc 和 HandleFunc 的区别)里也可以看到这个强制转换过程：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) &#123;    DefaultServeMux.HandleFunc(pattern, handler)&#125;&#x2F;&#x2F; 调用func (mux *ServeMux) HandleFunc(pattern string, handler func(ResponseWriter, *Request)) &#123;    mux.Handle(pattern, HandlerFunc(handler))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>知道 handler 是怎么一回事，我们的中间件通过包装 handler，再返回一个新的 handler 就好理解了。</p><p>总结一下，我们的中间件要做的事情就是通过一个或多个函数对 handler 进行包装，返回一个包括了各个中间件逻辑的函数链。我们把上面的包装再做得复杂一些：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">customizedHandler &#x3D; logger(timeout(ratelimit(helloHandler)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个函数链在执行过程中的上下文可以用下面这张图来表示。</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-03-middleware_flow.png" alt="img"></p><p>再直白一些，这个流程在进行请求处理的时候实际上就是不断地进行函数压栈再出栈，有一些类似于递归的执行流：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[exec of logger logic]           函数栈: [][exec of timeout logic]          函数栈: [logger][exec of ratelimit logic]        函数栈: [timeout&#x2F;logger][exec of helloHandler logic]     函数栈: [ratelimit&#x2F;timeout&#x2F;logger][exec of ratelimit logic part2]  函数栈: [timeout&#x2F;logger][exec of timeout logic part2]    函数栈: [logger][exec of logger logic part2]     函数栈: []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>功能实现了，但在上面的使用过程中我们也看到了，这种函数套函数的用法不是很美观，同时也不具备什么可读性。</p><h3 id="5-3-3-更优雅的-middleware-写法"><a href="#5-3-3-更优雅的-middleware-写法" class="headerlink" title="5.3.3 更优雅的 middleware 写法"></a>5.3.3 更优雅的 middleware 写法</h3><p>如果需要修改这些函数的顺序，或者增删 middleware 还是有点费劲，</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">r &#x3D; NewRouter()r.Use(logger)r.Use(timeout)r.Use(ratelimit)r.Add(&quot;&#x2F;&quot;, helloHandler)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果我们要增加或者删除 middleware，只要简单地增加删除对应的 Use 调用就可以了。非常方便。</p><p>从框架的角度来讲，怎么实现这样的功能呢？也不复杂：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type middleware func(http.Handler) http.Handlertype Router struct &#123;    middlewareChain [] func(http.Handler) http.Handler    mux map[string] http.Handler&#125;func NewRouter() *Router&#123;    return &amp;Router&#123;&#125;&#125;func (r *Router) Use(m middleware) &#123;    r.middlewareChain &#x3D; append(r.middlewareChain, m)&#125;func (r *Router) Add(route string, h http.Handler) &#123;    var mergedHandler &#x3D; h    for i :&#x3D; len(r.middlewareChain) - 1; i &gt;&#x3D; 0; i-- &#123;        mergedHandler &#x3D; r.middlewareChain[i](mergedHandler)    &#125;    r.mux[route] &#x3D; mergedHandler&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>注意代码中的 middleware 数组遍历顺序，和用户希望的调用顺序应该是”相反”的</em>。应该不难理解。</p><h3 id="5-3-4-哪些事情适合在-middleware-中做"><a href="#5-3-4-哪些事情适合在-middleware-中做" class="headerlink" title="5.3.4 哪些事情适合在 middleware 中做"></a>5.3.4 哪些事情适合在 middleware 中做</h3><p>比如开源界很火的 gin 这个框架，就专门为用户贡献的 middleware 开了一个仓库：</p><p>如果读者去阅读 gin 的源码的话，可能会发现 gin 的 middleware 中处理的并不是 http.Handler，而是一个叫 gin.HandlerFunc 的函数类型，和本节中讲解的 http.Handler 签名并不一样。不过实际上 gin 的 handler 也只是针对其框架的一种封装，middleware 的原理与本节中的说明是一致的。</p><h2 id="5-4-validator-请求校验"><a href="#5-4-validator-请求校验" class="headerlink" title="5.4 validator 请求校验"></a>5.4 validator 请求校验</h2><h3 id="5-4-1-重构请求校验函数"><a href="#5-4-1-重构请求校验函数" class="headerlink" title="5.4.1 重构请求校验函数"></a>5.4.1 重构请求校验函数</h3><p>假设我们的数据已经通过某个 binding 库绑定到了具体的 struct 上。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type RegisterReq struct &#123;    Username        string   &#96;json:&quot;username&quot;&#96;    PasswordNew     string   &#96;json:&quot;password_new&quot;&#96;    PasswordRepeat  string   &#96;json:&quot;password_repeat&quot;&#96;    Email           string   &#96;json:&quot;email&quot;&#96;&#125;func register(req RegisterReq) error&#123;    if len(req.Username) &gt; 0 &#123;        if len(req.PasswordNew) &gt; 0 &amp;&amp; len(req.PasswordRepeat) &gt; 0 &#123;            if req.PasswordNew &#x3D;&#x3D; req.PasswordRepeat &#123;                if emailFormatValid(req.Email) &#123;                    createUser()                    return nil                &#125; else &#123;                    return errors.New(&quot;invalid email&quot;)                &#125;            &#125; else &#123;                return errors.New(&quot;password and reinput must be the same&quot;)            &#125;        &#125; else &#123;            return errors.New(&quot;password and password reinput must be longer than 0&quot;)        &#125;    &#125; else &#123;        return errors.New(&quot;length of username cannot be 0&quot;)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们在 golang 里成功写出了 hadoken 开路的箭头型代码。。这种代码一般怎么进行优化呢？</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"> if len(req.Username) &#x3D;&#x3D; 0 &#123;        return errors.New(&quot;length of username cannot be 0&quot;)    &#125;    if len(req.PasswordNew) &#x3D;&#x3D; 0 || len(req.PasswordRepeat) &#x3D;&#x3D; 0 &#123;        return errors.New(&quot;password and password reinput must be longer than 0&quot;)    &#125;    if req.PasswordNew !&#x3D; req.PasswordRepeat &#123;        return errors.New(&quot;password and reinput must be the same&quot;)    &#125;    if emailFormatValid(req.Email) &#123;        return errors.New(&quot;invalid email&quot;)    &#125;    createUser()    return nil&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然使用了重构方法使我们的 validate 过程看起来优雅了，但我们还是得为每一个 http 请求都去写这么一套差不多的 validate 函数，有没有更好的办法来帮助我们解除这项体力劳动？答案就是 validator。</p><h3 id="5-4-2-用-validator-解放体力劳动"><a href="#5-4-2-用-validator-解放体力劳动" class="headerlink" title="5.4.2 用 validator 解放体力劳动"></a>5.4.2 用 validator 解放体力劳动</h3><p>从设计的角度讲，我们一定会为每个请求都声明一个 struct。前文中提到的校验场景我们都可以通过 validator 完成工作。还以前文中的 struct 为例。为了美观起见，我们先把 json tag 省略掉。</p><p>这里我们引入一个新的 validator 库：</p><blockquote><p><a href="https://github.com/go-playground/validator">https://github.com/go-playground/validator</a></p></blockquote><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;gopkg.in&#x2F;go-playground&#x2F;validator.v9&quot;type RegisterReq struct &#123;    &#x2F;&#x2F; 字符串的 gt&#x3D;0 表示长度必须 &gt; 0，gt &#x3D; greater than    Username        string   &#96;validate:&quot;gt&#x3D;0&quot;&#96;    &#x2F;&#x2F; 同上    PasswordNew     string   &#96;validate:&quot;gt&#x3D;0&quot;&#96;    &#x2F;&#x2F; eqfield 跨字段相等校验    PasswordRepeat  string   &#96;validate:&quot;eqfield&#x3D;PasswordNew&quot;&#96;    &#x2F;&#x2F; 合法 email 格式校验    Email           string   &#96;validate:&quot;email&quot;&#96;&#125;func validate(req RegisterReq) error &#123;    err :&#x3D; validate.Struct(mystruct)    if err !&#x3D; nil &#123;        doSomething()    &#125;    ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就不需要在每个请求进入业务逻辑之前都写重复的 validate 函数了。本例中只列出了这个 validator 非常简单的几个功能。</p><p>我们试着跑一下这个程序，输入参数设置为：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F;...var req &#x3D; RegisterReq &#123;    Username       : &quot;Xargin&quot;,    PasswordNew    : &quot;ohno&quot;,    PasswordRepeat : &quot;ohn&quot;,    Email          : &quot;alex@abc.com&quot;,&#125;err :&#x3D; validate.Struct(mystruct)fmt.Println(err) &#x2F;&#x2F; Key: &#39;RegisterReq.PasswordRepeat&#39; Error:Field validation for &#39;PasswordRepeat&#39; failed on the &#39;eqfield&#39; tag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果觉得这个 validator 提供的错误信息不够人性化，例如要把错误信息返回给用户，那就不应该直接显示英文了。可以针对每种 tag 进行错误信息定制，读者可以自行探索。</p><h3 id="5-4-3-原理"><a href="#5-4-3-原理" class="headerlink" title="5.4.3 原理"></a>5.4.3 原理</h3><p>从结构上来看，每一个 struct 都可以看成是一棵树。假如我们有如下定义的 struct：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Nested struct &#123;    Email string &#96;validate:&quot;email&quot;&#96;&#125;type T struct &#123;    Age    int &#96;validate:&quot;eq&#x3D;10&quot;&#96;    Nested Nested&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从字段校验的需求来讲，无论我们采用深度优先搜索还是广度优先搜索来对这棵 struct 树来进行遍历，都是可以的。</p><p>有心的读者这时候可能会产生一个问题，我们对 struct 进行 validate 时大量使用了 reflect，而 go 的 reflect 在性能上不太出众，有时甚至会影响到我们程序的性能。这样的考虑确实有一些道理，但需要对 struct 进行大量校验的场景往往出现在 web 服务，这里并不一定是程序的性能瓶颈所在，实际的效果还是要从 pprof 中做更精确的判断。</p><p>如果基于反射的 validator 真的成为了你服务的性能瓶颈怎么办？现在也有一种思路可以避免反射：使用 golang 内置的 parser 对源代码进行扫描，然后根据 struct 的定义生成校验代码。我们可以将所有需要校验的结构体放在单独的 package 内。 </p><h2 id="5-5-Database-和数据库打交道"><a href="#5-5-Database-和数据库打交道" class="headerlink" title="5.5 Database 和数据库打交道"></a>5.5 Database 和数据库打交道</h2><p>本节将对 db/sql 官方标准库作一些简单分析，并介绍一些应用比较广泛的开源 ORM 和 sql builder。并从企业级应用开发和公司架构的角度来分析哪种技术栈对于现代的企业级应用更为合适。</p><h3 id="5-5-1-从-database-sql-讲起"><a href="#5-5-1-从-database-sql-讲起" class="headerlink" title="5.5.1 从 database/sql 讲起"></a>5.5.1 从 database/sql 讲起</h3><p>Go官方提供了 <code>database/sql</code> 包来给用户进行和数据库打交道的工作，实际上 <code>database/sql</code> 库就只是提供了一套操作数据库的接口和规范，例如抽象好的 sql 预处理(prepare)，连接池管理，数据绑定，事务，错误处理等等。官方并没有提供具体某种数据库实现的协议支持。</p><p>和具体的数据库，例如 MySQL 打交道，还需要再引入 MySQL 的驱动，像下面这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;database&#x2F;sql&quot;import _ &quot;github.com&#x2F;go-sql-driver&#x2F;mysql&quot;db, err :&#x3D; sql.Open(&quot;mysql&quot;, &quot;user:password@&#x2F;dbname&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go">import _ &quot;github.com&#x2F;go-sql-driver&#x2F;mysql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这一句 import，实际上是调用了 mysql 包的 init 函数，做的事情也很简单：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func init() &#123;    sql.Register(&quot;mysql&quot;, &amp;MySQLDriver&#123;&#125;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在 sql 包的 全局 map 里把 mysql 这个名字的 driver 注册上。实际上 Driver 在 sql 包中是一个 interface：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Driver interface &#123;    Open(name string) (Conn, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>调用 sql.Open() 返回的 db 对象实际上就是这里的 Conn。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Conn interface &#123;    Prepare(query string) (Stmt, error)    Close() error    Begin() (Tx, error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也是一个接口。实际上如果你仔细地查看 database/sql/driver/driver.go 的代码会发现，这个文件里所有的成员全都是 interface，对这些类型进行操作，实际上还是会调用具体的 driver 里的方法。</p><p>从用户的角度来讲，在使用 database/sql 包的过程中，你能够使用的也就是这些 interface 里提供的函数</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;database&#x2F;sql&quot;    _ &quot;github.com&#x2F;go-sql-driver&#x2F;mysql&quot;)func main() &#123;    &#x2F;&#x2F; db 是一个 sql.DB 类型的对象    &#x2F;&#x2F; 该对象线程安全，且内部已包含了一个连接池    &#x2F;&#x2F; 连接池的选项可以在 sql.Open 中设置，这里为了简单省略了    db, err :&#x3D; sql.Open(&quot;mysql&quot;,        &quot;user:password@tcp(127.0.0.1:3306)&#x2F;hello&quot;)    if err !&#x3D; nil &#123;        log.Fatal(err)    &#125;    defer db.Close()    var (        id int        name string    )    rows, err :&#x3D; db.Query(&quot;select id, name from users where id &#x3D; ?&quot;, 1)    if err !&#x3D; nil &#123;        log.Fatal(err)    &#125;    defer rows.Close()    &#x2F;&#x2F; 必须要把 rows 里的内容读完，否则连接永远不会释放    for rows.Next() &#123;        err :&#x3D; rows.Scan(&amp;id, &amp;name)        if err !&#x3D; nil &#123;            log.Fatal(err)        &#125;        log.Println(id, name)    &#125;    err &#x3D; rows.Err()    if err !&#x3D; nil &#123;        log.Fatal(err)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>官方的 db 库提供的功能这么简单，我们每次去数据库里读取内容岂不是都要去写这么一套差不多的代码？或者如果我们的对象是 struct，把 sql.Rows 绑定到对象的工作就会变得更加得重复而无聊。</p><p>是的，所以社区才会有各种各样的 sql builder 和 orm 百花齐放。</p><h3 id="5-5-2-提高生产效率的-ORM-和-SQL-Builder"><a href="#5-5-2-提高生产效率的-ORM-和-SQL-Builder" class="headerlink" title="5.5.2 提高生产效率的 ORM 和 SQL Builder"></a>5.5.2 提高生产效率的 ORM 和 SQL Builder</h3><p>在 web 开发领域常常提到的 ORM 是什么？我们先看看万能的维基百科：</p><blockquote><p>对象关系映射（英语：Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序设计技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。<br>从效果上说，它其实是创建了一个可在编程语言里使用的“虚拟对象数据库”。</p></blockquote><p>最为常见的 ORM 实际上做的是从 db -&gt; 程序的 class / struct 这样的映射。所以你手边的程序可能是从 mysql 的表 -&gt; 你的程序内 class。 </p><p>ORM 的目的就是屏蔽掉DB层，实际上很多语言的 ORM 只要把你的 class/struct 定义好，再用特定的语法将结构体之间的一对一或者一对多关系表达出来。</p><p>举个例子，我们有个需求：向用户展示最新的商品列表，我们再假设，商品和商家是1:1的关联关系，我们就很容易写出像下面这样的代码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 伪代码shopList :&#x3D; []for product in productList &#123;    shopList &#x3D; append(shopList, product.GetShop)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然了，我们不能批判这样写代码的程序员是偷懒的程序员。因为ORM 一类的工具在出发点上就是屏蔽 sql，让我们对数据库的操作更接近于人类的思维方式。这样很多只接触过 orm 而且又是刚入行的程序员就很容易写出上面这样的代码。</p><p>这样的代码将对数据库的读请求放大了 N 倍。也就是说，如果你的商品列表有 15 个 SKU，那么每次用户打开这个页面，至少需要执行 1(查询商品列表) + 15(查询相关的商铺信息) 次查询。这里 N 是 16。如果你的列表页很大，比如说有 600 个条目，那么你就至少要执行 1 + 600 次查询。如果说你的数据库能够承受的最大的简单查询是12w QPS，而上述这样的查询正好是你最常用的查询的话，实际上你能对外提供的服务能力是多少呢？是 200 qps！互联网系统的忌讳之一，就是这种无端的读放大。</p><p>当然，你也可以说这不是 ORM 的问题，如果你手写 sql 你还是可能会写出差不多的程序，那么再来看两个 demo：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">o :&#x3D; orm.NewOrm()num, err :&#x3D; o.QueryTable(&quot;cardgroup&quot;).Filter(&quot;Cards__Card__Name&quot;, cardName).All(&amp;cardgroups)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>很多 orm 都提供了这种 Filter 类型的查询方式，beego 也不例外。不过实际上在这段 orm 背后隐藏了非常难以察觉的细节，那就是生成的 sql 语句会自动 limit 1000。</p><p>一个程序库背地里做的事情还是越少越好，如果一定要做，那也一定要在显眼的地方做。比如上面的例子，去掉这种默认的自作聪明的行为，或者要求用户强制传入 limit 参数都是更好的选择</p><p>orm 想从设计上隐去太多的细节。而方便的代价是其背后的运行完全失控。这样的项目在经过几任维护人员之后，将变得面目全非，难以维护。上了规模的公司的人们渐渐达成了一个共识，由于隐藏重要的细节，ORM 可能是失败的设计。其所隐藏的重要细节对于上了规模的系统开发来说至关重要。</p><p>相比 ORM 来说，sql builder 在 sql 和项目可维护性之间取得了比较好的平衡。首先 sql builer 不像 ORM 那样屏蔽了过多的细节，其次从开发的角度来讲，sql builder 简单进行封装后也可以非常高效地完成开发，举个例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">where :&#x3D; map[string]interface&#123;&#125; &#123;    &quot;order_id &gt; ?&quot; : 0,    &quot;customer_id !&#x3D; ?&quot; : 0,&#125;limit :&#x3D; []int&#123;0,100&#125;orderBy :&#x3D; []string&#123;&quot;id asc&quot;, &quot;create_time desc&quot;&#125;orders :&#x3D; orderModel.GetList(where, limit, orderBy)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>说白了 sql builder 是 sql 在代码里的一种特殊方言，如果你们没有DBA(A <em>database</em> administrator )但研发有自己分析和优化 sql 的能力，或者你们公司的 dba 对于学习这样一些 sql 的方言没有异议。那么使用 sql builder 是一个比较好的选择，不会导致什么问题。</p><p>在一些本来也不需要DBA介入的场景内，使用 sql builder 也是可以的，例如你要做一套运维系统，且将 mysql 当作了系统中的一个组件，系统的 QPS 不高，查询不复杂等等。</p><p>一旦你做的是高并发的 OLTP 在线系统，且想在人员充足分工明确的前提下最大程度控制系统的风险，使用 sql builder 就不合适了。</p><h3 id="5-5-3-脆弱的-db"><a href="#5-5-3-脆弱的-db" class="headerlink" title="5.5.3 脆弱的 db"></a>5.5.3 脆弱的 db</h3><p>无论是 ORM 还是 sql builder 都有一个致命的缺点，就是没有办法进行系统上线的事前 sql 审核。虽然很多 orm 和 sql builder 也提供了运行期打印 sql 的功能，但只在查询的时候才能进行输出。而 sql builder 和 ORM本身提供的功能太过灵活。使得你不可能通过测试枚举出所有可能在线上执行的 sql。</p><p>对于现在 7 * 24 服务的互联网公司来说，服务不可用是非常重大的问题。存储层的技术栈虽经历了多年的发展，在整个系统中依然是最为脆弱的一环。系统宕机对于 24 小时对外提供服务的公司来说，意味着直接的经济损失。个中风险不可忽视。</p><p>所以现如今，大型的互联网公司核心线上业务都会在代码中把 sql 放在显眼的位置提供给 DBA review，以此来控制系统在数据层的风险。结合Go 举一个例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">const (    getAllByProductIDAndCustomerID &#x3D; &#96;select * from p_orders where product_id in (:product_id) and customer_id&#x3D;:customer_id&#96;)&#x2F;&#x2F; GetAllByProductIDAndCustomerID&#x2F;&#x2F; @param driver_id&#x2F;&#x2F; @param rate_date&#x2F;&#x2F; @return []Order, errorfunc GetAllByProductIDAndCustomerID(ctx context.Context, productIDs []uint64, customerID uint64) ([]Order, error) &#123;    var orderList []Order    params :&#x3D; map[string]interface&#123;&#125;&#123;        &quot;product_id&quot; : productIDs,        &quot;customer_id&quot;: customerID,    &#125;    &#x2F;&#x2F; getAllByProductIDAndCustomerID 是 const 类型的 sql 字符串    sql, args, err :&#x3D; sqlutil.Named(getAllByProductIDAndCustomerID, params)    if err !&#x3D; nil &#123;        return nil, err    &#125;    err &#x3D; dao.QueryList(ctx, sqldbInstance, sql, args, &amp;orderList)    if err !&#x3D; nil &#123;        return nil, err    &#125;    return orderList, err&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>像这样的代码，在上线之前把DAO层的变更集的 const 部分直接拿给 dba 来进行审核，就比较方便了。代码中的 sqlutil.Named 是类似于 sqlx 中的 Named 函数，同时支持 where 表达式中的比较操作符和 in。</p><h2 id="5-6-Ratelimit-服务流量限制"><a href="#5-6-Ratelimit-服务流量限制" class="headerlink" title="5.6 Ratelimit 服务流量限制"></a>5.6 Ratelimit 服务流量限制</h2><p>计算机程序可依据其瓶颈分为 Disk IO-bound，CPU-bound，Network-bound，分布式场景下有时候也会外部系统而导致自身瓶颈</p><p>web 系统打交道最多的是网络，无论是接收，解析用户请求，访问存储，还是把响应数据返回给用户，都是要走网络的。在没有 epoll/kqueue 之类的系统提供的 IO 多路复用接口之前，多个核心的现代计算机最头痛的是 C10k 问题，C10k 问题会导致计算机没有办法充分利用 CPU 来处理更多的用户连接，进而没有办法通过优化程序提升 CPU 利用率来处理更多的请求。</p><p>自从 linux 实现了 epoll，freebsd 实现了 kqueue，这个问题基本解决了，我们可以借助内核提供的 API 轻松解决当年的 C10k 问题，也就是说如今如果你的程序主要是和网络打交道，那么瓶颈一定在用户程序而不在操作系统内核。</p><p>随着时代的发展，编程语言对这些系统调用又进一步进行了封装，如今做应用层开发，几乎不会在程序中看到 epoll 之类的字眼，大多数时候我们就只要聚焦在业务逻辑上就好。Go 的 net 库针对不同平台封装了不同的 syscall API，http 库又是构建在 net 库之上，所以在 Go 我们可以借助标准库，很轻松地写出高性能的 http 服务，下面是一个简单的 <code>hello world</code> 服务的代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;io&quot;    &quot;log&quot;    &quot;net&#x2F;http&quot;)func sayhello(wr http.ResponseWriter, r *http.Request) &#123;    wr.WriteHeader(200)    io.WriteString(wr, &quot;hello world&quot;)&#125;func main() &#123;    http.HandleFunc(&quot;&#x2F;&quot;, sayhello)    err :&#x3D; http.ListenAndServe(&quot;:9090&quot;, nil)    if err !&#x3D; nil &#123;        log.Fatal(&quot;ListenAndServe:&quot;, err)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们需要衡量一下这个 web 服务的吞吐量，再具体一些，实际上就是接口的 QPS（Queries Per Second) 是每秒查询率。借助 wrk，在家用电脑 Macbook Pro 上对这个 <code>hello world</code> 服务进行基准测试， </p><p>这里的 <code>hello world</code> 服务没有任何业务逻辑。真实环境的程序要复杂得多，有些程序偏 Network-bound，例如一些 cdn 服务、proxy 服务；有些程序偏 CPU/GPU bound，例如登陆校验服务、图像处理服务；有些程序偏 Disk IO-bound，例如专门的存储系统，数据库。不同的程序瓶颈会体现在不同的地方，这里提到的这些功能单一的服务相对来说还算容易分析。如果碰到业务逻辑复杂代码量巨大的模块，其瓶颈并不是三下五除二可以推测出来的，还是需要从压力测试中得到更为精确的结论。</p><p>对于 IO/Network bound 类的程序，其表现是网卡/磁盘 IO 会先于 CPU 打满，这种情况即使优化 CPU 的使用也不能提高整个系统的吞吐量，只能提高磁盘的读写速度，增加内存大小，提升网卡的带宽来提升整体性能。而 CPU bound 类的程序，则是在存储和网卡未打满之前 CPU 占用率提前到达 100%，CPU 忙于各种计算任务，IO 设备相对则较闲。</p><p>无论哪种类型的服务，在资源使用到极限的时候都会导致请求堆积，超时，系统 hang 死，最终伤害到终端用户。对于分布式的 web 服务来说，瓶颈还不一定总在系统内部，也有可能在外部。非计算密集型的系统往往会在关系型数据库环节失守，而这时候 web 模块本身还远远未达到瓶颈。</p><p>不管我们的服务瓶颈在哪里，最终要做的事情都是一样的，那就是流量限制</p><h3 id="5-6-1-常见的流量限制手段"><a href="#5-6-1-常见的流量限制手段" class="headerlink" title="5.6.1 常见的流量限制手段"></a>5.6.1 常见的流量限制手段</h3><p>流量限制的手段有很多，最常见的：漏桶、令牌桶两种：</p><ol><li>漏桶是指我们有一个一直装满了水的桶，每过固定的一段时间即向外漏一滴水。如果你接到了这滴水，那么你就可以继续服务请求，如果没有接到，那么就需要等待下一滴水。</li><li>令牌桶则是指匀速向桶中添加令牌，服务请求时需要从桶中获取令牌，令牌的数目可以按照需要消耗的资源进行相应的调整。如果没有令牌，可以选择等待，或者放弃。</li></ol><p>这两种方法看起来很像，不过还是有区别的。漏桶流出的速率固定，而令牌桶只要在桶中有令牌，那就可以拿。也就是说令牌桶是允许一定程度的并发的，令牌桶在桶中没有令牌的情况下也会退化为漏桶模型。</p><p>实际应用中令牌桶应用较为广泛，开源界流行的限流器大多数都是基于令牌桶思想的。并且在此基础上进行了一定程度的扩充，比如 <code>github.com/juju/ratelimit</code> 提供了几种不同特色的令牌桶填充方式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func NewBucket(fillInterval time.Duration, capacity int64) *Bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认的令牌桶，fillInterval 指每过多长时间向桶里放一个令牌，capacity 是桶的容量，超过桶容量的部分会被直接丢弃。桶初始是满的。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func NewBucketWithQuantum(fillInterval time.Duration, capacity, quantum int64) *Bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>和普通的 NewBucket 的区别是，每次向桶中放令牌时，是放 quantum 个令牌，而不是一个令牌。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func NewBucketWithRate(rate float64, capacity int64) *Bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个就有点特殊了，会按照提供的比例，每秒钟填充令牌数。例如 capacity 是 100，而 rate 是 0.1，那么每秒会填充 10 个令牌。</p><p>相比于开源界更为有名的 google 的 Java 工具库 Guava 中提供的 ratelimiter，这个库不支持令牌桶预热，且无法修改初始的令牌容量，所以可能个别极端情况下的需求无法满足。但在明白令牌桶的基本原理之后，如果没办法满足需求，相信你也可以很快对其进行修改并支持自己的业务场景。</p><h3 id="5-6-2-原理"><a href="#5-6-2-原理" class="headerlink" title="5.6.2 原理"></a>5.6.2 原理</h3><p>从功能上来看，令牌桶模型实际上就是对全局计数的加减法操作过程，但使用计数需要我们自己加读写锁，有小小的思想负担。如果我们对 Go 语言已经比较熟悉的话，很容易想到可以用 buffered channel 来完成简单的加令牌取令牌操作：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var tokenBucket &#x3D; make(chan struct&#123;&#125;, capacity)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>每过一段时间向 tokenBucket 中添加 token，如果 bucket 已经满了，那么直接放弃：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">illToken :&#x3D; func() &#123;    ticker :&#x3D; time.NewTicker(fillInterval)    for &#123;        select &#123;        case &lt;-ticker.C:            select &#123;            case tokenBucket &lt;- struct&#123;&#125;&#123;&#125;:            default:            &#125;            fmt.Println(&quot;current token cnt:&quot;, len(tokenBucket), time.Now())        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的令牌桶的取令牌操作实现起来也比较简单，简化问题，我们这里只取一个令牌：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func TakeAvailable(block bool) bool&#123;    var takenResult bool    if block &#123;        select &#123;        case &lt;-tokenBucket:            takenResult &#x3D; true        &#125;    &#125; else &#123;        select &#123;        case &lt;-tokenBucket:            takenResult &#x3D; true        default:            takenResult &#x3D; false        &#125;    &#125;    return takenResult&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一些公司自己造的限流的轮子就是用上面这种方式来实现的，不过如果开源版 ratelimit 也如此的话，那我们也没什么可说的了。现实并不是这样的。</p><p>我们来思考一下，令牌桶每隔一段固定的时间向桶中放令牌，如果我们记下上一次放令牌的时间为 t1，和当时的令牌数 k1，放令牌的时间间隔为 ti，每次向令牌桶中放 x 个令牌，令牌桶容量为 cap。现在如果有人来调用 <code>TakeAvailable</code> 来取 n 个令牌，我们将这个时刻记为 t2。在 t2 时刻，令牌桶中理论上应该有多少令牌呢？伪代码如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">cur &#x3D; k1 + ((t2 - t1)&#x2F;ti) * xcur &#x3D; cur &gt; cap ? cap : cur<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们用两个时间点的时间差，再结合其它的参数，理论上在取令牌之前就完全可以知道桶里有多少令牌了。那劳心费力地像本小节前面向 channel 里填充 token 的操作，理论上是没有必要的。只要在每次 <code>Take</code> 的时候，再对令牌桶中的 token 数进行简单计算，就可以得到正确的令牌数。是不是很像 <code>惰性求值</code> 的感觉？</p><p>在得到正确的令牌数之后，再进行实际的 Take 操作就好，这个 Take 操作只需要对令牌数进行简单的减法即可，记得加锁以保证并发安全。<code>github.com/juju/ratelimit</code> 这个库就是这样做的。</p><h3 id="5-6-3-服务瓶颈和-QoS"><a href="#5-6-3-服务瓶颈和-QoS" class="headerlink" title="5.6.3 服务瓶颈和 QoS"></a>5.6.3 服务瓶颈和 QoS</h3><p>前面我们说了很多 CPU-bound、IO-bound 之类的概念，这种性能瓶颈从大多数公司都有的监控系统中可以比较快速地定位出来，如果一个系统遇到了性能问题，那监控图的反应一般都是最快的。</p><p>虽然性能指标很重要，但对用户提供服务时还应考虑服务整体的 QoS。QoS 全称是 Quality of Service，顾名思义是服务质量。QoS 包含有可用性、吞吐量、时延、时延变化和丢失等指标。一般来讲我们可以通过优化系统，来提高 web 服务的 CPU 利用率，从而提高整个系统的吞吐量。但吞吐量提高的同时，用户体验是有可能变差的。用户角度比较敏感的除了可用性之外，还有时延。虽然你的系统吞吐量高，但半天刷不开页面，想必会造成大量的用户流失。</p><p>所以在大公司的 web 服务性能指标中，除了平均响应时延之外，还会把响应时间的 95 分位，99 分位也拿出来作为性能标准。平均响应在提高 CPU 利用率没受到太大影响时，可能 95 分位、 99 分位的响应时间大幅度攀升了，那么这时候就要考虑提高这些 CPU 利用率所付出的代价是否值得了。</p><p>在线系统的机器一般都会保持 CPU 有一定的余裕。</p><h3 id="5-7-layout-常见大型-web-项目分层"><a href="#5-7-layout-常见大型-web-项目分层" class="headerlink" title="5.7 layout 常见大型 web 项目分层"></a>5.7 layout 常见大型 web 项目分层</h3><p>流行的 web 框架大多数是 MVC 框架，</p><ol><li>控制器（Controller）- 负责转发请求，对请求进行处理。</li><li>视图（View） - 界面设计人员进行图形界面设计。</li><li>模型（Model） - 程序员编写程序应有的功能（实现算法等等）、数据库专家进行数据管理和数据库设计(可以实现具体的功能)。</li></ol><p>随着时代的发展，前端也变成了越来越复杂的工程，为了更好地工程化，现在更为流行的一般是前后分离的架构。可以认为前后分离是把 V 层从 MVC 中抽离单独成为项目。这样一个后端项目一般就只剩下 M 和 C 层了。前后端之间通过 ajax 来交互，有时候要解决跨域的问题，但也已经有了较为成熟的方案。下面是一个前后分离的系统的简易交互图。</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-frontend-backend.png" alt="前后分离"></p><p>事实上，即使是简单的项目，业界也并没有完全遵守 MVC 框架提出者对于 M 和 C 所定义的分工。有很多公司的项目会在 controller 层塞入大量的逻辑，在 model 层就只管理数据的存储。这往往来源于对于 model 层字面含义的某种擅自引申理解。认为字面意思，这一层就是处理某种建模，而模型是什么？就是数据呗！</p><p>这种理解显然是有问题的，业务流程也算是一种“模型”，是对真实世界用户行为或者既有流程的一种建模，并非只有按格式组织的数据才能叫模型。不过按照 MVC 的创始人的想法，我们如果把和数据打交道的代码还有业务流程全部塞进 MVC 里的 M 层的话，这个 M 层又会显得有些过于臃肿。对于复杂的项目，一个 C 和一个 M 层显然是不够用的，现在比较流行的纯后端 api 模块一般采用下述划分方法：</p><ol><li>Controller，与上述类似，服务入口，负责处理路由，参数校验，请求转发。</li><li>Logic/Service，逻辑(服务)层，一般是业务逻辑的入口，可以认为从这里开始，所有的请求参数一定是合法的。业务逻辑和业务流程也都在这一层中。常见的设计中会将该层称为 Business Rules。</li><li>DAO/Repository，这一层主要负责和数据、存储打交道。将下层存储以更简单的函数、接口形式暴露给 Logic 层来使用。负责数据的持久化工作。</li></ol><p>每一层都会做好自己的工作，然后用请求当前的上下文构造下一层工作所需要的结构体或其它类型参数，然后调用下一次的函数。在工作完成之后，再把处理结果一层层地传出到入口。</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-controller-logic-dao.png" alt="controller-logic-dao"></p><p>划分为 CLD 三层之后，在 C 层之前我们可能还需要同时支持多种协议。本章前面讲到的 thrift、gRPC 和 http 并不是一定只选择其中一种，有时我们需要支持其中的两种，比如同一个接口，我们既需要效率较高的 thrift，也需要方便 debug 的 http 入口。即除了 CLD 之外，还需要一个单独的 protocol 层，负责处理各种交互协议的细节。这样请求的流程会变成下面这样：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-control-flow.png" alt="control-flow"></p><p>这样我们 controller 中的入口函数就变成了下面这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func CreateOrder(ctx context.Context, req *CreateOrderStruct) (*CreateOrderRespStruct, error) &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go">func CreateOrder(ctx context.Context, req *CreateOrderStruct) (*CreateOrderRespStruct, error) &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>CreateOrder 有两个参数，ctx 用来传入 trace_id 一类的需要串联请求的全局参数，req 里存储了我们创建订单所需要的所有输入信息。返回结果是一个响应结构体和错误。可以认为，我们的代码运行到 controller 层之后，就没有任何与“协议”相关的代码了。在这里你找不到 http.Request，也找不到 http.ResponseWriter，也找不到任何与 thrift 或者 gRPC 相关的字眼。</p><p>在 protocol 层，处理 http 协议的大概代码如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; defined in protocol layertype CreateOrderRequest struct &#123;    OrderID int64 &#96;json:&quot;order_id&quot;&#96;    &#x2F;&#x2F; ...&#125;&#x2F;&#x2F; defined in controllertype CreateOrderParams struct &#123;    OrderID int64&#125;func HTTPCreateOrderHandler(wr http.ResponseWriter, r *http.Request) &#123;    var req CreateOrderRequest    var params CreateOrderParams    ctx :&#x3D; context.TODO()    &#x2F;&#x2F; bind data to req    bind(r, &amp;req)    &#x2F;&#x2F; map protocol binded to protocol-independent    map(req, params)    logicResp,err :&#x3D; controller.CreateOrder(ctx, &amp;params)    if err !&#x3D; nil &#123;&#125;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>理论上我们可以用同一个 request struct 组合上不同的 tag，来达到一个 struct 来给不同的协议复用的目的。不过遗憾的是在 thrift 中，request struct 也是通过 IDL 生成的，其内容在自动生成的 ttypes.go 文件中，我们还是需要在 thrift 的入口将这个自动生成的 struct 映射到我们 logic 入口所需要的 struct 上。gRPC 也是类似。这部分代码还是需要的。</p><p>聪明的读者可能已经可以看出来了，协议细节处理这一层实际上有大量重复劳动，每一个接口在协议这一层的处理，无非是把数据从协议特定的 struct(例如 http.Request，thrift 的被包装过了) 读出来，再绑定到我们协议无关的 struct 上，再把这个 struct 映射到 controller 入口的 struct 上，这些代码实际上长得都差不多。差不多的代码都遵循着某种模式，那么我们可以对这些模式进行简单的抽象，用 codegen 来把繁复的协议处理代码从工作内容中抽离出去。</p><p>先来看看 http 对应的 struct、thrift 对应的 struct 和我们协议无关的 struct 分别长什么样子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; http request structtype CreateOrder struct &#123;    OrderID int64 &#96;json:&quot;order_id&quot; validate:&quot;required&quot;&#96;    UserID int64 &#96;json:&quot;user_id&quot; validate:&quot;required&quot;&#96;    ProductID int &#96;json:&quot;prod_id&quot; validate:&quot;required&quot;&#96;    Addr string &#96;json:&quot;addr&quot; validate:&quot;required&quot;&#96;&#125;&#x2F;&#x2F; thrift request structtype FeatureSetParams struct &#123;    DriverID int64 &#96;thrift:&quot;driverID,1,required&quot;&#96;    OrderID int64 &#96;thrift:&quot;OrderID,2,required&quot;&#96;    UserID int64 &#96;thrift:&quot;UserID,3,required&quot;&#96;    ProductID int &#96;thrift:&quot;ProductID,4,required&quot;&#96;    Addr string &#96;thrift:&quot;Addr,5,required&quot;&#96;&#125;&#x2F;&#x2F; controller input structtype CreateOrderParams struct &#123;    OrderID int64    UserID int64    ProductID int    Addr string&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们需要通过一个源 struct 来生成我们需要的 http 和 thrift 入口代码。再观察一下上面定义的三种 struct，实际上我们只要能用一个 struct 生成 thrift 的 IDL，以及 http 服务的 “IDL(实际上就是带 json/form 相关 tag 的 struct 定义)” 就可以了。这个初始的 struct 我们可以把 struct 上的 http 的 tag 和 thrift 的 tag 揉在一起：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type FeatureSetParams struct &#123;    DriverID int64 &#96;thrift:&quot;driverID,1,required&quot; json:&quot;driver_id&quot;&#96;    OrderID int64 &#96;thrift:&quot;OrderID,2,required&quot; json:&quot;order_id&quot;&#96;    UserID int64 &#96;thrift:&quot;UserID,3,required&quot; json:&quot;user_id&quot;&#96;    ProductID int &#96;thrift:&quot;ProductID,4,required&quot; json:&quot;prod_id&quot;&#96;    Addr string &#96;thrift:&quot;Addr,5,required&quot; json:&quot;addr&quot;&#96;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后通过代码生成把 thrift 的 IDL 和 http 的 request struct 都生成出来：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-code-gen.png" alt="code gen"></p><p>至于用什么手段来生成，你可以通过 go 语言内置的 parser 读取文本文件中的 Go 源代码，然后根据 ast 来生成目标代码，也可以简单地把这个源 struct 和 generator 的代码放在一起编译，让 struct 作为 generator 的输入参数(这样会更简单一些)，都是可以的。</p><p>当然这种思路并不是唯一选择，我们还可以通过解析 thrift 的 IDL，生成一套 http 接口的 struct。如果你选择这么做，那整个流程就变成了这样：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-code-gen-2.png" alt="code gen"></p><p>看起来比之前的图顺畅一点，不过如果你选择了这么做，你需要自行对 thrift 的 IDL 进行解析，也就是相当于可能要手写一个 thrift 的 IDL 的 parser，虽然现在有 antlr 或者 peg 能帮你简化这些 parser 的书写工作，但在“解析”的这一步我们不希望引入太多的工作量，所以量力而行即可。</p><p>既然工作流已经成型，我们可以琢磨一下怎么让整个流程对用户更加友好。</p><p>比如在前面的生成环境引入 GUI 或者 web 页面，只要让用户点点鼠标就能生成 SDK，这些就靠读者自己去探索了。</p><p>本节中所叙述的分层没有将 middleware 作为项目的分层考虑进去。如果我们考虑 middleware 的话，请求的流程是什么样的？</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-08-control-flow-2.png" alt="control flow 2"></p><p>之前我们学习的 middleware 是和 http 协议强相关的，遗憾的是在 thrift 中看起来没有和 http 中对等的解决这些非功能性逻辑代码重复问题的 middleware。所以我们在图上写 <code>thrift stuff</code>。这些 <code>stuff</code> 可能需要你手写去实现，然后每次增加一个新的 thrift 接口，就需要去写一遍这些非功能性代码。</p><p>这也是很多企业项目所面临的真实问题，遗憾的是开源界并没有这样方便的多协议 middleware 解决方案。当然了，前面我们也说过，很多时候我们给自己保留的 http 接口只是用来做 debug，并不会暴露给外人用。这种情况下，这些非功能性的代码只要在 thrift 的代码中完成即可。</p><h2 id="5-8-interface-和-table-driven-开发"><a href="#5-8-interface-和-table-driven-开发" class="headerlink" title="5.8 interface 和 table-driven 开发"></a>5.8 interface 和 table-driven 开发</h2><p>在 web 项目中经常会遇到外部依赖环境的变化，比如：</p><ol><li>公司的老存储系统年久失修，现在已经没有人维护了，新的系统上线也没有考虑平滑迁移，但最后通牒已下，要求 N 天之内迁移完毕。</li><li>平台部门的老用户系统年久失修(怎么都是年久失修，摔！)，现在已经没有人维护了，真是悲伤的故事。新系统上线没有考虑兼容老接口，但最后通牒已下，要求 N 个月之内迁移完毕。</li><li>公司的老消息队列人走茶凉，年久失修(汗)，新来的技术精英们没有考虑向前兼容，但最后通牒已下，要求半年之内迁移完毕。</li></ol><p>所以你看到了，我们的外部依赖总是为了自己爽而不断地做升级，且不想做向前兼容，然后来给我们下最后通牒。如果我们的部门工作饱和，领导强势，那么有时候也可以倒逼依赖方来做兼容。但世事不一定如人愿，即使我们的领导强势，读者朋友的领导也还是可能认怂的。</p><h3 id="5-8-1-业务系统的发展过程"><a href="#5-8-1-业务系统的发展过程" class="headerlink" title="5.8.1 业务系统的发展过程"></a>5.8.1 业务系统的发展过程</h3><p>互联网公司只要可以活过三年，工程方面面临的首要问题就是代码膨胀。系统的代码膨胀之后，可以将系统中与业务本身流程无关的部分做拆解和异步化。什么算是业务无关呢，比如一些统计、反作弊、营销发券、价格计算、用户状态更新等等需求。这些需求往往依赖于主流程的数据，但又只是挂在主流程上的旁支，自成体系。</p><p>这时候我们就可以把这些旁支拆解出去，作为独立的系统来部署、开发以及维护。这些旁支流程的时延如若非常敏感，比如用户在界面上点了按钮，需要立刻返回(价格计算、支付)，那么需要与主流程系统进行 RPC 通信，并且在通信失败时，要将结果直接返回给用户。如果时延不敏感，比如抽奖系统，结果稍后公布的这种，或者非实时的统计类系统，那么就没有必要在主流程里为每一套系统做一套 RPC 流程。我们只要将下游需要的数据打包成一条消息，传入消息队列，之后的事情与主流程一概无关(当然，与用户的后续交互流程还是要做的)。</p><p>通过拆解和异步化虽然解决了一部分问题，但并不能解决所有问题。随着业务发展，单一职责的模块也会变得越来越复杂，这是必然的趋势。一件事情本身变的复杂的话，这时候拆解和异步化就不灵了。我们还是要对事情本身进行一定程度的封装抽象。</p><h3 id="5-8-2-使用函数封装业务流程"><a href="#5-8-2-使用函数封装业务流程" class="headerlink" title="5.8.2 使用函数封装业务流程"></a>5.8.2 使用函数封装业务流程</h3><p>最基本的封装过程，我们把相似的行为放在一起，然后打包成一个一个的函数，让自己杂乱无章的代码变成下面这个样子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func BusinessProcess(ctx context.Context, params Params) (resp, error)&#123;    ValidateLogin()    ValidateParams()    AntispamCheck()    GetPrice()    CreateOrder()    UpdateUserStatus()    NotifyDownstreamSystems()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不管是多么复杂的业务，系统内的逻辑都是可以分解为 step1 -&gt; step2 -&gt; step3 … 这样的流程的。</p><p>每一个步骤内部也</p><p>会有复杂的流程，比如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func CreateOrder() &#123;    ValidateDistrict() &#x2F;&#x2F; 判断是否是地区限定商品    ValidateVIPProduct() &#x2F;&#x2F; 检查是否是只提供给 vip 的商品    GetUserInfo() &#x2F;&#x2F; 从用户系统获取更详细的用户信息    GetProductDesc() &#x2F;&#x2F; 从商品系统中获取商品在该时间点的详细信息    DecrementStorage() &#x2F;&#x2F; 扣减库存    CreateOrderSnapshot() &#x2F;&#x2F; 创建订单快照    return CreateSuccess&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在阅读业务流程代码时，我们只要阅读其函数名就能知晓在该流程中完成了哪些操作，如果需要修改细节，那么就继续深入到每一个业务步骤去看具体的流程。写得稀烂的业务流程代码则会将所有过程都堆积在少数的几个函数中，从而导致几百甚至上千行的函数。这种意大利面条式的代码阅读和维护都会非常痛苦。在开发的过程中，一旦有条件应该立即进行类似上面这种方式的简单封装。</p><h3 id="5-8-3-使用-interface-来做抽象"><a href="#5-8-3-使用-interface-来做抽象" class="headerlink" title="5.8.3 使用 interface 来做抽象"></a>5.8.3 使用 interface 来做抽象</h3><p>业务发展的早期，是不适宜引入 interface 的，很多时候业务流程变化很大，过早引入 interface 会使业务系统本身增加很多不必要的分层，从而导致每次修改几乎都要全盘否定之前的工作。</p><p>当业务发展到一定阶段，主流程稳定之后，就可以适当地使用 interface 来进行抽象了。这里的稳定，是指主流程的大部分业务步骤已经确定，即使再进行修改，也不会进行大规模的变动，而只是小修小补，或者只是增加或删除少量业务步骤。</p><p>如果我们在开发过程中，已经对业务步骤进行了良好的封装，这时候进行 interface 抽象化就会变的非常容易，伪代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; OrderCreator 创建订单流程type OrderCreator interface &#123;    ValidateDistrict()    &#x2F;&#x2F; 判断是否是地区限定商品    ValidateVIPProduct()  &#x2F;&#x2F; 检查是否是只提供给 vip 的商品    GetUserInfo()         &#x2F;&#x2F; 从用户系统获取更详细的用户信息    GetProductDesc()      &#x2F;&#x2F; 从商品系统中获取商品在该时间点的详细信息    DecrementStorage()    &#x2F;&#x2F; 扣减库存    CreateOrderSnapshot() &#x2F;&#x2F; 创建订单快照&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们只要把之前写过的步骤函数签名都提到一个 interface 中，就可以完成抽象了。</p><p>在进行抽象之前，我们应该想明白的一点是，引入 interface 对我们的系统本身是否有意义，这是要按照场景去进行分析的。假如我们的系统只服务一条产品线，并且内部的代码只是针对很具体的场景进行定制化开发，那么实际上引入 interface 是不会带来任何收益的。至于说是否方便测试，这一点我们会在之后的章节来讲。</p><p>如果我们正在做的是平台系统，需要由平台来定义统一的业务流程和业务规范，那么基于 interface 的抽象就是有意义的。举个例子：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-interface-impl.uml.png" alt="interface-impl"></p><p>平台需要服务多条业务线，但数据定义需要统一，所以希望都能走平台定义的流程。作为平台方，我们可以定义一套类似上文的 interface，然后要求接入方的业务必须将这些 interface 都实现。如果 interface 中有其不需要的步骤，那么只要返回 nil，或者忽略就好。</p><p>在业务进行迭代时，平台的代码是不用修改的，这样我们便把这些接入业务当成了平台代码的插件(plugin)引入进来了。如果没有 interface 的话，我们会怎么做？</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;sample.com&#x2F;travelorder&quot;    &quot;sample.com&#x2F;marketorder&quot;)func CreateOrder() &#123;    switch businessType &#123;        case TravelBusiness:            travelorder.CreateOrder()        case MarketBusiness:            marketorder.CreateOrderForMarket()        default:            return errors.New(&quot;not supported business&quot;)    &#125;&#125;func ValidateUser() &#123;    switch businessType &#123;        case TravelBusiness:            travelorder.ValidateUserVIP()        case MarketBusiness:            marketorder.ValidateUserRegistered()        default:            return errors.New(&quot;not supported business&quot;)    &#125;&#125;&#x2F;&#x2F; ...switch ...switch ...switch ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>没错，就是无穷无尽的 switch，和没完没了的垃圾代码。引入了 interface 之后，我们的 switch 只需要在业务入口做一次。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type BusinessInstance interface &#123;    ValidateLogin()    ValidateParams()    AntispamCheck()    GetPrice()    CreateOrder()    UpdateUserStatus()    NotifyDownstreamSystems()&#125;func entry() &#123;    var bi BusinessInstance    switch businessType &#123;        case TravelBusiness:            bi &#x3D; travelorder.New()        case MarketBusiness:            bi &#x3D; marketorder.New()        default:            return errors.New(&quot;not supported business&quot;)    &#125;&#125;func BusinessProcess(bi BusinessInstance) &#123;    bi.ValidateLogin()    bi.ValidateParams()    bi.AntispamCheck()    bi.GetPrice()    bi.CreateOrder()    bi.UpdateUserStatus()    bi.NotifyDownstreamSystems()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接面向 interface 编程，而不用关心具体的实现了。如果对应的业务在迭代中发生了修改，所有的逻辑对平台方来说也是完全透明的。</p><h3 id="5-8-4-interface-的优缺点"><a href="#5-8-4-interface-的优缺点" class="headerlink" title="5.8.4 interface 的优缺点"></a>5.8.4 interface 的优缺点</h3><p>Go 被人称道的最多的地方是其 interface 设计的正交性，模块之间不需要知晓相互的存在，A 模块定义 interface，B 模块实现这个 interface 就可以。如果 interface 中没有 A 模块中定义的数据类型，那 B 模块中甚至都不用 import A。比如标准库中的 <code>io.Writer</code>：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Writer interface &#123;    Write(p []byte) (n int, err error)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>我们可以在自己的模块中实现 <code>io.Writer</code> 接口：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type MyType struct &#123;&#125;func (m MyType) Write(p []byte) (n int, err error) &#123;    return 0, nil&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>那么我们就可以把我们自己的 MyType 传给任何使用 <code>io.Writer</code> 作为参数的函数来使用了，比如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package logfunc SetOutput(w io.Writer) &#123;    output &#x3D; w&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package my-businessimport &quot;xy.com&#x2F;log&quot;func init() &#123;    log.SetOutput(MyType)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 MyType 定义的地方，不需要 <code>import &quot;io&quot;</code> 就可以直接实现 <code>io.Writer</code> interface，我们还可以随意地组合很多函数，以实现各种类型的接口，同时接口实现方和接口定义方都不用建立 import 产生的依赖关系。因此很多人认为 Go 的这种正交是一种很优秀的设计。</p><p>但这种“正交”性也会给我们带来一些麻烦。当我们接手了一个几十万行的系统时，如果看到定义了很多 interface，例如订单流程的 interface，我们希望能直接找到这些 interface 都被哪些对象实现了。但直到现在，这个简单的需求也就只有 goland 实现了，并且体验尚可。Visual Studio Code 则需要对项目进行全局扫描，来看到底有哪些 struct 实现了该 interface 的全部函数。那些显式实现 interface 的语言，对于 IDE 的 interface 查找来说就友好多了。另一方面，我们看到一个 struct，也希望能够立刻知道这个 struct 实现了哪些 interface，但也有着和前面提到的相同的问题。</p><p>虽有不便，interface 带给我们的好处也是不言而喻的：一是依赖反转，这是 interface 在大多数语言中对软件项目所能产生的影响，在 Go 的正交 interface 的设计场景下甚至可以去除依赖；二是由编译器来帮助我们在编译期就能检查到类似“未完全实现接口”这样的错误，如果业务未实现某个流程，但又将其实例作为 interface 强行来使用的话：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package maintype OrderCreator interface &#123;    ValidateUser()    CreateOrder()&#125;type BookOrderCreator struct&#123;&#125;func (boc BookOrderCreator) ValidateUser() &#123;&#125;func createOrder(oc OrderCreator) &#123;    oc.ValidateUser()    oc.CreateOrder()&#125;func main() &#123;    createOrder(BookOrderCreator&#123;&#125;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>会报出下述错误。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># command-line-arguments.&#x2F;a.go:18:30: cannot use BookOrderCreator literal (type BookOrderCreator) as type OrderCreator in argument to createOrder:    BookOrderCreator does not implement OrderCreator (missing CreateOrder method)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>所以 interface 也可以认为是一种编译期进行检查的保证类型安全的手段</p><h3 id="5-8-5-table-driven-开发"><a href="#5-8-5-table-driven-开发" class="headerlink" title="5.8.5 table-driven 开发"></a>5.8.5 table-driven 开发</h3><p>熟悉开源 lint 工具的同学应该见到过圈复杂度的说法，在函数中如果有 if 和 switch 的话，会使函数的圈复杂度上升，所以有强迫症的同学即使在入口一个函数中有 switch，还是想要干掉这个 switch，有没有什么办法呢？当然有，用表驱动的方式来存储我们需要实例：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func entry() &#123;    var bi BusinessInstance    switch businessType &#123;        case TravelBusiness:            bi &#x3D; travelorder.New()        case MarketBusiness:            bi &#x3D; marketorder.New()        default:            return errors.New(&quot;not supported business&quot;)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以修改为：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var businessInstanceMap &#x3D; map[int]BusinessInstance &#123;    TravelBusiness : travelorder.New(),    MarketBusiness : marketorder.New(),&#125;func entry() &#123;    bi :&#x3D; businessInstanceMap[businessType]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>table driven 的设计方式，很多设计模式相关的书籍并没有把它作为一种设计模式来讲，但我认为这依然是一种非常重要的帮助我们来简化代码的手段。<strong>在日常的开发工作中可以多多思考，哪些不必要的 switch case 可以用一个字典和一行代码就可以轻松搞定。</strong></p><h2 id="5-9-灰度发布和-A-B-test"><a href="#5-9-灰度发布和-A-B-test" class="headerlink" title="5.9 灰度发布和 A/B test"></a>5.9 灰度发布和 A/B test</h2><p>中型的互联网公司往往有着以百万计的用户，而大型互联网公司的系统则可能要服务千万级甚至亿级的用户需求。大型系统的请求流入往往是源源不断的，任何风吹草动，都一定会有最终用户感受得到。例如你的系统在上线途中会拒绝一些上游过来的请求，而这时候依赖你的系统没有做任何容错，那么这个错误就会一直向上抛出，直到触达最终用户。 </p><p>不管怎么说，在大型系统中容错是重要的，能够让系统按百分比，分批次到达最终用户，也是很重要的。虽然当今的互联网公司系统，名义上会说自己上线前都经过了充分慎重严格的测试，但就算它们真得做到了，代码的 bug 总是在所难免的。即使代码没有 bug，分布式服务之间的协作也是可能出现“逻辑”上的非技术问题的。</p><p>互联网系统的灰度发布(灰度发布也称为金丝雀发布)一般通过两种方式实现：</p><ol><li>通过分批次部署实现灰度发布</li><li>通过业务规则进行灰度发布</li></ol><p>在对系统的旧功能进行升级迭代时，第一种方式用的比较多。新功能上线时，第二种方式用的比较多。当然，对比较重要的老功能进行较大幅度的修改时，一般也会选择按业务规则来进行发布，因为直接全量开放给所有用户风险实在太大。</p><h3 id="5-9-1-通过分批次部署实现灰度发布"><a href="#5-9-1-通过分批次部署实现灰度发布" class="headerlink" title="5.9.1 通过分批次部署实现灰度发布"></a>5.9.1 通过分批次部署实现灰度发布</h3><p>假如服务部署在 15 个实例(可能是物理机，也可能是容器)上，我们把这 7 个实例分为三组，按照先后顺序，分别有 1-2-4-8 台机器，保证每次扩展时大概都是二倍的关系。为什么要用 2 倍？这样能够保证我们不管有多少台机器，都不会把组划分得太多。</p><p>在上线时，最有效的观察手法是查看程序的错误日志，如果较明显的逻辑错误，一般错误日志的滚动速度都会有肉眼可见的增加。这些错误也可以通过 metrics 一类的系统上报给公司内的监控系统，所以在上线过程中，也可以通过观察监控曲线，来判断是否有异常发生。</p><p>如果有异常情况，首先要做的自然就是回滚了。</p><h3 id="5-9-2-通过业务规则进行灰度发布"><a href="#5-9-2-通过业务规则进行灰度发布" class="headerlink" title="5.9.2 通过业务规则进行灰度发布"></a>5.9.2 通过业务规则进行灰度发布</h3><p>常见的灰度策略有多种，较为简单的需求，例如我们的策略是要按照千分比来发布，那么我们可以用用户 id、手机号、用户设备信息，等等，来生成一个简单的哈希值，然后再求模，用伪代码表示一下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; pass 3&#x2F;1000func passed() bool &#123;    key :&#x3D; hashFunctions(userID) % 1000    if key &lt;&#x3D; 2 &#123;        return true    &#125;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-9-2-1-可选规则"><a href="#5-9-2-1-可选规则" class="headerlink" title="5.9.2.1 可选规则"></a>5.9.2.1 可选规则</h4><p>常见的灰度发布系统会有下列规则提供选择：</p><ol><li>按城市发布</li><li>按概率发布</li><li>按百分比发布</li><li>按白名单发布</li><li>按业务线发布</li><li>按 UA 发布(app、web、pc)</li><li>按分发渠道发布</li></ol><p>按白名单发布比较简单，功能上线时，可能我们希望只有公司内部的员工和测试人员可以访问到新功能，会直接把账号、邮箱写入到白名单，拒绝其它任何账号的访问。</p><p>按概率发布则是指实现一个简单的函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func isTrue() bool &#123;    return true&#x2F;false according to the rate provided by user&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>按百分比发布，是指实现下面这样的函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func isTrue(phone string) bool &#123;    if hash of phone matches &#123;        return true    &#125;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和上面的单纯按照概率的区别是这里我们需要调用方提供给我们一个输入参数，我们以该输入参数作为源来计算哈希，并以哈希后的结果来求模，并返回结果。这样可以保证同一个用户的返回结果多次调用是一致的，</p><h3 id="5-9-3-如何实现一套灰度发布系统"><a href="#5-9-3-如何实现一套灰度发布系统" class="headerlink" title="5.9.3 如何实现一套灰度发布系统"></a>5.9.3 如何实现一套灰度发布系统</h3><p>提供给用户的接口大概可以分为和业务绑定的简单灰度判断逻辑。以及输入稍微复杂一些的哈希灰度。我们来分别看看怎么实现这样的灰度系统(函数)。</p><h4 id="5-9-3-1-业务相关的简单灰度"><a href="#5-9-3-1-业务相关的简单灰度" class="headerlink" title="5.9.3.1 业务相关的简单灰度"></a>5.9.3.1 业务相关的简单灰度</h4><h4 id="5-9-3-2-哈希算法"><a href="#5-9-3-2-哈希算法" class="headerlink" title="5.9.3.2 哈希算法"></a>5.9.3.2 哈希算法</h4><p>求哈希可用的算法非常多，比如 md5，crc32，sha1 等等，但我们这里的目的只是为了给这些数据做个映射，并不想要因为计算哈希消耗过多的 cpu，所以现在业界使用较多的算法是 murmurhash， murmurhash 相比其它的算法有三倍以上的性能提升。</p><h4 id="5-9-3-3-分布是否均匀"><a href="#5-9-3-3-分布是否均匀" class="headerlink" title="5.9.3.3 分布是否均匀"></a>5.9.3.3 分布是否均匀</h4><p>对于哈希算法来说，性能是一方面的问题，另一方面还要考虑哈希后的值是否分布均匀。</p><h2 id="5-10-补充说明"><a href="#5-10-补充说明" class="headerlink" title="5.10 补充说明"></a>5.10 补充说明</h2><p>现代的软件工程是离不开 web 的，广义地来讲，web 甚至可以不用非得基于 http 协议。只要是 CS 或者 BS 架构，都可以认为是 web 系统。</p><p>即使是在看起来非常封闭的游戏系统里，因为玩家们与日俱增的联机需求，也同样会涉及到远程通信，这里面也会涉及到很多 web 方面的技术。</p><p>所以这个时代，web 编程是一个程序员所必须接触的知识领域。无论你的目标是成为架构师，是去创业，或是去当技术顾问。web 方面的知识都会成为你的硬通货。</p><h1 id="第6章-分布式系统"><a href="#第6章-分布式系统" class="headerlink" title="第6章 分布式系统"></a>第6章 分布式系统</h1><p>Go语言号称是互联网时代的C语言。现在的互联网系统已经不是以前的一个主机搞定一切的时代，互联网时代的后台服务由大量的分布式系统构成，任何单一后台服务器节点的故障并不会导致整个系统的停机。同时以青云、阿里云、腾讯云为代表的云厂商崛起标志着云时代的到来，在云时代分布式编程将成为一个基本技能。而基于Go语言构建的Docker、K8s等系统推动了云时代的提前到来。</p><h2 id="6-1-分布式-id-生成器"><a href="#6-1-分布式-id-生成器" class="headerlink" title="6.1 分布式 id 生成器"></a>6.1 分布式 id 生成器</h2><p>有时我们需要能够生成类似 MySQL 自增 ID 这样不断增大，同时又不会重复的 id。以支持业务中的高并发场景。比较典型的，电商促销时，短时间内会有大量的订单涌入到系统，比如每秒 10w+。 </p><p>在插入数据库之前，我们需要给这些消息/订单先打上一个 ID，然后再插入到我们的数据库。对这个 id 的要求是希望其中能带有一些时间信息，这样即使我们后端的系统对消息进行了分库分表，也能够以时间顺序对这些消息进行排序</p><p>Twitter 的 snowflake 算法是这种场景下的一个典型解法</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">                                                           datacenter_id          sequence_idunused                                                                  │                     │   │                                                              │                     │   │                                                              │                     │   │  │                                                      │    │                     │   │  │                                                      │    │                     │   ▼  │◀──────────────────    41 bits   ────────────────────▶│    ▼                     ▼┌─────┼──────────────────────────────────────────────────────┼────────┬────────┬────────────────┐│  0  │ 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0  │ 00000  │ 00000  │ 0000 0000 0000 │└─────┴──────────────────────────────────────────────────────┴────────┴────────┴────────────────┘                                  ▲                                        ▲                                  │                                        │                                  │                                        │                                  │                                        │                                  │                                        │                                  │                                        │                                  │                                        │                        time in milliseconds                          worker_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先确定我们的数值是 64 位，int64 类型，被划分为四部分，不含开头的第一个 bit，因为这个 bit 是符号位。用 41 位来表示收到请求时的时间戳，单位为毫秒，然后五位来表示数据中心的 id，然后再五位来表示机器的实例 id，最后是 12 位的循环自增 id(到达 1111 1111 1111 后会归 0)。</p><p>这样的机制可以支持我们在同一台机器上，同一毫秒内产生 2 ^ 12 = 4096 条消息。一秒共 409.6w 条消息。从值域上来讲完全够用了。</p><p>数据中心 + 实例 id 共有 10 位，可以支持我们每数据中心部署 32 台机器，所有数据中心共 1024 台实例。</p><p>表示 timestamp 的 41 位，可以支持我们使用 69 年。</p><p>当然，我们的时间毫秒计数不会真的从 1970 年开始记，那样我们的系统跑到 <code>2039/9/7 23:47:35</code> 就不能用了，所以这里的 timestamp 实际上只是相对于某个时间的增量，比如我们的系统上线是 2018-08-01，那么我们可以把这个 timestamp 当作是从 <code>2018-08-01 00:00:00.000</code> 的偏移量。</p><h3 id="6-1-1-worker-id-分配"><a href="#6-1-1-worker-id-分配" class="headerlink" title="6.1.1 worker id　分配"></a>6.1.1 worker id　分配</h3><p>timestamp，datacenter_id，worker_id 和 sequence_id 这四个字段中，timestamp 和 sequence_id 是由程序在运行期生成的。但 datacenter_id 和 worker_id 需要我们在部署阶段就能够获取得到，并且一旦程序启动之后，就是不可更改的了(想想，如果可以随意更改，可能被不慎修改，造成最终生成的 id 有冲突)。</p><p>一般不同数据中心的机器，会提供对应的获取数据中心 id 的 api，所以 datacenter_id 我们可以在部署阶段轻松地获取到。而 worker_id 是我们逻辑上给机器分配的一个 id，这个要怎么办呢？比较简单的想法是由能够提供这种自增 id 功能的工具来支持，比如 MySQL:</p><p>从 MySQL 中获取到 worker_id 之后，就把这个 worker_id 直接持久化到本地，以避免每次上线时都需要获取新的 worker_id。让单实例的 worker_id 可以始终保持不变。</p><p>当然，使用 MySQL 相当于给我们简单的 id 生成服务增加了一个外部依赖。依赖越多，我们的服务的可运维性就越差。</p><p>考虑到集群中即使有单个 id 生成服务的实例挂了，也就是损失一段时间的一部分 id，所以我们也可以更简单暴力一些，把 worker_id 直接写在 worker 的配置中，上线时，由部署脚本完成 worker_id 字段替换。</p><h3 id="6-1-2-开源实例"><a href="#6-1-2-开源实例" class="headerlink" title="6.1.2 开源实例"></a>6.1.2 开源实例</h3><h4 id="6-1-2-1-标准-snowflake-实现"><a href="#6-1-2-1-标准-snowflake-实现" class="headerlink" title="6.1.2.1 标准 snowflake 实现"></a>6.1.2.1 标准 snowflake 实现</h4><p><code>github.com/bwmarrin/snowflake</code> 是一个相当轻量化的 snowflake 的 Go 实现。其文档指出：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">+--------------------------------------------------------------------------+| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |+--------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>和标准的 snowflake 完全一致。 </p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;os&quot;    &quot;github.com&#x2F;bwmarrin&#x2F;snowflake&quot;)func main() &#123;    n, err :&#x3D; snowflake.NewNode(1)    if err !&#x3D; nil &#123;        println(err)        os.Exit(1)    &#125;    for i :&#x3D; 0; i &lt; 3; i++ &#123;        id :&#x3D; n.Generate()        fmt.Println(&quot;id&quot;, id)        fmt.Println(&quot;node: &quot;, id.Node(), &quot;step: &quot;, id.Step(), &quot;time: &quot;, id.Time(), &quot;\n&quot;)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然，这个库也给我们留好了定制的后路：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Epoch is set to the twitter snowflake epoch of Nov 04 2010 01:42:54 UTC&#x2F;&#x2F; You may customize this to set a different epoch for your application.Epoch int64 &#x3D; 1288834974657&#x2F;&#x2F; Number of bits to use for Node&#x2F;&#x2F; Remember, you have a total 22 bits to share between Node&#x2F;StepNodeBits uint8 &#x3D; 10&#x2F;&#x2F; Number of bits to use for Step&#x2F;&#x2F; Remember, you have a total 22 bits to share between Node&#x2F;StepStepBits uint8 &#x3D; 12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Epoch 就是本节开头讲的起始时间，NodeBits 指的是机器编号的位长，StepBits 指的是自增序列的位长。</p><h4 id="6-1-2-2-sonyflake"><a href="#6-1-2-2-sonyflake" class="headerlink" title="6.1.2.2 sonyflake"></a>6.1.2.2 sonyflake</h4><p>sonyflake 是 Sony 公司的一个开源项目，基本思路和 snowflake 差不多，不过位分配上稍有不同：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">+-----------------------------------------------------------------------------+| 1 Bit Unused | 39 Bit Timestamp |  8 Bit Sequence ID  |   16 Bit Machine ID |+-----------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这里的时间只用了 39 个 bit，但时间的单位变成了 10ms，所以理论上比 41 位表示的时间还要久(174 years)。</p><p>Sequence ID 和之前的定义一致，Machine ID 其实就是节点 id。sonyflake 与众不同的地方在于其在启动阶段的 setting 配置：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func NewSonyflake(st Settings) *Sonyflake<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Settings 数据结构如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Settings struct &#123;    StartTime      time.Time    MachineID      func() (uint16, error)    CheckMachineID func(uint16) bool&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>StartTime 选项和我们之前的 Epoch 差不多，如果不设置的话，默认是从 <code>2014-09-01 00:00:00 +0000 UTC</code> 开始。</p><p>MachineID 可以由用户自定义的函数，如果用户不定义的话，会默认将本机 ip 的低 16 位作为 machine id。</p><p>CheckMachineID 是由用户提供的检查 MachineID 是否冲突的函数。这里的设计还是比较巧妙的，如果有另外的中心化存储并支持检查重复的存储，那我们就可以按照自己的想法随意定制这个检查 MachineID 是否冲突的逻辑。如果公司有现成的 Redis 集群，那么我们可以很轻松地用 Redis 的 set 来检查冲突。</p><h2 id="6-2-分布式锁"><a href="#6-2-分布式锁" class="headerlink" title="6.2 分布式锁"></a>6.2 分布式锁</h2><h3 id="6-2-1-进程内加锁"><a href="#6-2-1-进程内加锁" class="headerlink" title="6.2.1 进程内加锁"></a>6.2.1 进程内加锁</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport &quot;sync&quot;var counter intfunc main() &#123;   var wg sync.WaitGroup   var l sync.Mutex   for i :&#x3D; 0; i &lt; 1000; i++ &#123;      wg.Add(1)      go func() &#123;         defer wg.Done()         l.Lock()         counter++         l.Unlock()      &#125;()   &#125;   wg.Wait()   println(counter)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想要得到正确的结果的话，要把对 counter 的操作代码部分加上锁</p><h3 id="6-2-2-trylock"><a href="#6-2-2-trylock" class="headerlink" title="6.2.2 trylock"></a>6.2.2 trylock</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;sync&quot;)&#x2F;&#x2F; Lock try locktype Lock struct &#123;    c chan struct&#123;&#125;&#125;&#x2F;&#x2F; NewLock generate a try lockfunc NewLock() Lock &#123;    var l Lock    l.c &#x3D; make(chan struct&#123;&#125;, 1)    l.c &lt;- struct&#123;&#125;&#123;&#125;    return l&#125;&#x2F;&#x2F; Lock try lock, return lock resultfunc (l Lock) Lock() bool &#123;    lockResult :&#x3D; false    select &#123;    case &lt;-l.c:        lockResult &#x3D; true    default:    &#125;    return lockResult&#125;&#x2F;&#x2F; Unlock , Unlock the try lockfunc (l Lock) Unlock() &#123;    l.c &lt;- struct&#123;&#125;&#123;&#125;&#125;var counter intfunc main() &#123;    var l &#x3D; NewLock()    var wg sync.WaitGroup    for i :&#x3D; 0; i &lt; 10; i++ &#123;        wg.Add(1)        go func() &#123;            defer wg.Done()            if !l.Lock() &#123;                &#x2F;&#x2F; log error                println(&quot;lock failed&quot;)                return            &#125;            counter++            println(&quot;current counter&quot;, counter)            l.Unlock()        &#125;()    &#125;    wg.Wait()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为我们的逻辑限定每个 goroutine 只有成功执行了 Lock 才会继续执行后续逻辑，因此在 Unlock 时可以保证 Lock struct 中的 channel 一定是空，从而不会阻塞，也不会失败。</p><p>在单机系统中，trylock 并不是一个好选择。因为大量的 goroutine 抢锁可能会导致 cpu 无意义的资源浪费。有一个专有名词用来描述这种抢锁的场景：活锁。</p><p>活锁指的是程序看起来在正常执行，但实际上 cpu 周期被浪费在抢锁，而非执行任务上，从而程序整体的执行效率低下。活锁的问题定位起来要麻烦很多。所以在单机场景下，不建议使用这种锁。</p><h3 id="6-2-3-基于-redis-的-setnx"><a href="#6-2-3-基于-redis-的-setnx" class="headerlink" title="6.2.3 基于 redis 的 setnx"></a>6.2.3 基于 redis 的 setnx</h3><p>setnx 很适合在高并发场景下，用来争抢一些“唯一”的资源。比如交易撮合系统中卖家发起订单，而多个买家会对其进行并发争抢。这种场景我们没有办法依赖具体的时间来判断先后，因为不管是用户设备的时间，还是分布式场景下的各台机器的时间，都是没有办法在合并后保证正确的时序的。哪怕是我们同一个机房的集群，不同的机器的系统时间可能也会有细微的差别。</p><p>所以，我们需要依赖于这些请求到达 redis 节点的顺序来做正确的抢锁操作。如果用户的网络环境比较差，那也只能自求多福了。</p><h3 id="6-2-4-基于-zk"><a href="#6-2-4-基于-zk" class="headerlink" title="6.2.4 基于 zk"></a>6.2.4 基于 zk</h3><p>基于 zk 的锁与基于 redis 的锁的不同之处在于 Lock 成功之前会一直阻塞，这与我们单机场景中的 mutex.Lock 很相似。</p><p>其原理也是基于临时 sequence 节点和 watch api，例如我们这里使用的是 <code>/lock</code> 节点。Lock 会在该节点下的节点列表中插入自己的值，只要节点下的子节点发生变化，就会通知所有 watch 该节点的程序。这时候程序会检查当前节点下最小的子节点的 id 是否与自己的一致。如果一致，说明加锁成功了。</p><p>这种分布式的阻塞锁比较适合分布式任务调度场景，但不适合高频次持锁时间短的抢锁场景。按照 Google 的 chubby 论文里的阐述，基于强一致协议的锁适用于 <code>粗粒度</code> 的加锁操作。这里的粗粒度指锁占用时间较长。我们在使用时也应思考在自己的业务场景中使用是否合适。</p><h3 id="6-2-5-基于-etcd"><a href="#6-2-5-基于-etcd" class="headerlink" title="6.2.5 基于 etcd"></a>6.2.5 基于 etcd</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;log&quot;    &quot;github.com&#x2F;zieckey&#x2F;etcdsync&quot;)func main() &#123;    m, err :&#x3D; etcdsync.New(&quot;&#x2F;lock&quot;, 10, []string&#123;&quot;http:&#x2F;&#x2F;127.0.0.1:2379&quot;&#125;)    if m &#x3D;&#x3D; nil || err !&#x3D; nil &#123;        log.Printf(&quot;etcdsync.New failed&quot;)        return    &#125;    err &#x3D; m.Lock()    if err !&#x3D; nil &#123;        log.Printf(&quot;etcdsync.Lock failed&quot;)        return    &#125;    log.Printf(&quot;etcdsync.Lock OK&quot;)    log.Printf(&quot;Get the lock. Do something here.&quot;)    err &#x3D; m.Unlock()    if err !&#x3D; nil &#123;        log.Printf(&quot;etcdsync.Unlock failed&quot;)    &#125; else &#123;        log.Printf(&quot;etcdsync.Unlock OK&quot;)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>etcd 中没有像 zookeeper 那样的 sequence 节点。所以其锁实现和基于 zookeeper 实现的有所不同。在上述示例代码中使用的 etcdsync 的 Lock 流程是：</p><ol><li>先检查 <code>/lock</code> 路径下是否有值，如果有值，说明锁已经被别人抢了</li><li>如果没有值，那么写入自己的值。写入成功返回，说明加锁成功。写入时如果节点被其它节点写入过了，那么会导致加锁失败，这时候到 3</li><li>watch <code>/lock</code> 下的事件，此时陷入阻塞</li><li>当 <code>/lock</code> 路径下发生事件时，当前进程被唤醒。检查发生的事件是否是删除事件(说明锁被持有者主动 unlock)，或者过期事件(说明锁过期失效)。如果是的话，那么回到 1，走抢锁流程。</li></ol><h3 id="6-2-7-如何选择"><a href="#6-2-7-如何选择" class="headerlink" title="6.2.7 如何选择"></a>6.2.7 如何选择</h3><p>业务还在单机就可以搞定的量级时，那么按照需求使用任意的单机锁方案就可以。</p><p>如果发展到了分布式服务阶段，但业务规模不大，比如 qps &lt; 1000，使用哪种锁方案都差不多。如果公司内已有可以使用的 zk/etcd/redis 集群，那么就尽量在不引入新的技术栈的情况下满足业务需求。</p><p>业务发展到一定量级的话，就需要从多方面来考虑了。首先是你的锁是否在任何恶劣的条件下都不允许数据丢失，如果不允许，那么就不要使用 redis 的 setnx 的简单锁。</p><p>如果要使用 redlock，那么要考虑你们公司 redis 的集群方案，是否可以直接把对应的 redis 的实例的 ip+port 暴露给开发人员。如果不可以，那也没法用。</p><p>对锁数据的可靠性要求极高的话，那只能使用 etcd 或者 zk 这种通过一致性协议保证数据可靠性的锁方案。但可靠的背面往往都是较低的吞吐量和较高的延迟。需要根据业务的量级对其进行压力测试，以确保分布式锁所使用的 etcd/zk 集群可以承受得住实际的业务请求压力。需要注意的是，etcd 和 zk 集群是没有办法通过增加节点来提高其性能的。要对其进行横向扩展，只能增加搭建多个集群来支持更多的请求。这会进一步提高对运维和监控的要求。多个集群可能需要引入 proxy，没有 proxy 那就需要业务去根据某个业务 id 来做 sharding。如果业务已经上线的情况下做扩展，还要考虑数据的动态迁移。这些都不是容易的事情。</p><p>在选择具体的方案时，还是需要多加思考，对风险早做预估。</p><h2 id="6-3-延时任务系统"><a href="#6-3-延时任务系统" class="headerlink" title="6.3 延时任务系统"></a>6.3 延时任务系统</h2><p>如果业务规模比较小，有时我们也可以通过 db + 轮询来对这种任务进行简单处理，但上了规模的公司，自然会寻找更为普适的解决方案来解决这一类问题</p><p>一般有两种思路来解决这个问题：</p><ol><li>实现一套类似 crontab 的分布式定时任务管理系统。</li><li>实现一个支持定时发送消息的消息队列。</li></ol><p>两种思路进而衍生出了一些不同的系统，但其本质是差不多的。都是需要实现一个定时器。在单机的场景下其实并不少见，例如我们在和网络库打交道的时候经常会写 <code>SetReadDeadline</code>，这实际上就是在本地创建了一个定时器，在到达指定的时间后，我们会收到定时器的通知，告诉我们时间已到。这时候如果读取还没有完成的话，就可以认为发生了网络问题，从而中断读取。</p><p>timer 的实现在工业界已经是有解的问题了。常见的就是时间堆和时间轮</p><h3 id="6-3-1-timer-实现"><a href="#6-3-1-timer-实现" class="headerlink" title="6.3.1 timer 实现"></a>6.3.1 timer 实现</h3><h4 id="6-3-1-1-时间堆"><a href="#6-3-1-1-时间堆" class="headerlink" title="6.3.1.1 时间堆"></a>6.3.1.1 时间堆</h4><p>最常见的时间堆一般用小顶堆实现，小顶堆其实就是一种特殊的二叉树：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">                        ┌─────┐                        │     │                        │  5  │                        └─────┘                           │                           │                ┌──────────┴──────────┐                │                     │                ▼                     ▼             ┌─────┐               ┌─────┐             │     │               │     │             │  6  │               │  10 │             └─────┘               └─────┘                │                     │           ┌────┴─────┐          ┌────┴─────┐           │          │          │          │           ▼          ▼          ▼          ▼        ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐        │     │    │     │    │     │    │     │        │  7  │    │  6  │    │  11 │    │  20 │        └─────┘    └─────┘    └─────┘    └─────┘           │                                │           │                                │   ┌───────┴────┐                           └───────┐   │            │                                   │   ▼            ▼                                   ▼┌─────┐      ┌─────┐                             ┌─────┐│     │      │     │   ...............           │     ││  15 │      │  8  │                             │  30 │└─────┘      └─────┘                             └─────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>小顶堆的好处是什么呢？实际上对于定时器来说，如果堆顶元素比当前的时间还要大，那么说明堆内所有元素都比当前时间大。进而说明这个时刻我们还没有必要对时间堆进行任何处理。所以对于定时 check 来说，时间复杂度是 O(1) 的。</p><p>当我们发现堆顶的元素 &lt; 当前时间时，那么说明可能已经有一批事件已经开始过期了，这时进行正常的弹出和堆调整操作就好。每一次堆调整的时间复杂度都是 O(LgN)。</p><p>Go 自身的 timer 就是用时间堆来实现的，不过并没有使用二叉堆，而是使用了扁平一些的四叉堆。在最近的版本中，还加了一些优化，我们先不说优化，先来看看四叉的小顶堆长什么样：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">                                                             +-----+                                                             |     |                                                             |  0  |                                                             +-----+                                                                |                                                                |                                                                |                                                                v                                                    +-----+-----+-----+-----+                                                    |     |     |     |     |                                                    |  3  |  2  |  2  |  10 |                                                    +-----+-----+-----+-----+                                                       |     |     |     |                                                       |     |     |     |                    +----------+                       |     |     |     |   +----------------+  4*i+1   +-----------------------+     |     |     +-----------------------------+   |                +----------+         +-------------------+     +---+                               |   |                                     |                             |                               |   |                                     |                             |                               |   v                                     |                             |                               v+-----+-----+-----+-----+                |                             |                            +-----+-----+-----+-----+|     |     |     |     |                v                             v                            |     |     |     |     ||  20 |  4  |  5  |  13 |             +-----+-----+-----+-----+     +-----+-----+-----+-----+       | 99  | 13  | 11  |  12 |+-----+-----+-----+-----+             |     |     |     |     |     |     |     |     |     |       +-----+-----+-----+-----+                                      | 12  | 14  | 15  |  16 |     | 3   | 10  | 3   |  3  |                                      +-----+-----+-----+-----+     +-----+-----+-----+-----+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>小顶堆的性质，父节点比其 4 个子节点都小，子节点之间没有特别的大小关系要求。</p><h4 id="6-3-1-2-时间轮"><a href="#6-3-1-2-时间轮" class="headerlink" title="6.3.1.2 时间轮"></a>6.3.1.2 时间轮</h4><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-timewheel.png" alt="timewheel"></p><p>用时间轮来实现 timer 时，我们需要定义每一个格子的“刻度”，可以将时间轮想像成一个时钟，中心有秒针顺时针转动。每次转动到一个刻度时，我们就需要去查看该刻度挂载的 tasklist 是否有已经到期的任务。</p><p>从结构上来讲，时间轮和哈希表很相似，如果我们把哈希算法定义为：触发时间%时间轮元素大小。那么这就是一个简单的哈希表。在哈希冲突时，采用链表挂载哈希冲突的定时器。</p><p>除了这种单层时间轮，业界也有一些时间轮采用多层实现， </p><h3 id="6-3-2-任务分发"><a href="#6-3-2-任务分发" class="headerlink" title="6.3.2 任务分发"></a>6.3.2 任务分发</h3><p>有了基本的 timer 实现方案，如果我们开发的是单机系统，那么就可以撸起袖子开干了，不过本章我们讨论的是分布式，距离“分布式”还稍微有一些距离</p><p>我们还需要把这些“定时”或是“延时”(本质也是定时)任务分发出去。下面是一种思路：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-task-sched.png" alt="task-dist"></p><p>每一个实例每隔一小时，会去数据库里把下一个小时需要处理的定时任务捞出来，捞取的时候只要取那些 task_id % shard_count = shard_id 的那些 task 即可。</p><p>当这些定时任务被触发之后需要通知用户侧，有两种思路：</p><ol><li>将任务被触发的信息封装为一条 event 消息，发往消息队列，由用户侧对消息队列进行监听。</li><li>对用户预先配置的回调函数进行调用。</li></ol><p>两种方案各有优缺点，如果采用 1，那么如果消息队列出故障会导致整个系统不可用，当然，现在的消息队列一般也会有自身的高可用方案，大多数时候我们不用担心这个问题。其次一般业务流程中间走消息队列的话会导致延时增加，定时任务若必须在触发后的几十毫秒到几百毫秒内完成，那么采用消息队列就会有一定的风险。如果采用 2，会加重定时任务系统的负担。我们知道，单机的 timer 执行时最害怕的就是回调函数执行时间过长，这样会阻塞后续的任务执行。在分布式场景下，这种忧虑依然是适用的。一个不负责任的业务回调可能就会直接拖垮整个定时任务系统。所以我们还要考虑在回调的基础上增加经过测试的超时时间设置，并且对由用户填入的超时时间做慎重的审核。</p><h3 id="6-3-3-rebalance-和幂等考量"><a href="#6-3-3-rebalance-和幂等考量" class="headerlink" title="6.3.3 rebalance 和幂等考量"></a>6.3.3 rebalance 和幂等考量</h3><p>当我们的任务执行集群有机器故障时，需要对任务进行重新分配。按照之前的求模策略，对这台机器还没有处理的任务进行重新分配就比较麻烦了。如果是实际运行的线上系统，还要在故障时的任务平衡方面花更多的心思。</p><p>下面给出一种思路：</p><p>我们可以参考 elasticsearch 的设计，每份任务数据都有多个副本，这里假设两副本：</p><p>一份数据虽然有两个持有者，但持有者持有的副本会进行区分，比如持有的是主副本还是非主副本</p><p>一个任务只会在持有主副本的节点上被执行。</p><p>当有机器故障时，任务数据需要进行 rebalance 工作，比如 node 1 挂了：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">┌──────────┐│  node 1  │├──────────┴────────────────────────┐│                                   ││    X          X          X        ││                                   │└───────────────────────────────────┘┌──────────┐│  node 2  │├──────────┴────────────────────────┐│ ┌───┐  ┌───┐  ┏━━━┓  ┏━━━┓  ┏━━━┓ ││ │ 0 │  │ 1 │  ┃ 2 ┃  ┃ 3 ┃  ┃ 4 ┃ ││ └───┘  └───┘  ┗━━━┛  ┗━━━┛  ┗━━━┛ │└───────────────────────────────────┘┌──────────┐│  node 3  │├──────────┴────────────────────────┐│ ┏━━━┓  ┏━━━┓  ┌───┐  ┌───┐  ┌───┐ ││ ┃ 0 ┃  ┃ 1 ┃  │ 2 │  │ 3 │  │ 4 │ ││ ┗━━━┛  ┗━━━┛  └───┘  └───┘  └───┘ │└───────────────────────────────────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>node 1 的数据会被迁移到 node 2 和 node 3 上。</p><p>当然，也可以用稍微复杂一些的思路，比如对集群中的节点进行角色划分，由协调节点来做这种故障时的任务重新分配工作，考虑到高可用，协调节点可能也需要有 1 ~ 2 个备用节点以防不测。</p><p>之前提到我们会用 MQ 触发对用户的通知，在使用 MQ 时，很多 MQ 是不支持 exactly once 的语义的，这种情况下我们需要让用户自己来负责消息的去重或者消费的幂等处理。</p><h2 id="6-4-分布式搜索引擎"><a href="#6-4-分布式搜索引擎" class="headerlink" title="6.4 分布式搜索引擎"></a>6.4 分布式搜索引擎</h2><p>数据库系统本身要保证实时和强一致性，所以其功能设计上都是为了满足这种一致性需求。比如 write ahead log 的设计，基于 B+ 树实现的索引和数据组织，以及基于 MVCC 实现的事务等等。</p><p>系型数据库一般被用于实现 OLTP 系统，所谓 OLTP，援引 wikipedia:</p><blockquote><p>在线交易处理（OLTP, Online transaction processing）是指透过信息系统、电脑网络及数据库，以线上交易的方式处理一般即时性的作业数据，和更早期传统数据库系统大量批量的作业方式并不相同。OLTP通常被运用于自动化的数据处理工作，如订单输入、金融业务…等反复性的日常性交易活动。和其相对的是属于决策分析层次的联机分析处理（OLAP）。</p></blockquote><p>在互联网的业务场景中，也有一些实时性要求不高(可以接受多 s 的延迟)，但是查询复杂性却很高的场景。举个例子，在电商的 wms 系统中，或者在大多数业务场景丰富的 crm 或者客服系统中，可能需要提供几十个字段的随意组合查询功能。这种系统的数据维度天生众多，比如一个电商的 wms 中对一件货物的描述，可能有下面这些字段：</p><blockquote><p>仓库 id，入库时间，库位分区 id，储存货架 id，入库操作员 id，出库操作员 id，库存数量，过期时间，sku 类型，产品品牌，产品分类，内件数量</p></blockquote><p>除了上述信息，如果商品在仓库内有流转。可能还有有关联的流程 id，当前的流转状态等等。</p><p>想像一下，如果我们所经营的是一个大型电商，每天有千万级别的订单，那么在这个数据库中查询和建立合适的索引都是一件非常难的事情。</p><p>在 CRM 或客服类系统中，常常有根据关键字进行搜索的需求，大型互联网公司每天会接收数以万计的用户投诉。而考虑到事件溯源，用户的投诉至少要存 2~3 年。又是千万级甚至上亿的数据。根据关键字进行一次 like 查询，可能整个 MySQL 就直接挂掉了。</p><p>这时候我们就需要搜索引擎来救场了。</p><h3 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h3><p>elasticsearch 是开源分布式搜索引擎的霸主，其依赖于 Lucene 实现，在部署和运维方面做了很多优化。当今搭建一个分布式搜索引擎比起 Sphinx 的时代已经是容易很多很多了。只要简单配置客户端 ip 和端口就可以了。</p><h3 id="倒排列表"><a href="#倒排列表" class="headerlink" title="倒排列表"></a>倒排列表</h3><p>虽然 es 是针对搜索场景来定制的，但如前文所言，实际应用中常常用 es 来作为 database 来使用，就是因为倒排列表的特性。可以用比较朴素的观点来理解倒排索引：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">┌─────────────────┐       ┌─────────────┬─────────────┬─────────────┬─────────────┐│  order_id: 103  │──────▶│ doc_id:4231 │ doc_id:4333 │ doc_id:5123 │ doc_id:9999 │└─────────────────┘       └─────────────┴─────────────┴─────────────┴─────────────┘┌─────────────────┐       ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐│  sku_id: 30221  │──────▶│ doc_id:4231 │ doc_id:5123 │ doc_id:5644 │ doc_id:7801 │ doc_id:9999 │└─────────────────┘       └─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘┌─────────────────┐       ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐│   city_id: 3    │──────▶│ doc_id:5123 │ doc_id:9999 │doc_id:10232 │doc_id:54321 │doc_id:63142 │doc_id:71230 │doc_id:90123 │└─────────────────┘       └─────────────┴─────────────┴─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对 es 中的数据进行查询时，本质就是求多个排好序的序列求交集。非数值类型字段涉及到分词问题，大多数内部使用场景下，我们可以直接使用默认的 bi-gram 分词。什么是 bi-gram 分词呢：</p><p>即将所有 Ti 和 T(i+1) 组成一个词(在 es 中叫 term)，然后再编排其倒排列表，这样我们的倒排列表大概就是这样的：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-terms.png" alt="terms"></p><p>当用户搜索 ‘天气很好’ 时，其实就是求：天气、气很、很好三组倒排列表的交集，但这里的相等判断逻辑有些特殊，用伪代码表示一下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func equal() &#123;    if postEntry.docID of &#39;天气&#39; &#x3D;&#x3D; postEntry.docID of &#39;气很&#39; &amp;&amp; postEntry.offset + 1 of &#39;天气&#39; &#x3D;&#x3D; postEntry.offset of &#39;气很&#39; &#123;        return true    &#125;    if postEntry.docID of &#39;气很&#39; &#x3D;&#x3D; postEntry.docID of &#39;很好&#39; &amp;&amp; postEntry.offset + 1 of &#39;气很&#39; &#x3D;&#x3D; postEntry.offset of &#39;很好&#39; &#123;        return true    &#125;    if postEntry.docID of &#39;天气&#39; &#x3D;&#x3D; postEntry.docID of &#39;很好&#39; &amp;&amp; postEntry.offset + 2 of &#39;天气&#39; &#x3D;&#x3D; postEntry.offset of &#39;很好&#39; &#123;        return true    &#125;    return false&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>多个有序列表求交集的时间复杂度是：O(N * M)， N 为给定列表当中元素数最小的集合， M 为给定列表的个数。</p><p>在整个算法中起决定作用的一是最短的倒排列表的长度，其次是词数总和，一般词数不会很大(想像一下，你会在搜索引擎里输入几百字来搜索么？)，所以起决定性作用的，一般是所有倒排列表中，最短的那一个的长度。</p><p>因此，文档总数很多的情况下，搜索词的倒排列表最短的那一个不长时，搜索速度也是很快的。如果用关系型数据库，那就需要按照索引(如果有的话)来慢慢扫描了。</p><h3 id="查询-DSL"><a href="#查询-DSL" class="headerlink" title="查询 DSL"></a>查询 DSL</h3><p>es 的 Bool Query 方案，实际上就是用 json 来表达了这种程序语言中的 Boolean Expression，为什么可以这么做呢？因为 json 本身是可以表达树形结构的，我们的程序代码在被编译器 parse 之后，也会变成 AST，而 AST 抽象语法树，顾名思义，就是树形结构。理论上 json 能够完备地表达一段程序代码被 parse 之后的结果。这里的 Boolean Expression 被编译器 Parse 之后也会生成差不多的树形结构，而且只是整个编译器实现的一个很小的子集。</p><h3 id="基于-client-sdk-做开发"><a href="#基于-client-sdk-做开发" class="headerlink" title="基于 client sdk 做开发"></a>基于 client sdk 做开发</h3><h3 id="将-sql-转换为-DSL"><a href="#将-sql-转换为-DSL" class="headerlink" title="将 sql 转换为 DSL"></a>将 sql 转换为 DSL</h3><p>比如我们有一段 bool 表达式，user_id = 1 and (product_id = 1 and (star_num = 4 or star_num = 5) and banned = 1)，写成 SQL 是如下形式：</p><blockquote><p>select * from xxx where user_id = 1 and (product_id = 1 and (star_num = 4 or star_num = 5) and banned = 1)</p></blockquote><p>写成 es 的 DSL 是如下形式：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;query&quot;: &#123;    &quot;bool&quot;: &#123;      &quot;must&quot;: [        &#123;          &quot;match&quot;: &#123;            &quot;user_id&quot;: &#123;              &quot;query&quot;: &quot;1&quot;,              &quot;type&quot;: &quot;phrase&quot;            &#125;          &#125;        &#125;,        &#123;          &quot;match&quot;: &#123;            &quot;product_id&quot;: &#123;              &quot;query&quot;: &quot;1&quot;,              &quot;type&quot;: &quot;phrase&quot;            &#125;          &#125;        &#125;,        &#123;          &quot;bool&quot;: &#123;            &quot;should&quot;: [              &#123;                &quot;match&quot;: &#123;                  &quot;star_num&quot;: &#123;                    &quot;query&quot;: &quot;4&quot;,                    &quot;type&quot;: &quot;phrase&quot;                  &#125;                &#125;              &#125;,              &#123;                &quot;match&quot;: &#123;                  &quot;star_num&quot;: &#123;                    &quot;query&quot;: &quot;5&quot;,                    &quot;type&quot;: &quot;phrase&quot;                  &#125;                &#125;              &#125;            ]          &#125;        &#125;,        &#123;          &quot;match&quot;: &#123;            &quot;banned&quot;: &#123;              &quot;query&quot;: &quot;1&quot;,              &quot;type&quot;: &quot;phrase&quot;            &#125;          &#125;        &#125;      ]    &#125;  &#125;,  &quot;from&quot;: 0,  &quot;size&quot;: 1&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>es 的 DSL 虽然很好理解，但是手写起来非常费劲。前面提供了基于 SDK 的方式来写，但也不足够灵活。</p><p>SQL 的 where 部分就是 boolean expression。我们之前提到过，这种 bool 表达式在被 parse 之后，和 es 的 DSL 的结构长得差不多，我们能不能直接通过这种“差不多”的猜测来直接帮我们把 SQL 转换成 DSL 呢？</p><p>当然可以，我们把 SQL 的 where 被 Parse 之后的结构和 es 的 DSL 的结构做个对比：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-ast-dsl.png" alt="ast"></p><p>既然结构上完全一致，逻辑上我们就可以相互转换。我们以广度优先对 AST 树进行遍历，然后将二元表达式转换成 json 字符串，再拼装起来就可以了，限于篇幅，本文中就不给出示例了， </p><h3 id="异构数据同步"><a href="#异构数据同步" class="headerlink" title="异构数据同步"></a>异构数据同步</h3><p>在实际应用中，我们很少直接向搜索引擎中写入数据。更为常见的方式是，将 MySQL 或其它关系型数据中的数据同步到搜索引擎中。而搜索引擎的使用方只能对数据进行查询，无法进行修改和删除。</p><p>常见的同步方案有两种：</p><h4 id="通过时间戳进行增量数据同步"><a href="#通过时间戳进行增量数据同步" class="headerlink" title="通过时间戳进行增量数据同步"></a>通过时间戳进行增量数据同步</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">  ┌────────────────────────┐     ┌────────────────────────┐  │ move 10 min data to es │     │ move 10 min data to es │  └────────────────────────┘     └────────────────────────┘               │                               │                              ┌───────────────┐───────────────┼────────────────┬──────────────┴─────────────┬──────────────▶ │  time passes  │               │   ┌───────┐    │                            │                └───────────────┘               │◀──┤ 10min ├───▶│                  ┌────────────────────────┐               │   └───────┘    │                  │ move 10 min data to es │                                │                  └────────────────────────┘                                │                                │                                │                                │                    ┌────────────────────────┐                    │ move 10 min data to es │                    └────────────────────────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种同步方式与业务强绑定，例如 wms 系统中的出库单，我们并不需要非常实时，稍微有延迟也可以接受，那么我们可以每分钟从 MySQL 的出库单表中，把最近十分钟创建的所有出库单取出，批量存入 es 中，具体的逻辑实际上就是一条 SQL：</p><blockquote><p>from wms_orders where update_time &gt;= date_sub(now(), interval 10 minute);</p></blockquote><p>当然，考虑到边界情况，我们可以让这个时间段的数据与前一次的有一些重叠：</p><blockquote><p>select * from wms_orders where update_time &gt;= date_sub(now(), interval 11 minute);</p></blockquote><p>取最近 11 分钟有变动的数据覆盖更新到 es 中。这种方案的缺点显而易见，我们必须要求业务数据严格遵守一定的规范。比如这里的，必须要有 update_time 字段，并且每次创建和更新都要保证该字段有正确的时间值。否则我们的同步逻辑就会丢失数据。</p><h4 id="通过-binlog-进行数据同步"><a href="#通过-binlog-进行数据同步" class="headerlink" title="通过 binlog 进行数据同步"></a>通过 binlog 进行数据同步</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">                ┌────────────────────────┐                │      MySQL master      │                └────────────────────────┘                             │                             │                             │                             │                             │                             │                             ▼                   ┌───────────────────┐                   │ row format binlog │                   └───────────────────┘                             │                             │                             │             ┌───────────────┴──────────────┐             │                              │             │                              │             ▼                              ▼┌────────────────────────┐         ┌─────────────────┐│      MySQL slave       │         │      canal      │└────────────────────────┘         └─────────────────┘                                            │                                  ┌─────────┴──────────┐                                  │   parsed binlog    │                                  └─────────┬──────────┘                                            │                                            ▼                                   ┌────────────────┐                                   │     kafka      │─────┐                                   └────────────────┘     │                                                          │                                                          │                                                          │                                                          │                                              ┌───────────┴──────┐                                              │  kafka consumer  │                                              └───────────┬──────┘                                                          │                                                          │                                                          │                                                          │      ┌────────────────┐                                                          └─────▶│ elasticsearch  │                                                                 └────────────────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>业界使用较多的是阿里开源的 canal，来进行 binlog 解析与同步。canal 会伪装成 MySQL 的从库，然后解析好行格式的 binlog，再以更容易解析的格式(例如 json) 发送到消息队列。</p><p>由下游的 kafka 消费者负责把上游数据表的自增主键作为 es 的 document 的 id 进行写入，这样可以保证每次接收到 binlog 时，对应 id 的数据都被覆盖更新为最新。MySQL 的 row 格式的 binlog 会将每条记录的所有字段都提供给下游，所以实际上在向异构数据目标同步数据时，不需要考虑数据是插入还是更新，只要一律按 id 进行覆盖即可。</p><p>这种模式同样需要业务遵守一条数据表规范，即表中必须有唯一主键 id 来保证我们进入 es 的数据不会发生重复。一旦不遵守该规范，那么就会在同步时导致数据重复。当然，你也可以为每一张需要的表去定制消费者的逻辑，这就不是通用系统讨论的范畴了。</p><h2 id="6-5-Load-Balance-负载均衡"><a href="#6-5-Load-Balance-负载均衡" class="headerlink" title="6.5 Load-Balance 负载均衡"></a>6.5 Load-Balance 负载均衡</h2><h3 id="6-5-1-常见的负载均衡思路"><a href="#6-5-1-常见的负载均衡思路" class="headerlink" title="6.5.1 常见的负载均衡思路"></a>6.5.1 常见的负载均衡思路</h3><p>如果我们不考虑均衡的话，现在有 n 个 endpoint，我们完成业务流程实际上只需要从这 n 个中挑出其中的一个。有几种思路:</p><ol><li>按顺序挑: 例如上次选了第一台，那么这次就选第二台，下次第三台，如果已经到了最后一台，那么下一次从第一台开始。这种情况下我们可以把 endpoint 都存储在数组中，每次请求完成下游之后，将一个索引后移即可。在移到尽头时再移回数组开头处。</li><li>随机挑一个: 每次都随机挑，真随机伪随机均可。假设选择第 x 台机器，那么 x 可描述为 <code>rand.Intn() % n</code>。</li><li>根据某种权重，对下游 endpoints 进行排序，选择权重最大/小的那一个。</li></ol><p>当然了，实际场景我们不可能无脑轮询或者无脑随机，如果对下游请求失败了，我们还需要某种机制来进行重试，如果纯粹的随机算法，存在一定的可能性使你在下一次仍然随机到这次的问题节点。</p><h3 id="6-5-2-基于洗牌算法的负载均衡"><a href="#6-5-2-基于洗牌算法的负载均衡" class="headerlink" title="6.5.2 基于洗牌算法的负载均衡"></a>6.5.2 基于洗牌算法的负载均衡</h3><p>考虑到我们需要随机选取每次发送请求的 endpoint，同时在遇到下游返回错误时换其它节点重试。所以我们设计一个大小和 endpoints 数组大小一致的索引数组，每次来新的请求，我们对索引数组做洗牌，然后取第一个元素作为选中的服务节点，如果请求失败，那么选择下一个节点重试，以此类推:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var endpoints &#x3D; []string &#123;    &quot;100.69.62.1:3232&quot;,    &quot;100.69.62.32:3232&quot;,    &quot;100.69.62.42:3232&quot;,    &quot;100.69.62.81:3232&quot;,    &quot;100.69.62.11:3232&quot;,    &quot;100.69.62.113:3232&quot;,    &quot;100.69.62.101:3232&quot;,&#125;&#x2F;&#x2F; 重点在这个 shufflefunc shuffle(slice []int) &#123;    for i :&#x3D; 0; i &lt; len(slice); i++ &#123;        a :&#x3D; rand.Intn(len(slice))        b :&#x3D; rand.Intn(len(slice))        slice[a], slice[b] &#x3D; slice[b], slice[a]    &#125;&#125;func request(params map[string]interface&#123;&#125;) error &#123;    var indexes &#x3D; []int &#123;0,1,2,3,4,5,6&#125;    var err error    shuffle(indexes)    maxRetryTimes :&#x3D; 3    idx :&#x3D; 0    for i :&#x3D; 0; i &lt; maxRetryTimes; i++ &#123;        err &#x3D; apiRequest(params, indexes[idx])        if err &#x3D;&#x3D; nil &#123;            break        &#125;        idx++    &#125;    if err !&#x3D; nil &#123;        &#x2F;&#x2F; logging        return err    &#125;    return nil&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-5-2-1-错误的洗牌导致的负载不均衡"><a href="#6-5-2-1-错误的洗牌导致的负载不均衡" class="headerlink" title="6.5.2.1 错误的洗牌导致的负载不均衡"></a>6.5.2.1 错误的洗牌导致的负载不均衡</h4><p>这段简短的程序里有两个隐藏的隐患:</p><ol><li>没有随机种子。在没有随机种子的情况下，rand.Intn 返回的伪随机数序列是固定的。</li><li>洗牌不均匀，会导致整个数组第一个节点有大概率被选中，并且多个节点的负载分布不均衡。</li></ol><h4 id="6-5-2-2-修正洗牌算法"><a href="#6-5-2-2-修正洗牌算法" class="headerlink" title="6.5.2.2 修正洗牌算法"></a>6.5.2.2 修正洗牌算法</h4><p>从数学上得到过证明的还是经典的 fisher-yates 算法，主要思路为每次随机挑选一个值，放在数组末尾。然后在 n-1 个元素的数组中再随机挑选一个值，放在数组末尾，以此类推。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func shuffle(indexes []int) &#123;    for i:&#x3D;len(indexes); i&gt;0; i-- &#123;        lastIdx :&#x3D; i - 1        idx :&#x3D; rand.Int(i)        indexes[lastIdx], indexes[idx] &#x3D; indexes[idx], indexes[lastIdx]    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 Go 的标准库中实际上已经为我们内置了该算法:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func shuffle(n int) []int &#123;    b :&#x3D; rand.Perm(n)    return b&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在当前的场景下，我们只要用 rand.Perm 就可以得到我们想要的索引数组了</p><h3 id="6-5-3-zk-集群的随机节点挑选问题"><a href="#6-5-3-zk-集群的随机节点挑选问题" class="headerlink" title="6.5.3 zk 集群的随机节点挑选问题"></a>6.5.3 zk 集群的随机节点挑选问题</h3><p>本节中的场景是从 N 个节点中选择一个节点发送请求，初始请求结束之后，后续的请求会重新对数组洗牌，所以每两个请求之间没有什么关联关系。因此我们上面的洗牌算法，理论上不初始化随机库的种子也是不会出什么问题的。</p><p>但在一些特殊的场景下，例如使用 zk 时，客户端初始化从多个服务节点中挑选一个节点后，是会向该节点建立长连接的。并且之后如果有请求，也都会发送到该节点去。直到该节点不可用，才会在 endpoints 列表中挑选下一个节点。在这种场景下，我们的初始连接节点选择就要求必须是“真”随机了。否则，所有客户端起动时，都会去连接同一个 zk 的实例，根本无法起到负载均衡的目的。如果在日常开发中，你的业务也是类似的场景，也务必考虑一下是否会发生类似的情况。为 rand 库设置种子的方法:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">rand.Seed(time.Now().UnixNano())<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>之所以会有上面这些结论，是因为某个使用较广泛的开源 zk 库的早期版本就犯了上述错误，直到 2016 年早些时候，这个问题才被修正。</p><h2 id="6-6-分布式配置管理"><a href="#6-6-分布式配置管理" class="headerlink" title="6.6 分布式配置管理"></a>6.6 分布式配置管理</h2><p>在分布式系统中，常困扰我们的还有上线问题。虽然目前有一些优雅重启方案，但实际应用中可能受限于我们系统内部的运行情况而没有办法做到真正的“优雅”。比如我们为了对去下游的流量进行限制，在内存中堆积一些数据，并对堆积设定时间/总量的阈值。在任意阈值达到之后将数据统一发送给下游，以避免频繁的请求超出下游的承载能力而将下游打垮。这种情况下重启要做到优雅就比较难了。</p><p>所以我们的目标还是尽量避免采用或者绕过上线的方式，对线上程序做一些修改。比较典型的修改内容就是程序的配置项。</p><h3 id="6-6-1-场景举例"><a href="#6-6-1-场景举例" class="headerlink" title="6.6.1 场景举例"></a>6.6.1 场景举例</h3><h4 id="6-6-1-1-报表系统"><a href="#6-6-1-1-报表系统" class="headerlink" title="6.6.1.1 报表系统"></a>6.6.1.1 报表系统</h4><p>在一些偏 OLAP 或者离线的数据平台中，经过长期的叠代开发，整个系统的功能模块已经渐渐稳定。可变动的项只出现在数据层，而数据层的变动大多可以认为是 SQL 的变动，架构师们自然而然地会想着把这些变动项抽离到系统外部。比如本节所述的配置管理系统。</p><p>当业务提出了新的需求时，我们的需求是将新的 SQL 录入到系统内部，或者简单修改一下老的 SQL。不对系统进行上线，就可以直接完成这些修改。</p><h4 id="6-6-1-2-业务配置"><a href="#6-6-1-2-业务配置" class="headerlink" title="6.6.1.2 业务配置"></a>6.6.1.2 业务配置</h4><p>大公司的平台部门服务众多业务线，在平台内为各业务线分配唯一 id。平台本身也由多个模块构成，这些模块需要共享相同的业务线定义(要不然就乱套了)。当公司新开产品线时，需要能够在短时间内打通所有平台系统的流程。这时候每个系统都走上线流程肯定是来不及的。另外需要对这种公共配置进行统一管理，同时对其增减逻辑也做统一管理。这些信息变更时，需要自动通知到业务方的系统，而不需要人力介入(或者只需要很简单的介入，比如点击审核通过)。</p><p>除业务线管理之外，很多互联网公司会按照城市来铺展自己的业务。在某个城市未开城之前，理论上所有模块都应该认为带有该城市 id 的数据是脏数据并自动过滤掉。而如果业务开城，在系统中就应该自己把这个新的城市 id 自动加入到白名单中。这样业务流程便可以自动运转。</p><p>再举个例子，互联网公司的运营系统中会有各种类型的运营活动，有些运营活动推出后可能出现了超出预期的事件(比如公关危机)，需要紧急将系统下线。这时候会用到一些开关来快速关闭相应的功能。或者快速将想要剔除的活动 id 从白名单中剔除。在 web 章节中的 ab test 一节中，我们也提到，有时需要有这样的系统来告诉我们当前需要放多少流量到相应的功能代码上。我们可以像那一节中，使用远程 rpc 来获知这些信息，但同时，也可以结合分布式配置系统，主动地拉取到这些信息。</p><h3 id="6-6-2-使用-etcd-实现配置更新"><a href="#6-6-2-使用-etcd-实现配置更新" class="headerlink" title="6.6.2 使用 etcd 实现配置更新"></a>6.6.2 使用 etcd 实现配置更新</h3><h3 id="6-6-2-1-配置定义"><a href="#6-6-2-1-配置定义" class="headerlink" title="6.6.2.1 配置定义"></a>6.6.2.1 配置定义</h3><p>简单的配置，可以将内容完全存储在 etcd 中。比如：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">etcdctl get &#x2F;configs&#x2F;remote_config.json&#123;    &quot;addr&quot; : &quot;127.0.0.1:1080&quot;,    &quot;aes_key&quot; : &quot;01B345B7A9ABC00F0123456789ABCDAF&quot;,    &quot;https&quot; : false,    &quot;secret&quot; : &quot;&quot;,    &quot;private_key_path&quot; : &quot;&quot;,    &quot;cert_file_path&quot; : &quot;&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-6-2-2-新建-etcd-client"><a href="#6-6-2-2-新建-etcd-client" class="headerlink" title="6.6.2.2 新建 etcd client"></a>6.6.2.2 新建 etcd client</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">cfg :&#x3D; client.Config&#123;    Endpoints:               []string&#123;&quot;http:&#x2F;&#x2F;127.0.0.1:2379&quot;&#125;,    Transport:               client.DefaultTransport,    HeaderTimeoutPerRequest: time.Second,&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接用 etcd client 包中的结构体初始化，没什么可说的。</p><h3 id="6-6-2-3-配置获取"><a href="#6-6-2-3-配置获取" class="headerlink" title="6.6.2.3 配置获取"></a>6.6.2.3 配置获取</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">resp, err &#x3D; kapi.Get(context.Background(), &quot;&#x2F;path&#x2F;to&#x2F;your&#x2F;config&quot;, nil)if err !&#x3D; nil &#123;    log.Fatal(err)&#125; else &#123;    log.Printf(&quot;Get is done. Metadata is %q\n&quot;, resp)    log.Printf(&quot;%q key has %q value\n&quot;, resp.Node.Key, resp.Node.Value)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获取配置使用 etcd KeysAPI 的 Get 方法，比较简单。</p><h3 id="6-6-2-4-配置更新订阅"><a href="#6-6-2-4-配置更新订阅" class="headerlink" title="6.6.2.4 配置更新订阅"></a>6.6.2.4 配置更新订阅</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">kapi :&#x3D; client.NewKeysAPI(c)w :&#x3D; kapi.Watcher(&quot;&#x2F;path&#x2F;to&#x2F;your&#x2F;config&quot;, nil)go func() &#123;    for &#123;        resp, err :&#x3D; w.Next(context.Background())        log.Println(resp, err)        log.Println(&quot;new values is &quot;, resp.Node.Value)    &#125;&#125;()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过订阅 config 路径的变动事件，在该路径下内容发生变化时，客户端侧可以收到变动通知，并收到变动后的字符串值。</p><p>这里只需要注意一点，我们在更新配置时，进行了一系列操作：watch 响应，json 解析，这些操作都不具备原子性。当单个业务请求流程中多次获取 config 时，有可能因为中途 config 发生变化而导致单个请求前后逻辑不一致。因此，在使用类似这样的方式来更新配置时，需要在单个请求的生命周期内使用同样的配置。具体实现方式可以是只在请求开始的时候获取一次配置，然后依次向下透传等等，具体情况具体分析。</p><h3 id="6-6-3-配置膨胀"><a href="#6-6-3-配置膨胀" class="headerlink" title="6.6.3 配置膨胀"></a>6.6.3 配置膨胀</h3><p>随着业务的发展，配置系统本身所承载的压力可能也会越来越大，配置文件可能成千上万。客户端同样上万，将配置内容存储在 etcd 内部便不再合适了</p><p>随着配置文件数量的膨胀，除了存储系统本身的吞吐量问题，还有配置信息的管理问题。我们需要对相应的配置进行权限管理，需要根据业务量进行配置存储的集群划分。如果客户端太多，导致了配置存储系统无法承受瞬时大量的 QPS，那可能还需要在客户端侧进行缓存优化，等等。</p><p>这也就是为什么大公司都会针对自己的业务额外开发一套复杂配置系统的原因。</p><h3 id="6-6-4-配置版本管理"><a href="#6-6-4-配置版本管理" class="headerlink" title="6.6.4 配置版本管理"></a>6.6.4 配置版本管理</h3><p>在配置管理过程中，难免出现用户误操作的情况，例如在更新配置时，输入了无法解析的配置。这种情况下我们可以通过配置校验来解决。</p><p>有时错误的配置可能不是格式上有问题，而是在逻辑上有问题。比如我们写 SQL 时少 select 了一个字段，更新配置时，不小心把丢掉了 json 字符串中的一个 field 而导致程序无法理解新的配置而进入诡异的逻辑。为了快速止损，最快且最有效的办法就是进行版本管理，并支持按版本回滚。</p><p>在配置进行更新时，我们要为每份配置的新内容赋予一个版本号，并将修改前的内容和版本号记录下来，当发现新配置出问题时，能够及时地回滚回来。</p><p>常见的做法是，使用 MySQL 来存储配置文件/字符串的不同版本内容，在需要回滚时，只要进行简单的查询即可。</p><h3 id="6-6-5-客户端容错"><a href="#6-6-5-客户端容错" class="headerlink" title="6.6.5 客户端容错"></a>6.6.5 客户端容错</h3><p>在业务系统的配置被剥离到配置中心之后，并不意味着我们的系统可以高枕无忧了。当配置中心本身宕机时，我们也需要一定的容错能力，至少保证在其宕机期间，业务依然可以运转。这要求我们的系统能够在配置中心宕机时，也能拿到需要的配置信息。哪怕这些信息不够新。</p><p>具体来讲，在给业务提供配置读取的 sdk 时，最好能够将拿到的配置在业务机器的磁盘上也缓存一份。这样远程配置中心不可用时，可以直接用硬盘上的内容来做兜底。当重新连接上配置中心时，再把相应的内容进行更新。</p><p>加入缓存之后务必需要考虑的是数据一致性问题，当个别业务机器因为网络错误而与其它机器配置不一致时，我们也应该能够从监控系统中知晓。</p><p>我们使用一种手段解决了我们配置更新痛点，但同时可能因为使用的手段而带给我们新的问题。</p><h2 id="6-7-分布式爬虫"><a href="#6-7-分布式爬虫" class="headerlink" title="6.7 分布式爬虫"></a>6.7 分布式爬虫</h2><h3 id="nats-简介"><a href="#nats-简介" class="headerlink" title="nats 简介"></a>nats 简介</h3><p>nats 是 Go 实现的一个高性能分布式消息队列，适用于高并发高吞吐量的消息分发场景。早期的 nats 以速度为重，没有支持持久化。从 16 年开始，nats 通过 nats-streaming 支持基于日志的持久化，以及可靠的消息传输。为了演示方便，我们本节中只使用 nats。</p><p>nats 的服务端项目是 gnatsd，客户端与 gnatsd 的通信方式为基于 tcp 的文本协议，非常简单：</p><p>向 subject 为 task 发消息：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-09-nats-protocol-pub.png" alt="nats-protocol-pub"></p><p>以 workers 的 queue 从 tasks subject 订阅消息：</p><p><img src="https://go.wuhaolin.cn/advanced-go-programming-book/images/ch6-09-nats-protocol-sub.png" alt="nats-protocol-sub"></p><p>其中的 queue 参数是可选的，如果希望在分布式的消费端进行任务的负载均衡，而不是所有人都收到同样的消息，那么就要给消费端指定相同的 queue 名字。</p><h4 id="基本消息生产"><a href="#基本消息生产" class="headerlink" title="基本消息生产"></a>基本消息生产</h4><p>生产消息只要指定 subject 即可：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">nc, err :&#x3D; nats.Connect(nats.DefaultURL)if err !&#x3D; nil &#123;    &#x2F;&#x2F; log error    return&#125;&#x2F;&#x2F; 指定 subject 为 tasks，消息内容随意err &#x3D; nc.Publish(&quot;tasks&quot;, []byte(&quot;your task content&quot;))nc.Flush()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-8-补充说明"><a href="#6-8-补充说明" class="headerlink" title="6.8 补充说明"></a>6.8 补充说明</h2><p>分布式是很大的领域，本章中的介绍只能算是对领域的管中窥豹。因为大型系统流量大，并发高，所以往往很多朴素的方案会变得难以满足需求。人们为了解决大型系统场景中的各种问题，而开发出了各式各样的分布式系统。有些系统非常简单，比如本章中介绍的分布式 id 生成器，而有一些系统则可能非常复杂，比如本章中的分布式搜索引擎(当然，本章中提到的 es 不是 Go 实现)。</p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="附录A：Go语言常见坑"><a href="#附录A：Go语言常见坑" class="headerlink" title="附录A：Go语言常见坑"></a>附录A：Go语言常见坑</h2><h2 id="可变参数是空接口类型"><a href="#可变参数是空接口类型" class="headerlink" title="可变参数是空接口类型"></a>可变参数是空接口类型</h2><p>当参数的可变参数是空接口类型时，传人空接口的切片时需要注意参数展开的问题。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    var a &#x3D; []interface&#123;&#125;&#123;1, 2, 3&#125;    fmt.Println(a)    fmt.Println(a...)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不管是否展开，编译器都无法发现错误，但是输出是不同的：</p><blockquote><p>[1 2 3]<br>1 2 3</p></blockquote><h3 id="数组是值传递"><a href="#数组是值传递" class="headerlink" title="数组是值传递"></a>数组是值传递</h3><h3 id="map遍历是顺序不固定"><a href="#map遍历是顺序不固定" class="headerlink" title="map遍历是顺序不固定"></a>map遍历是顺序不固定</h3><h3 id="返回值被屏蔽"><a href="#返回值被屏蔽" class="headerlink" title="返回值被屏蔽"></a>返回值被屏蔽</h3><p>在局部作用域中，命名的返回值内同名的局部变量屏蔽：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func Foo() (err error) &#123;    if err :&#x3D; Bar(); err !&#x3D; nil &#123;        return    &#125;    return&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="recover必须在defer函数中运行"><a href="#recover必须在defer函数中运行" class="headerlink" title="recover必须在defer函数中运行"></a>recover必须在defer函数中运行</h3><p>recover捕获的是祖父级调用时的异常，直接调用时无效：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    recover()    panic(1)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>直接defer调用也是无效：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    defer recover()    panic(1)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>defer调用时多层嵌套依然无效：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    defer func() &#123;        func() &#123; recover() &#125;()    &#125;()    panic(1)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>必须在defer函数中直接调用才有效：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    defer func() &#123;        recover()    &#125;()    panic(1)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="main函数提前退出"><a href="#main函数提前退出" class="headerlink" title="main函数提前退出"></a>main函数提前退出</h3><p>后台Goroutine无法保证完成任务。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    go println(&quot;hello&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="通过Sleep来回避并发中的问题"><a href="#通过Sleep来回避并发中的问题" class="headerlink" title="通过Sleep来回避并发中的问题"></a>通过Sleep来回避并发中的问题</h3><p>休眠并不能保证输出完整的字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    go println(&quot;hello&quot;)    time.Sleep(time.Second)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>类似的还有通过插入调度语句：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    go println(&quot;hello&quot;)    runtime.Gosched()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="独占CPU导致其它Goroutine饿死"><a href="#独占CPU导致其它Goroutine饿死" class="headerlink" title="独占CPU导致其它Goroutine饿死"></a>独占CPU导致其它Goroutine饿死</h3><p>Goroutine是协作式抢占调度，Goroutine本身不会主动放弃CPU：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    runtime.GOMAXPROCS(1)    go func() &#123;        for i :&#x3D; 0; i &lt; 10; i++ &#123;            fmt.Println(i)        &#125;    &#125;()    for &#123;&#125; &#x2F;&#x2F; 占用CPU&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决的方法是在for循环加入runtime.Gosched()调度函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    runtime.GOMAXPROCS(1)    go func() &#123;        for i :&#x3D; 0; i &lt; 10; i++ &#123;            fmt.Println(i)        &#125;    &#125;()    for &#123;        runtime.Gosched()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者是通过阻塞的方式避免CPU占用：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    runtime.GOMAXPROCS(1)    go func() &#123;        for i :&#x3D; 0; i &lt; 10; i++ &#123;            fmt.Println(i)        &#125;        os.Exit(0)    &#125;()    select&#123;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="不同Goroutine之间不满足顺序一致性内存模型"><a href="#不同Goroutine之间不满足顺序一致性内存模型" class="headerlink" title="不同Goroutine之间不满足顺序一致性内存模型"></a>不同Goroutine之间不满足顺序一致性内存模型</h3><p>因为在不同的Goroutine，main函数中无法保证能打印出<code>hello, world</code>:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var msg stringvar done boolfunc setup() &#123;    msg &#x3D; &quot;hello, world&quot;    done &#x3D; true&#125;func main() &#123;    go setup()    for !done &#123;    &#125;    println(msg)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决的办法是用显式同步：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var msg stringvar done &#x3D; make(chan bool)func setup() &#123;    msg &#x3D; &quot;hello, world&quot;    done &lt;- true&#125;func main() &#123;    go setup()    &lt;-done    println(msg)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>msg的写入是在channel发送之前，所以能保证打印<code>hello, world</code></p><h3 id="闭包错误引用同一个变量"><a href="#闭包错误引用同一个变量" class="headerlink" title="闭包错误引用同一个变量"></a>闭包错误引用同一个变量</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    for i :&#x3D; 0; i &lt; 5; i++ &#123;        defer func() &#123;            println(i)        &#125;()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>改进的方法是在每轮迭代中生成一个局部变量：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    for i :&#x3D; 0; i &lt; 5; i++ &#123;        i :&#x3D; i        defer func() &#123;            println(i)        &#125;()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者是通过函数参数传入：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    for i :&#x3D; 0; i &lt; 5; i++ &#123;        defer func(i int) &#123;            println(i)        &#125;(i)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="在循环内部执行defer语句"><a href="#在循环内部执行defer语句" class="headerlink" title="在循环内部执行defer语句"></a>在循环内部执行defer语句</h3><p>defer在函数退出时才能执行，在for执行defer会导致资源延迟释放：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    for i :&#x3D; 0; i &lt; 5; i++ &#123;        f, err :&#x3D; os.Open(&quot;&#x2F;path&#x2F;to&#x2F;file&quot;)        if err !&#x3D; nil &#123;            log.Fatal(err)        &#125;        defer f.Close()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决的方法可以在for中构造一个局部函数，在局部函数内部执行defer：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    for i :&#x3D; 0; i &lt; 5; i++ &#123;        func() &#123;            f, err :&#x3D; os.Open(&quot;&#x2F;path&#x2F;to&#x2F;file&quot;)            if err !&#x3D; nil &#123;                log.Fatal(err)            &#125;            defer f.Close()        &#125;()    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="切片会导致整个底层数组被锁定"><a href="#切片会导致整个底层数组被锁定" class="headerlink" title="切片会导致整个底层数组被锁定"></a>切片会导致整个底层数组被锁定</h3><p>切片会导致整个底层数组被锁定，底层数组无法释放内存。如果底层数组较大会对内存产生很大的压力。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    headerMap :&#x3D; make(map[string][]byte)    for i :&#x3D; 0; i &lt; 5; i++ &#123;        name :&#x3D; &quot;&#x2F;path&#x2F;to&#x2F;file&quot;        data, err :&#x3D; ioutil.ReadFile(name)        if err !&#x3D; nil &#123;            log.Fatal(err)        &#125;        headerMap[name] &#x3D; data[:1]    &#125;    &#x2F;&#x2F; do some thing&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决的方法是将结果克隆一份，这样可以释放底层的数组：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    headerMap :&#x3D; make(map[string][]byte)    for i :&#x3D; 0; i &lt; 5; i++ &#123;        name :&#x3D; &quot;&#x2F;path&#x2F;to&#x2F;file&quot;        data, err :&#x3D; ioutil.ReadFile(name)        if err !&#x3D; nil &#123;            log.Fatal(err)        &#125;        headerMap[name] &#x3D; append([]byte&#123;&#125;, data[:1]...)    &#125;    &#x2F;&#x2F; do some thing&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="内存地址会变化"><a href="#内存地址会变化" class="headerlink" title="内存地址会变化"></a>内存地址会变化</h3><p>Go语言中对象的地址可能发生变化，因此指针不能从其它非指针类型的值生成：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    var x int &#x3D; 42    var p uintptr &#x3D; uintptr(unsafe.Pointer(&amp;x))    runtime.GC()    var px *int &#x3D; (*int)(unsafe.Pointer(p))    println(*px)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当内存发送变化的时候，相关的指针会同步更新，但是非指针类型的uintptr不会做同步更新。</p><p>同理CGO中也不能保存Go对象地址。</p><h3 id="Goroutine泄露"><a href="#Goroutine泄露" class="headerlink" title="Goroutine泄露"></a>Goroutine泄露</h3><p>Go语言是带内存自动回收的特性，因此内存一般不会泄漏。但是Goroutine确存在泄漏的情况，同时泄漏的Goroutine引用的内存同样无法被回收。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    ch :&#x3D; func() &lt;-chan int &#123;        ch :&#x3D; make(chan int)        go func() &#123;            for i :&#x3D; 0; ; i++ &#123;                ch &lt;- i            &#125;        &#125; ()        return ch    &#125;()    for v :&#x3D; range ch &#123;        fmt.Println(v)        if v &#x3D;&#x3D; 5 &#123;            break        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的程序中后台Goroutine向管道输入自然数序列，main函数中输出序列。但是当break跳出for循环的时候，后台Goroutine就处于无法被回收的状态了。</p><p>我们可以通过context包来避免这个问题：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    ctx, cancel :&#x3D; context.WithCancel(context.Background())    ch :&#x3D; func(ctx context.Context) &lt;-chan int &#123;        ch :&#x3D; make(chan int)        go func() &#123;            for i :&#x3D; 0; ; i++ &#123;                select &#123;                case &lt;- ctx.Done():                    return                case ch &lt;- i:                &#125;            &#125;        &#125; ()        return ch    &#125;(ctx)    for v :&#x3D; range ch &#123;        fmt.Println(v)        if v &#x3D;&#x3D; 5 &#123;            cancel()            break        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当main函数在break跳出循环时，通过调用<code>cancel()</code>来通知后台Goroutine退出，这样就避免了Goroutine的泄漏。</p>]]></content>
    
    
    <summary type="html">《Go语言高级编程》阅读笔记</summary>
    
    
    
    <category term="书摘" scheme="https://changqingaas.github.io/categories/%E4%B9%A6%E6%91%98/"/>
    
    
    <category term="Go" scheme="https://changqingaas.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>《Go语言圣经》阅读笔记</title>
    <link href="https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/"/>
    <id>https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Go/go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/</id>
    <published>2022-05-10T14:00:33.000Z</published>
    <updated>2022-10-24T02:57:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>为了解决在21世纪多核和网络化环境下越来越复杂的编程问题而发明了Go语言</p><p>纵观这几年来的发展趋势，Go语言已经成为云计算、云存储时代最重要的基础编程语言。</p><p>Go语言中和并发编程相关的特性是全新的也是有效的，同时对数据抽象和面向对象编程的支持也很灵活。 Go语言同时还集成了自动垃圾收集技术用于更好地管理内存。</p><p>Go语言尤其适合编写网络服务相关基础设施，同时也适合开发一些工具软件和系统软件。 但是Go语言确实是一个通用的编程语言，它也可以用在图形图像驱动编程、移动应用程序开发 和机器学习等诸多领域。目前Go语言已经成为受欢迎的作为无类型的脚本语言的替代者： 因为Go编写的程序通常比脚本语言运行的更快也更安全，而且很少会发生意外的类型错误。</p><h2 id="Go语言项目"><a href="#Go语言项目" class="headerlink" title="Go语言项目"></a>Go语言项目</h2><p>正如<a href="http://genius.cat-v.org/rob-pike/">Rob Pike</a>所说，“软件的复杂性是乘法级相关的”，通过增加一个部分的复杂性来修复问题通常将慢慢地增加其他部分的复杂性。通过增加功能、选项和配置是修复问题的最快的途径，但是这很容易让人忘记简洁的内涵，即从长远来看，简洁依然是好软件的关键因素。</p><p>Go项目包括编程语言本身，附带了相关的工具和标准库，最后但并非代表不重要的是，关于简洁编程哲学的宣言。就事后诸葛的角度来看，Go语言的这些地方都做的还不错：拥有自动垃圾回收、一个包系统、函数作为一等公民、词法作用域、系统调用接口、只读的UTF8字符串等。但是Go语言本身只有很少的特性，也不太可能添加太多的特性。例如，它没有隐式的数值转换，没有构造函数和析构函数，没有运算符重载，没有默认参数，也没有继承，没有泛型，没有异常，没有宏，没有函数修饰，更没有线程局部存储。但是，语言本身是成熟和稳定的，而且承诺保证向后兼容：用之前的Go语言编写程序可以用新版本的Go语言编译器和标准库直接构建而不需要修改代码。</p><p>Go语言有足够的类型系统以避免动态语言中那些粗心的类型错误，但是，Go语言的类型系统相比传统的强类型语言又要简洁很多。虽然，有时候这会导致一个“无类型”的抽象类型概念，但是Go语言程序员并不需要像C++或Haskell程序员那样纠结于具体类型的安全属性。在实践中，Go语言简洁的类型系统给程序员带来了更多的安全性和更好的运行时性能。</p><p>由于现代计算机是一个并行的机器，Go语言提供了基于CSP（顺序通信进程）的并发特性支持。Go语言的动态栈使得轻量级线程goroutine的初始栈可以很小，因此，创建一个goroutine的代价很小，创建百万级的goroutine完全是可行的。</p><h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p>Go语言的代码通过<strong>包</strong>（package）组织，包类似于其它语言里的库（libraries）或者模块（modules）。一个包由位于单个目录下的一个或多个.go源代码文件组成, 目录定义包的作用。每个源文件都以一条<code>package</code>声明语句开始，这个例子里就是<code>package main</code>, 表示该文件属于哪个包，紧跟着一系列导入（import）的包，之后是存储在这个文件里的程序语句。</p><p>Go的标准库提供了100多个包，以支持常见功能，如输入、输出、排序以及文本处理。比如<code>fmt</code>包，就含有格式化输出、接收输入的函数。<code>Println</code>是其中一个基础函数，可以打印以空格间隔的一个或多个值，并在最后添加一个换行符，从而输出一整行。</p><p><code>main</code>包比较特殊。它定义了一个独立可执行的程序，而不是一个库。在<code>main</code>里的<code>main</code> <em>函数</em> 也很特殊，它是整个程序执行时的入口（译注：C系语言差不多都这样）。</p><p>必须恰当导入需要的包，缺少了必要的包或者导入了不需要的包，程序都无法编译通过。这项严格要求避免了程序开发过程中引入未使用的包（译注：Go语言编译过程没有警告信息，争议特性之一）。</p><p>Go语言不需要在语句或者声明的末尾添加分号，除非一行上有多条语句。实际上，编译器会主动把特定符号后的换行符转换为分号, 因此换行符添加的位置会影响Go代码的正确解析（译注：比如行末是标识符、整数、浮点数、虚数、字符或字符串文字、关键字<code>break</code>、<code>continue</code>、<code>fallthrough</code>或<code>return</code>中的一个、运算符和分隔符<code>++</code>、<code>--</code>、<code>)</code>、<code>]</code>或<code>&#125;</code>中的一个）举个例子, 函数的左括号<code>&#123;</code>必须和<code>func</code>函数声明在同一行上, 且位于末尾，不能独占一行，而在表达式<code>x + y</code>中，可在<code>+</code>后换行，不能在<code>+</code>前换行（译注：以+结尾的话不会被插入分号分隔符，但是以x结尾的话则会被分号分隔符，从而导致编译错误）</p><p>Go语言在代码格式上采取了很强硬的态度。<code>gofmt</code>工具把代码格式化为标准格式（译注：这个格式化工具没有任何可以调整代码格式的参数，Go语言就是这么任性），并且<code>go</code>工具中的<code>fmt</code>子命令会对指定包, 否则默认为当前目录, 中所有.go源文件应用<code>gofmt</code>命令。 这样可以做多种自动源码转换，</p><p>很多文本编辑器都可以配置为保存文件时自动执行<code>gofmt</code>，这样你的源代码总会被恰当地格式化。还有个相关的工具，<code>goimports</code>，可以根据代码需要, 自动地添加或删除<code>import</code>声明。</p><h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;os&quot;)func main() &#123;    var s, sep string    for i :&#x3D; 1; i &lt; len(os.Args); i++ &#123;        s +&#x3D; sep + os.Args[i]        sep &#x3D; &quot; &quot;    &#125;    fmt.Println(s)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果变量没有显式初始化，则被隐式地赋予其类型的<em>零值</em>（zero value），数值类型是0，字符串类型是空字符串””。这个例子里，声明把s和sep隐式地初始化成空字符串。</p><p>++和—都只能放在变量名后面，因此<code>--i</code>非法</p><p>Go语言只有for循环这一种循环语句。for循环有多种形式，其中一种如下所示：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">for initialization; condition; post &#123;    &#x2F;&#x2F; zero or more statements&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>initialization</em>语句是可选的，在循环开始前执行。<em>initalization</em>如果存在，必须是一条<em>简单语句</em>（simple statement），即，短变量声明、自增语句、赋值语句或函数调用。<code>condition</code>是一个布尔表达式（boolean expression），其值在每次循环迭代开始时计算。如果为<code>true</code>则执行循环体语句。<code>post</code>语句在循环体执行结束后执行，之后再次对<code>condition</code>求值。<code>condition</code>值为<code>false</code>时，循环结束。</p><p>for循环的这三个部分每个都可以省略，如果省略<code>initialization</code>和<code>post</code>，分号也可以省略：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; a traditional &quot;while&quot; loopfor condition &#123;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果连<code>condition</code>也省略了，像下面这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; a traditional infinite loopfor &#123;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这就变成一个无限循环，尽管如此，还可以用其他方式终止循环, 如一条<code>break</code>或<code>return</code>语句。</p><p><code>for</code>循环的另一种形式, 在某种数据类型的区间（range）上遍历，如字符串或切片。<code>echo</code>的第二版本展示了这种形式：</p><p><em>gopl.io/ch1/echo2</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Echo2 prints its command-line arguments.package mainimport (    &quot;fmt&quot;    &quot;os&quot;)func main() &#123;    s, sep :&#x3D; &quot;&quot;, &quot;&quot;    for _, arg :&#x3D; range os.Args[1:] &#123;        s +&#x3D; sep + arg        sep &#x3D; &quot; &quot;    &#125;    fmt.Println(s)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每次循环迭代，<code>range</code>产生一对值；索引以及在该索引处的元素值。这个例子不需要索引，但<code>range</code>的语法要求, 要处理元素, 必须处理索引。一种思路是把索引赋值给一个临时变量, 如<code>temp</code>, 然后忽略它的值，但Go语言不允许使用无用的局部变量（local variables），因为这会导致编译错误。Go语言中这种情况的解决方法是用<code>空标识符</code>（blank identifier），即<code>_</code>（也就是下划线）。</p><p>声明一个变量有好几种方式，下面这些都等价：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s :&#x3D; &quot;&quot;var s stringvar s &#x3D; &quot;&quot;var s string &#x3D; &quot;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>第一种形式，是一条短变量声明，最简洁，但只能用在函数内部，而不能用于包变量。第二种形式依赖于字符串的默认初始化零值机制，被初始化为””。第三种形式用得很少，除非同时声明多个变量。第四种形式显式地标明变量的类型，当变量类型与初值类型相同时，类型冗余, 但如果两者类型不同，变量类型就必须了。实践中一般使用前两种形式中的某个，初始值重要的话就显式地指定变量的类型，否则使用隐式初始化。</p><p>如前文所述，每次循环迭代字符串s的内容都会更新。<code>+=</code>连接原字符串、空格和下个参数，产生新字符串, 并把它赋值给<code>s</code>。<code>s</code>原来的内容已经不再使用，将在适当时机对它进行垃圾回收。</p><p>如果连接涉及的数据量很大，这种方式代价高昂。一种简单且高效的解决方案是使用<code>strings</code>包的<code>Join</code>函数：</p><p><em>gopl.io/ch1/echo3</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    fmt.Println(strings.Join(os.Args[1:], &quot; &quot;))&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>最后，如果不关心输出格式，只想看看输出值，或许只是为了调试，可以用<code>Println</code>为我们格式化输出。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(os.Args[1:])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这条语句的输出结果跟<code>strings.Join</code>得到的结果很像，只是被放到了一对方括号里。切片都会被打印成这种格式。</p><h2 id="寻找重复的行"><a href="#寻找重复的行" class="headerlink" title="寻找重复的行"></a>寻找重复的行</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (&quot;bufio&quot;&quot;fmt&quot;&quot;os&quot;)func main() &#123;counts :&#x3D; make(map[string]int)input :&#x3D; bufio.NewScanner(os.Stdin)for input.Scan() &#123;        line :&#x3D; input.Text()counts[line]++&#125;for line, n :&#x3D; range counts &#123;if n &gt; 1 &#123;fmt.Println(&quot;%d\t%s\t&quot;, n, line)&#125;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了打印结果，我们使用了基于<code>range</code>的循环，并在<code>counts</code>这个<code>map</code>上迭代。跟之前类似，每次迭代得到两个结果，键和其在<code>map</code>中对应的值。<code>map</code>的迭代顺序并不确定，从实践来看，该顺序随机，每次运行都会变化。这种设计是有意为之的，因为能防止程序依赖特定遍历顺序，而这是无法保证的。</p><p>继续来看<code>bufio</code>包，它使处理输入和输出方便又高效。<code>Scanner</code>类型是该包最有用的特性之一，它读取输入并将其拆成行或单词；通常是处理行形式的输入最简单的方法。</p><p>程序使用短变量声明创建<code>bufio.Scanner</code>类型的变量<code>input</code>。</p><pre class="line-numbers language-none"><code class="language-none">input :&#x3D; bufio.NewScanner(os.Stdin)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>该变量从程序的标准输入中读取内容。每次调用<code>input.Scan()</code>，即读入下一行，并移除行末的换行符；读取的内容可以调用<code>input.Text()</code>得到。<code>Scan</code>函数在读到一行时返回<code>true</code>，不再有输入时返回<code>false</code>。</p><p>多程序要么从标准输入中读取数据，如上面的例子所示，要么从一系列具名文件中读取数据。<code>dup</code>程序的下个版本读取标准输入或是使用<code>os.Open</code>打开各个具名文件，并操作它们。</p><p><em>gopl.io/ch1/dup2</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Dup2 prints the count and text of lines that appear more than once&#x2F;&#x2F; in the input.  It reads from stdin or from a list of named files.package mainimport (    &quot;bufio&quot;    &quot;fmt&quot;    &quot;os&quot;)func main() &#123;    counts :&#x3D; make(map[string]int)    files :&#x3D; os.Args[1:]    if len(files) &#x3D;&#x3D; 0 &#123;        countLines(os.Stdin, counts)    &#125; else &#123;        for _, arg :&#x3D; range files &#123;            f, err :&#x3D; os.Open(arg)            if err !&#x3D; nil &#123;                fmt.Fprintf(os.Stderr, &quot;dup2: %v\n&quot;, err)                continue            &#125;            countLines(f, counts)            f.Close()        &#125;    &#125;    for line, n :&#x3D; range counts &#123;        if n &gt; 1 &#123;            fmt.Printf(&quot;%d\t%s\n&quot;, n, line)        &#125;    &#125;&#125;func countLines(f *os.File, counts map[string]int) &#123;    input :&#x3D; bufio.NewScanner(f)    for input.Scan() &#123;        counts[input.Text()]++    &#125;    &#x2F;&#x2F; NOTE: ignoring potential errors from input.Err()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数和包级别的变量（package-level entities）可以任意顺序声明，并不影响其被调用。（译注：最好还是遵循一定的规范）</p><p><code>dup</code>的前两个版本以”流”模式读取输入，并根据需要拆分成多个行。理论上，这些程序可以处理任意数量的输入数据。还有另一个方法，就是一口气把全部输入数据读到内存中，一次分割为多行，然后处理它们。</p><p>这个例子引入了<code>ReadFile</code>函数（来自于<code>io/ioutil</code>包），其读取指定文件的全部内容，<code>strings.Split</code>函数把字符串分割成子串的切片。（<code>Split</code>的作用与前文提到的<code>strings.Join</code>相反。）</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (    &quot;fmt&quot;    &quot;io&#x2F;ioutil&quot;    &quot;os&quot;    &quot;strings&quot;)func main() &#123;    counts :&#x3D; make(map[string]int)    for _, filename :&#x3D; range os.Args[1:] &#123;        data, err :&#x3D; ioutil.ReadFile(filename)        if err !&#x3D; nil &#123;            fmt.Fprintf(os.Stderr, &quot;dup3: %v\n&quot;, err)            continue        &#125;        for _, line :&#x3D; range strings.Split(string(data), &quot;\n&quot;) &#123;            counts[line]++        &#125;    &#125;    for line, n :&#x3D; range counts &#123;        if n &gt; 1 &#123;            fmt.Printf(&quot;%d\t%s\n&quot;, n, line)        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>ReadFile</code>函数返回一个字节切片（byte slice），必须把它转换为<code>string</code>，才能用<code>strings.Split</code>分割。</p><p>实现上，<code>bufio.Scanner</code>、<code>ioutil.ReadFile</code>和<code>ioutil.WriteFile</code>都使用<code>*os.File</code>的<code>Read</code>和<code>Write</code>方法，但是，大多数程序员很少需要直接调用那些低级（lower-level）函数。高级（higher-level）函数，像<code>bufio</code>和<code>io/ioutil</code>包中所提供的那些，用起来要容易点。</p><h2 id="GIF动画"><a href="#GIF动画" class="headerlink" title="GIF动画"></a>GIF动画</h2><p>当我们import了一个包路径包含有多个单词的package时，比如image/color（image和color两个单词），通常我们只需要用最后那个单词表示这个包就可以。所以当我们写color.White时，这个变量指向的是image/color包里的变量 </p><p>这个程序里的常量声明给出了一系列的常量值，常量是指在程序编译后运行时始终都不会变化的值，比如圈数、帧数、延迟值。常量声明和变量声明一般都会出现在包级别，所以这些常量在整个包中都是可以共享的，或者你也可以把常量声明定义在函数体内部，那么这种常量就只能在函数体内用。</p><h2 id="1-5-获取URL"><a href="#1-5-获取URL" class="headerlink" title="1.5. 获取URL"></a>1.5. 获取URL</h2><p>Go语言在net这个强大package的帮助下提供了一系列的package来做这件事情，使用这些包可以更简单地用网络收发信息，还可以建立更底层的网络连接，编写服务器程序。在这些情景下，Go语言原生的并发特性（在第八章中会介绍）显得尤其好用。</p><h2 id="1-6"><a href="#1-6" class="headerlink" title="1.6"></a>1.6</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Fetchall fetches URLs in parallel and reports their times and sizes.package mainimport (    &quot;fmt&quot;    &quot;io&quot;    &quot;io&#x2F;ioutil&quot;    &quot;net&#x2F;http&quot;    &quot;os&quot;    &quot;time&quot;)func main() &#123;    start :&#x3D; time.Now()    ch :&#x3D; make(chan string)    for _, url :&#x3D; range os.Args[1:] &#123;        go fetch(url, ch) &#x2F;&#x2F; start a goroutine    &#125;    for range os.Args[1:] &#123;        fmt.Println(&lt;-ch) &#x2F;&#x2F; receive from channel ch    &#125;    fmt.Printf(&quot;%.2fs elapsed\n&quot;, time.Since(start).Seconds())&#125;func fetch(url string, ch chan&lt;- string) &#123;    start :&#x3D; time.Now()    resp, err :&#x3D; http.Get(url)    if err !&#x3D; nil &#123;        ch &lt;- fmt.Sprint(err) &#x2F;&#x2F; send to channel ch        return    &#125;    nbytes, err :&#x3D; io.Copy(ioutil.Discard, resp.Body)    resp.Body.Close() &#x2F;&#x2F; don&#39;t leak resources    if err !&#x3D; nil &#123;        ch &lt;- fmt.Sprintf(&quot;while reading %s: %v&quot;, url, err)        return    &#125;    secs :&#x3D; time.Since(start).Seconds()    ch &lt;- fmt.Sprintf(&quot;%.2fs  %7d  %s&quot;, secs, nbytes, url)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>goroutine是一种函数的并发执行方式，而channel是用来在goroutine之间进行参数传递。main函数本身也运行在一个goroutine中，而go function则表示创建一个新的goroutine，并在这个新的goroutine中执行这个函数。</p><p>当一个goroutine尝试在一个channel上做send或者receive操作时，这个goroutine会阻塞在调用处，直到另一个goroutine从这个channel里接收或者写入值，这样两个goroutine才会继续执行channel操作之后的逻辑。在这个例子中，每一个fetch函数在执行时都会往channel里发送一个值(ch &lt;- expression)，主函数负责接收这些值(&lt;-ch)。这个程序中我们用main函数来接收所有fetch函数传回的字符串，可以避免在goroutine异步执行还没有完成时main函数提前退出。</p><h2 id="1-8-Web服务"><a href="#1-8-Web服务" class="headerlink" title="1.8 Web服务"></a>1.8 Web服务</h2><p>o语言的内置库使得写一个类似fetch的web服务器变得异常地简单。在本节中，我们会展示一个微型服务器，这个服务器的功能是返回当前用户正在访问的URL。比如用户访问的是 <a href="http://localhost:8000/hello">http://localhost:8000/hello</a> ，那么响应是URL.Path = “hello”。</p><p><em>gopl.io/ch1/server1</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Server1 is a minimal &quot;echo&quot; server.package mainimport (    &quot;fmt&quot;    &quot;log&quot;    &quot;net&#x2F;http&quot;)func main() &#123;    http.HandleFunc(&quot;&#x2F;&quot;, handler) &#x2F;&#x2F; each request calls handler    log.Fatal(http.ListenAndServe(&quot;localhost:8000&quot;, nil))&#125;&#x2F;&#x2F; handler echoes the Path component of the request URL r.func handler(w http.ResponseWriter, r *http.Request) &#123;    fmt.Fprintf(w, &quot;URL.Path &#x3D; %q\n&quot;, r.URL.Path)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们只用了八九行代码就实现了一个Web服务程序，这都是多亏了标准库里的方法已经帮我们完成了大量工作。main函数将所有发送到/路径下的请求和handler函数关联起来，/开头的请求其实就是所有发送到当前站点上的请求，服务监听8000端口。发送到这个服务的“请求”是一个http.Request类型的对象，这个对象中包含了请求中的一系列相关字段，其中就包括我们需要的URL。当请求到达服务器时，这个请求会被传给handler函数来处理，这个函数会将/hello这个路径从请求的URL中解析出来，然后把其发送到响应中，这里我们用的是标准输出流的fmt.Fprintf。Web服务会在第7.7节中做更详细的阐述。</p><p>让我们在后台运行这个服务程序。如果你的操作系统是Mac OS X或者Linux，那么在运行命令的末尾加上一个&amp;符号，即可让程序简单地跑在后台，windows下可以在另外一个命令行窗口去运行这个程序。</p><pre class="line-numbers language-none"><code class="language-none">$ go run src&#x2F;gopl.io&#x2F;ch1&#x2F;server1&#x2F;main.go &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在可以通过命令行来发送客户端请求了：</p><pre class="line-numbers language-none"><code class="language-none">$ go build gopl.io&#x2F;ch1&#x2F;fetch$ .&#x2F;fetch http:&#x2F;&#x2F;localhost:8000URL.Path &#x3D; &quot;&#x2F;&quot;$ .&#x2F;fetch http:&#x2F;&#x2F;localhost:8000&#x2F;helpURL.Path &#x3D; &quot;&#x2F;help&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还可以直接在浏览器里访问这个URL，然后得到返回结果</p><p>在这个服务的基础上叠加特性是很容易的。一种比较实用的修改是为访问的url添加某种状态。比如，下面这个版本输出了同样的内容，但是会对请求的次数进行计算；对URL的请求结果会包含各种URL被访问的总次数，直接对/count这个URL的访问要除外。</p><p><em>gopl.io/ch1/server2</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Server2 is a minimal &quot;echo&quot; and counter server.package mainimport (    &quot;fmt&quot;    &quot;log&quot;    &quot;net&#x2F;http&quot;    &quot;sync&quot;)var mu sync.Mutexvar count intfunc main() &#123;    http.HandleFunc(&quot;&#x2F;&quot;, handler)    http.HandleFunc(&quot;&#x2F;count&quot;, counter)    log.Fatal(http.ListenAndServe(&quot;localhost:8000&quot;, nil))&#125;&#x2F;&#x2F; handler echoes the Path component of the requested URL.func handler(w http.ResponseWriter, r *http.Request) &#123;    mu.Lock()    count++    mu.Unlock()    fmt.Fprintf(w, &quot;URL.Path &#x3D; %q\n&quot;, r.URL.Path)&#125;&#x2F;&#x2F; counter echoes the number of calls so far.func counter(w http.ResponseWriter, r *http.Request) &#123;    mu.Lock()    fmt.Fprintf(w, &quot;Count %d\n&quot;, count)    mu.Unlock()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个服务器有两个请求处理函数，根据请求的url不同会调用不同的函数：对/count这个url的请求会调用到counter这个函数，其它的url都会调用默认的处理函数。如果你的请求pattern是以/结尾，那么所有以该url为前缀的url都会被这条规则匹配。在这些代码的背后，服务器每一次接收请求处理时都会另起一个goroutine，这样服务器就可以同一时间处理多个请求。然而在并发情况下，假如真的有两个请求同一时刻去更新count，那么这个值可能并不会被正确地增加；这个程序可能会引发一个严重的bug：竞态条件（参见9.1）。为了避免这个问题，我们必须保证每次修改变量的最多只能有一个goroutine，这也就是代码里的mu.Lock()和mu.Unlock()调用将修改count的所有行为包在中间的目的。第九章中我们会进一步讲解共享变量。</p><p>Go语言的接口机制会在第7章中讲解，为了在这里简单说明接口能做什么，让我们简单地将这里的web服务器和之前写的lissajous函数结合起来，这样GIF动画可以被写到HTTP的客户端，而不是之前的标准输出流。只要在web服务器的代码里加入下面这几行。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">handler :&#x3D; func(w http.ResponseWriter, r *http.Request) &#123;    lissajous(w)&#125;http.HandleFunc(&quot;&#x2F;&quot;, handler)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>或者另一种等价形式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">http.HandleFunc(&quot;&#x2F;&quot;, func(w http.ResponseWriter, r *http.Request) &#123;    lissajous(w)&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="1-8-本章要点"><a href="#1-8-本章要点" class="headerlink" title="1.8 本章要点"></a>1.8 本章要点</h2><p>Go语言并不需要显式地在每一个case后写break，语言默认执行完case后的逻辑语句会自动退出。当然了，如果你想要相邻的几个case都执行同一逻辑的话，需要自己显式地写上一个fallthrough语句来覆盖这种默认行为。不过fallthrough语句在一般的程序中很少用到。</p><p><strong>指针：</strong> Go语言提供了指针。指针是一种直接存储了变量的内存地址的数据类型。在其它语言中，比如C语言，指针操作是完全不受约束的。在另外一些语言中，指针一般被处理为“引用”，除了到处传递这些指针之外，并不能对这些指针做太多事情。Go语言在这两种范围中取了一种平衡。指针是可见的内存地址，&amp;操作符可以返回一个变量的内存地址，并且*操作符可以获取指针指向的变量内容，但是在Go语言里没有指针运算，也就是不能像c语言里可以对指针进行加或减操作。</p><p><strong>方法和接口：</strong> 方法是和命名类型关联的一类函数。Go语言里比较特殊的是方法可以被关联到任意一种命名类型。在第六章我们会详细地讲方法。接口是一种抽象类型，这种类型可以让我们以同样的方式来处理不同的固有类型，不用关心它们的具体实现，而只需要关注它们提供的方法。第七章中会详细说明这些内容。</p><h1 id="2-程序结构"><a href="#2-程序结构" class="headerlink" title="2.程序结构"></a>2.程序结构</h1><h2 id="2-3-变量"><a href="#2-3-变量" class="headerlink" title="2.3 变量"></a>2.3 变量</h2><p>那么Go语言的自动垃圾收集器是如何知道一个变量是何时可以被回收的呢？这里我们可以避开完整的技术细节，基本的实现思路是，从每个包级的变量和每个当前运行函数的每一个局部变量开始，通过指针或引用的访问路径遍历，是否可以找到该变量。如果不存在这样的访问路径，那么说明该变量是不可达的，也就是说它是否存在并不会影响程序后续的计算结果。</p><p>因为一个变量的有效周期只取决于是否可达，因此一个循环迭代内部的局部变量的生命周期可能超出其局部作用域。同时，局部变量可能在函数返回之后依然存在。</p><p>编译器会自动选择在栈上还是在堆上分配局部变量的存储空间，但可能令人惊讶的是，这个选择并不是由用var还是new声明变量的方式决定的。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var global *intfunc f() &#123;    var x int    x &#x3D; 1    global &#x3D; &amp;x&#125;func g() &#123;    y :&#x3D; new(int)    *y &#x3D; 1&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>f函数里的x变量必须在堆上分配，因为它在函数退出后依然可以通过包一级的global变量找到，虽然它是在函数内部定义的；用Go语言的术语说，<strong>这个x局部变量从函数f中逃逸了</strong>。相反，当g函数返回时，变量<code>*y</code>将是不可达的，也就是说可以马上被回收的。因此，<code>*y</code>并没有从函数g中逃逸，编译器可以选择在栈上分配<code>*y</code>的存储空间（译注：也可以选择在堆上分配，然后由Go语言的GC回收这个变量的内存空间），虽然这里用的是new方式。其实在任何时候，你并不需为了编写正确的代码而要考虑变量的逃逸行为，要记住的是，<code>逃逸的变量需要额外分配内存，同时对性能的优化可能会产生细微的影响</code>。</p><p>Go语言的自动垃圾收集器对编写正确的代码是一个巨大的帮助，但也并不是说你完全不用考虑内存了。你虽然不需要显式地分配和释放内存，但是要编写高效的程序你依然需要了解变量的生命周期。例如，如果将指向短生命周期对象的指针保存到具有长生命周期的对象中，特别是保存到全局变量时，会阻止对短生命周期对象的垃圾回收（从而可能影响程序的性能）。</p><h2 id="2-4-赋值"><a href="#2-4-赋值" class="headerlink" title="2.4 赋值"></a>2.4 赋值</h2><p>在稍后我们将看到的三个操作都是类似的用法。如果map查找（§4.3）、类型断言（§7.10）或通道接收（§8.4.2）出现在赋值语句的右边，它们都可能会产生两个结果，有一个额外的布尔结果表示操作是否成功：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">v, ok &#x3D; m[key]             &#x2F;&#x2F; map lookupv, ok &#x3D; x.(T)              &#x2F;&#x2F; type assertionv, ok &#x3D; &lt;-ch               &#x2F;&#x2F; channel receive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>译注：map查找（§4.3）、类型断言（§7.10）或通道接收（§8.4.2）出现在赋值语句的右边时，并不一定是产生两个结果，也可能只产生一个结果。对于只产生一个结果的情形，map查找失败时会返回零值，类型断言失败时会发生运行时panic异常，通道接收失败时会返回零值（阻塞不算是失败）。例如下面的例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">v &#x3D; m[key]                &#x2F;&#x2F; map查找，失败时返回零值v &#x3D; x.(T)                 &#x2F;&#x2F; type断言，失败时panic异常v &#x3D; &lt;-ch                  &#x2F;&#x2F; 管道接收，失败时返回零值（阻塞不算是失败）_, ok &#x3D; m[key]            &#x2F;&#x2F; map返回2个值_, ok &#x3D; mm[&quot;&quot;], false     &#x2F;&#x2F; map返回1个值_ &#x3D; mm[&quot;&quot;]                &#x2F;&#x2F; map返回1个值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-2-可赋值性"><a href="#2-4-2-可赋值性" class="headerlink" title="2.4.2. 可赋值性"></a>2.4.2. 可赋值性</h3><p>不管是隐式还是显式地赋值，在赋值语句左边的变量和右边最终的求到的值必须有相同的数据类型。更直白地说，只有右边的值对于左边的变量是可赋值的，赋值语句才是允许的。</p><p>可赋值性的规则对于不同类型有着不同要求，对每个新类型特殊的地方我们会专门解释。对于目前我们已经讨论过的类型，它的规则是简单的：类型必须完全匹配，nil可以赋值给任何指针或引用类型的变量。常量（§3.6）则有更灵活的赋值规则，因为这样可以避免不必要的显式的类型转换。</p><p>对于两个值是否可以用<code>==</code>或<code>!=</code>进行相等比较的能力也和可赋值能力有关系：对于任何类型的值的相等比较，第二个值必须是对第一个值类型对应的变量是可赋值的，</p><h2 id="2-5-类型"><a href="#2-5-类型" class="headerlink" title="2.5 类型"></a>2.5 类型</h2><p><em>gopl.io/ch2/tempconv0</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Package tempconv performs Celsius and Fahrenheit temperature computations.package tempconvimport &quot;fmt&quot;type Celsius float64    &#x2F;&#x2F; 摄氏温度type Fahrenheit float64 &#x2F;&#x2F; 华氏温度const (    AbsoluteZeroC Celsius &#x3D; -273.15 &#x2F;&#x2F; 绝对零度    FreezingC     Celsius &#x3D; 0       &#x2F;&#x2F; 结冰点温度    BoilingC      Celsius &#x3D; 100     &#x2F;&#x2F; 沸水温度)func CToF(c Celsius) Fahrenheit &#123; return Fahrenheit(c*9&#x2F;5 + 32) &#125;func FToC(f Fahrenheit) Celsius &#123; return Celsius((f - 32) * 5 &#x2F; 9) &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们在这个包声明了两种类型：Celsius和Fahrenheit分别对应不同的温度单位。它们虽然有着相同的底层类型float64，但是它们是不同的数据类型，因此它们不可以被相互比较或混在一个表达式运算。刻意区分类型，可以避免一些像无意中使用不同单位的温度混合计算导致的错误；<strong>因此需要一个类似Celsius(t)或Fahrenheit(t)形式的显式转型操作才能将float64转为对应的类型</strong>。Celsius(t)和Fahrenheit(t)是类型转换操作，它们并不是函数调用。类型转换不会改变值本身，但是会使它们的语义发生变化。另一方面，CToF和FToC两个函数则是对不同温度单位下的温度进行换算，它们会返回不同的值。</p><p><strong>对于每一个类型T，都有一个对应的类型转换操作T(x)*</strong>，用于将x转为T类型（译注：如果T是指针类型，可能会需要用小括弧包装T，比如<code>(*int)(0)</code>）。<strong>只有当两个类型的底层基础类型相同时，才允许这种转型操作，或者是两者都是指向相同底层结构的指针类型，这些转换只改变类型而不会影响值本身</strong>。如果x是可以赋值给T类型的值，那么x必然也可以被转为T类型，但是一般没有这个必要。</p><p>数值类型之间的转型也是允许的，并且在字符串和一些特定类型的slice之间也是可以转换的，在下一章我们会看到这样的例子。这类转换可能改变值的表现。例如，将一个浮点数转为整数将丢弃小数部分，将一个字符串转为<code>[]byte</code>类型的slice将拷贝一个字符串数据的副本。在任何情况下，运行时不会发生转换失败的错误（译注: <strong>错误只会发生在编译阶段*</strong>）。</p><p>比较运算符<code>==</code>和<code>&lt;</code>也可以用来比较一个命名类型的变量和另一个有相同类型的变量，或有着相同底层类型的未命名类型的值之间做比较。但是如果两个值有着不同的类型，则不能直接进行比较：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var c Celsiusvar f Fahrenheitfmt.Println(c &#x3D;&#x3D; 0)          &#x2F;&#x2F; &quot;true&quot;fmt.Println(f &gt;&#x3D; 0)          &#x2F;&#x2F; &quot;true&quot;fmt.Println(c &#x3D;&#x3D; f)          &#x2F;&#x2F; compile error: type mismatchfmt.Println(c &#x3D;&#x3D; Celsius(f)) &#x2F;&#x2F; &quot;true&quot;!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>许多类型都会定义一个String方法，因为当使用fmt包的打印方法时，将会优先使用该类型对应的String方法返回的结果打印，我们将在7.1节讲述。</p><h2 id="2-6-包和文件"><a href="#2-6-包和文件" class="headerlink" title="2.6. 包和文件"></a>2.6. 包和文件</h2><p>Go语言中的包和其他语言的库或模块的概念类似，目的都是为了支持模块化、封装、单独编译和代码重用。一个包的源代码保存在一个或多个以.go为文件后缀名的源文件中，通常一个包所在目录路径的后缀是包的导入路径；</p><p>每个包都对应一个独立的名字空间。</p><p>包还可以让我们通过控制哪些名字是外部可见的来隐藏内部实现信息。在Go语言中，一个简单的规则是：如果一个名字是大写字母开头的，那么该名字是导出的（译注：因为汉字不区分大小写，因此汉字开头的名字是没有导出的）。</p><p>在每个源文件的包声明前紧跟着的注释是包注释（§10.7.4）。通常，包注释的第一句应该先是包的功能概要说明。一个包通常只有一个源文件有包注释（译注：如果有多个包注释，目前的文档工具会根据源文件名的先后顺序将它们链接为一个包注释）。如果包注释很大，通常会放到一个独立的doc.go文件中。</p><p>对于在包级别声明的变量，如果有初始化表达式则用表达式初始化，还有一些没有初始化表达式的，例如某些表格数据初始化并不是一个简单的赋值过程。在这种情况下，我们可以用一个特殊的init初始化函数来简化初始化工作。每个文件都可以包含多个init初始化函数</p><p>这样的init初始化函数除了不能被调用或引用外，其他行为和普通函数类似。在每个文件中的init初始化函数，在程序开始执行时按照它们声明的顺序被自动调用。每个包在解决依赖的前提下，以导入声明的顺序初始化，每个包只会被初始化一次。因此，如果一个p包导入了q包，那么在p包初始化的时候可以认为q包必然已经初始化过了。初始化工作是自下而上进行的，main包最后被初始化。以这种方式，可以确保在main函数执行之前，所有依赖的包都已经完成初始化工作了</p><h2 id="2-7-作用域"><a href="#2-7-作用域" class="headerlink" title="2.7 作用域"></a>2.7 作用域</h2><p>个人认为，只要代码不重名名就不用考虑这些问题</p><h1 id="第三章-基础数据类型"><a href="#第三章-基础数据类型" class="headerlink" title="第三章　基础数据类型"></a>第三章　基础数据类型</h1><p>虽然数据种类很多，但它们都是对程序中一个变量或状态的间接引用。这意味着对任一引用类型数据的修改都会影响所有该引用的拷贝。</p><h2 id="3-1-整型"><a href="#3-1-整型" class="headerlink" title="3.1 整型"></a>3.1 整型</h2><p>Go语言同时提供了有符号和无符号类型的整数运算。这里有int8、int16、int32和int64四种截然不同大小的有符号整数类型，分别对应8、16、32、64bit大小的有符号整数，与此对应的是uint8、uint16、uint32和uint64四种无符号整数类型。</p><p>这里还有两种一般对应特定CPU平台机器字大小的有符号和无符号整数int和uint；其中int是应用最广泛的数值类型</p><p>Unicode字符rune类型是和int32等价的类型，通常用于表示一个Unicode码点。这两个名称可以互换使用。同样byte也是uint8类型的等价类型，byte类型一般用于强调数值是一个原始的数据而不是一个小的整数。</p><p>还有一种无符号的整数类型uintptr，没有指定具体的bit大小但是足以容纳指针。uintptr类型只有在底层编程时才需要，特别是Go语言和C语言函数库或操作系统接口相交互的地方</p><p>不管它们的具体大小，int、uint和uintptr是不同类型的兄弟类型。其中int和int32也是不同的类型，即使int的大小也是32bit，在需要将int当作int32类型的地方需要一个显式的类型转换操作，反之亦然。</p><p>在Go语言中，%取模运算符的符号和被取模数的符号总是一致的，因此<code>-5%3</code>和<code>-5%-3</code>结果都是-2。除法运算符<code>/</code>的行为则依赖于操作数是否全为整数，比如<code>5.0/4.0</code>的结果是1.25，但是5/4的结果是1，因为整数除法会向着0方向截断余数。</p><p>对于每种类型T，如果转换允许的话，类型转换操作T(x)将x转换为T类型。许多整数之间的相互转换并不会改变数值；它们只是告诉编译器如何解释这个值。但是对于将一个大尺寸的整数类型转为一个小尺寸的整数类型，或者是将一个浮点数转为整数，可能会改变数值或丢失精度：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">f :&#x3D; 3.141 &#x2F;&#x2F; a float64i :&#x3D; int(f)fmt.Println(f, i) &#x2F;&#x2F; &quot;3.141 3&quot;f &#x3D; 1.99fmt.Println(int(f)) &#x2F;&#x2F; &quot;1&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-2-浮点数"><a href="#3-2-浮点数" class="headerlink" title="3.2 浮点数"></a>3.2 浮点数</h2><h2 id="3-3-复数"><a href="#3-3-复数" class="headerlink" title="3.3 复数"></a>3.3 复数</h2><h2 id="3-4-布尔型"><a href="#3-4-布尔型" class="headerlink" title="3.4 布尔型"></a>3.4 布尔型</h2><h2 id="3-5-字符串"><a href="#3-5-字符串" class="headerlink" title="3.5 字符串"></a>3.5 字符串</h2><p>一个字符串是一个不可改变的字节序列。</p><p>不变性意味着如果两个字符串共享相同的底层数据的话也是安全的，这使得复制任何长度的字符串代价是低廉的。</p><h3 id="3-5-1-字符串面值"><a href="#3-5-1-字符串面值" class="headerlink" title="3.5.1. 字符串面值"></a>3.5.1. 字符串面值</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">const GoUsage &#x3D; &#96;Go is a tool for managing Go source code.Usage:    go command [arguments]...&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-2-Unicode"><a href="#3-5-2-Unicode" class="headerlink" title="3.5.2 Unicode"></a>3.5.2 Unicode</h3><p>通用的表示一个Unicode码点的数据类型是int32，也就是Go语言中rune对应的类型；它的同义词rune符文正是这个意思。 </p><h2 id="3-5-字符串-1"><a href="#3-5-字符串-1" class="headerlink" title="3.5. 字符串"></a>3.5. 字符串</h2><p>一个字符串是一个不可改变的字节序列。字符串可以包含任意的数据，包括byte值0，但是通常是用来包含人类可读的文本。文本字符串通常被解释为采用UTF8编码的Unicode码点（rune）序列，我们稍后会详细讨论这个问题。</p><p>内置的len函数可以返回一个字符串中的字节数目（不是rune字符数目），索引操作s[i]返回第i个字节的字节值，i必须满足0 ≤ i&lt; len(s)条件约束。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s :&#x3D; &quot;hello, world&quot;fmt.Println(len(s))     &#x2F;&#x2F; &quot;12&quot;fmt.Println(s[0], s[7]) &#x2F;&#x2F; &quot;104 119&quot; (&#39;h&#39; and &#39;w&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果试图访问超出字符串索引范围的字节将会导致panic异常：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">c :&#x3D; s[len(s)] &#x2F;&#x2F; panic: index out of range<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第i个字节并不一定是字符串的第i个字符，因为对于非ASCII字符的UTF8编码会要两个或多个字节。我们先简单说下字符的工作方式。</p><p>子字符串操作s[i:j]基于原始的s字符串的第i个字节开始到第j个字节（并不包含j本身）生成一个新字符串。生成的新字符串将包含j-i个字节。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(s[0:5]) &#x2F;&#x2F; &quot;hello&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样，如果索引超出字符串范围或者j小于i的话将导致panic异常。</p><p>不管i还是j都可能被忽略，当它们被忽略时将采用0作为开始位置，采用len(s)作为结束的位置。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(s[:5]) &#x2F;&#x2F; &quot;hello&quot;fmt.Println(s[7:]) &#x2F;&#x2F; &quot;world&quot;fmt.Println(s[:])  &#x2F;&#x2F; &quot;hello, world&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中+操作符将两个字符串连接构造一个新字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(&quot;goodbye&quot; + s[5:]) &#x2F;&#x2F; &quot;goodbye, world&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>字符串可以用==和&lt;进行比较；比较通过逐个字节比较完成的，因此比较的结果是字符串自然编码的顺序。</p><p>字符串的值是不可变的：一个字符串包含的字节序列永远不会被改变，当然我们也可以给一个字符串变量分配一个新字符串值。可以像下面这样将一个字符串追加到另一个字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s :&#x3D; &quot;left foot&quot;t :&#x3D; ss +&#x3D; &quot;, right foot&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这并不会导致原始的字符串值被改变，但是变量s将因为+=语句持有一个新的字符串值，但是t依然是包含原先的字符串值。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(s) &#x2F;&#x2F; &quot;left foot, right foot&quot;fmt.Println(t) &#x2F;&#x2F; &quot;left foot&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>因为字符串是不可修改的，因此尝试修改字符串内部数据的操作也是被禁止的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s[0] &#x3D; &#39;L&#39; &#x2F;&#x2F; compile error: cannot assign to s[0]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不变性意味着如果两个字符串共享相同的底层数据的话也是安全的，这使得复制任何长度的字符串代价是低廉的。同样，一个字符串s和对应的子字符串切片s[7:]的操作也可以安全地共享相同的内存，因此字符串切片操作代价也是低廉的。在这两种情况下都没有必要分配新的内存。 图3.4演示了一个字符串和两个子串共享相同的底层数据。</p><h3 id="3-5-1-字符串面值-1"><a href="#3-5-1-字符串面值-1" class="headerlink" title="3.5.1. 字符串面值"></a>3.5.1. 字符串面值</h3><p>字符串值也可以用字符串面值方式编写，只要将一系列字节序列包含在双引号内即可：</p><pre class="line-numbers language-none"><code class="language-none">&quot;Hello, 世界&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://docs.hacknode.org/gopl-zh/images/ch3-04.png" alt="img"></p><p>因为Go语言源文件总是用UTF8编码，并且Go语言的文本字符串也以UTF8编码的方式处理，因此我们可以将Unicode码点也写到字符串面值中。</p><p>在一个双引号包含的字符串面值中，可以用以反斜杠<code>\</code>开头的转义序列插入任意的数据。下面的换行、回车和制表符等是常见的ASCII控制代码的转义方式：</p><pre class="line-numbers language-none"><code class="language-none">\a      响铃\b      退格\f      换页\n      换行\r      回车\t      制表符\v      垂直制表符\&#39;      单引号 (只用在 &#39;\&#39;&#39; 形式的rune符号面值中)\&quot;      双引号 (只用在 &quot;...&quot; 形式的字符串面值中)\\      反斜杠<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以通过十六进制或八进制转义在字符串面值中包含任意的字节。一个十六进制的转义形式是<code>\xhh</code>，其中两个h表示十六进制数字（大写或小写都可以）。一个八进制转义形式是<code>\ooo</code>，包含三个八进制的o数字（0到7），但是不能超过<code>\377</code>（译注：对应一个字节的范围，十进制为255）。每一个单一的字节表达一个特定的值。稍后我们将看到如何将一个Unicode码点写到字符串面值中。</p><p>一个原生的字符串面值形式是<code>...</code>，使用反引号代替双引号。在原生的字符串面值中，没有转义操作；全部的内容都是字面的意思，包含退格和换行，因此一个程序中的原生字符串面值可能跨越多行（译注：在原生字符串面值内部是无法直接写<code>字符的，可以用八进制或十六进制转义或+&quot;</code>“连接字符串常量完成）。唯一的特殊处理是会删除回车以保证在所有平台上的值都是一样的，包括那些把回车也放入文本文件的系统（译注：Windows系统会把回车和换行一起放入文本文件中）。</p><p>原生字符串面值用于编写正则表达式会很方便，因为正则表达式往往会包含很多反斜杠。原生字符串面值同时被广泛应用于HTML模板、JSON面值、命令行提示信息以及那些需要扩展到多行的场景。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">const GoUsage &#x3D; &#96;Go is a tool for managing Go source code.Usage:    go command [arguments]...&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-2-Unicode-1"><a href="#3-5-2-Unicode-1" class="headerlink" title="3.5.2. Unicode"></a>3.5.2. Unicode</h3><p>在很久以前，世界还是比较简单的，起码计算机世界就只有一个ASCII字符集：美国信息交换标准代码。ASCII，更准确地说是美国的ASCII，使用7bit来表示128个字符：包含英文字母的大小写、数字、各种标点符号和设备控制符。对于早期的计算机程序来说，这些就足够了，但是这也导致了世界上很多其他地区的用户无法直接使用自己的符号系统。随着互联网的发展，混合多种语言的数据变得很常见（译注：比如本身的英文原文或中文翻译都包含了ASCII、中文、日文等多种语言字符）。如何有效处理这些包含了各种语言的丰富多样的文本数据呢？</p><p>答案就是使用Unicode（ <a href="http://unicode.org/">http://unicode.org</a> ），它收集了这个世界上所有的符号系统，包括重音符号和其它变音符号，制表符和回车符，还有很多神秘的符号，每个符号都分配一个唯一的Unicode码点，Unicode码点对应Go语言中的rune整数类型（译注：rune是int32等价类型）。</p><p>在第八版本的Unicode标准里收集了超过120,000个字符，涵盖超过100多种语言。这些在计算机程序和数据中是如何体现的呢？通用的表示一个Unicode码点的数据类型是int32，也就是Go语言中rune对应的类型；它的同义词rune符文正是这个意思。</p><p>我们可以将一个符文序列表示为一个int32序列。这种编码方式叫UTF-32或UCS-4，每个Unicode码点都使用同样大小的32bit来表示。这种方式比较简单统一，但是它会浪费很多存储空间，因为大多数计算机可读的文本是ASCII字符，本来每个ASCII字符只需要8bit或1字节就能表示。而且即使是常用的字符也远少于65,536个，也就是说用16bit编码方式就能表达常用字符。但是，还有其它更好的编码方法吗？</p><h3 id="3-5-3-UTF-8"><a href="#3-5-3-UTF-8" class="headerlink" title="3.5.3. UTF-8"></a>3.5.3. UTF-8</h3><p>UTF8是一个将Unicode码点编码为字节序列的变长编码。UTF8编码是由Go语言之父Ken Thompson和Rob Pike共同发明的，，现在已经是Unicode的标准。</p><p>FIXME：这部分讲了一些UTF-8的相关知识，但是我没记。</p><h3 id="3-5-4-字符串和Byte切片"><a href="#3-5-4-字符串和Byte切片" class="headerlink" title="3.5.4 字符串和Byte切片"></a>3.5.4 字符串和Byte切片</h3><p>strconv包提供了布尔型、整型数、浮点数和对应字符串的相互转换，还提供了双引号转义相关的转换。</p><p>因为字符串是只读的，因此逐步构建字符串会导致很多分配和复制。在这种情况下，使用bytes.Buffer类型将会更有效</p><p>unicode包提供了IsDigit、IsLetter、IsUpper和IsLower等类似功能，它们用于给字符分类。每个函数有一个单一的rune类型的参数，然后返回一个布尔值。而像ToUpper和ToLower之类的转换函数将用于rune字符的大小写转换。所有的这些函数都是遵循Unicode标准定义的字母、数字等分类规范。strings包也有类似的函数，它们是ToUpper和ToLower，将原始字符串的每个字符都做相应的转换，然后返回新的字符串。</p><h3 id="3-5-5-字符串和数字的转换"><a href="#3-5-5-字符串和数字的转换" class="headerlink" title="3.5.5. 字符串和数字的转换"></a>3.5.5. 字符串和数字的转换</h3><p>将一个整数转为字符串，一种方法是用fmt.Sprintf返回一个格式化的字符串；另一个方法是用strconv.Itoa(“整数到ASCII”)：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">x :&#x3D; 123y :&#x3D; fmt.Sprintf(&quot;%d&quot;, x)fmt.Println(y, strconv.Itoa(x)) &#x2F;&#x2F; &quot;123 123&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>FormatInt和FormatUint函数可以用不同的进制来格式化数字：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Println(strconv.FormatInt(int64(x), 2)) &#x2F;&#x2F; &quot;1111011&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果要将一个字符串解析为整数，可以使用strconv包的Atoi或ParseInt函数，还有用于解析无符号整数的ParseUint函数：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">x, err :&#x3D; strconv.Atoi(&quot;123&quot;)             &#x2F;&#x2F; x is an inty, err :&#x3D; strconv.ParseInt(&quot;123&quot;, 10, 64) &#x2F;&#x2F; base 10, up to 64 bits<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ParseInt函数的第三个参数是用于指定整型数的大小；例如16表示int16，0则表示int。在任何情况下，返回的结果y总是int64类型，你可以通过强制类型转换将它转为更小的整数类型。</p><p>有时候也会使用fmt.Scanf来解析输入的字符串和数字，特别是当字符串和数字混合在一行的时候，它可以灵活处理不完整或不规则的输入。</p><h2 id="3-6-常量"><a href="#3-6-常量" class="headerlink" title="3.6 常量"></a>3.6 常量</h2><p>所有常量的运算都可以在编译期完成，这样可以减少运行时的工作，也方便其他编译优化。</p><p>常量间的所有算术运算、逻辑运算和比较运算的结果也是常量</p><p>如果是批量声明的常量，除了第一个外其它的常量右边的初始化表达式都可以省略，如果省略初始化表达式则表示使用前面常量的初始化表达式写法，对应的常量类型也一样的。例如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">const (    a &#x3D; 1    b    c &#x3D; 2    d)fmt.Println(a, b, c, d) &#x2F;&#x2F; &quot;1 1 2 2&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果只是简单地复制右边的常量表达式，其实并没有太实用的价值。但是它可以带来其它的特性，那就是iota常量生成器语法。</p><h3 id="3-6-1-iota-常量生成器"><a href="#3-6-1-iota-常量生成器" class="headerlink" title="3.6.1 iota 常量生成器"></a>3.6.1 iota 常量生成器</h3><p>常量声明可以使用iota常量生成器初始化，它用于生成一组以相似规则初始化的常量，但是不用每行都写一遍初始化表达式。在一个const声明语句中，在第一个声明的常量所在的行，iota将会被置为0，然后在每一个有常量声明的行加一。</p><p>下面是来自time包的例子，它首先定义了一个Weekday命名类型，然后为一周的每天定义了一个常量，从周日0开始。在其它编程语言中，这种类型一般被称为枚举类型。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Weekday intconst (    Sunday Weekday &#x3D; iota    Monday    Tuesday    Wednesday    Thursday    Friday    Saturday)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>周日将对应0，周一为1，如此等等。</p><p>我们也可以在复杂的常量表达式中使用iota，下面是来自net包的例子，用于给一个无符号整数的最低5bit的每个bit指定一个名字：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Flags uintconst (    FlagUp Flags &#x3D; 1 &lt;&lt; iota &#x2F;&#x2F; is up    FlagBroadcast            &#x2F;&#x2F; supports broadcast access capability    FlagLoopback             &#x2F;&#x2F; is a loopback interface    FlagPointToPoint         &#x2F;&#x2F; belongs to a point-to-point link    FlagMulticast            &#x2F;&#x2F; supports multicast access capability)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>随着iota的递增，每个常量对应表达式1 &lt;&lt; iota，是连续的2的幂，分别对应一个bit位置。使用这些常量可以用于测试、设置或清除对应的bit位的值 </p><p><em>Go语言并没有计算幂的运算符。</em></p><h3 id="3-6-2-无类型常量"><a href="#3-6-2-无类型常量" class="headerlink" title="3.6.2. 无类型常量"></a>3.6.2. 无类型常量</h3><p>另一个例子，math.Pi无类型的浮点数常量，可以直接用于任意需要浮点数或复数的地方：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var x float32 &#x3D; math.Pivar y float64 &#x3D; math.Pivar z complex128 &#x3D; math.Pi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果math.Pi被确定为特定类型，比如float64，那么结果精度可能会不一样，同时对于需要float32或complex128类型值的地方则会强制需要一个明确的类型转换 </p><p>对于常量面值，不同的写法可能会对应不同的类型。例如0、0.0、0i和<code>\u0000</code>虽然有着相同的常量值，但是它们分别对应无类型的整数、无类型的浮点数、无类型的复数和无类型的字符等不同的常量类型。同样，true和false也是无类型的布尔类型，字符串面值常量是无类型的字符串类型。</p><p>只有常量可以是无类型的。当一个无类型的常量被赋值给一个变量的时候，就像下面的第一行语句，或者出现在有明确类型的变量声明的右边，如下面的其余三行语句，无类型的常量将会被隐式转换为对应的类型，如果转换合法的话。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var f float64 &#x3D; 3 + 0i &#x2F;&#x2F; untyped complex -&gt; float64f &#x3D; 2                  &#x2F;&#x2F; untyped integer -&gt; float64f &#x3D; 1e123              &#x2F;&#x2F; untyped floating-point -&gt; float64f &#x3D; &#39;a&#39;                &#x2F;&#x2F; untyped rune -&gt; float64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的语句相当于:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var f float64 &#x3D; float64(3 + 0i)f &#x3D; float64(2)f &#x3D; float64(1e123)f &#x3D; float64(&#39;a&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>对于一个没有显式类型的变量声明（包括简短变量声明），常量的形式将隐式决定变量的默认类型，就像下面的例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">i :&#x3D; 0      &#x2F;&#x2F; untyped integer;        implicit int(0)r :&#x3D; &#39;\000&#39; &#x2F;&#x2F; untyped rune;           implicit rune(&#39;\000&#39;)f :&#x3D; 0.0    &#x2F;&#x2F; untyped floating-point; implicit float64(0.0)c :&#x3D; 0i     &#x2F;&#x2F; untyped complex;        implicit complex128(0i)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>注意有一点不同：无类型整数常量转换为int，它的内存大小是不确定的，但是无类型浮点数和复数常量则转换为内存大小明确的float64和complex128。 如果不知道浮点数类型的内存大小是很难写出正确的数值算法的，因此Go语言不存在整型类似的不确定内存大小的浮点数和复数类型。</p><h1 id="第四章-复合数据类型"><a href="#第四章-复合数据类型" class="headerlink" title="第四章　复合数据类型"></a>第四章　复合数据类型</h1><p>数组和结构体是聚合类型；它们的值由许多元素或成员字段的值组成。数组是由同构的元素组成——每个数组元素都是完全相同的类型——结构体则是由异构的元素组成的。数组和结构体都是有固定内存大小的数据结构。相比之下，slice和map则是动态的数据结构，它们将根据需要动态增长。</p><h2 id="4-1-数组"><a href="#4-1-数组" class="headerlink" title="4.1. 数组"></a>4.1. 数组</h2><p>因为数组的长度是固定的，因此在Go语言中很少直接使用数组。和数组对应的类型是Slice（切片），它是可以增长和收缩的动态序列</p><p>在数组字面值中，如果在数组的长度位置出现的是“…”省略号，则表示数组的长度是根据初始化值的个数来计算。因此，上面q数组的定义可以简化为</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">q :&#x3D; [...]int&#123;1, 2, 3&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当调用一个函数的时候，函数的每个调用参数将会被赋值给函数内部的参数变量，所以函数参数变量接收的是一个复制的副本，并不是原始调用的变量。因为函数参数传递的机制导致传递大的数组类型将是低效的，并且对数组参数的任何的修改都是发生在复制的数组上，并不能直接修改调用时原始的数组变量。在这个方面，Go语言对待数组的方式和其它很多编程语言不同，其它编程语言可能会隐式地将数组作为引用或指针对象传入被调用的函数。</p><p>虽然通过指针来传递数组参数是高效的，而且也允许在函数内部修改数组的值，但是数组依然是僵化的类型，因为数组的类型包含了僵化的长度信息。</p><h2 id="4-2-Slice"><a href="#4-2-Slice" class="headerlink" title="4.2 Slice"></a>4.2 Slice</h2><p>一个slice是一个轻量级的数据结构，提供了访问数组子序列（或者全部）元素的功能，而且slice的底层确实引用一个数组对象。一个slice由三个部分构成：指针、长度和容量。指针指向第一个slice元素对应的底层数组元素的地址，要注意的是slice的第一个元素并不一定就是数组的第一个元素。长度对应slice中元素的数目；长度不能超过容量，容量一般是从slice的开始位置到底层数据的结尾位置。内置的len和cap函数分别返回slice的长度和容量。</p><p><img src="https://docs.hacknode.org/gopl-zh/images/ch4-01.png" alt="img"></p><p>如果切片操作超出cap(s)的上限将导致一个panic异常，但是超出len(s)则是意味着扩展了slice，因为新slice的长度会变大：</p><p>因为slice值包含指向第一个slice元素的指针，因此向函数传递slice将允许在函数内部修改底层数组的元素。换句话说，复制一个slice只是对底层的数组创建了一个新的slice别名（§2.3.2）。</p><p>要注意的是slice类型的变量s和数组类型的变量a的初始化语法的差异。slice和数组的字面值语法很类似，它们都是用花括弧包含一系列的初始化元素，但是对于slice并没有指明序列的长度。这会隐式地创建一个合适大小的数组，然后slice的指针指向底层的数组。就像数组字面值一样，slice的字面值也可以按顺序指定初始化值序列，或者是通过索引和元素值指定，或者用两种风格的混合语法初始化。</p><p>为何slice不直接支持比较运算符呢？这方面有两个原因。第一个原因，一个slice的元素是间接引用的，一个slice甚至可以包含自身。虽然有很多办法处理这种情形，但是没有一个是简单有效的。</p><p>第二个原因，因为slice的元素是间接引用的，一个固定的slice值(译注：指slice本身的值，不是元素的值)在不同的时刻可能包含不同的元素，因为底层数组的元素可能会被修改。而例如Go语言中map的key只做简单的浅拷贝，它要求key在整个生命周期内保持不变性(译注：例如slice扩容，就会导致其本身的值/地址变化)。而用深度相等判断的话，显然在map的key这种场合不合适。对于像指针或chan之类的引用类型，== 相等测试可以判断两个是否是引用相同的对象。一个针对slice的浅相等测试的==操作符可能是有一定用处的，也能临时解决map类型的key问题，但是slice和数组不同的相等测试行为会让人困惑。因此，安全的做法是直接禁止slice之间的比较操作。</p><p>slice唯一合法的比较操作是和nil比较，例如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if summer &#x3D;&#x3D; nil &#123; &#x2F;* ... *&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个零值的slice等于nil。一个nil值的slice并没有底层数组。一个nil值的slice的长度和容量都是0，但是也有非nil值的slice的长度和容量也是0的，例如[]int{}或make([]int, 3)[3:]。与任意类型的nil值一样，我们可以用[]int(nil)类型转换表达式来生成一个对应类型slice的nil值。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var s []int    &#x2F;&#x2F; len(s) &#x3D;&#x3D; 0, s &#x3D;&#x3D; nils &#x3D; nil        &#x2F;&#x2F; len(s) &#x3D;&#x3D; 0, s &#x3D;&#x3D; nils &#x3D; []int(nil) &#x2F;&#x2F; len(s) &#x3D;&#x3D; 0, s &#x3D;&#x3D; nils &#x3D; []int&#123;&#125;    &#x2F;&#x2F; len(s) &#x3D;&#x3D; 0, s !&#x3D; nil<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果你需要测试一个slice是否是空的，使用len(s) == 0来判断，而不应该用s == nil来判断。除了和nil相等比较外，一个nil值的slice的行为和其它任意0长度的slice一样；例如reverse(nil)也是安全的。</p><p>内置的make函数创建一个指定元素类型、长度和容量的slice。容量部分可以省略，在这种情况下，容量将等于长度。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">make([]T, len)make([]T, len, cap) &#x2F;&#x2F; same as make([]T, cap)[:len]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在底层，make创建了一个匿名的数组变量，然后返回一个slice；只有通过返回的slice才能引用底层匿名的数组变量。</p><h3 id="4-2-1-append函数"><a href="#4-2-1-append函数" class="headerlink" title="4.2.1. append函数"></a>4.2.1. append函数</h3><p>内置的append函数用于向slice追加元素：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var runes []runefor _, r :&#x3D; range &quot;Hello, 世界&quot; &#123;    runes &#x3D; append(runes, r)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>正确地使用slice，需要记住尽管底层数组的元素是间接访问的，但是slice对应结构体本身的指针、长度和容量部分是直接访问的。</p><p>slice并不是一个纯粹的引用类型，它实际上是一个类似下面结构体的聚合类型：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type IntSlice struct &#123;    ptr      *int    len, cap int&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-3-Map"><a href="#4-3-Map" class="headerlink" title="4.3. Map"></a>4.3. Map</h2><p>它是一个无序的key/value对的集合，其中所有的key都是不同的，然后通过给定的key可以在常数时间复杂度内检索、更新或删除对应的value。</p><p>其中K对应的key必须是支持==比较运算符的数据类型，所以map可以通过测试key是否相等来判断是否已经存在。虽然浮点数类型也是支持相等运算符比较的，但是将浮点数用做key类型则是一个坏的想法</p><p>如果一个查找失败将返回value类型对应的零值，例如，即使map中不存在“bob”下面的代码也可以正常工作，因为ages[“bob”]失败时将返回0。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ages[&quot;bob&quot;] &#x3D; ages[&quot;bob&quot;] + 1 &#x2F;&#x2F; happy birthday!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是map中的元素并不是一个变量，因此我们不能对map的元素进行取址操作：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">_ &#x3D; &amp;ages[&quot;bob&quot;] &#x2F;&#x2F; compile error: cannot take address of map element<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>禁止对map元素取址的原因是map可能随着元素数量的增长而重新分配更大的内存空间，从而可能导致之前的地址无效。</p><p>Map的迭代顺序是不确定的，并且不同的哈希函数实现可能导致不同的遍历顺序。在实践中，遍历的顺序是随机的，每一次遍历的顺序都不相同。这是故意的，每次都使用随机的遍历顺序可以强制要求程序不会依赖具体的哈希函数实现。如果要按顺序遍历key/value对，我们必须显式地对key进行排序，可以使用sort包的Strings函数对字符串slice进行排序。下面是常见的处理方式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;sort&quot;var names []stringfor name :&#x3D; range ages &#123;    names &#x3D; append(names, name)&#125;sort.Strings(names)for _, name :&#x3D; range names &#123;    fmt.Printf(&quot;%s\t%d\n&quot;, name, ages[name])&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>map类型的零值是nil，也就是没有引用任何哈希表。map上的大部分操作，包括查找、删除、len和range循环都可以安全工作在nil值的map上，它们的行为和一个空的map类似。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var ages map[string]intfmt.Println(ages &#x3D;&#x3D; nil)    &#x2F;&#x2F; &quot;true&quot;fmt.Println(len(ages) &#x3D;&#x3D; 0) &#x2F;&#x2F; &quot;true&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>但是向一个nil值的map存入元素将导致一个panic异常：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ages[&quot;carol&quot;] &#x3D; 21 &#x2F;&#x2F; panic: assignment to entry in nil map<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在向map存数据前必须先创建map。</p><p>有时候可能需要知道对应的元素是否真的是在map之中。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">age, ok :&#x3D; ages[&quot;bob&quot;]if !ok &#123;     &#x2F;* &quot;bob&quot; is not a key in this map; age &#x3D;&#x3D; 0. *&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>你会经常看到将这两个结合起来使用，像这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if age, ok :&#x3D; ages[&quot;bob&quot;]; !ok &#123; &#x2F;* ... *&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Map的value类型也可以是一个聚合类型，比如是一个map或slice。在下面的代码中，图graph的key类型是一个字符串，value类型map[string]bool代表一个字符串集合。从概念上讲，graph将一个字符串类型的key映射到一组相关的字符串集合，它们指向新的graph的key。</p><p><em>gopl.io/ch4/graph</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var graph &#x3D; make(map[string]map[string]bool)func addEdge(from, to string) &#123;    edges :&#x3D; graph[from]    if edges &#x3D;&#x3D; nil &#123;        edges &#x3D; make(map[string]bool)        graph[from] &#x3D; edges    &#125;    edges[to] &#x3D; true&#125;func hasEdge(from, to string) bool &#123;    return graph[from][to]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中addEdge函数惰性初始化map是一个惯用方式，也就是说在每个值首次作为key时才初始化。addEdge函数显示了如何让map的零值也能正常工作；即使from到to的边不存在，graph[from][to]依然可以返回一个有意义的结果。</p><h2 id="4-4-结构体"><a href="#4-4-结构体" class="headerlink" title="4.4 结构体"></a>4.4 结构体</h2><p>如果结构体成员名字是以大写字母开头的，那么该成员就是导出的；这是Go语言导出规则决定的。一个结构体可能同时包含导出和未导出的成员。</p><p>一个命名为S的结构体类型将不能再包含S类型的成员：因为一个聚合的值不能包含它自身。（该限制同样适用于数组。）</p><p>但是S类型的结构体可以包含<code>*S</code>指针类型的成员，这可以让我们创建递归的数据结构，比如链表和树结构等。</p><p>如果结构体没有任何成员的话就是空结构体，写作struct{}。它的大小为0，也不包含任何信息，但是有时候依然是有价值的。有些Go语言程序员用map来模拟set数据结构时，用它来代替map中布尔类型的value，只是强调key的重要性，但是因为节约的空间有限，而且语法比较复杂，所以我们通常会避免这样的用法。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">seen :&#x3D; make(map[string]struct&#123;&#125;) &#x2F;&#x2F; set of strings&#x2F;&#x2F; ...if _, ok :&#x3D; seen[s]; !ok &#123;    seen[s] &#x3D; struct&#123;&#125;&#123;&#125;    &#x2F;&#x2F; ...first time seeing s...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-4-1-结构体字面值"><a href="#4-4-1-结构体字面值" class="headerlink" title="4.4.1. 结构体字面值"></a>4.4.1. 结构体字面值</h3><p>如果考虑效率的话，较大的结构体通常会用指针的方式传入和返回，</p><p>如果要在函数内部修改结构体成员的话，用指针传入是必须的；因为在Go语言中，所有的函数参数都是值拷贝传入的，函数参数将不再是函数调用时的原始变量。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">pp :&#x3D; &amp;Point&#123;1, 2&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>它和下面的语句是等价的</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">pp :&#x3D; new(Point)*pp &#x3D; Point&#123;1, 2&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>不过&amp;Point{1, 2}写法可以直接在表达式中使用，比如一个函数调用。</p><h3 id="4-4-2-结构体比较"><a href="#4-4-2-结构体比较" class="headerlink" title="4.4.2. 结构体比较"></a>4.4.2. 结构体比较</h3><p>如果结构体的全部成员都是可以比较的，那么结构体也是可以比较的，那样的话两个结构体将可以使用==或!=运算符进行比较。</p><p>等比较运算符==将比较两个结构体的每个成员，因此下面两个比较的表达式是等价的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Point struct&#123; X, Y int &#125;p :&#x3D; Point&#123;1, 2&#125;q :&#x3D; Point&#123;2, 1&#125;fmt.Println(p.X &#x3D;&#x3D; q.X &amp;&amp; p.Y &#x3D;&#x3D; q.Y) &#x2F;&#x2F; &quot;false&quot;fmt.Println(p &#x3D;&#x3D; q)                   &#x2F;&#x2F; &quot;false&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-4-3-结构体嵌入和匿名成员"><a href="#4-4-3-结构体嵌入和匿名成员" class="headerlink" title="4.4.3. 结构体嵌入和匿名成员"></a>4.4.3. 结构体嵌入和匿名成员</h3><p>Go语言有一个特性让我们只声明一个成员对应的数据类型而不指名成员的名字；这类成员就叫匿名成员。匿名成员的数据类型必须是命名的类型或指向一个命名的类型的指针。下面的代码中，Circle和Wheel各自都有一个匿名成员。我们可以说Point类型被嵌入到了Circle结构体，同时Circle类型被嵌入到了Wheel结构体。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type Circle struct &#123;    Point    Radius int&#125;type Wheel struct &#123;    Circle    Spokes int&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>得益于匿名嵌入的特性，我们可以直接访问叶子属性而不需要给出完整的路径：</strong></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w Wheelw.X &#x3D; 8            &#x2F;&#x2F; equivalent to w.Circle.Point.X &#x3D; 8w.Y &#x3D; 8            &#x2F;&#x2F; equivalent to w.Circle.Point.Y &#x3D; 8w.Radius &#x3D; 5       &#x2F;&#x2F; equivalent to w.Circle.Radius &#x3D; 5w.Spokes &#x3D; 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不幸的是，结构体字面值并没有简短表示匿名成员的语法， 因此下面的语句都不能编译通过：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">w &#x3D; Wheel&#123;8, 8, 5, 20&#125;                       &#x2F;&#x2F; compile error: unknown fieldsw &#x3D; Wheel&#123;X: 8, Y: 8, Radius: 5, Spokes: 20&#125; &#x2F;&#x2F; compile error: unknown fields<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>结构体字面值必须遵循形状类型声明时的结构，所以我们只能用下面的两种语法，它们彼此是等价的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt.Printf(&quot;%#v\n&quot;, w)&#x2F;&#x2F; Output:&#x2F;&#x2F; Wheel&#123;Circle:Circle&#123;Point:Point&#123;X:42, Y:8&#125;, Radius:5&#125;, Spokes:20&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>需要注意的是Printf函数中%v参数包含的#副词，它表示用和Go语言类似的语法打印值。对于结构体类型来说，将包含每个成员的名字。</strong></p><h2 id="4-5-JSON"><a href="#4-5-JSON" class="headerlink" title="4.5. JSON"></a>4.5. JSON</h2><p>JavaScript对象表示法（JSON）是一种用于发送和接收结构化信息的标准协议。</p><p>Go语言对于这些标准格式的编码和解码都有良好的支持，由标准库中的encoding/json、encoding/xml、encoding/asn1等包提供支持（译注：Protocol Buffers的支持由 github.com/golang/protobuf 包提供）</p><p>基本的JSON类型有数字（十进制或科学记数法）、布尔值（true或false）、字符串，其中字符串是以双引号包含的Unicode字符序列，支持和Go语言类似的反斜杠转义特性，不过JSON使用的是<code>\Uhhhh</code>转义数字来表示一个UTF-16编码（译注：UTF-16和UTF-8一样是一种变长的编码，有些Unicode码点较大的字符需要用4个字节表示；而且UTF-16还有大端和小端的问题），而不是Go语言的rune类型。</p><p>在编码时，默认使用Go语言结构体的成员名字作为JSON的对象（通过reflect反射技术，我们将在12.6节讨论）。只有导出的结构体成员才会被编码，这也就是我们为什么选择用大写字母开头的成员名称。</p><p>其中Year名字的成员在编码后变成了released，还有Color成员编码后变成了小写字母开头的color。这是因为结构体成员Tag所导致的。一个结构体成员Tag是和在编译阶段关联到该成员的元信息字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">Year  int  &#96;json:&quot;released&quot;&#96;Color bool &#96;json:&quot;color,omitempty&quot;&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>因此成员Tag一般用原生字符串面值的形式书写。json开头键名对应的值用于控制encoding/json包的编码和解码的行为，并且encoding/…下面其它的包也遵循这个约定。成员Tag中json对应值的第一部分用于指定JSON对象的名字，比如将Go语言中的TotalCount成员对应到JSON中的total_count对象。Color成员的Tag还带了一个额外的omitempty选项，表示当Go语言结构体成员为空或零值时不生成该JSON对象（这里false为零值）。</p><h2 id="4-6-文本和HTML模板"><a href="#4-6-文本和HTML模板" class="headerlink" title="4.6. 文本和HTML模板"></a>4.6. 文本和HTML模板</h2><p>前面的例子，只是最简单的格式化，使用Printf是完全足够的。但是有时候会需要复杂的打印格式，这时候一般需要将格式化代码分离出来以便更安全地修改。这些功能是由text/template和html/template等模板包提供的，它们提供了一个将变量值填充到一个文本或HTML格式的模板的机制。</p><p>一个模板是一个字符串或一个文件，里面包含了一个或多个由双花括号包含的<code>&#123;&#123;action&#125;&#125;</code>对象。大部分的字符串只是按字面值打印，但是对于actions部分将触发其它的行为。每个actions都包含了一个用模板语言书写的表达式，一个action虽然简短但是可以输出复杂的打印值，模板语言包含通过选择结构体的成员、调用函数或方法、表达式控制流if-else语句和range循环语句，还有其它实例化模板等诸多特性。下面是一个简单的模板字符串：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">const templ &#x3D; &#96;&#123;&#123;.TotalCount&#125;&#125; issues:&#123;&#123;range .Items&#125;&#125;----------------------------------------Number: &#123;&#123;.Number&#125;&#125;User:   &#123;&#123;.User.Login&#125;&#125;Title:  &#123;&#123;.Title | printf &quot;%.64s&quot;&#125;&#125;Age:    &#123;&#123;.CreatedAt | daysAgo&#125;&#125; days&#123;&#123;end&#125;&#125;&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个模板先打印匹配到的issue总数，然后打印每个issue的编号、创建用户、标题还有存在的时间。对于每一个action，都有一个当前值的概念，对应点操作符，写作“.”。当前值“.”最初被初始化为调用模板时的参数，在当前例子中对应github.IssuesSearchResult类型的变量。模板中<code>&#123;&#123;.TotalCount&#125;&#125;</code>对应action将展开为结构体中TotalCount成员以默认的方式打印的值。模板中<code>&#123;&#123;range .Items&#125;&#125;</code>和<code>&#123;&#123;end&#125;&#125;</code>对应一个循环action，因此它们直接的内容可能会被展开多次，循环每次迭代的当前值对应当前的Items元素的值。</p><p>在一个action中，<code>|</code>操作符表示将前一个表达式的结果作为后一个函数的输入，类似于UNIX中管道的概念。在Title这一行的action中，第二个操作是一个printf函数，是一个基于fmt.Sprintf实现的内置函数，所有模板都可以直接使用。对于Age部分，第二个动作是一个叫daysAgo的函数，通过time.Since函数将CreatedAt成员转换为过去的时间长度：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func daysAgo(t time.Time) int &#123;    return int(time.Since(t).Hours() &#x2F; 24)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>这部分的模板特性是其他语言里没有的</strong></p><h1 id="第五章-函数"><a href="#第五章-函数" class="headerlink" title="第五章　函数"></a>第五章　函数</h1><h2 id="5-1-函数声明"><a href="#5-1-函数声明" class="headerlink" title="5.1. 函数声明"></a>5.1. 函数声明</h2><p>我们给出4种方法声明拥有2个int型参数和1个int型返回值的函数.blank identifier(译者注：即下文的_符号)可以强调某个参数未被使用。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func add(x int, y int) int   &#123;return x + y&#125;func sub(x, y int) (z int)   &#123; z &#x3D; x - y; return&#125;func first(x int, _ int) int &#123; return x &#125;func zero(int, int) int      &#123; return 0 &#125;fmt.Printf(&quot;%T\n&quot;, add)   &#x2F;&#x2F; &quot;func(int, int) int&quot;fmt.Printf(&quot;%T\n&quot;, sub)   &#x2F;&#x2F; &quot;func(int, int) int&quot;fmt.Printf(&quot;%T\n&quot;, first) &#x2F;&#x2F; &quot;func(int, int) int&quot;fmt.Printf(&quot;%T\n&quot;, zero)  &#x2F;&#x2F; &quot;func(int, int) int&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数的形参是实参的拷贝。对形参进行修改不会影响实参。但是，如果实参包括引用类型，如指针，slice(切片)、map、function、channel等类型，实参可能会由于函数的间接引用被修改。</p><p>你可能会偶尔遇到没有函数体的函数声明，这表示该函数不是以Go实现的。这样的声明定义了函数标识符。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mathfunc Sin(x float64) float &#x2F;&#x2F;implemented in assembly language<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="5-2-递归"><a href="#5-2-递归" class="headerlink" title="5.2. 递归"></a>5.2. 递归</h2><p>golang.org/x/… 目录下存储了一些由Go团队设计、维护，对网络编程、国际化文件处理、移动平台、图像处理、加密解密、开发者工具提供支持的扩展包。未将这些扩展包加入到标准库原因有二，一是部分包仍在开发中，二是对大多数Go语言的开发者而言，扩展包提供的功能很少被使用。</p><p>大部分编程语言使用固定大小的函数调用栈，常见的大小从64KB到2MB不等。固定大小栈会限制递归的深度，当你用递归处理大量数据时，需要避免栈溢出；除此之外，还会导致安全性问题。与此相反，Go语言使用可变栈，栈的大小按需增加(初始时很小)。这使得我们使用递归时不必考虑溢出和安全问题。</p><h2 id="5-3-多返回值"><a href="#5-3-多返回值" class="headerlink" title="5.3. 多返回值"></a>5.3. 多返回值</h2><p>虽然Go的垃圾回收机制会回收不被使用的内存，但是这不包括操作系统层面的资源，比如打开的文件、网络连接。因此我们必须显式的释放这些资源。</p><p>虽然良好的命名很重要，但你也不必为每一个返回值都取一个适当的名字。比如，按照惯例，函数的最后一个bool类型的返回值表示函数是否运行成功，error类型的返回值代表函数的错误信息，对于这些类似的惯例，我们不必思考合适的命名，它们都无需解释。</p><p>如果一个函数所有的返回值都有显式的变量名，那么该函数的return语句可以省略操作数。这称之为bare return。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; CountWordsAndImages does an HTTP GET request for the HTML&#x2F;&#x2F; document url and returns the number of words and images in it.func CountWordsAndImages(url string) (words, images int, err error) &#123;    resp, err :&#x3D; http.Get(url)    if err !&#x3D; nil &#123;        return    &#125;    doc, err :&#x3D; html.Parse(resp.Body)    resp.Body.Close()    if err !&#x3D; nil &#123;        err &#x3D; fmt.Errorf(&quot;parsing HTML: %s&quot;, err)        return    &#125;    words, images &#x3D; countWordsAndImages(doc)    return&#125;func countWordsAndImages(n *html.Node) (words, images int) &#123; &#x2F;* ... *&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照返回值列表的次序，返回所有的返回值，在上面的例子中，每一个return语句等价于：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">return words, images, err<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当一个函数有多处return语句以及许多返回值时，bare return 可以减少代码的重复，但是使得代码难以被理解。举个例子，如果你没有仔细的审查代码，很难发现前2处return等价于 return 0,0,err（Go会将返回值 words和images在函数体的开始处，根据它们的类型，将其初始化为0），最后一处return等价于 return words，image，nil。基于以上原因，不宜过度使用bare return。</p><h2 id="5-4-错误"><a href="#5-4-错误" class="headerlink" title="5.4. 错误"></a>5.4. 错误</h2><p>panic是来自被调用函数的信号，表示发生了某个已知的bug。一个良好的程序永远不应该发生panic异常。</p><p>对于大部分函数而言，永远无法确保能否成功运行。这是因为错误的原因超出了程序员的控制。举个例子，任何进行I/O操作的函数都会面临出现错误的可能，只有没有经验的程序员才会相信读写操作不会失败，因此，当本该可信的操作出乎意料的失败后，我们必须弄清楚导致失败的原因。</p><p>在Go的错误处理中，错误是软件包API和应用程序用户界面的一个重要组成部分，程序运行失败仅被认为是几个预期的结果之一。</p><p>对于那些将运行失败看作是预期结果的函数，它们会返回一个额外的返回值，通常是最后一个，来传递错误信息。如果导致失败的原因只有一个，额外的返回值可以是一个布尔值，通常被命名为ok。</p><p>通常，导致失败的原因不止一种，尤其是对I/O操作而言，用户需要了解更多的错误信息。因此，额外的返回值不再是简单的布尔类型，而是error类型。</p><p>内置的error是接口类型。我们将在第七章了解接口类型的含义，以及它对错误处理的影响。现在我们只需要明白error类型可能是nil或者non-nil。nil意味着函数运行成功，non-nil表示失败。对于non-nil的error类型,我们可以通过调用error的Error函数或者输出函数获得字符串类型的错误信息。</p><p>通常，当函数返回non-nil的error时，其他的返回值是未定义的(undefined),这些未定义的返回值应该被忽略。然而，有少部分函数在发生错误时，仍然会返回一些有用的返回值。比如，当读取文件发生错误时，Read函数会返回可以读取的字节数以及错误信息。对于这种情况，正确的处理方式应该是先处理这些不完整的数据，再处理错误。因此对函数的返回值要有清晰的说明，以便于其他人使用。</p><p>在Go中，函数运行失败时会返回错误信息，这些错误信息被认为是一种预期的值而非异常（exception），这使得Go有别于那些将函数运行失败看作是异常的语言。虽然Go有各种异常机制，但这些机制仅被使用在处理那些未被预料到的错误，即bug，而不是那些在健壮程序中应该被避免的程序错误。对于Go的异常机制我们将在5.9介绍。</p><p>Go这样设计的原因是由于对于某个应该在控制流程中处理的错误而言，将这个错误以异常的形式抛出会混乱对错误的描述，这通常会导致一些糟糕的后果。当某个程序错误被当作异常处理后，这个错误会将堆栈跟踪信息返回给终端用户，这些信息复杂且无用，无法帮助定位错误。</p><p>正因此，Go使用控制流机制（如if和return）处理错误，这使得编码人员能更多的关注错误处理。</p><h3 id="5-4-1-错误处理策略"><a href="#5-4-1-错误处理策略" class="headerlink" title="5.4.1. 错误处理策略"></a>5.4.1. 错误处理策略</h3><p>常用的五种方式</p><p>首先，也是最常用的方式是传播错误。这意味着函数中某个子程序的失败，会变成该函数的失败。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">resp, err :&#x3D; http.Get(url)if err !&#x3D; nil&#123;    return nil, err&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>fmt.Errorf函数使用fmt.Sprintf格式化错误信息并返回。我们使用该函数添加额外的前缀上下文信息到原始错误信息。当错误最终由main函数处理时，错误信息应提供清晰的从原因到后果的因果链，</p><p>由于错误信息经常是以链式组合在一起的，所以错误信息中应避免大写和换行符。最终的错误信息可能很长，我们可以通过类似grep的工具处理错误信息（译者注：grep是一种文本搜索工具）。</p><p>以os包为例，os包确保文件操作（如os.Open、Read、Write、Close）返回的每个错误的描述不仅仅包含错误的原因（如无权限，文件目录不存在）也包含文件名，这样调用者在构造新的错误信息时无需再添加这些信息。</p><p>一般而言，被调用函数f(x)会将调用信息和参数信息作为发生错误时的上下文放在错误信息中并返回给调用者，调用者需要添加一些错误信息中不包含的信息， </p><p>如果错误发生后，程序无法继续运行，我们就可以采用第三种策略：输出错误信息并结束程序。需要注意的是，这种策略只应在main中执行。对库函数而言，应仅向上传播错误，除非该错误意味着程序内部包含不一致性，即遇到了bug，才能在库函数中结束程序。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; (In function main.)if err :&#x3D; WaitForServer(url); err !&#x3D; nil &#123;    fmt.Fprintf(os.Stderr, &quot;Site is down: %v\n&quot;, err)    os.Exit(1)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用log.Fatalf可以更简洁的代码达到与上文相同的效果。log中的所有函数，都默认会在错误信息之前输出时间信息。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if err :&#x3D; WaitForServer(url); err !&#x3D; nil &#123;    log.Fatalf(&quot;Site is down: %v\n&quot;, err)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>长时间运行的服务器常采用默认的时间格式，而交互式工具很少采用包含如此多信息的格式。</p><pre class="line-numbers language-none"><code class="language-none">2006&#x2F;01&#x2F;02 15:04:05 Site is down: no such domain:bad.gopl.io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>第四种策略：有时，我们只需要输出错误信息就足够了，不需要中断程序的运行。我们可以通过log包提供函数</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if err :&#x3D; Ping(); err !&#x3D; nil &#123;    log.Printf(&quot;ping failed: %v; networking disabled&quot;,err)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者标准错误流输出错误信息。</p><p>第五种，也是最后一种策略：我们可以直接忽略掉错误。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">dir, err :&#x3D; ioutil.TempDir(&quot;&quot;, &quot;scratch&quot;)if err !&#x3D; nil &#123;    return fmt.Errorf(&quot;failed to create temp dir: %v&quot;,err)&#125;&#x2F;&#x2F; ...use temp dir…os.RemoveAll(dir) &#x2F;&#x2F; ignore errors; $TMPDIR is cleaned periodically<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尽管os.RemoveAll会失败，但上面的例子并没有做错误处理。这是因为操作系统会定期的清理临时目录。</p><p><strong>在Go中，错误处理有一套独特的编码风格。检查某个子函数是否失败后，我们通常将处理失败的逻辑代码放在处理成功的代码之前。如果某个错误会导致函数返回，那么成功时的逻辑代码不应放在else语句块中，而应直接放在函数体中。Go中大部分函数的代码结构几乎相同，首先是一系列的初始检查，防止错误发生，之后是函数的实际逻辑。*</strong></p><h3 id="5-4-2-文件结尾错误（EOF）"><a href="#5-4-2-文件结尾错误（EOF）" class="headerlink" title="5.4.2. 文件结尾错误（EOF）"></a>5.4.2. 文件结尾错误（EOF）</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">in :&#x3D; bufio.NewReader(os.Stdin)for &#123;    r, _, err :&#x3D; in.ReadRune()    if err &#x3D;&#x3D; io.EOF &#123;        break &#x2F;&#x2F; finished reading    &#125;    if err !&#x3D; nil &#123;        return fmt.Errorf(&quot;read failed:%v&quot;, err)    &#125;    &#x2F;&#x2F; ...use r…&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为文件结束这种错误不需要更多的描述，所以io.EOF有固定的错误信息——“EOF”。对于其他错误，我们可能需要在错误信息中描述错误的类型和数量，这使得我们不能像io.EOF一样采用固定的错误信息。  </p><h2 id="5-5-函数值"><a href="#5-5-函数值" class="headerlink" title="5.5. 函数值"></a>5.5. 函数值</h2><p>在Go中，函数被看作第一类值（first-class values）：函数像其他值一样，拥有类型，可以被赋值给其他变量，传递给函数，从函数返回。</p><p>函数类型的零值是nil。调用值为nil的函数值会引起panic错误：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var f func(int) intf(3) &#x2F;&#x2F; 此处f的值为nil, 会引起panic错误<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>函数值可以与nil比较：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var f func(int) intif f !&#x3D; nil &#123;    f(3)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是函数值之间是不可比较的，也不能用函数值作为map的key。</p><h2 id="5-6-匿名函数"><a href="#5-6-匿名函数" class="headerlink" title="5.6. 匿名函数"></a>5.6. 匿名函数</h2><p>拥有函数名的函数只能在包级语法块中被声明，通过函数字面量（function literal），我们可绕过这一限制，在任何表达式中表示一个函数值。</p><p>函数字面量允许我们在使用函数时，再定义它。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">strings.Map(func(r rune) rune &#123; return r + 1 &#125;, &quot;HAL-9000&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>更为重要的是，通过这种方式定义的函数可以访问完整的词法环境（lexical environment），这意味着在函数中定义的内部函数可以引用该函数的变量，如下例所示：</p><p><em>gopl.io/ch5/squares</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; squares返回一个匿名函数。&#x2F;&#x2F; 该匿名函数每次被调用时都会返回下一个数的平方。func squares() func() int &#123;    var x int    return func() int &#123;        x++        return x * x    &#125;&#125;func main() &#123;    f :&#x3D; squares()    fmt.Println(f()) &#x2F;&#x2F; &quot;1&quot;    fmt.Println(f()) &#x2F;&#x2F; &quot;4&quot;    fmt.Println(f()) &#x2F;&#x2F; &quot;9&quot;    fmt.Println(f()) &#x2F;&#x2F; &quot;16&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>squares的例子证明，函数值不仅仅是一串代码，还记录了状态。</p><p>在squares中定义的匿名内部函数可以访问和更新squares中的局部变量，这意味着匿名函数和squares中，存在变量引用。这就是函数值属于引用类型和函数值不可比较的原因。Go使用闭包（closures）技术实现函数值，Go程序员也把函数值叫做闭包。</p><p>通过这个例子，我们看到变量的生命周期不由它的作用域决定：squares返回后，变量x仍然隐式的存在于f中。</p><h3 id="5-6-1-警告：捕获迭代变量"><a href="#5-6-1-警告：捕获迭代变量" class="headerlink" title="5.6.1. 警告：捕获迭代变量"></a>5.6.1. 警告：捕获迭代变量</h3><h2 id="5-7-可变参数"><a href="#5-7-可变参数" class="headerlink" title="5.7. 可变参数"></a>5.7. 可变参数</h2><p>在声明可变参数函数时，需要在参数列表的最后一个参数类型之前加上省略符号“…”，这表示该函数会接收任意数量的该类型参数。</p><p><em>gopl.io/ch5/sum</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func sum(vals...int) int &#123;    total :&#x3D; 0    for _, val :&#x3D; range vals &#123;        total +&#x3D; val    &#125;    return total&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面的代码中，调用者隐式的创建一个数组，并将原始参数复制到数组中，再把数组的一个切片作为参数传给被调用函数。如果原始参数已经是切片类型，我们该如何传递给sum？只需在最后一个参数后加上省略符。下面的代码功能与上个例子中最后一条语句相同。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">values :&#x3D; []int&#123;1, 2, 3, 4&#125;fmt.Println(sum(values...)) &#x2F;&#x2F; &quot;10&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>虽然在可变参数函数内部，…int 型参数的行为看起来很像切片类型，但实际上，可变参数函数和以切片作为参数的函数是不同的。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func f(...int) &#123;&#125;func g([]int) &#123;&#125;fmt.Printf(&quot;%T\n&quot;, f) &#x2F;&#x2F; &quot;func(...int)&quot;fmt.Printf(&quot;%T\n&quot;, g) &#x2F;&#x2F; &quot;func([]int)&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可变参数函数经常被用于格式化字符串。</p><p>函数名的后缀f是一种通用的命名规范，代表该可变参数函数可以接收Printf风格的格式化字符串。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func errorf(linenum int, format string, args ...interface&#123;&#125;) &#123;    fmt.Fprintf(os.Stderr, &quot;Line %d: &quot;, linenum)    fmt.Fprintf(os.Stderr, format, args...)    fmt.Fprintln(os.Stderr)&#125;linenum, name :&#x3D; 12, &quot;count&quot;errorf(linenum, &quot;undefined: %s&quot;, name) &#x2F;&#x2F; &quot;Line 12: undefined: count&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>interface{}表示函数的最后一个参数可以接收任意类型 </p><h2 id="5-8-Deferred函数"><a href="#5-8-Deferred函数" class="headerlink" title="5.8. Deferred函数"></a>5.8. Deferred函数</h2><p>你只需要在调用普通函数或方法前加上关键字defer，就完成了defer所需要的语法。当执行到该条语句时，函数和参数表达式得到计算，但直到包含该defer语句的函数执行完毕时，defer后的函数才会被执行，不论包含defer语句的函数是通过return正常结束，还是由于panic导致的异常结束。你可以在一个函数中执行多条defer语句，它们的执行顺序与声明顺序相反。</p><p>defer语句经常被用于处理成对的操作，如打开、关闭、连接、断开连接、加锁、释放锁。通过defer机制，不论函数逻辑多复杂，都能保证在任何执行路径下，资源被释放。释放资源的defer应该直接跟在请求资源的语句后。 </p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package ioutilfunc ReadFile(filename string) ([]byte, error) &#123;    f, err :&#x3D; os.Open(filename)    if err !&#x3D; nil &#123;        return nil, err    &#125;    defer f.Close()    return ReadAll(f)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或是处理互斥锁（9.2章）</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var mu sync.Mutexvar m &#x3D; make(map[string]int)func lookup(key string) int &#123;    mu.Lock()    defer mu.Unlock()    return m[key]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调试复杂程序时，defer机制也常被用于记录何时进入和退出函数。</p><p>下例中的bigSlowOperation函数，直接调用trace记录函数的被调情况。bigSlowOperation被调时，trace会返回一个函数值，该函数值会在bigSlowOperation退出时被调用。通过这种方式， 我们可以只通过一条语句控制函数的入口和所有的出口，甚至可以记录函数的运行时间，如例子中的start。需要注意一点：<strong>不要忘记defer语句后的圆括号</strong>，否则本该在进入时执行的操作会在退出时执行，而本该在退出时执行的，永远不会被执行。</p><p><em>gopl.io/ch5/trace</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func bigSlowOperation() &#123;    defer trace(&quot;bigSlowOperation&quot;)() &#x2F;&#x2F; don&#39;t forget the extra parentheses    &#x2F;&#x2F; ...lots of work…    time.Sleep(10 * time.Second) &#x2F;&#x2F; simulate slow operation by sleeping&#125;func trace(msg string) func() &#123;    start :&#x3D; time.Now()    log.Printf(&quot;enter %s&quot;, msg)    return func() &#123;         log.Printf(&quot;exit %s (%s)&quot;, msg,time.Since(start))     &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 通过os.Create打开文件进行写入，在关闭文件时，我们没有对f.close采用defer机制，因为这会产生一些微妙的错误。许多文件系统，尤其是NFS，写入文件时发生的错误会被延迟到文件关闭时反馈。如果没有检查文件关闭时的反馈信息，可能会导致数据丢失，而我们还误以为写入操作成功。如果io.Copy和f.close都失败了，我们倾向于将io.Copy的错误信息反馈给调用者，因为它先于f.close发生，更有可能接近问题的本质。</p><h2 id="5-9-Panic异常"><a href="#5-9-Panic异常" class="headerlink" title="5.9. Panic异常"></a>5.9. Panic异常</h2><p>Go的类型系统会在编译时捕获很多错误，但有些错误只能在运行时检查，如数组访问越界、空指针引用等。这些运行时错误会引起painc异常。</p><p>一般而言，当panic异常发生时，程序会中断运行，并立即执行在该goroutine中被延迟的函数（defer 机制）。随后，程序崩溃并输出日志信息</p><p>不是所有的panic异常都来自运行时，直接调用内置的panic函数也会引发panic异常；panic函数接受任何值作为参数。当某些不应该发生的场景发生时，我们就应该调用panic。比如，当程序到达了某条逻辑上不可能到达的路径：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">switch s :&#x3D; suit(drawCard()); s &#123;    case &quot;Spades&quot;:                                &#x2F;&#x2F; ...    case &quot;Hearts&quot;:                                &#x2F;&#x2F; ...    case &quot;Diamonds&quot;:                              &#x2F;&#x2F; ...    case &quot;Clubs&quot;:                                 &#x2F;&#x2F; ...    default:        panic(fmt.Sprintf(&quot;invalid suit %q&quot;, s)) &#x2F;&#x2F; Joker?&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>断言函数必须满足的前置条件是明智的做法，但这很容易被滥用。除非你能提供更多的错误信息，或者能更快速的发现错误，否则不需要使用断言，<strong>编译器在运行时会帮你检查代码。</strong></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func Reset(x *Buffer) &#123;    if x &#x3D;&#x3D; nil &#123;        panic(&quot;x is nil&quot;) &#x2F;&#x2F; unnecessary!    &#125;    x.elements &#x3D; nil&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然Go的panic机制类似于其他语言的异常，但panic的适用场景有一些不同。由于panic会引起程序的崩溃，因此panic一般用于严重错误，如程序内部的逻辑不一致。<strong>勤奋的程序员认为任何崩溃都表明代码中存在漏洞，所以对于大部分漏洞，我们应该使用Go提供的错误机制，而不是panic，</strong>尽量避免程序的崩溃。在健壮的程序中，任何可以预料到的错误，如不正确的输入、错误的配置或是失败的I/O操作都应该被优雅的处理，最好的处理方式，就是使用Go的错误机制。</p><p>我们在下一节将看到，如何使程序从panic异常中恢复，阻止程序的崩溃</p><p>为了方便诊断问题，runtime包允许程序员输出堆栈信息。在下面的例子中，我们通过在main函数中延迟调用printStack输出堆栈信息。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    defer printStack()    f(3)&#125;func printStack() &#123;    var buf [4096]byte    n :&#x3D; runtime.Stack(buf[:], false)    os.Stdout.Write(buf[:n])&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将panic机制类比其他语言异常机制的读者可能会惊讶，runtime.Stack为何能输出已经被释放函数的信息？在Go的panic机制中，延迟函数的调用在释放堆栈信息之前。</p><h2 id="5-10-Recover捕获异常"><a href="#5-10-Recover捕获异常" class="headerlink" title="5.10. Recover捕获异常"></a>5.10. Recover捕获异常</h2><p>如果在deferred函数中调用了内置函数recover，并且定义该defer语句的函数发生了panic异常，recover会使程序从panic中恢复，并返回panic value。导致panic异常的函数不会继续运行，但能正常返回。在未发生panic时调用recover，recover会返回nil。</p><p>让我们以语言解析器为例，说明recover的使用场景。考虑到语言解析器的复杂性，即使某个语言解析器目前工作正常，也无法肯定它没有漏洞。因此，当某个异常出现时，我们不会选择让解析器崩溃，而是会将panic异常当作普通的解析错误，并附加额外信息提醒用户报告此错误。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func Parse(input string) (s *Syntax, err error) &#123;    defer func() &#123;        if p :&#x3D; recover(); p !&#x3D; nil &#123;            err &#x3D; fmt.Errorf(&quot;internal error: %v&quot;, p)        &#125;    &#125;()    &#x2F;&#x2F; ...parser...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>deferred函数帮助Parse从panic中恢复。在deferred函数内部，panic value被附加到错误信息中；并用err变量接收错误信息，返回给调用者。我们也可以通过调用runtime.Stack往错误信息中添加完整的堆栈调用信息。</p><p>虽然把对panic的处理都集中在一个包下，有助于简化对复杂和不可以预料问题的处理，但作为被广泛遵守的规范，你不应该试图去恢复其他包引起的panic。公有的API应该将函数的运行失败作为error返回，而不是panic。同样的，你也不应该恢复一个由他人开发的函数引起的panic，比如说调用者传入的回调函数，因为你无法确保这样做是安全的。</p><p>有时我们很难完全遵循规范，举个例子，net/http包中提供了一个web服务器，将收到的请求分发给用户提供的处理函数。很显然，我们不能因为某个处理函数引发的panic异常，杀掉整个进程；web服务器遇到处理函数导致的panic时会调用recover，输出堆栈信息，继续运行。这样的做法在实践中很便捷，但也会引起资源泄漏，或是因为recover操作，导致其他问题。</p><p>基于以上原因，安全的做法是有选择性的recover。换句话说，只恢复应该被恢复的panic异常，此外，这些异常所占的比例应该尽可能的低。为了标识某个panic是否应该被恢复，我们可以将panic value设置成特殊类型。在recover时对panic value进行检查，如果发现panic value是特殊类型，就将这个panic作为errror处理，如果不是，则按照正常的panic进行处理</p><p>有些情况下，我们无法恢复。某些致命错误会导致Go在运行时终止程序，如内存不足。</p><h1 id="第六章-方法"><a href="#第六章-方法" class="headerlink" title="第六章　方法"></a>第六章　方法</h1><h2 id="6-1-方法声明"><a href="#6-1-方法声明" class="headerlink" title="6.1. 方法声明"></a>6.1. 方法声明</h2><p>在函数声明时，在其名字之前放上一个变量，即是一个方法。这个附加的参数会将该函数附加到这种类型上，即相当于为这种类型定义了一个独占的方法。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package geometryimport &quot;math&quot;type Point struct&#123; X, Y float64 &#125;&#x2F;&#x2F; traditional functionfunc Distance(p, q Point) float64 &#123;    return math.Hypot(q.X-p.X, q.Y-p.Y)&#125;&#x2F;&#x2F; same thing, but as a method of the Point typefunc (p Point) Distance(q Point) float64 &#123;    return math.Hypot(q.X-p.X, q.Y-p.Y)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码里那个附加的参数p，叫做方法的接收器(receiver)，早期的面向对象语言留下的遗产将调用一个方法称为“向一个对象发送消息”。</p><p>在Go语言中，我们并不会像其它语言那样用this或者self作为接收器；我们可以任意的选择接收器的名字。由于接收器的名字经常会被使用到，所以保持其在方法间传递时的一致性和简短性是不错的主意。这里的建议是可以使用其类型的第一个字母，比如这里使用了Point的首字母p。</p><p>在方法调用过程中，接收器参数一般会在方法名之前出现。这和方法声明是一样的，都是接收器参数在方法名字之前。下面是例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">p :&#x3D; Point&#123;1, 2&#125;q :&#x3D; Point&#123;4, 6&#125;fmt.Println(Distance(p, q)) &#x2F;&#x2F; &quot;5&quot;, function callfmt.Println(p.Distance(q))  &#x2F;&#x2F; &quot;5&quot;, method call<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的两个函数调用都是Distance，但是却没有发生冲突。第一个Distance的调用实际上用的是包级别的函数geometry.Distance，而第二个则是使用刚刚声明的Point，调用的是Point类下声明的Point.Distance方法。</p><p>这种p.Distance的表达式叫做选择器，因为他会选择合适的对应p这个对象的Distance方法来执行。选择器也会被用来选择一个struct类型的字段，比如p.X。</p><p>对于一个给定的类型，其内部的方法都必须有唯一的方法名，但是不同的类型却可以有同样的方法名</p><h2 id="6-2-基于指针对象的方法"><a href="#6-2-基于指针对象的方法" class="headerlink" title="6.2. 基于指针对象的方法"></a>6.2. 基于指针对象的方法</h2><p>当调用一个函数时，会对其每一个参数值进行拷贝，如果一个函数需要更新一个变量，或者函数的其中一个参数实在太大我们希望能够避免进行这种默认的拷贝，这种情况下我们就需要用到指针了。</p><p>为了避免歧义，在声明方法时，如果一个类型名本身是一个指针的话，是不允许其出现在接收器中的，比如下面这个例子：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type P *intfunc (P) f() &#123; &#x2F;* ... *&#x2F; &#125; &#x2F;&#x2F; compile error: invalid receiver type<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>想要调用指针类型方法<code>(*Point).ScaleBy</code>，只要提供一个Point类型的指针即可，像下面这样。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">r :&#x3D; &amp;Point&#123;1, 2&#125;r.ScaleBy(2)fmt.Println(*r) &#x2F;&#x2F; &quot;&#123;2, 4&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>幸运的是，go语言本身在这种地方会帮到我们。如果接收器p是一个Point类型的变量，并且其方法需要一个Point指针作为接收器，我们可以用下面这种简短的写法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">p.ScaleBy(2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编译器会隐式地帮我们用&amp;p去调用ScaleBy这个方法。这种简写方法只适用于“变量”，包括struct里的字段比如p.X，以及array和slice内的元素比如perim[0]。我们不能通过一个无法取到地址的接收器来调用指针方法，比如临时变量的内存地址就无法获取得到：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">Point&#123;1, 2&#125;.ScaleBy(2) &#x2F;&#x2F; compile error: can&#39;t take address of Point literal<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是我们可以用一个<code>*Point</code>这样的接收器来调用Point的方法，因为我们可以通过地址来找到这个变量，只要用解引用符号<code>*</code>来取到该变量即可。编译器在这里也会给我们隐式地插入<code>*</code>这个操作符，所以下面这两种写法等价的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">pptr.Distance(q)(*pptr).Distance(q)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="6-2-1-Nil也是一个合法的接收器类型"><a href="#6-2-1-Nil也是一个合法的接收器类型" class="headerlink" title="6.2.1. Nil也是一个合法的接收器类型"></a>6.2.1. Nil也是一个合法的接收器类型</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">m :&#x3D; url.Values&#123;&quot;lang&quot;: &#123;&quot;en&quot;&#125;&#125; &#x2F;&#x2F; direct constructionm.Add(&quot;item&quot;, &quot;1&quot;)m.Add(&quot;item&quot;, &quot;2&quot;)fmt.Println(m.Get(&quot;lang&quot;)) &#x2F;&#x2F; &quot;en&quot;fmt.Println(m.Get(&quot;q&quot;))    &#x2F;&#x2F; &quot;&quot;fmt.Println(m.Get(&quot;item&quot;)) &#x2F;&#x2F; &quot;1&quot;      (first value)fmt.Println(m[&quot;item&quot;])     &#x2F;&#x2F; &quot;[1 2]&quot;  (direct map access)m &#x3D; nilfmt.Println(m.Get(&quot;item&quot;)) &#x2F;&#x2F; &quot;&quot;m.Add(&quot;item&quot;, &quot;3&quot;)         &#x2F;&#x2F; panic: assignment to entry in nil map<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对Get的最后一次调用中，nil接收器的行为即是一个空map的行为。我们可以等价地将这个操作写成Value(nil).Get(“item”)，但是如果你直接写nil.Get(“item”)的话是无法通过编译的，因为nil的字面量编译器无法判断其准确类型。所以相比之下，最后的那行m.Add的调用就会产生一个panic，因为他尝试更新一个空map。</p><p>由于url.Values是一个map类型，并且间接引用了其key/value对，因此url.Values.Add对这个map里的元素做任何的更新、删除操作对调用方都是可见的。实际上，就像在普通函数中一样，虽然可以通过引用来操作内部值，但在方法想要修改引用本身时是不会影响原始值的，比如把他置换为nil，或者让这个引用指向了其它的对象，调用方都不会受影响。（译注：因为传入的是存储了内存地址的变量，你改变这个变量本身是影响不了原始的变量的，想想C语言，是差不多的）</p><h2 id="6-3-通过嵌入结构体来扩展类型"><a href="#6-3-通过嵌入结构体来扩展类型" class="headerlink" title="6.3. 通过嵌入结构体来扩展类型"></a>6.3. 通过嵌入结构体来扩展类型</h2><p>读者如果对基于类来实现面向对象的语言比较熟悉的话，可能会倾向于将Point看作一个基类，而ColoredPoint看作其子类或者继承类，或者将ColoredPoint看作”is a” Point类型。但这是错误的理解。请注意上面例子中对Distance方法的调用。Distance有一个参数是Point类型，但q并不是一个Point类，所以尽管q有着Point这个内嵌类型，我们也必须要显式地选择它。尝试直接传q的话你会看到下面这样的错误：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">p.Distance(q) &#x2F;&#x2F; compile error: cannot use q (ColoredPoint) as Point<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个ColoredPoint并不是一个Point，但他”has a”Point，并且它有从Point类里引入的Distance和ScaleBy方法。如果你喜欢从实现的角度来考虑问题，内嵌字段会指导编译器去生成额外的包装方法来委托已经声明好的方法，和下面的形式是等价的：</p><p>下面是一个小trick。这个例子展示了简单的cache，其使用两个包级别的变量来实现，一个mutex互斥量(§9.2)和它所操作的cache：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var (    mu sync.Mutex &#x2F;&#x2F; guards mapping    mapping &#x3D; make(map[string]string))func Lookup(key string) string &#123;    mu.Lock()    v :&#x3D; mapping[key]    mu.Unlock()    return v&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面这个版本在功能上是一致的，但将两个包级别的变量放在了cache这个struct一组内：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var cache &#x3D; struct &#123;    sync.Mutex    mapping map[string]string&#125;&#123;    mapping: make(map[string]string),&#125;func Lookup(key string) string &#123;    cache.Lock()    v :&#x3D; cache.mapping[key]    cache.Unlock()    return v&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们给新的变量起了一个更具表达性的名字：cache。因为sync.Mutex字段也被嵌入到了这个struct里，其Lock和Unlock方法也就都被引入到了这个匿名结构中了，这让我们能够以一个简单明了的语法来对其进行加锁解锁操作。</p><h2 id="6-4-方法值和方法表达式"><a href="#6-4-方法值和方法表达式" class="headerlink" title="6.4. 方法值和方法表达式"></a>6.4. 方法值和方法表达式</h2><p>在某些情况，方法可以当做值来使用</p><h2 id="6-5-示例-Bit数组"><a href="#6-5-示例-Bit数组" class="headerlink" title="6.5. 示例: Bit数组"></a>6.5. 示例: Bit数组</h2><h2 id="6-6-封装"><a href="#6-6-封装" class="headerlink" title="6.6. 封装"></a>6.6. 封装</h2><p>一个对象的变量或者方法如果对调用方是不可见的话，一般就被定义为“封装”。</p><p>Go语言只有一种控制可见性的手段：大写首字母的标识符会从定义它们的包中被导出，小写字母的则不会。这种限制包内成员的方式同样适用于struct或者一个类型的方法。因而如果我们想要封装一个对象，我们必须将其定义为一个struct。</p><h1 id="第七章-接口"><a href="#第七章-接口" class="headerlink" title="第七章　接口"></a>第七章　接口</h1><p>接口类型是对其它类型行为的抽象和概括；因为接口类型不会和特定的实现细节绑定在一起，通过这种抽象的方式我们可以让我们的函数更加灵活和更具有适应能力。</p><p>很多面向对象的语言都有相似的接口概念，但Go语言中接口类型的独特之处在于它是满足隐式实现的。也就是说，我们没有必要对于给定的具体类型定义所有满足的接口类型；简单地拥有一些必需的方法就足够了。这种设计可以让你创建一个新的接口类型满足已经存在的具体类型却不会去改变这些类型的定义；当我们使用的类型来自于不受我们控制的包时这种设计尤其有用。 </p><h2 id="7-1-接口约定"><a href="#7-1-接口约定" class="headerlink" title="7.1. 接口约定"></a>7.1. 接口约定</h2><p>接口类型是一种抽象的类型。它不会暴露出它所代表的对象的内部值的结构和这个对象支持的基础操作的集合；它们只会表现出它们自己的方法。也就是说当你有看到一个接口类型的值时，你不知道它是什么，唯一知道的就是可以通过它的方法来做什么。</p><h2 id="7-2-接口类型"><a href="#7-2-接口类型" class="headerlink" title="7.2 接口类型"></a>7.2 接口类型</h2><h2 id="7-3-实现接口的条件"><a href="#7-3-实现接口的条件" class="headerlink" title="7.3 实现接口的条件"></a>7.3 实现接口的条件</h2><p>一个类型如果拥有一个接口需要的所有方法，那么这个类型就实现了这个接口。</p><p>例如，<code>*os.File</code>类型实现了io.Reader，Writer，Closer，和ReadWriter接口。<code>*bytes.Buffer</code>实现了Reader，Writer，和ReadWriter这些接口，但是它没有实现Closer接口因为它不具有Close方法</p><p>接口指定的规则非常简单：表达一个类型属于某个接口只要这个类型实现这个接口。所以：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w io.Writerw &#x3D; os.Stdout           &#x2F;&#x2F; OK: *os.File has Write methodw &#x3D; new(bytes.Buffer)   &#x2F;&#x2F; OK: *bytes.Buffer has Write methodw &#x3D; time.Second         &#x2F;&#x2F; compile error: time.Duration lacks Write methodvar rwc io.ReadWriteCloserrwc &#x3D; os.Stdout         &#x2F;&#x2F; OK: *os.File has Read, Write, Close methodsrwc &#x3D; new(bytes.Buffer) &#x2F;&#x2F; compile error: *bytes.Buffer lacks Close method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个规则甚至适用于等式右边本身也是一个接口类型</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">w &#x3D; rwc                 &#x2F;&#x2F; OK: io.ReadWriteCloser has Write methodrwc &#x3D; w                 &#x2F;&#x2F; compile error: io.Writer lacks Close method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在第6.5章中，IntSet类型的String方法的接收者是一个指针类型，所以我们不能在一个不能寻址的IntSet值上调用这个方法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type IntSet struct &#123; &#x2F;* ... *&#x2F; &#125;func (*IntSet) String() stringvar _ &#x3D; IntSet&#123;&#125;.String() &#x2F;&#x2F; compile error: String requires *IntSet receiver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>但是我们可以在一个IntSet值上调用这个方法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var s IntSetvar _ &#x3D; s.String() &#x2F;&#x2F; OK: s is a variable and &amp;s has a String method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然而，由于只有<code>*IntSet</code>类型有String方法，所以也只有<code>*IntSet</code>类型实现了fmt.Stringer接口：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var _ fmt.Stringer &#x3D; &amp;s &#x2F;&#x2F; OKvar _ fmt.Stringer &#x3D; s  &#x2F;&#x2F; compile error: IntSet lacks String method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于创建的一个interface{}值持有一个boolean，float，string，map，pointer，或者任意其它的类型；我们当然不能直接对它持有的值做操作，因为interface{}没有任何方法。</p><p>每一个具体类型的组基于它们相同的行为可以表示成一个接口类型。不像基于类的语言，他们一个类实现的接口集合需要进行显式的定义，在Go语言中我们可以在需要的时候定义一个新的抽象或者特定特点的组，而不需要修改具体类型的定义。当具体的类型来自不同的作者时这种方式会特别有用。当然也确实没有必要在具体的类型中指出这些共性。</p><h2 id="7-4-flag-Value接口"><a href="#7-4-flag-Value接口" class="headerlink" title="7.4. flag.Value接口"></a>7.4. flag.Value接口</h2><h2 id="7-5-接口值"><a href="#7-5-接口值" class="headerlink" title="7.5. 接口值"></a>7.5. 接口值</h2><p>接口值，由两个部分组成，一个具体的类型和那个类型的值。它们被称为接口的动态类型和动态值。对于像Go语言这种静态类型的语言，类型是编译期的概念；因此一个类型不是一个值。在我们的概念模型中，一些提供每个类型信息的值被称为类型描述符，比如类型的名称和方法。在一个接口值中，类型部分代表与之相关类型的描述符。</p><p>下面4个语句中，变量w得到了3个不同的值。（开始和最后的值是相同的）</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w io.Writerw &#x3D; os.Stdoutw &#x3D; new(bytes.Buffer)w &#x3D; nil<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>让我们进一步观察在每一个语句后的w变量的值和动态行为。第一个语句定义了变量w:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w io.Writer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在Go语言中，变量总是被一个定义明确的值初始化，即使接口类型也不例外。对于一个接口的零值就是它的类型和值的部分都是nil</p><p>一个接口值基于它的动态类型被描述为空或非空，所以这是一个空的接口值。你可以通过使用w==nil或者w!=nil来判断接口值是否为空。调用一个空接口值上的任意方法都会产生panic:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">w.Write([]byte(&quot;hello&quot;)) &#x2F;&#x2F; panic: nil pointer dereference<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从概念上讲，不论接口值多大，动态值总是可以容下它。（这只是一个概念上的模型；具体的实现可能会非常不同）</p><p>接口值可以使用== 和!＝来进行比较。两个接口值相等仅当它们都是nil值，或者它们的动态类型相同并且动态值也根据这个动态类型的==操作相等。因为接口值是可比较的，所以它们可以用在map的键或者作为switch语句的操作数。</p><p>然而，如果两个接口值的动态类型相同，但是这个动态类型是不可比较的（比如切片），将它们进行比较就会失败并且panic:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var x interface&#123;&#125; &#x3D; []int&#123;1, 2, 3&#125;fmt.Println(x &#x3D;&#x3D; x) &#x2F;&#x2F; panic: comparing uncomparable type []int<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>考虑到这点，接口类型是非常与众不同的。其它类型要么是安全的可比较类型（如基本类型和指针）要么是完全不可比较的类型（如切片，映射类型，和函数），但是在比较接口值或者包含了接口值的聚合类型时，我们必须要意识到潜在的panic。同样的风险也存在于使用接口作为map的键或者switch的操作数。只能比较你非常确定它们的动态值是可比较类型的接口值。</p><p>当我们处理错误或者调试的过程中，得知接口值的动态类型是非常有帮助的。所以我们使用fmt包的%T动作:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w io.Writerfmt.Printf(&quot;%T\n&quot;, w) &#x2F;&#x2F; &quot;&lt;nil&gt;&quot;w &#x3D; os.Stdoutfmt.Printf(&quot;%T\n&quot;, w) &#x2F;&#x2F; &quot;*os.File&quot;w &#x3D; new(bytes.Buffer)fmt.Printf(&quot;%T\n&quot;, w) &#x2F;&#x2F; &quot;*bytes.Buffer&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在fmt包内部，使用反射来获取接口动态类型的名称</p><h3 id="7-5-1-警告：一个包含nil指针的接口不是nil接口"><a href="#7-5-1-警告：一个包含nil指针的接口不是nil接口" class="headerlink" title="7.5.1. 警告：一个包含nil指针的接口不是nil接口"></a>7.5.1. 警告：一个包含nil指针的接口不是nil接口</h3><p>一个不包含任何值的nil接口值和一个刚好包含nil指针的接口值是不同的。这个细微区别产生了一个容易绊倒每个Go程序员的陷阱。</p><p>思考下面的程序。当debug变量设置为true时，main函数会将f函数的输出收集到一个bytes.Buffer类型中。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">const debug &#x3D; truefunc main() &#123;    var buf *bytes.Buffer    if debug &#123;        buf &#x3D; new(bytes.Buffer) &#x2F;&#x2F; enable collection of output    &#125;    f(buf) &#x2F;&#x2F; NOTE: subtly incorrect!    if debug &#123;        &#x2F;&#x2F; ...use buf...    &#125;&#125;&#x2F;&#x2F; If out is non-nil, output will be written to it.func f(out io.Writer) &#123;    &#x2F;&#x2F; ...do something...    if out !&#x3D; nil &#123;        out.Write([]byte(&quot;done!\n&quot;))    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可能会预计当把变量debug设置为false时可以禁止对输出的收集，但是实际上在out.Write方法调用时程序发生了panic：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if out !&#x3D; nil &#123;    out.Write([]byte(&quot;done!\n&quot;)) &#x2F;&#x2F; panic: nil pointer dereference&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>当main函数调用函数f时，它给f函数的out参数赋了一个<em>bytes.Buffer的空指针，所以out的动态值是nil。然而，它的动态类型是</em>bytes.Buffer，意思就是out变量是一个包含空指针值的非空接口（如图7.5），所以防御性检查out!=nil的结果依然是true。</p><p><img src="https://docs.hacknode.org/gopl-zh/images/ch7-05.png" alt="img"></p><p>动态分配机制依然决定(*bytes.Buffer).Write的方法会被调用，但是这次的接收者的值是nil。对于一些如<em>os.File的类型，nil是一个有效的接收者(§6.2.1)，但是</em>bytes.Buffer类型不在这些种类中。这个方法会被调用，但是当它尝试去获取缓冲区时会发生panic。</p><p>问题在于尽管一个nil的<em>bytes.Buffer指针有实现这个接口的方法，它也不满足这个接口具体的行为上的要求。特别是这个调用违反了(</em>bytes.Buffer).Write方法的接收者非空的隐含先觉条件，所以将nil指针赋给这个接口是错误的。解决方案就是将main函数中的变量buf的类型改为io.Writer，因此可以避免一开始就将一个不完整的值赋值给这个接口：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var buf io.Writerif debug &#123;    buf &#x3D; new(bytes.Buffer) &#x2F;&#x2F; enable collection of output&#125;f(buf) &#x2F;&#x2F; OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在我们已经把接口值的技巧都讲完了，让我们来看更多的一些在Go标准库中的重要接口类型。在下面的三章中，我们会看到接口类型是怎样用在排序，web服务，错误处理中的。</p><h2 id="7-6-sort-Interface接口"><a href="#7-6-sort-Interface接口" class="headerlink" title="7.6. sort.Interface接口"></a>7.6. sort.Interface接口</h2><p>一个内置的排序算法需要知道三个东西：序列的长度，表示两个元素比较的结果，一种交换两个元素的方式；这就是sort.Interface的三个方法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package sorttype Interface interface &#123;    Len() int    Less(i, j int) bool &#x2F;&#x2F; i, j are indices of sequence elements    Swap(i, j int)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了对序列进行排序，我们需要定义一个实现了这三个方法的类型，然后对这个类型的一个实例应用sort.Sort函数。思考对一个字符串切片进行排序，这可能是最简单的例子了。下面是这个新的类型StringSlice和它的Len，Less和Swap方法</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">type StringSlice []stringfunc (p StringSlice) Len() int           &#123; return len(p) &#125;func (p StringSlice) Less(i, j int) bool &#123; return p[i] &lt; p[j] &#125;func (p StringSlice) Swap(i, j int)      &#123; p[i], p[j] &#x3D; p[j], p[i] &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>现在我们可以通过像下面这样将一个切片转换为一个StringSlice类型来进行排序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">sort.Sort(StringSlice(names))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="7-10-类型断言"><a href="#7-10-类型断言" class="headerlink" title="7.10. 类型断言"></a>7.10. 类型断言</h2><p>类型断言是一个使用在接口值上的操作。语法上它看起来像x.(T)被称为断言类型，这里x表示一个接口的类型和T表示一个类型。</p><p>一个类型断言检查它操作对象的动态类型是否和断言的类型匹配。果检查失败，接下来这个操作会抛出panic。 </p><p>第二种，如果相反地断言的类型T是一个接口类型，然后类型断言检查是否x的动态类型满足T。如果这个检查成功了，动态值没有获取到；这个结果仍然是一个有相同动态类型和值部分的接口值，但是结果为类型T。换句话说，对一个接口类型的类型断言改变了类型的表述方式，改变了可以获取的方法集合（通常更大）,但是它保留了接口值内部的动态类型和值的部分。</p><p>在下面的第一个类型断言后，w和rw都持有os.Stdout，因此它们都有一个动态类型<code>*os.File</code>，但是变量w是一个io.Writer类型，只对外公开了文件的Write方法，而rw变量还公开了它的Read方法。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var w io.Writerw &#x3D; os.Stdoutrw :&#x3D; w.(io.ReadWriter) &#x2F;&#x2F; success: *os.File has both Read and Writew &#x3D; new(ByteCounter)rw &#x3D; w.(io.ReadWriter) &#x2F;&#x2F; panic: *ByteCounter has no Read method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果断言操作的对象是一个nil接口值，那么不论被断言的类型是什么这个类型断言都会失败。我们几乎不需要对一个更少限制性的接口类型（更少的方法集合）做断言，因为它表现的就像是赋值操作一样，除了对于nil接口值的情况。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">w &#x3D; rw             &#x2F;&#x2F; io.ReadWriter is assignable to io.Writerw &#x3D; rw.(io.Writer) &#x2F;&#x2F; fails only if rw &#x3D;&#x3D; nil<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>当类型断言的操作对象是一个变量，你有时会看见原来的变量名重用而不是声明一个新的本地变量名，这个重用的变量原来的值会被覆盖（理解：其实是声明了一个同名的新的本地变量，外层原来的w不会被改变），如下面这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">if w, ok :&#x3D; w.(*os.File); ok &#123;    &#x2F;&#x2F; ...use w...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="7-11-基于类型断言区别错误类型"><a href="#7-11-基于类型断言区别错误类型" class="headerlink" title="7.11. 基于类型断言区别错误类型"></a>7.11. 基于类型断言区别错误类型</h2><h2 id="7-12-通过类型断言询问行为"><a href="#7-12-通过类型断言询问行为" class="headerlink" title="7.12. 通过类型断言询问行为"></a>7.12. 通过类型断言询问行为</h2><h2 id="7-13-类型分支"><a href="#7-13-类型分支" class="headerlink" title="7.13. 类型分支"></a>7.13. 类型分支</h2><p>接口被以两种不同的方式使用。在第一个方式中，以io.Reader，io.Writer，fmt.Stringer，sort.Interface，http.Handler和error为典型，一个接口的方法表达了实现这个接口的具体类型间的相似性，但是隐藏了代码的细节和这些具体类型本身的操作。重点在于方法上，而不是具体的类型上。</p><p>第二个方式是利用一个接口值可以持有各种具体类型值的能力，将这个接口认为是这些类型的联合。类型断言用来动态地区别这些类型，使得对每一种情况都不一样。在这个方式中，重点在于具体的类型满足这个接口，而不在于接口的方法（如果它确实有一些的话），并且没有任何的信息隐藏。我们将以这种方式使用的接口描述为discriminated unions（可辨识联合）</p><p>如果你熟悉面向对象编程，你可能会将这两种方式当作是subtype polymorphism（子类型多态）和 ad hoc polymorphism（非参数多态）</p><p>和其它那些语言一样，Go语言查询一个SQL数据库的API会干净地将查询中固定的部分和变化的部分分开。一个调用的例子可能看起来像这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;database&#x2F;sql&quot;func listTracks(db sql.DB, artist string, minYear, maxYear int) &#123;    result, err :&#x3D; db.Exec(        &quot;SELECT * FROM tracks WHERE artist &#x3D; ? AND ? &lt;&#x3D; year AND year &lt;&#x3D; ?&quot;,        artist, minYear, maxYear)    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Exec方法使用SQL字面量替换在查询字符串中的每个’?’；SQL字面量表示相应参数的值，它有可能是一个布尔值，一个数字，一个字符串，或者nil空值。用这种方式构造查询可以帮助避免SQL注入攻击；这种攻击就是对手可以通过利用输入内容中不正确的引号来控制查询语句。在Exec函数内部，我们可能会找到像下面这样的一个函数，它会将每一个参数值转换成它的SQL字面量符号。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func sqlQuote(x interface&#123;&#125;) string &#123;    if x &#x3D;&#x3D; nil &#123;        return &quot;NULL&quot;    &#125; else if _, ok :&#x3D; x.(int); ok &#123;        return fmt.Sprintf(&quot;%d&quot;, x)    &#125; else if _, ok :&#x3D; x.(uint); ok &#123;        return fmt.Sprintf(&quot;%d&quot;, x)    &#125; else if b, ok :&#x3D; x.(bool); ok &#123;        if b &#123;            return &quot;TRUE&quot;        &#125;        return &quot;FALSE&quot;    &#125; else if s, ok :&#x3D; x.(string); ok &#123;        return sqlQuoteString(s) &#x2F;&#x2F; (not shown)    &#125; else &#123;        panic(fmt.Sprintf(&quot;unexpected type %T: %v&quot;, x, x))    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意到在原来的函数中，对于bool和string情况的逻辑需要通过类型断言访问提取的值。因为这个做法很典型，类型分支语句有一个扩展的形式，它可以将提取的值绑定到一个在每个case范围内都有效的新变量。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">switch x :&#x3D; x.(type) &#123; &#x2F;* ... *&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里我们已经将新的变量也命名为x；和类型断言一样，重用变量名是很常见的。和一个switch语句相似地，一个类型分支隐式的创建了一个词法块，因此新变量x的定义不会和外面块中的x变量冲突。每一个case也会隐式的创建一个单独的词法块。</p><p>使用类型分支的扩展形式来重写sqlQuote函数会让这个函数更加的清晰：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func sqlQuote(x interface&#123;&#125;) string &#123;    switch x :&#x3D; x.(type) &#123;    case nil:        return &quot;NULL&quot;    case int, uint:        return fmt.Sprintf(&quot;%d&quot;, x) &#x2F;&#x2F; x has type interface&#123;&#125; here.    case bool:        if x &#123;            return &quot;TRUE&quot;        &#125;        return &quot;FALSE&quot;    case string:        return sqlQuoteString(x) &#x2F;&#x2F; (not shown)    default:        panic(fmt.Sprintf(&quot;unexpected type %T: %v&quot;, x, x))    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Go支持在一个case里写多个条件，例如：”a”,”b” 或者 i<1 && i >-1</strong></p><h3 id="goto语句"><a href="#goto语句" class="headerlink" title="goto语句"></a>goto语句</h3><p>使用goto语句跳转到标签，进行代码间的无条件跳转。在快速跳出循环，避免重复退出方面也有一定的帮助。并且可以简化一些代码的实现流程。</p><p>在满足条件时，如果需要重复退出两层循环，传统的编码方式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;  var isBreak bool  for x :&#x3D; 0; x &lt; 20; x++ &#123;    for y :&#x3D; 0; y &lt; 20; y++ &#123;      if y &#x3D;&#x3D; 2 &#123;        isBreak &#x3D; true        break      &#125;    &#125;    if isBreak &#123; &#x2F;&#x2F; 根据标记，再退出外层循环      break    &#125;  &#125;  fmt.Println(&quot;over!&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将上面的代码改写为goto形式：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;  for x :&#x3D; 0; x &lt; 20; x++ &#123;    for y :&#x3D; 0; y &lt; 20; y++ &#123;      if y &#x3D;&#x3D; 2 &#123;        goto breakTag      &#125;    &#125;  &#125;  return breakTag:  fmt.Println(&quot;done&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在以上代码中，标签只能被goto使用，不影响代码执行流程。在定义标签breakTag之前有一个return语句，此处如果不手动返回，则在不满足条件时也会执行breakTag代码。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport &quot;fmt&quot;func main() &#123;for x :&#x3D; 0; x &lt; 20; x++ &#123;for y :&#x3D; 0; y &lt; 20; y++ &#123;if y &gt;&#x3D; 22 &#123;goto breakTag&#125;&#125;&#125;breakTag:fmt.Println(&quot;done&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在代码中，经常会遇到”多错误处理“，存在代码重复问题</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;  ...  err :&#x3D; getUserInfo()  if err !&#x3D; nil &#123;    goto doExit  &#125;  err :&#x3D; getEmail()  if err !&#x3D; nil &#123;    goto doExit  &#125;  fmt.Println(&quot;over&quot;)  returndoExit:  fmt.Println(err)  exitProcess()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="break语句"><a href="#break语句" class="headerlink" title="break语句"></a>break语句</h3><p>在break语句后面添加标签，表示退出某个标签对应的代码块，添加的标签必须定义在对应的for，Switch和select的代码块上。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport &quot;fmt&quot;func main() &#123;OuterLoop:for x :&#x3D; 0; x &lt; 20; x++ &#123;for y :&#x3D; 0; y &lt; 20; y++ &#123;switch y &#123;case 1:fmt.Println(x - y) &#x2F;&#x2F; 退出OuterLoop的循环之外break OuterLoopcase 2:fmt.Println(y - x)continue OuterLoop&#125;&#125;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-15-一些建议"><a href="#7-15-一些建议" class="headerlink" title="7.15. 一些建议"></a>7.15. 一些建议</h2><p>当设计一个新的包时，新手Go程序员总是先创建一套接口，然后再定义一些满足它们的具体类型。这种方式的结果就是有很多的接口，它们中的每一个仅只有一个实现。不要再这么做了。这种接口是不必要的抽象；它们也有一个运行时损耗。你可以使用导出机制(§6.6)来限制一个类型的方法或一个结构体的字段是否在包外可见。接口只有当有两个或两个以上的具体类型必须以相同的方式进行处理时才需要。</p><p>当一个接口只被一个单一的具体类型实现时有一个例外，就是由于它的依赖，这个具体类型不能和这个接口存在在一个相同的包中。这种情况下，一个接口是解耦这两个包的一个好方式。</p><p>因为在Go语言中只有当两个或更多的类型实现一个接口时才使用接口，它们必定会从任意特定的实现细节中抽象出来。结果就是有更少和更简单方法的更小的接口（经常和io.Writer或 fmt.Stringer一样只有一个）。当新的类型出现时，小的接口更容易满足。对于接口设计的一个好的标准就是 ask only for what you need（只考虑你需要的东西）</p><h1 id="第八章-Goroutines和Channels"><a href="#第八章-Goroutines和Channels" class="headerlink" title="第八章　Goroutines和Channels"></a>第八章　Goroutines和Channels</h1><p>Go语言中的并发程序可以用两种手段来实现。本章讲解goroutine和channel，其支持“顺序通信进程”(communicating sequential processes)或被简称为CSP。CSP是一种现代的并发编程模型，在这种编程模型中值会在不同的运行实例(goroutine)中传递，尽管大多数情况下仍然是被限制在单一实例中。</p><p>尽管Go对并发的支持是众多强力特性之一，但跟踪调试并发程序还是很困难，在线性程序中形成的直觉往往还会使我们误入歧途。</p><h2 id="8-1-Goroutines"><a href="#8-1-Goroutines" class="headerlink" title="8.1. Goroutines"></a>8.1. Goroutines</h2><p>在Go语言中，每一个并发的执行单元叫作一个goroutine。设想这里的一个程序有两个函数，一个函数做计算，另一个输出结果，假设两个函数没有相互之间的调用关系。一个线性的程序会先调用其中的一个函数，然后再调用另一个。如果程序中包含多个goroutine，对两个函数的调用则可能发生在同一时刻。马上就会看到这样的一个程序。</p><p>新的goroutine会用go语句来创建。在语法上，go语句是一个普通的函数或方法调用前加上关键字go。go语句会使其语句中的函数在一个新创建的goroutine中运行。而go语句本身会迅速地完成。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">f()    &#x2F;&#x2F; call f(); wait for it to returngo f() &#x2F;&#x2F; create a new goroutine that calls f(); don&#39;t wait<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>主函数返回时，所有的goroutine都会被直接打断，程序退出。除了从主函数退出或者直接终止程序之外，没有其它的编程方法能够让一个goroutine来打断另一个的执行，但是之后可以看到一种方式来实现这个目的，通过goroutine之间的通信来让一个goroutine请求其它的goroutine，并让被请求的goroutine自行结束执行。</p><h2 id="8-2-示例-并发的Clock服务"><a href="#8-2-示例-并发的Clock服务" class="headerlink" title="8.2. 示例: 并发的Clock服务"></a>8.2. 示例: 并发的Clock服务</h2><p>网络编程是并发大显身手的一个领域，由于服务器是最典型的需要同时处理很多连接的程序，这些连接一般来自于彼此独立的客户端 </p><h2 id="8-3-示例-并发的Echo服务"><a href="#8-3-示例-并发的Echo服务" class="headerlink" title="8.3. 示例: 并发的Echo服务"></a>8.3. 示例: 并发的Echo服务</h2><p>让服务使用并发不只是处理多个客户端的请求，甚至在处理单个连接时也可能会用到，就像我们上面的两个go关键词的用法。然而在我们使用go关键词的同时，需要慎重地考虑net.Conn中的方法在并发地调用时是否安全，事实上对于大多数类型来说也确实不安全。我们会在下一章中详细地探讨并发安全性。</p><h2 id="8-4-Channels"><a href="#8-4-Channels" class="headerlink" title="8.4. Channels"></a>8.4. Channels</h2><p>如果说goroutine是Go语言程序的并发体的话，那么channels则是它们之间的通信机制。一个channel是一个通信机制，它可以让一个goroutine通过它给另一个goroutine发送值信息。每个channel都有一个特殊的类型，也就是channels可发送数据的类型。一个可以发送int类型数据的channel一般写为chan int。</p><p>使用内置的make函数，我们可以创建一个channel：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ch :&#x3D; make(chan int) &#x2F;&#x2F; ch has type &#39;chan int&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当我们复制一个channel或用于函数参数传递时，我们只是拷贝了一个channel引用，因此调用者和被调用者将引用同一个channel对象。和其它的引用类型一样，channel的零值也是nil。</p><p>两个相同类型的channel可以使用==运算符比较。如果两个channel引用的是相同的对象，那么比较的结果为真。一个channel也可以和nil进行比较。</p><p>一个channel有发送和接受两个主要操作，都是通信行为。一个发送语句将一个值从一个goroutine通过channel发送到另一个执行接收操作的goroutine。发送和接收两个操作都使用<code>&lt;-</code>运算符。在发送语句中，<code>&lt;-</code>运算符分割channel和要发送的值。在接收语句中，<code>&lt;-</code>运算符写在channel对象之前。一个不使用接收结果的接收操作也是合法的。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ch &lt;- x  &#x2F;&#x2F; a send statementx &#x3D; &lt;-ch &#x2F;&#x2F; a receive expression in an assignment statement&lt;-ch     &#x2F;&#x2F; a receive statement; result is discarded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Channel还支持close操作，用于关闭channel，随后对基于该channel的任何发送操作都将导致panic异常。对一个已经被close过的channel进行接收操作依然可以接受到之前已经成功发送的数据；如果channel中已经没有数据的话将产生一个零值的数据。</p><p>使用内置的close函数就可以关闭一个channel：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">close(ch)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以最简单方式调用make函数创建的是一个无缓存的channel，但是我们也可以指定第二个整型参数，对应channel的容量。如果channel的容量大于零，那么该channel就是带缓存的channel。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ch &#x3D; make(chan int)    &#x2F;&#x2F; unbuffered channelch &#x3D; make(chan int, 0) &#x2F;&#x2F; unbuffered channelch &#x3D; make(chan int, 3) &#x2F;&#x2F; buffered channel with capacity 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="8-4-1-不带缓存的Channels"><a href="#8-4-1-不带缓存的Channels" class="headerlink" title="8.4.1. 不带缓存的Channels"></a>8.4.1. 不带缓存的Channels</h3><p>一个基于无缓存Channels的发送操作将导致发送者goroutine阻塞，直到另一个goroutine在相同的Channels上执行接收操作，当发送的值通过Channels成功传输之后，两个goroutine可以继续执行后面的语句。反之，如果接收操作先发生，那么接收者goroutine也将阻塞，直到有另一个goroutine在相同的Channels上执行发送操作。</p><p>基于无缓存Channels的发送和接收操作将导致两个goroutine做一次同步操作。因为这个原因，无缓存Channels有时候也被称为同步Channels。当通过一个无缓存Channels发送数据时，接收者收到数据发生在唤醒发送者goroutine之前（译注：<em>happens before</em>，这是Go语言并发内存模型的一个关键术语！）。</p><p>在讨论并发编程时，当我们说x事件在y事件之前发生（<em>happens before</em>），我们并不是说x事件在时间上比y时间更早；我们要表达的意思是要保证在此之前的事件都已经完成了，例如在此之前的更新某些变量的操作已经完成，你可以放心依赖这些已完成的事件了。</p><p>当我们说x事件既不是在y事件之前发生也不是在y事件之后发生，我们就说x事件和y事件是并发的。这并不是意味着x事件和y事件就一定是同时发生的，我们只是不能确定这两个事件发生的先后顺序。</p><h3 id="8-4-2-串联的Channels（Pipeline）"><a href="#8-4-2-串联的Channels（Pipeline）" class="headerlink" title="8.4.2. 串联的Channels（Pipeline）"></a>8.4.2. 串联的Channels（Pipeline）</h3><p>Channels也可以用于将多个goroutine连接在一起，一个Channel的输出作为下一个Channel的输入。这种串联的Channels就是所谓的管道（pipeline）。下面的程序用两个channels将三个goroutine串联起来，如图8.1所示。</p><p><img src="https://docs.hacknode.org/gopl-zh/images/ch8-01.png" alt="img"></p><p>像这样的串联Channels的管道（Pipelines）可以用在需要长时间运行的服务中，每个长时间运行的goroutine可能会包含一个死循环，在不同goroutine的死循环内部使用串联的Channels来通信。但是，如果我们希望通过Channels只发送有限的数列该如何处理呢？</p><p>如果发送者知道，没有更多的值需要发送到channel的话，那么让接收者也能及时知道没有多余的值可接收将是有用的，因为接收者可以停止不必要的接收等待。这可以通过内置的close函数来关闭channel实现：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">close(naturals)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当一个channel被关闭后，再向该channel发送数据将导致panic异常。当一个被关闭的channel中已经发送的数据都被成功接收后，后续的接收操作将不再阻塞，它们会立即返回一个零值。关闭上面例子中的naturals变量对应的channel并不能终止循环，它依然会收到一个永无休止的零值序列，然后将它们发送给打印者goroutine。</p><p>没有办法直接测试一个channel是否被关闭，但是接收操作有一个变体形式：它多接收一个结果，多接收的第二个结果是一个布尔值ok，ture表示成功从channels接收到值，false表示channels已经被关闭并且里面没有值可接收。使用这个特性，我们可以修改squarer函数中的循环代码，当naturals对应的channel被关闭并没有值可接收时跳出循环，并且也关闭squares对应的channel.</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">package mainimport (&quot;fmt&quot;)func main() &#123;naturals :&#x3D; make(chan int)squares :&#x3D; make(chan int)&#x2F;&#x2F; Countergo func() &#123;for x :&#x3D; 0; x &lt; 5; x++ &#123;naturals &lt;- x&#125;close(naturals)&#125;()&#x2F;&#x2F; Squarergo func() &#123;for &#123;x, ok :&#x3D; &lt;-naturalsif !ok &#123;break&#125;squares &lt;- x * x&#125;close(squares)&#125;()&#x2F;&#x2F; Printer (in main goroutine)for i :&#x3D; 0; i &lt; 5; i++ &#123;fmt.Println(&lt;-squares)&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在下面的改进中，我们的计数器goroutine只生成100个含数字的序列，然后关闭naturals对应的channel，这将导致计算平方数的squarer对应的goroutine可以正常终止循环并关闭squares对应的channel。（在一个更复杂的程序中，可以通过defer语句关闭对应的channel。）最后，主goroutine也可以正常终止循环并退出程序。</p><p><em>gopl.io/ch8/pipeline2</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func main() &#123;    naturals :&#x3D; make(chan int)    squares :&#x3D; make(chan int)    &#x2F;&#x2F; Counter    go func() &#123;        for x :&#x3D; 0; x &lt; 100; x++ &#123;            naturals &lt;- x        &#125;        close(naturals)    &#125;()    &#x2F;&#x2F; Squarer    go func() &#123;        for x :&#x3D; range naturals &#123;            squares &lt;- x * x        &#125;        close(squares)    &#125;()    &#x2F;&#x2F; Printer (in main goroutine)    for x :&#x3D; range squares &#123;        fmt.Println(x)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实你并不需要关闭每一个channel。只有当需要告诉接收者goroutine，所有的数据已经全部发送时才需要关闭channel。不管一个channel是否被关闭，当它没有被引用时将会被Go语言的垃圾自动回收器回收。（不要将关闭一个打开文件的操作和关闭一个channel操作混淆。对于每个打开的文件，都需要在不使用的时候调用对应的Close方法来关闭文件。）</p><p>试图重复关闭一个channel将导致panic异常，试图关闭一个nil值的channel也将导致panic异常。关闭一个channels还会触发一个广播机制</p><h3 id="8-4-3-单方向的Channel"><a href="#8-4-3-单方向的Channel" class="headerlink" title="8.4.3. 单方向的Channel"></a>8.4.3. 单方向的Channel</h3><p>当一个channel作为一个函数参数时，它一般总是被专门用于只发送或者只接收。</p><p>分别用于只发送或只接收的channel。类型<code>chan&lt;- int</code>表示一个只发送int的channel，只能发送不能接收。相反，类型<code>&lt;-chan int</code>表示一个只接收int的channel，只能接收不能发送。（箭头<code>&lt;-</code>和关键字chan的相对位置表明了channel的方向。）这种限制将在编译期检测。</p><p><strong>因为关闭操作只用于断言不再向channel发送新的数据，所以只有在发送者所在的goroutine才会调用close函数，因此对一个只接收的channel调用close将是一个编译错误</strong>。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func counter(out chan&lt;- int) &#123;    for x :&#x3D; 0; x &lt; 100; x++ &#123;        out &lt;- x    &#125;    close(out)&#125;func squarer(out chan&lt;- int, in &lt;-chan int) &#123;    for v :&#x3D; range in &#123;        out &lt;- v * v    &#125;    close(out)&#125;func printer(in &lt;-chan int) &#123;    for v :&#x3D; range in &#123;        fmt.Println(v)    &#125;&#125;func main() &#123;    naturals :&#x3D; make(chan int)    squares :&#x3D; make(chan int)    go counter(naturals)    go squarer(squares, naturals)    printer(squares)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用counter（naturals）时，naturals的类型将隐式地从chan int转换成chan&lt;- int。调用printer(squares)也会导致相似的隐式转换，这一次是转换为<code>&lt;-chan int</code>类型只接收型的channel。任何双向channel向单向channel变量的赋值操作都将导致该隐式转换</p><h3 id="8-4-4-带缓存的Channels"><a href="#8-4-4-带缓存的Channels" class="headerlink" title="8.4.4. 带缓存的Channels"></a>8.4.4. 带缓存的Channels</h3><p>向缓存Channel的发送操作就是向内部缓存队列的尾部插入元素，接收操作则是从队列的头部删除元素。如果内部缓存队列是满的，那么发送操作将阻塞直到因另一个goroutine执行接收操作而释放了新的队列空间。相反，如果channel是空的，接收操作将阻塞直到有另一个goroutine执行发送操作而向队列插入元素。</p><p>如果我们使用了无缓存的channel，那么两个慢的goroutines将会因为没有人接收而被永远卡住。这种情况，称为goroutines泄漏，这将是一个BUG。和垃圾变量不同，泄漏的goroutines并不会被自动回收，因此确保每个不再需要的goroutine能正常退出是重要的。</p><p>关于无缓存或带缓存channels之间的选择，或者是带缓存channels的容量大小的选择，都可能影响程序的正确性。无缓存channel更强地保证了每个发送操作与相应的同步接收操作；但是对于带缓存channel，这些操作是解耦的。同样，即使我们知道将要发送到一个channel的信息的数量上限，创建一个对应容量大小的带缓存channel也是不现实的，因为这要求在执行任何接收操作之前缓存所有已经发送的值。如果未能分配足够的缓存将导致程序死锁。</p><p>Channel的缓存也可能影响程序的性能。想象一家蛋糕店有三个厨师，一个烘焙，一个上糖衣，还有一个将每个蛋糕传递到它下一个厨师的生产线。在狭小的厨房空间环境，每个厨师在完成蛋糕后必须等待下一个厨师已经准备好接受它；这类似于在一个无缓存的channel上进行沟通。</p><p>如果在每个厨师之间有一个放置一个蛋糕的额外空间，那么每个厨师就可以将一个完成的蛋糕临时放在那里而马上进入下一个蛋糕的制作中；这类似于将channel的缓存队列的容量设置为1。只要每个厨师的平均工作效率相近，那么其中大部分的传输工作将是迅速的，个体之间细小的效率差异将在交接过程中弥补。如果厨师之间有更大的额外空间——也是就更大容量的缓存队列——将可以在不停止生产线的前提下消除更大的效率波动，例如一个厨师可以短暂地休息，然后再加快赶上进度而不影响其他人。</p><p>另一方面，如果生产线的前期阶段一直快于后续阶段，那么它们之间的缓存在大部分时间都将是满的。相反，如果后续阶段比前期阶段更快，那么它们之间的缓存在大部分时间都将是空的。对于这类场景，额外的缓存并没有带来任何好处。</p><p>生产线的隐喻对于理解channels和goroutines的工作机制是很有帮助的。<strong>例如，如果第二阶段是需要精心制作的复杂操作，一个厨师可能无法跟上第一个厨师的进度，或者是无法满足第三阶段厨师的需求。要解决这个问题，我们可以再雇佣另一个厨师来帮助完成第二阶段的工作，他执行相同的任务但是独立工作</strong>。这类似于基于相同的channels创建另一个独立的goroutine。</p><h2 id="8-9-并发的退出"><a href="#8-9-并发的退出" class="headerlink" title="8.9. 并发的退出"></a>8.9. 并发的退出</h2><p>Go语言并没有提供在一个goroutine中终止另一个goroutine的方法，由于这样会导致goroutine之间的共享变量落在未定义的状态上</p><p>为了能够达到我们退出goroutine的目的，我们需要更靠谱的策略，来通过一个channel把消息广播出去，这样goroutine们能够看到这条事件消息，并且在事件完成之后，可以知道这件事已经发生过了。</p><p>回忆一下我们关闭了一个channel并且被消费掉了所有已发送的值，操作channel之后的代码可以立即被执行，并且会产生零值。我们可以将这个机制扩展一下，来作为我们的广播机制：不要向channel发送值，而是用关闭一个channel来进行广播。</p><p>现在当取消发生时，所有后台的goroutine都会迅速停止并且主函数会返回。当然，当主函数返回时，一个程序会退出，而我们又无法在主函数退出的时候确认其已经释放了所有的资源(译注：因为程序都退出了，你的代码都没法执行了)。这里有一个方便的窍门我们可以一用：取代掉直接从主函数返回，我们调用一个panic，然后runtime会把每一个goroutine的栈dump下来。如果main goroutine是唯一一个剩下的goroutine的话，他会清理掉自己的一切资源。但是如果还有其它的goroutine没有退出，他们可能没办法被正确地取消掉，也有可能被取消但是取消操作会很花时间；所以这里的一个调研还是很有必要的。我们用panic来获取到足够的信息来验证我们上面的判断，看看最终到底是什么样的情况。</p><h1 id="第九章-基于共享变量的并发"><a href="#第九章-基于共享变量的并发" class="headerlink" title="第九章　基于共享变量的并发"></a>第九章　基于共享变量的并发</h1><h2 id="9-1-竞态条件"><a href="#9-1-竞态条件" class="headerlink" title="9.1 竞态条件"></a>9.1 竞态条件</h2><p>当我们没有办法自信地确认一个事件是在另一个事件的前面或者后面发生的话，就说明x和y这两个事件是并发的。</p><p>一个函数在并发调用时没法工作的原因太多了，比如死锁(deadlock)、活锁(livelock)和饿死(resource starvation)。我们没有空去讨论所有的问题，这里我们只聚焦在竞争条件上。</p><p>竞争条件指的是程序在多个goroutine交叉执行操作时，没有给出正确的结果。竞争条件是很恶劣的一种场景，因为这种问题会一直潜伏在你的程序里，然后在非常少见的时候蹦出来，或许只是会在很大的负载时才会发生，又或许是会在使用了某一个编译器、某一种平台或者某一种架构的时候才会出现。这些使得竞争条件带来的问题非常难以复现而且难以分析诊断。</p><h2 id="9-2-sync-Mutex互斥锁"><a href="#9-2-sync-Mutex互斥锁" class="headerlink" title="9.2. sync.Mutex互斥锁"></a>9.2. sync.Mutex互斥锁</h2><p>这种互斥很实用，而且被sync包里的Mutex类型直接支持。它的Lock方法能够获取到token(这里叫锁)，并且Unlock方法会释放这个token：</p><p><em>gopl.io/ch9/bank3</em></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;sync&quot;var (    mu      sync.Mutex &#x2F;&#x2F; guards balance    balance int)func Deposit(amount int) &#123;    mu.Lock()    balance &#x3D; balance + amount    mu.Unlock()&#125;func Balance() int &#123;    mu.Lock()    b :&#x3D; balance    mu.Unlock()    return b&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在更复杂的临界区的应用中，尤其是必须要尽早处理错误并返回的情况下，就很难去(靠人)判断对Lock和Unlock的调用是在所有路径中都能够严格配对的了。Go语言里的defer简直就是这种情况下的救星：我们用defer来调用Unlock，临界区会隐式地延伸到函数作用域的最后，这样我们就从“总要记得在函数返回之后或者发生错误返回时要记得调用一次Unlock”这种状态中获得了解放。Go会自动帮我们完成这些事情。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func Balance() int &#123;    mu.Lock()    defer mu.Unlock()    return balance&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此外，一个deferred Unlock即使在临界区发生panic时依然会执行，这对于用recover (§5.10)来恢复的程序来说是很重要的。defer调用只会比显式地调用Unlock成本高那么一点点，不过却在很大程度上保证了代码的整洁性。</p><p>理想情况下，取款应该只在整个操作中获得一次互斥锁。下面这样的尝试是错误的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; NOTE: incorrect!func Withdraw(amount int) bool &#123;    mu.Lock()    defer mu.Unlock()    Deposit(-amount)    if Balance() &lt; 0 &#123;        Deposit(amount)        return false &#x2F;&#x2F; insufficient funds    &#125;    return true&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面这个例子中，Deposit会调用mu.Lock()第二次去获取互斥锁，但因为mutex已经锁上了，而无法被重入(译注：go里没有重入锁，关于重入锁的概念，请参考java)—也就是说没法对一个已经锁上的mutex来再次上锁—这会导致程序死锁，没法继续执行下去，Withdraw会永远阻塞下去。</p><h2 id="9-3-sync-RWMutex读写锁"><a href="#9-3-sync-RWMutex读写锁" class="headerlink" title="9.3. sync.RWMutex读写锁"></a>9.3. sync.RWMutex读写锁</h2><p>由于Balance函数只需要读取变量的状态，所以我们同时让多个Balance调用并发运行事实上是安全的，只要在运行的时候没有存款或者取款操作就行。在这种场景下我们需要一种特殊类型的锁，其允许多个只读操作并行执行，但写操作会完全互斥。这种锁叫作“多读单写”锁(multiple readers, single writer lock)，Go语言提供的这样的锁是sync.RWMutex：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var mu sync.RWMutexvar balance intfunc Balance() int &#123;    mu.RLock() &#x2F;&#x2F; readers lock    defer mu.RUnlock()    return balance&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RLock只能在临界区共享变量没有任何写入操作时可用。一般来说，我们不应该假设逻辑上的只读函数/方法也不会去更新某一些变量。比如一个方法功能是访问一个变量，但它也有可能会同时去给一个内部的计数器+1(译注：可能是记录这个方法的访问次数啥的)，或者去更新缓存—使即时的调用能够更快。如果有疑惑的话，请使用互斥锁。</p><p>RWMutex只有当获得锁的大部分goroutine都是读操作，而锁在竞争条件下，也就是说，goroutine们必须等待才能获取到锁的时候，RWMutex才是最能带来好处的。RWMutex需要更复杂的内部记录，所以会让它比一般的无竞争锁的mutex慢一些</p><h2 id="9-4-内存同步"><a href="#9-4-内存同步" class="headerlink" title="9.4. 内存同步"></a>9.4. 内存同步</h2><p>你可能比较纠结为什么Balance方法需要用到互斥条件，无论是基于channel还是基于互斥量。毕竟和存款不一样，它只由一个简单的操作组成，所以不会碰到其它goroutine在其执行“期间”执行其它逻辑的风险。这里使用mutex有两方面考虑。第一Balance不会在其它操作比如Withdraw“中间”执行。第二（更重要的）是“同步”不仅仅是一堆goroutine执行顺序的问题，同样也会涉及到内存的问题。</p><p>在现代计算机中可能会有一堆处理器，每一个都会有其本地缓存(local cache)。为了效率，对内存的写入一般会在每一个处理器中缓冲，并在必要时一起flush到主存。这种情况下这些数据可能会以与当初goroutine写入顺序不同的顺序被提交到主存。像channel通信或者互斥量操作这样的原语会使处理器将其聚集的写入flush并commit，这样goroutine在某个时间点上的执行结果才能被其它处理器上运行的goroutine得到。</p><p>考虑一下下面代码片段的可能输出：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var x, y intgo func() &#123;    x &#x3D; 1 &#x2F;&#x2F; A1    fmt.Print(&quot;y:&quot;, y, &quot; &quot;) &#x2F;&#x2F; A2&#125;()go func() &#123;    y &#x3D; 1                   &#x2F;&#x2F; B1    fmt.Print(&quot;x:&quot;, x, &quot; &quot;) &#x2F;&#x2F; B2&#125;()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为两个goroutine是并发执行，并且访问共享变量时也没有互斥，会有数据竞争，所以程序的运行结果没法预测的话也请不要惊讶。我们可能希望它能够打印出下面这四种结果中的一种，相当于几种不同的交错执行时的情况：</p><pre class="line-numbers language-none"><code class="language-none">y:0 x:1x:0 y:1x:1 y:1y:1 x:1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>第四行可以被解释为执行顺序A1,B1,A2,B2或者B1,A1,A2,B2的执行结果。然而实际运行时还是有些情况让我们有点惊讶：</p><pre class="line-numbers language-none"><code class="language-none">x:0 y:0y:0 x:0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在一个独立的goroutine中，每一个语句的执行顺序是可以被保证的，也就是说goroutine内顺序是连贯的。但是在不使用channel且不使用mutex这样的显式同步操作时，我们就没法保证事件在不同的goroutine中看到的执行顺序是一致的了。尽管goroutine A中一定需要观察到x=1执行成功之后才会去读取y，但它没法确保自己观察得到goroutine B中对y的写入，所以A还可能会打印出y的一个旧版的值。</p><h2 id="9-5-sync-Once惰性初始化"><a href="#9-5-sync-Once惰性初始化" class="headerlink" title="9.5. sync.Once惰性初始化"></a>9.5. sync.Once惰性初始化</h2><p>回忆一下9.4节。因为缺少显式的同步，编译器和CPU是可以随意地去更改访问内存的指令顺序，以任意方式，只要保证每一个goroutine自己的执行顺序一致</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var mu sync.RWMutex &#x2F;&#x2F; guards iconsvar icons map[string]image.Image&#x2F;&#x2F; Concurrency-safe.func Icon(name string) image.Image &#123;    mu.RLock()    if icons !&#x3D; nil &#123;        icon :&#x3D; icons[name]        mu.RUnlock()        return icon    &#125;    mu.RUnlock()    &#x2F;&#x2F; acquire an exclusive lock    mu.Lock()    if icons &#x3D;&#x3D; nil &#123; &#x2F;&#x2F; NOTE: must recheck for nil        loadIcons()    &#125;    icon :&#x3D; icons[name]    mu.Unlock()    return icon&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码有两个临界区。goroutine首先会获取一个读锁，查询map，然后释放锁。如果条目被找到了(一般情况下)，那么会直接返回。如果没有找到，那goroutine会获取一个写锁。不释放共享锁的话，也没有任何办法来将一个共享锁升级为一个互斥锁，所以我们必须重新检查icons变量是否为nil，以防止在执行这一段代码的时候，icons变量已经被其它gorouine初始化过了。</p><p>上面的模板使我们的程序能够更好的并发，但是有一点太复杂且容易出错。幸运的是，sync包为我们提供了一个专门的方案来解决这种一次性初始化的问题：sync.Once。概念上来讲，一次性的初始化需要一个互斥量mutex和一个boolean变量来记录初始化是不是已经完成了；互斥量用来保护boolean变量和客户端数据结构。Do这个唯一的方法需要接收初始化函数作为其参数。让我们用sync.Once来简化前面的Icon函数吧：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">var loadIconsOnce sync.Oncevar icons map[string]image.Image&#x2F;&#x2F; Concurrency-safe.func Icon(name string) image.Image &#123;    loadIconsOnce.Do(loadIcons)    return icons[name]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每一次对Do(loadIcons)的调用都会锁定mutex，并会检查boolean变量(译注：Go1.9中会先判断boolean变量是否为1(true)，只有不为1才锁定mutex，不再需要每次都锁定mutex)。在第一次调用时，boolean变量的值是false，Do会调用loadIcons并会将boolean变量设置为true。随后的调用什么都不会做，但是mutex同步会保证loadIcons对内存(这里其实就是指icons变量啦)产生的效果能够对所有goroutine可见。用这种方式来使用sync.Once的话，我们能够避免在变量被构建完成之前和其它goroutine共享该变量。</p><h2 id="9-6-竞争条件检测"><a href="#9-6-竞争条件检测" class="headerlink" title="9.6. 竞争条件检测"></a>9.6. 竞争条件检测</h2><p>只要在go build，go run或者go test命令后面加上-race的flag，就会使编译器创建一个你的应用的“修改”版或者一个附带了能够记录所有运行期对共享变量访问工具的test，并且会记录下每一个读或者写共享变量的goroutine的身份信息。另外，修改版的程序会记录下所有的同步事件，比如go语句，channel操作，以及对<code>(*sync.Mutex).Lock</code>，<code>(*sync.WaitGroup).Wait</code>等等的调用。(完整的同步事件集合是在The Go Memory Model文档中有说明，该文档是和语言文档放在一起的</p><p>竞争检查器会检查这些事件，会寻找在哪一个goroutine中出现了这样的case，例如其读或者写了一个共享变量，这个共享变量是被另一个goroutine在没有进行干预同步操作便直接写入的。这种情况也就表明了是对一个共享变量的并发访问，即数据竞争。这个工具会打印一份报告，内容包含变量身份，读取和写入的goroutine中活跃的函数的调用栈。这些信息在定位问题时通常很有用。</p><p>竞争检查器会报告所有的已经发生的数据竞争。然而，它只能检测到运行时的竞争条件；并不能证明之后不会发生数据竞争。所以为了使结果尽量正确，请保证你的测试并发地覆盖到了你的包。</p><p>由于需要额外的记录，因此构建时加了竞争检测的程序跑起来会慢一些，且需要更大的内存，即使是这样，这些代价对于很多生产环境的工作来说还是可以接受的。对于一些偶发的竞争条件来说，让竞争检查器来干活可以节省无数日夜的debugging。(译注：多少服务端C和C++程序员为此竞折腰)</p><h2 id="9-8-Goroutines和线程"><a href="#9-8-Goroutines和线程" class="headerlink" title="9.8. Goroutines和线程"></a>9.8. Goroutines和线程</h2><h3 id="9-8-1-动态栈"><a href="#9-8-1-动态栈" class="headerlink" title="9.8.1. 动态栈"></a>9.8.1. 动态栈</h3><p>每一个OS线程都有一个固定大小的内存块(一般会是2MB)来做栈，这个栈会用来存储当前正在被调用或挂起(指在调用其它函数时)的函数的内部变量。这个固定大小的栈同时很大又很小。因为2MB的栈对于一个小小的goroutine来说是很大的内存浪费，比如对于我们用到的，一个只是用来WaitGroup之后关闭channel的goroutine来说。而对于go程序来说，同时创建成百上千个goroutine是非常普遍的，如果每一个goroutine都需要这么大的栈的话，那这么多的goroutine就不太可能了。除去大小的问题之外，固定大小的栈对于更复杂或者更深层次的递归函数调用来说显然是不够的。修改固定的大小可以提升空间的利用率，允许创建更多的线程，并且可以允许更深的递归调用，不过这两者是没法同时兼备的。</p><p>相反，一个goroutine会以一个很小的栈开始其生命周期，一般只需要2KB。一个goroutine的栈，和操作系统线程一样，会保存其活跃或挂起的函数调用的本地变量，但是和OS线程不太一样的是，一个goroutine的栈大小并不是固定的；栈的大小会根据需要动态地伸缩。而goroutine的栈的最大值有1GB，比传统的固定大小的线程栈要大得多，尽管一般情况下，大多goroutine都不需要这么大的栈。</p><h3 id="9-8-2-Goroutine调度"><a href="#9-8-2-Goroutine调度" class="headerlink" title="9.8.2. Goroutine调度"></a>9.8.2. Goroutine调度</h3><p>OS线程会被操作系统内核调度。每几毫秒，一个硬件计时器会中断处理器，这会调用一个叫作scheduler的内核函数。这个函数会挂起当前执行的线程并将它的寄存器内容保存到内存中，检查线程列表并决定下一次哪个线程可以被运行，并从内存中恢复该线程的寄存器信息，然后恢复执行该线程的现场并开始执行线程。因为操作系统线程是被内核所调度，所以从一个线程向另一个“移动”需要完整的上下文切换，也就是说，保存一个用户线程的状态到内存，恢复另一个线程的到寄存器，然后更新调度器的数据结构。这几步操作很慢，因为其局部性很差需要几次内存访问，并且会增加运行的cpu周期。</p><p>Go的运行时包含了其自己的调度器，这个调度器使用了一些技术手段，比如m:n调度，因为其会在n个操作系统线程上多工(调度)m个goroutine。Go调度器的工作和内核的调度是相似的，但是这个调度器只关注单独的Go程序中的goroutine（译注：按程序独立）。</p><p>和操作系统的线程调度不同的是，Go调度器并不是用一个硬件定时器，而是被Go语言“建筑”本身进行调度的。例如当一个goroutine调用了time.Sleep，或者被channel调用或者mutex操作阻塞时，调度器会使其进入休眠并开始执行另一个goroutine，直到时机到了再去唤醒第一个goroutine。因为这种调度方式不需要进入内核的上下文，所以重新调度一个goroutine比调度一个线程代价要低得多。</p><h3 id="9-8-3-GOMAXPROCS"><a href="#9-8-3-GOMAXPROCS" class="headerlink" title="9.8.3. GOMAXPROCS"></a>9.8.3. GOMAXPROCS</h3><p>Go的调度器使用了一个叫做GOMAXPROCS的变量来决定会有多少个操作系统的线程同时执行Go的代码。其默认的值是运行机器上的CPU的核心数，所以在一个有8个核心的机器上时，调度器一次会在8个OS线程上去调度GO代码。(GOMAXPROCS是前面说的m:n调度中的n)。在休眠中的或者在通信中被阻塞的goroutine是不需要一个对应的线程来做调度的。在I/O中或系统调用中或调用非Go语言函数时，是需要一个对应的操作系统线程的，但是GOMAXPROCS并不需要将这几种情况计算在内。 </p><h3 id="9-8-4-Goroutine没有ID号"><a href="#9-8-4-Goroutine没有ID号" class="headerlink" title="9.8.4. Goroutine没有ID号"></a>9.8.4. Goroutine没有ID号</h3><p>goroutine没有可以被程序员获取到的身份(id)的概念。这一点是设计上故意而为之，由于thread-local storage总是会被滥用。比如说，一个web server是用一种支持tls的语言实现的，而非常普遍的是很多函数会去寻找HTTP请求的信息，这代表它们就是去其存储层(这个存储层有可能是tls)查找的。这就像是那些过分依赖全局变量的程序一样，会导致一种非健康的“距离外行为”，在这种行为下，一个函数的行为可能并不仅由自己的参数所决定，而是由其所运行在的线程所决定。因此，如果线程本身的身份会改变——比如一些worker线程之类的——那么函数的行为就会变得神秘莫测。</p><p>Go鼓励更为简单的模式，这种模式下参数(译注：外部显式参数和内部显式参数。tls 中的内容算是”外部”隐式参数)对函数的影响都是显式的。这样不仅使程序变得更易读，而且会让我们自由地向一些给定的函数分配子任务时不用担心其身份信息影响行为。</p><h1 id="10-包"><a href="#10-包" class="headerlink" title="10 包"></a>10 包</h1><h2 id="10-1-包简介"><a href="#10-1-包简介" class="headerlink" title="10.1 包简介"></a>10.1 包简介</h2><p>Go语言的闪电般的编译速度主要得益于三个语言特性。第一点，所有导入的包必须在每个文件的开头显式声明，这样的话编译器就没有必要读取和分析整个源文件来判断包的依赖关系。第二点，禁止包的环状依赖，因为没有循环依赖，包的依赖关系形成一个有向无环图，每个包可以被独立编译，而且很可能是被并发编译。第三点，编译后包的目标文件不仅仅记录包本身的导出信息，目标文件同时还记录了包的依赖关系。因此，在编译一个包的时候，编译器只需要读取每个直接导入包的目标文件，而不需要遍历所有依赖的的文件（译注：很多都是重复的间接依赖）。</p><h2 id="10-2-导入路径"><a href="#10-2-导入路径" class="headerlink" title="10.2. 导入路径"></a>10.2. 导入路径</h2><p>如果你计划分享或发布包，那么导入路径最好是全球唯一的。为了避免冲突，所有非标准库包的导入路径建议以所在组织的互联网域名为前缀；而且这样也有利于包的检索。</p><h2 id="10-3-包声明"><a href="#10-3-包声明" class="headerlink" title="10.3. 包声明"></a>10.3. 包声明</h2><p>例如，math/rand包的每个源文件的开头都包含<code>package rand</code>包声明语句，所以当你导入这个包，你就可以用rand.Int、rand.Float64类似的方式访问包的成员。</p><p>通常来说，默认的包名就是包导入路径名的最后一段，因此即使两个包的导入路径不同，它们依然可能有一个相同的包名。例如，math/rand包和crypto/rand包的包名都是rand。 </p><p>关于默认包名一般采用导入路径名的最后一段的约定也有三种例外情况。第一个例外，包对应一个可执行程序，也就是main包，这时候main包本身的导入路径是无关紧要的。名字为main的包是给go build（§10.7.3）构建命令一个信息，这个包编译完之后必须调用连接器生成一个可执行程序。</p><p>第二个例外，包所在的目录中可能有一些文件名是以<code>_test.go</code>为后缀的Go源文件（译注：前面必须有其它的字符，因为以<code>_</code>或<code>.</code>开头的源文件会被构建工具忽略），并且这些源文件声明的包名也是以<code>_test</code>为后缀名的。这种目录可以包含两种包：一种是普通包，另一种则是测试的外部扩展包。所有以<code>_test</code>为后缀包名的测试外部扩展包都由go test命令独立编译，普通包和测试的外部扩展包是相互独立的。测试的外部扩展包一般用来避免测试代码中的循环导入依赖，具体细节我们将在11.2.4节中介绍。</p><p>第三个例外，一些依赖版本号的管理工具会在导入路径后追加版本号信息，例如”gopkg.in/yaml.v2”。这种情况下包的名字并不包含版本号后缀，而是yaml。</p><h2 id="10-4-导入声明"><a href="#10-4-导入声明" class="headerlink" title="10.4. 导入声明"></a>10.4. 导入声明</h2><p>如果我们想同时导入两个有着名字相同的包，例如math/rand包和crypto/rand包，那么导入声明必须至少为一个同名包指定一个新的包名以避免冲突。这叫做导入包的重命名。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;crypto&#x2F;rand&quot;    mrand &quot;math&#x2F;rand&quot; &#x2F;&#x2F; alternative name mrand avoids conflict)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>导入包的重命名只影响当前的源文件。其它的源文件如果导入了相同的包，可以用导入包原本默认的名字或重命名为另一个完全不同的名字。它不仅仅只是为了解决名字冲突。如果导入的一个包名很笨重，特别是在一些自动生成的代码中，这时候用一个简短名称会更方便</p><p>每个导入声明语句都明确指定了当前包和被导入包之间的依赖关系。如果遇到包循环导入的情况，Go语言的构建工具将报告错误。</p><h2 id="10-5-包的匿名导入"><a href="#10-5-包的匿名导入" class="headerlink" title="10.5. 包的匿名导入"></a>10.5. 包的匿名导入</h2><p>如果只是导入一个包而并不使用导入的包将会导致一个编译错误。但是有时候我们只是想利用导入包而产生的副作用：它会计算包级变量的初始化表达式和执行导入包的init初始化函数（§2.6.2）。这时候我们需要抑制“unused import”编译错误，我们可以用下划线<code>_</code>来重命名导入的包。像往常一样，下划线<code>_</code>为空白标识符，并不能被访问。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import _ &quot;image&#x2F;png&quot; &#x2F;&#x2F; register PNG decoder<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个被称为包的匿名导入。它通常是用来实现一个编译时机制，然后通过在main主程序入口选择性地导入附加的包。</p><p>数据库包database/sql也是采用了类似的技术，让用户可以根据自己需要选择导入必要的数据库驱动。例如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;database&#x2F;sql&quot;    _ &quot;github.com&#x2F;lib&#x2F;pq&quot;              &#x2F;&#x2F; enable support for Postgres    _ &quot;github.com&#x2F;go-sql-driver&#x2F;mysql&quot; &#x2F;&#x2F; enable support for MySQL)db, err &#x3D; sql.Open(&quot;postgres&quot;, dbname) &#x2F;&#x2F; OKdb, err &#x3D; sql.Open(&quot;mysql&quot;, dbname)    &#x2F;&#x2F; OKdb, err &#x3D; sql.Open(&quot;sqlite3&quot;, dbname)  &#x2F;&#x2F; returns error: unknown driver &quot;sqlite3&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="10-6-包和命名"><a href="#10-6-包和命名" class="headerlink" title="10.6. 包和命名"></a>10.6. 包和命名</h2><p>当创建一个包，一般要用短小的包名，但也不能太短导致难以理解。</p><p>要尽量避免包名使用可能被经常用于局部变量的名字，这样可能导致用户重命名导入包，</p><p>包名一般采用单数的形式。标准库的bytes、errors和strings使用了复数形式，这是为了避免和预定义的类型冲突，同样还有go/types是为了避免和type关键字冲突。</p><h2 id="10-7-工具"><a href="#10-7-工具" class="headerlink" title="10.7. 工具"></a>10.7. 工具</h2><h3 id="10-7-1-工作区结构"><a href="#10-7-1-工作区结构" class="headerlink" title="10.7.1. 工作区结构"></a>10.7.1. 工作区结构</h3><p>对于大多数的Go语言用户，只需要配置一个名叫GOPATH的环境变量，用来指定当前工作目录即可。当需要切换到不同工作区的时候，只要更新GOPATH就可以了</p><p>第二个环境变量GOROOT用来指定Go的安装目录，还有它自带的标准库包的位置。GOROOT的目录结构和GOPATH类似，因此存放fmt包的源代码对应目录应该为$GOROOT/src/fmt。用户一般不需要设置GOROOT，默认情况下Go语言安装工具会将其设置为安装的目录路径</p><h3 id="10-7-2-下载包"><a href="#10-7-2-下载包" class="headerlink" title="10.7.2. 下载包"></a>10.7.2. 下载包</h3><p>使用命令<code>go get</code>可以下载一个单一的包或者用<code>...</code>下载整个子目录里面的每个包。Go语言工具箱的go命令同时计算并下载所依赖的每个包，这也是前一个例子中golang.org/x/net/html自动出现在本地工作区目录的原因。</p><p><code>go get</code>命令支持当前流行的托管网站GitHub、Bitbucket和Launchpad，可以直接向它们的版本控制系统请求代码。对于其它的网站，你可能需要指定版本控制系统的具体路径和协议，例如 Git或Mercurial。运行<code>go help importpath</code>获取相关的信息。</p><p><code>go get</code>命令获取的代码是真实的本地存储仓库，而不仅仅只是复制源文件，因此你依然可以使用版本管理工具比较本地代码的变更或者切换到其它的版本。例如golang.org/x/net包目录对应一个Git仓库：</p><pre class="line-numbers language-none"><code class="language-none">$ cd $GOPATH&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;net$ git remote -vorigin  https:&#x2F;&#x2F;go.googlesource.com&#x2F;net (fetch)origin  https:&#x2F;&#x2F;go.googlesource.com&#x2F;net (push)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意的是导入路径含有的网站域名和本地Git仓库对应远程服务地址并不相同，真实的Git地址是go.googlesource.com。这其实是Go语言工具的一个特性，可以让包用一个自定义的导入路径，但是真实的代码却是由更通用的服务提供，例如googlesource.com或github.com。因为页面 <a href="https://golang.org/x/net/html">https://golang.org/x/net/html</a> 包含了如下的元数据，它告诉Go语言的工具当前包真实的Git仓库托管地址：</p><pre class="line-numbers language-none"><code class="language-none">$ go build gopl.io&#x2F;ch1&#x2F;fetch$ .&#x2F;fetch https:&#x2F;&#x2F;golang.org&#x2F;x&#x2F;net&#x2F;html | grep go-import&lt;meta name&#x3D;&quot;go-import&quot;      content&#x3D;&quot;golang.org&#x2F;x&#x2F;net git https:&#x2F;&#x2F;go.googlesource.com&#x2F;net&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果指定<code>-u</code>命令行标志参数，<code>go get</code>命令将确保所有的包和依赖的包的版本都是最新的，然后重新编译和安装它们。如果不包含该标志参数的话，而且如果包已经在本地存在，那么代码将不会被自动更新。</p><p><code>go get -u</code>命令只是简单地保证每个包是最新版本，如果是第一次下载包则是比较方便的；但是对于发布程序则可能是不合适的，因为本地程序可能需要对依赖的包做精确的版本依赖管理。通常的解决方案是使用vendor的目录用于存储依赖包的固定版本的源代码，对本地依赖的包的版本更新也是谨慎和持续可控的。在Go1.5之前，一般需要修改包的导入路径，所以复制后golang.org/x/net/html导入路径可能会变为gopl.io/vendor/golang.org/x/net/html。最新的Go语言命令已经支持vendor特性，但限于篇幅这里并不讨论vendor的具体细节。</p><h3 id="10-7-3-构建包"><a href="#10-7-3-构建包" class="headerlink" title="10.7.3. 构建包"></a>10.7.3. 构建包</h3><p><code>go build</code>命令编译命令行参数指定的每个包。</p><h3 id="10-7-4-包文档"><a href="#10-7-4-包文档" class="headerlink" title="10.7.4. 包文档"></a>10.7.4. 包文档</h3><p>Go语言的编码风格鼓励为每个包提供良好的文档。包中每个导出的成员和包声明前都应该包含目的和用法说明的注释。</p><p>Go语言中的文档注释一般是完整的句子，第一行通常是摘要说明，以被注释者的名字开头。注释中函数的参数或其它的标识符并不需要额外的引号或其它标记注明。例如，下面是fmt.Fprintf的文档注释。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">&#x2F;&#x2F; Fprintf formats according to a format specifier and writes to w.&#x2F;&#x2F; It returns the number of bytes written and any write error encountered.func Fprintf(w io.Writer, format string, a ...interface&#123;&#125;) (int, error)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Fprintf函数格式化的细节在fmt包文档中描述。如果注释后紧跟着包声明语句，那注释对应整个包的文档。包文档对应的注释只能有一个（译注：其实可以有多个，它们会组合成一个包文档注释），包注释可以出现在任何一个源文件中。如果包的注释内容比较长，一般会放到一个独立的源文件中；fmt包注释就有300行之多。这个专门用于保存包文档的源文件通常叫doc.go。</p><h3 id="10-7-5-内部包"><a href="#10-7-5-内部包" class="headerlink" title="10.7.5. 内部包"></a>10.7.5. 内部包</h3><p>为了满足这些需求，Go语言的构建工具对包含internal名字的路径段的包导入路径做了特殊处理。这种包叫internal包，一个internal包只能被和internal目录有同一个父目录的包所导入。例如，net/http/internal/chunked内部包只能被net/http/httputil或net/http包导入，但是不能被net/url包导入。不过net/url包却可以导入net/http/httputil包。</p><pre class="line-numbers language-none"><code class="language-none">net&#x2F;httpnet&#x2F;http&#x2F;internal&#x2F;chunkednet&#x2F;http&#x2F;httputilnet&#x2F;url<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-7-6-查询包"><a href="#10-7-6-查询包" class="headerlink" title="10.7.6. 查询包"></a>10.7.6. 查询包</h3><p><code>go list</code>命令可以查询可用包的信息。其最简单的形式，可以测试包是否在工作区并打印它的导入路径</p><h1 id="第十一章-测试"><a href="#第十一章-测试" class="headerlink" title="第十一章　测试"></a>第十一章　测试</h1><p>现在的程序已经远比Wilkes时代的更大也更复杂，也有许多技术可以让软件的复杂性可得到控制。其中有两种技术在实践中证明是比较有效的。第一种是代码在被正式部署前需要进行代码评审。第二种则是测试</p><p>我们说测试的时候一般是指自动化测试，也就是写一些小的程序用来检测被测试代码（产品代码）的行为和预期的一样，这些通常都是精心设计的执行某些特定的功能或者是通过随机性的输入待验证边界的处理。</p><p>Go语言的测试技术是相对低级的。它依赖一个go test测试命令和一组按照约定方式编写的测试函数，测试命令可以运行这些测试函数。编写相对轻量级的纯测试代码是有效的，而且它很容易延伸到基准测试和示例文档。</p><p>在实践中，编写测试代码和编写程序本身并没有多大区别。我们编写的每一个函数也是针对每个具体的任务。我们必须小心处理边界条件，思考合适的数据结构，推断合适的输入应该产生什么样的结果输出。编写测试代码和编写普通的Go代码过程是类似的；它并不需要学习新的符号、规则和工具。</p><h2 id="11-1-go-test"><a href="#11-1-go-test" class="headerlink" title="11.1 go test"></a>11.1 go test</h2><p>go test命令是一个按照一定的约定和组织来测试代码的程序。在包目录内，所有以<code>_test.go</code>为后缀名的源文件在执行go build时不会被构建成包的一部分，它们是go test测试的一部分。</p><p>在<code>*_test.go</code>文件中，有三种类型的函数：测试函数、基准测试(benchmark)函数、示例函数。一个测试函数是以Test为函数名前缀的函数，用于测试程序的一些逻辑行为是否正确；go test命令会调用这些测试函数并报告测试结果是PASS或FAIL。基准测试函数是以Benchmark为函数名前缀的函数，它们用于衡量一些函数的性能；go test命令会多次运行基准测试函数以计算一个平均的执行时间。示例函数是以Example为函数名前缀的函数，提供一个由编译器保证正确性的示例文档。</p><p>go test命令会遍历所有的<code>*_test.go</code>文件中符合上述命名规则的函数，生成一个临时的main包用于调用相应的测试函数，接着构建并运行、报告测试结果，最后清理测试中生成的临时文件。</p><h2 id="11-2-测试函数"><a href="#11-2-测试函数" class="headerlink" title="11.2 测试函数"></a>11.2 测试函数</h2><p>每个测试函数必须导入testing包。测试函数有如下的签名：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func TestName(t *testing.T) &#123;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>测试函数的名字必须以Test开头，可选的后缀名必须以大写字母开头，其中t参数用于报告测试失败和附加的日志信息</p><p>先编写测试用例并观察到测试用例触发了和用户报告的错误相同的描述是一个好的测试习惯。只有这样，我们才能定位我们要真正解决的问题。</p><p>先写测试用例的另外的好处是，运行测试通常会比手工描述报告的处理更快，这让我们可以进行快速地迭代。如果测试集有很多运行缓慢的测试，我们可以通过只选择运行某些特定的测试来加快测试速度。</p><p>参数<code>-v</code>可用于打印每个测试函数的名字和运行时间：</p><pre class="line-numbers language-none"><code class="language-none">$ go test -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参数<code>-run</code>对应一个正则表达式，只有测试函数名被它正确匹配的测试函数才会被<code>go test</code>测试命令运行：</p><pre class="line-numbers language-none"><code class="language-none">$ go test -v -run&#x3D;&quot;French|Canal&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然，一旦我们已经修复了失败的测试用例，在我们提交代码更新之前，我们应该以不带参数的<code>go test</code>命令运行全部的测试用例，以确保修复失败测试的同时没有引入新的问题。</p><p>失败测试的输出并不包括调用t.Errorf时刻的堆栈调用信息。和其他编程语言或测试框架的assert断言不同，t.Errorf调用也没有引起panic异常或停止测试的执行。即使表格中前面的数据导致了测试的失败，表格后面的测试数据依然会运行测试，因此在一个测试中我们可能了解多个失败的信息。</p><p>如果我们真的需要停止测试，或许是因为初始化失败或可能是早先的错误导致了后续错误等原因，我们可以使用t.Fatal或t.Fatalf停止当前测试函数。它们必须在和测试函数同一个goroutine内调用。</p><h3 id="11-2-1-随机测试"><a href="#11-2-1-随机测试" class="headerlink" title="11.2.1. 随机测试"></a>11.2.1. 随机测试</h3><p>表格驱动的测试便于构造基于精心挑选的测试数据的测试用例。另一种测试思路是随机测试，也就是通过构造更广泛的随机输入来测试探索函数的行为。</p><p>那么对于一个随机的输入，我们如何能知道希望的输出结果呢？这里有两种处理策略。第一个是编写另一个对照函数，使用简单和清晰的算法，虽然效率较低但是行为和要测试的函数是一致的，然后针对相同的随机输入检查两者的输出结果。第二种是生成的随机输入的数据遵循特定的模式，这样我们就可以知道期望的输出的模式。</p><p>下面的例子使用的是第二种方法：randomPalindrome函数用于随机生成回文字符串。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;math&#x2F;rand&quot;&#x2F;&#x2F; randomPalindrome returns a palindrome whose length and contents&#x2F;&#x2F; are derived from the pseudo-random number generator rng.func randomPalindrome(rng *rand.Rand) string &#123;    n :&#x3D; rng.Intn(25) &#x2F;&#x2F; random length up to 24    runes :&#x3D; make([]rune, n)    for i :&#x3D; 0; i &lt; (n+1)&#x2F;2; i++ &#123;        r :&#x3D; rune(rng.Intn(0x1000)) &#x2F;&#x2F; random rune up to &#39;\u0999&#39;        runes[i] &#x3D; r        runes[n-1-i] &#x3D; r    &#125;    return string(runes)&#125;func TestRandomPalindromes(t *testing.T) &#123;    &#x2F;&#x2F; Initialize a pseudo-random number generator.    seed :&#x3D; time.Now().UTC().UnixNano()    t.Logf(&quot;Random seed: %d&quot;, seed)    rng :&#x3D; rand.New(rand.NewSource(seed))    for i :&#x3D; 0; i &lt; 1000; i++ &#123;        p :&#x3D; randomPalindrome(rng)        if !IsPalindrome(p) &#123;            t.Errorf(&quot;IsPalindrome(%q) &#x3D; false&quot;, p)        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然随机测试会有不确定因素，但是它也是至关重要的，我们可以从失败测试的日志获取足够的信息。在我们的例子中，输入IsPalindrome的p参数将告诉我们真实的数据，但是对于函数将接受更复杂的输入，不需要保存所有的输入，只要日志中简单地记录随机数种子即可（像上面的方式）。有了这些随机数初始化种子，我们可以很容易修改测试代码以重现失败的随机测试。</p><p>通过使用当前时间作为随机种子，在整个过程中的每次运行测试命令时都将探索新的随机数据。如果你使用的是定期运行的自动化测试集成系统，随机测试将特别有价值。</p><h3 id="11-2-2-测试一个命令"><a href="#11-2-2-测试一个命令" class="headerlink" title="11.2.2. 测试一个命令"></a>11.2.2. 测试一个命令</h3><p>要注意的是在测试代码中并没有调用log.Fatal或os.Exit，因为调用这类函数会导致程序提前退出；调用这些函数的特权应该放在main函数中。如果真的有意外的事情导致函数发生panic异常，测试驱动应该尝试用recover捕获异常，然后将当前测试当作失败处理。如果是可预期的错误，例如非法的用户输入、找不到文件或配置文件不当等应该通过返回一个非空的error的方式处理。</p><h3 id="11-2-3-白盒测试"><a href="#11-2-3-白盒测试" class="headerlink" title="11.2.3. 白盒测试"></a>11.2.3. 白盒测试</h3><p>一种测试分类的方法是基于测试者是否需要了解被测试对象的内部工作原理。黑盒测试只需要测试包公开的文档和API行为，内部实现对测试代码是透明的。相反，白盒测试有访问包内部函数和数据结构的权限，因此可以做到一些普通客户端无法实现的测试。</p><p>例如，一个白盒测试可以在每个操作之后检测不变量的数据类型。（<strong>白盒测试只是一个传统的名称，其实称为clear box测试会更准确。</strong>）</p><p>黑盒和白盒这两种测试方法是互补的。黑盒测试一般更健壮，随着软件实现的完善测试代码很少需要更新。它们可以帮助测试者了解真实客户的需求，也可以帮助发现API设计的一些不足之处。相反，白盒测试则可以对内部一些棘手的实现提供更多的测试覆盖。</p><h3 id="11-2-4-外部测试包"><a href="#11-2-4-外部测试包" class="headerlink" title="11.2.4. 外部测试包"></a>11.2.4. 外部测试包</h3><p>我们可以通过外部测试包的方式解决循环依赖的问题，也就是在net/url包所在的目录声明一个独立的url_test测试包。其中包名的<code>_test</code>后缀告诉go test工具它应该建立一个额外的包来运行测试。我们将这个外部测试包的导入路径视作是net/url_test会更容易理解，但实际上它并不能被其他任何包导入。</p><p>因为外部测试包是一个独立的包，所以能够导入那些<code>依赖待测代码本身</code>的其他辅助包；包内的测试代码就无法做到这点。在设计层面，外部测试包是在所有它依赖的包的上层，正如图11.2所示。</p><p><img src="https://docs.hacknode.org/gopl-zh/images/ch11-02.png" alt="img"></p><p>通过避免循环的导入依赖，外部测试包可以更灵活地编写测试，特别是集成测试（需要测试多个组件之间的交互），可以像普通应用程序那样自由地导入其他包。</p><h3 id="11-2-5-编写有效的测试"><a href="#11-2-5-编写有效的测试" class="headerlink" title="11.2.5. 编写有效的测试"></a>11.2.5. 编写有效的测试</h3><p>许多Go语言新人会惊异于Go语言极简的测试框架。很多其它语言的测试框架都提供了识别测试函数的机制（通常使用反射或元数据），通过设置一些“setup”和“teardown”的钩子函数来执行测试用例运行的初始化和之后的清理操作，同时测试工具箱还提供了很多类似assert断言、值比较函数、格式化输出错误信息和停止一个失败的测试等辅助函数（通常使用异常机制）。虽然这些机制可以使得测试非常简洁，但是测试输出的日志却会像火星文一般难以理解。此外，虽然测试最终也会输出PASS或FAIL的报告，但是它们提供的信息格式却非常不利于代码维护者快速定位问题，因为失败信息的具体含义非常隐晦，比如“assert: 0 == 1”或成页的海量跟踪日志。</p><p>Go语言的测试风格则形成鲜明对比。它期望测试者自己完成大部分的工作，定义函数避免重复，就像普通编程那样。编写测试并不是一个机械的填空过程；一个测试也有自己的接口，尽管它的维护者也是测试仅有的一个用户。一个好的测试不应该引发其他无关的错误信息，它只要清晰简洁地描述问题的症状即可，有时候可能还需要一些上下文信息。在理想情况下，维护者可以在不看代码的情况下就能根据错误信息定位错误产生的原因。一个好的测试不应该在遇到一点小错误时就立刻退出测试，它应该尝试报告更多的相关的错误信息，因为我们可能从多个失败测试的模式中发现错误产生的规律。</p><p>下面的断言函数比较两个值，然后生成一个通用的错误信息，并停止程序。它很好用也确实有效，但是当测试失败的时候，打印的错误信息却几乎是没有价值的。它并没有为快速解决问题提供一个很好的入口。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import (    &quot;fmt&quot;    &quot;strings&quot;    &quot;testing&quot;)&#x2F;&#x2F; A poor assertion function.func assertEqual(x, y int) &#123;    if x !&#x3D; y &#123;        panic(fmt.Sprintf(&quot;%d !&#x3D; %d&quot;, x, y))    &#125;&#125;func TestSplit(t *testing.T) &#123;    words :&#x3D; strings.Split(&quot;a:b:c&quot;, &quot;:&quot;)    assertEqual(len(words), 3)    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从这个意义上说，断言函数犯了过早抽象的错误：仅仅测试两个整数是否相同，而没能根据上下文提供更有意义的错误信息。我们可以根据具体的错误打印一个更有价值的错误信息，就像下面例子那样。只有在测试中出现重复模式时才采用抽象。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func TestSplit(t *testing.T) &#123;    s, sep :&#x3D; &quot;a:b:c&quot;, &quot;:&quot;    words :&#x3D; strings.Split(s, sep)    if got, want :&#x3D; len(words), 3; got !&#x3D; want &#123;        t.Errorf(&quot;Split(%q, %q) returned %d words, want %d&quot;,            s, sep, got, want)    &#125;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在的测试不仅报告了调用的具体函数、它的输入和结果的意义；并且打印的真实返回的值和期望返回的值；并且即使断言失败依然会继续尝试运行更多的测试。一旦我们写了这样结构的测试，下一步自然不是用更多的if语句来扩展测试用例，我们可以用像IsPalindrome的表驱动测试那样来准备更多的s和sep测试用例。</p><h3 id="11-2-6-避免脆弱的测试"><a href="#11-2-6-避免脆弱的测试" class="headerlink" title="11.2.6. 避免脆弱的测试"></a>11.2.6. 避免脆弱的测试</h3><p>避免脆弱测试代码的方法是只检测你真正关心的属性。保持测试代码的简洁和内部结构的稳定。特别是对断言部分要有所选择。不要对字符串进行全字匹配，而是针对那些在项目的发展中是比较稳定不变的子串。很多时候值得花力气来编写一个从复杂输出中提取用于断言的必要信息的函数，虽然这可能会带来很多前期的工作，但是它可以帮助迅速及时修复因为项目演化而导致的不合逻辑的失败测试。</p><h2 id="11-3-测试覆盖率"><a href="#11-3-测试覆盖率" class="headerlink" title="11.3. 测试覆盖率"></a>11.3. 测试覆盖率</h2><p>就其性质而言，测试不可能是完整的</p><p>对待测程序执行的测试的程度称为测试的覆盖率。测试覆盖率并不能量化——即使最简单的程序的动态也是难以精确测量的——但是有启发式方法来帮助我们编写有效的测试代码。</p><p>这些启发式方法中，语句的覆盖率是最简单和最广泛使用的。语句的覆盖率是指在测试中至少被运行一次的代码占总代码数的比例。</p><p>首先，我们要确保所有的测试都正常通过：</p><pre class="line-numbers language-none"><code class="language-none">$ go test -v -run&#x3D;Coverage gopl.io&#x2F;ch7&#x2F;eval&#x3D;&#x3D;&#x3D; RUN TestCoverage--- PASS: TestCoverage (0.00s)PASSok      gopl.io&#x2F;ch7&#x2F;eval         0.011s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面这个命令可以显示测试覆盖率工具的使用用法：</p><pre class="line-numbers language-none"><code class="language-none">$ go tool coverUsage of &#39;go tool cover&#39;:Given a coverage profile produced by &#39;go test&#39;:    go test -coverprofile&#x3D;c.outOpen a web browser displaying annotated source code:    go tool cover -html&#x3D;c.out...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>go tool</code>命令运行Go工具链的底层可执行程序。这些底层可执行程序放在$GOROOT/pkg/tool/${GOOS}_${GOARCH}目录。因为有<code>go build</code>命令的原因，我们很少直接调用这些底层工具。</p><p>现在我们可以用<code>-coverprofile</code>标志参数重新运行测试：</p><pre class="line-numbers language-none"><code class="language-none">$ go test -run&#x3D;Coverage -coverprofile&#x3D;c.out gopl.io&#x2F;ch7&#x2F;evalok      gopl.io&#x2F;ch7&#x2F;eval         0.032s      coverage: 68.5% of statements<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这个标志参数通过在测试代码中插入生成钩子来统计覆盖率数据。也就是说，在运行每个测试前，它将待测代码拷贝一份并做修改，在每个词法块都会设置一个布尔标志变量。当被修改后的被测试代码运行退出时，将统计日志数据写入c.out文件，并打印一部分执行的语句的一个总结。（如果你需要的是摘要，使用<code>go test -cover</code>。）</p><p>如果使用了<code>-covermode=count</code>标志参数，那么将在每个代码块插入一个计数器而不是布尔标志量。在统计结果中记录了每个块的执行次数，这可以用于衡量哪些是被频繁执行的热点代码。</p><p>为了收集数据，我们运行了测试覆盖率工具，打印了测试日志，生成一个HTML报告，然后在浏览器中打开（图11.3）。</p><pre class="line-numbers language-none"><code class="language-none">$ go tool cover -html&#x3D;c.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>实现100%的测试覆盖率听起来很美，但是在具体实践中通常是不可行的，也不是值得推荐的做法。因为那只能说明代码被执行过而已，并不意味着代码就是没有BUG的；因为对于逻辑复杂的语句需要针对不同的输入执行多次。有一些语句，例如上面的panic语句则永远都不会被执行到。另外，还有一些隐晦的错误在现实中很少遇到也很难编写对应的测试代码。测试从本质上来说是一个比较务实的工作，编写测试代码和编写应用代码的成本对比是需要考虑的。测试覆盖率工具可以帮助我们快速识别测试薄弱的地方，但是设计好的测试用例和编写应用代码一样需要严密的思考。</p><h2 id="11-4-基准测试"><a href="#11-4-基准测试" class="headerlink" title="11.4. 基准测试"></a>11.4. 基准测试</h2><p>基准测试是测量一个程序在固定工作负载下的性能。在Go语言中，基准测试函数和普通测试函数写法类似，但是以Benchmark为前缀名，并且带有一个<code>*testing.B</code>类型的参数；<code>*testing.B</code>参数除了提供和<code>*testing.T</code>类似的方法，还有额外一些和性能测量相关的方法。它还提供了一个整数N，用于指定操作执行的循环次数。</p><p>下面是IsPalindrome函数的基准测试，其中循环将执行N次。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">import &quot;testing&quot;func BenchmarkIsPalindrome(b *testing.B) &#123;    for i :&#x3D; 0; i &lt; b.N; i++ &#123;        IsPalindrome(&quot;A man, a plan, a canal: Panama&quot;)    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们用下面的命令运行基准测试。和普通测试不同的是，默认情况下不运行任何基准测试。我们需要通过<code>-bench</code>命令行标志参数手工指定要运行的基准测试函数。该参数是一个正则表达式，用于匹配要执行的基准测试函数的名字，默认值是空的。其中“.”模式将可以匹配所有基准测试函数，但因为这里只有一个基准测试函数，因此和<code>-bench=IsPalindrome</code>参数是等价的效果。</p><pre class="line-numbers language-none"><code class="language-none">$ cd $GOPATH&#x2F;src&#x2F;gopl.io&#x2F;ch11&#x2F;word2$ go test -bench&#x3D;.PASSBenchmarkIsPalindrome-8 1000000                1035 ns&#x2F;opok      gopl.io&#x2F;ch11&#x2F;word2      2.179s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果中基准测试名的数字后缀部分，这里是8，表示运行时对应的GOMAXPROCS的值，这对于一些与并发相关的基准测试是重要的信息。</p><p>报告显示每次调用IsPalindrome函数花费1.035微秒，是执行1,000,000次的平均时间。因为基准测试驱动器开始时并不知道每个基准测试函数运行所花的时间，它会尝试在真正运行基准测试前先尝试用较小的N运行测试来估算基准测试函数所需要的时间，然后推断一个较大的时间保证稳定的测量结果。</p><p>循环在基准测试函数内实现，而不是放在基准测试框架内实现，这样可以让每个基准测试函数有机会在循环启动前执行初始化代码，这样并不会显著影响每次迭代的平均运行时间。如果还是担心初始化代码部分对测量时间带来干扰，那么可以通过testing.B参数提供的方法来临时关闭或重置计时器，不过这些一般很少会用到。</p><p>这个基准测试告诉了我们某个具体操作所需的绝对时间，但我们往往想知道的是两个不同的操作的时间对比。例如，如果一个函数需要1ms处理1,000个元素，那么处理10000或1百万将需要多少时间呢？这样的比较揭示了渐近增长函数的运行时间。另一个例子：I/O缓存该设置为多大呢？基准测试可以帮助我们选择在性能达标情况下所需的最小内存。第三个例子：对于一个确定的工作哪种算法更好？基准测试可以评估两种不同算法对于相同的输入在不同的场景和负载下的优缺点。</p><p>比较型的基准测试就是普通程序代码。它们通常是单参数的函数，由几个不同数量级的基准测试函数调用，就像这样：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">func benchmark(b *testing.B, size int) &#123; &#x2F;* ... *&#x2F; &#125;func Benchmark10(b *testing.B)         &#123; benchmark(b, 10) &#125;func Benchmark100(b *testing.B)        &#123; benchmark(b, 100) &#125;func Benchmark1000(b *testing.B)       &#123; benchmark(b, 1000) &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>通过函数参数来指定输入的大小，但是参数变量对于每个具体的基准测试都是固定的。要避免直接修改b.N来控制输入的大小。除非你将它作为一个固定大小的迭代计算输入，否则基准测试的结果将毫无意义。</p><p>比较型的基准测试反映出的模式在程序设计阶段是很有帮助的，但是即使程序完工了也应当保留基准测试代码。因为随着项目的发展，或者是输入的增加，或者是部署到新的操作系统或不同的处理器，我们可以再次用基准测试来帮助我们改进设计。</p><h2 id="11-5-剖析"><a href="#11-5-剖析" class="headerlink" title="11.5. 剖析"></a>11.5. 剖析</h2><p>基准测试(Benchmark)对于衡量特定操作的性能是有帮助的，但是当我们试图让程序跑的更快的时候，我们通常并不知道从哪里开始优化</p><p>当我们想仔细观察我们程序的运行速度的时候，最好的方法是性能剖析。剖析技术是基于程序执行期间一些自动抽样，然后在收尾时进行推断；最后产生的统计结果就称为剖析数据。</p><p>Go语言支持多种类型的剖析性能分析，每一种关注不同的方面，但它们都涉及到每个采样记录的感兴趣的一系列事件消息，每个事件都包含函数调用时函数调用堆栈的信息。内建的<code>go test</code>工具对几种分析方式都提供了支持。</p><p>CPU剖析数据标识了最耗CPU时间的函数。在每个CPU上运行的线程在每隔几毫秒都会遇到操作系统的中断事件，每次中断时都会记录一个剖析数据然后恢复正常的运行。</p><p>堆剖析则标识了最耗内存的语句。剖析库会记录调用内部内存分配的操作，平均每512KB的内存申请会触发一个剖析数据。</p><p>阻塞剖析则记录阻塞goroutine最久的操作，例如系统调用、管道发送和接收，还有获取锁等。每当goroutine被这些操作阻塞时，剖析库都会记录相应的事件。</p><p>只需要开启下面其中一个标志参数就可以生成各种分析文件。当同时使用多个标志参数时需要当心，因为一项分析操作可能会影响其他项的分析结果。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ go test -cpuprofile&#x3D;cpu.out$ go test -blockprofile&#x3D;block.out$ go test -memprofile&#x3D;mem.out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>对于一些非测试程序也很容易进行剖析，具体的实现方式，与程序是短时间运行的小工具还是长时间运行的服务会有很大不同。剖析对于长期运行的程序尤其有用，因此可以通过调用Go的runtime API来启用运行时剖析。</p><p>一旦我们已经收集到了用于分析的采样数据，我们就可以使用pprof来分析这些数据。这是Go工具箱自带的一个工具，但并不是一个日常工具，它对应<code>go tool pprof</code>命令。该命令有许多特性和选项，但是最基本的是两个参数：生成这个概要文件的可执行程序和对应的剖析数据。</p><p>为了提高分析效率和减少空间，分析日志本身并不包含函数的名字；它只包含函数对应的地址。也就是说pprof需要对应的可执行程序来解读剖析数据。虽然<code>go test</code>通常在测试完成后就丢弃临时用的测试程序，但是在启用分析的时候会将测试程序保存为foo.test文件，其中foo部分对应待测包的名字。</p><p>本书最后的两章是讨论reflect和unsafe包,<strong>一般的Go程序员很少使用它们，事实上也很少需要用到</strong>。因此，如果你还没有写过任何真实的Go程序的话，现在可以先去写些代码了。</p><h1 id="第十二章-反射"><a href="#第十二章-反射" class="headerlink" title="第十二章　反射"></a>第十二章　反射</h1><p>Go语言提供了一种机制，能够在运行时更新变量和检查它们的值、调用它们的方法和它们支持的内在操作，而不需要在编译时就知道这些变量的具体类型。这种机制被称为反射。</p><p>在本章，我们将探讨Go语言的反射特性，看看它可以给语言增加哪些表达力，以及在两个至关重要的API是如何使用反射机制的：一个是fmt包提供的字符串格式化功能，另一个是类似encoding/json和encoding/xml提供的针对特定协议的编解码功能。对于我们在4.6节中看到过的text/template和html/template包，它们的实现也是依赖反射技术的。然后，反射是一个复杂的内省技术，不应该随意使用，因此，尽管上面这些包内部都是用反射技术实现的，但是它们自己的API都没有公开反射相关的接口。</p><h2 id="12-1-为何需要反射"><a href="#12-1-为何需要反射" class="headerlink" title="12.1. 为何需要反射?"></a>12.1. 为何需要反射?</h2><p>有时候我们需要编写一个函数能够处理一类并不满足普通公共接口的类型的值，也可能是因为它们并没有确定的表示方式，或者是在我们设计该函数的时候这些类型可能还不存在。</p><p>一个大家熟悉的例子是fmt.Fprintf函数提供的字符串格式化处理逻辑，它可以用来对任意类型的值格式化并打印，甚至支持用户自定义的类型。</p><p>我们首先用switch类型分支来测试输入参数是否实现了String方法，如果是的话就调用该方法。然后继续增加类型测试分支，检查这个值的动态类型是否是string、int、bool等基础类型，并在每种情况下执行相应的格式化操作。</p><p>但是我们如何处理其它类似[]float64、map[string][]string等类型呢？我们当然可以添加更多的测试分支，但是这些组合类型的数目基本是无穷的。还有如何处理类似url.Values这样的具名类型呢？即使类型分支可以识别出底层的基础类型是map[string][]string，但是它并不匹配url.Values类型，因为它们是两种不同的类型，而且switch类型分支也不可能包含每个类似url.Values的类型，这会导致对这些库的依赖。</p><p>没有办法来检查未知类型的表示方式，我们被卡住了。这就是我们为何需要反射的原因。</p><h2 id="12-2-reflect-Type和reflect-Value"><a href="#12-2-reflect-Type和reflect-Value" class="headerlink" title="12.2. reflect.Type和reflect.Value"></a>12.2. reflect.Type和reflect.Value</h2><p>反射是由 reflect 包提供的。 它定义了两个重要的类型, Type 和 Value. 一个 Type 表示一个Go类型. 它是一个接口, 有许多方法来区分类型以及检查它们的组成部分, 例如一个结构体的成员或一个函数的参数等. 唯一能反映 reflect.Type 实现的是接口的类型描述信息(§7.5), 也正是这个实体标识了接口值的动态类型.</p><p>函数 reflect.TypeOf 接受任意的 interface{} 类型, 并以reflect.Type形式返回其动态类型:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">t :&#x3D; reflect.TypeOf(3)  &#x2F;&#x2F; a reflect.Typefmt.Println(t.String()) &#x2F;&#x2F; &quot;int&quot;fmt.Println(t)          &#x2F;&#x2F; &quot;int&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>根据我的经验，感觉反射的东西，不是经常用到，属于那种用到再查的知识，（go并不像java那么面向对象）</p><h1 id="第十三章-底层编程"><a href="#第十三章-底层编程" class="headerlink" title="第十三章　底层编程"></a>第十三章　底层编程</h1><p>Go语言的设计包含了诸多安全策略，限制了可能导致程序运行出错的用法。编译时类型检查可以发现大多数类型不匹配的操作，例如两个字符串做减法的错误。字符串、map、slice和chan等所有的内置类型，都有严格的类型转换规则。</p><p>对于无法静态检测到的错误，例如数组访问越界或使用空指针，运行时动态检测可以保证程序在遇到问题的时候立即终止并打印相关的错误信息。自动内存管理（垃圾内存自动回收）可以消除大部分野指针和内存泄漏相关的问题。</p><p>Go语言的实现刻意隐藏了很多底层细节。我们无法知道一个结构体真实的内存布局，也无法获取一个运行时函数对应的机器码，也无法知道当前的goroutine是运行在哪个操作系统线程之上。事实上，Go语言的调度器会自己决定是否需要将某个goroutine从一个操作系统线程转移到另一个操作系统线程。一个指向变量的指针也并没有展示变量真实的地址。因为垃圾回收器可能会根据需要移动变量的内存位置，当然变量对应的地址也会被自动更新。</p><p>总的来说，Go语言的这些特性使得Go程序相比较低级的C语言来说更容易预测和理解，程序也不容易崩溃。通过隐藏底层的实现细节，也使得Go语言编写的程序具有高度的可移植性，因为语言的语义在很大程度上是独立于任何编译器实现、操作系统和CPU系统结构的（当然也不是完全绝对独立：例如int等类型就依赖于CPU机器字的大小，某些表达式求值的具体顺序，还有编译器实现的一些额外的限制等）。</p><p>有时候我们可能会放弃使用部分语言特性而优先选择具有更好性能的方法，例如需要与其他语言编写的库进行互操作，或者用纯Go语言无法实现的某些函数。</p><p>在本章，我们将展示如何使用unsafe包来摆脱Go语言规则带来的限制，讲述如何创建C语言函数库的绑定，以及如何进行系统调用。</p><p><strong>本章提供的方法不应该轻易使用</strong>（译注：属于黑魔法，虽然功能很强大，但是也容易误伤到自己）如果没有处理好细节，它们可能导致各种不可预测的并且隐晦的错误，甚至连有经验的C语言程序员也无法理解这些错误。使用unsafe包的同时也放弃了Go语言保证与未来版本的兼容性的承诺，因为它必然会有意无意中使用很多非公开的实现细节，而这些实现的细节在未来的Go语言中很可能会被改变。</p><p>要注意的是，unsafe包是一个采用特殊方式实现的包。虽然它可以和普通包一样的导入和使用，但它实际上是由编译器实现的。它提供了一些访问语言内部特性的方法，特别是内存布局相关的细节。将这些特性封装到一个独立的包中，是为在极少数情况下需要使用的时候，同时引起人们的注意（译注：因为看包的名字就知道使用unsafe包是不安全的）。此外，有一些环境因为安全的因素可能限制这个包的使用。</p><p>不过unsafe包被广泛地用于比较低级的包, 例如runtime、os、syscall还有net包等，因为它们需要和操作系统密切配合，但是对于普通的程序一般是不需要使用unsafe包的。</p><h2 id="13-1-unsafe-Sizeof-Alignof-和-Offsetof"><a href="#13-1-unsafe-Sizeof-Alignof-和-Offsetof" class="headerlink" title="13.1. unsafe.Sizeof, Alignof 和 Offsetof"></a>13.1. unsafe.Sizeof, Alignof 和 Offsetof</h2><h2 id="13-4-通过cgo调用C代码"><a href="#13-4-通过cgo调用C代码" class="headerlink" title="13.4. 通过cgo调用C代码"></a>13.4. 通过cgo调用C代码</h2><p>Go程序可能会遇到要访问C语言的某些硬件驱动函数的场景，或者是从一个C++语言实现的嵌入式数据库查询记录的场景，或者是使用Fortran语言实现的一些线性代数库的场景。C语言作为一个通用语言，很多库会选择提供一个C兼容的API，然后用其他不同的编程语言实现（译者：Go语言需要也应该拥抱这些巨大的代码遗产）。</p><p>在本节中，我们将构建一个简易的数据压缩程序，使用了一个Go语言自带的叫cgo的用于支援C语言函数调用的工具。这类工具一般被称为 <em>foreign-function interfaces</em> （简称ffi）, 并且在类似工具中cgo也不是唯一的。SWIG（ <a href="http://swig.org/">http://swig.org</a> ）是另一个类似的且被广泛使用的工具，SWIG提供了很多复杂特性以支援C++的特性，但SWIG并不是我们要讨论的主题</p><p>如果是比较小的C语言库，我们完全可以用纯Go语言重新实现一遍。如果我们对性能也没有特殊要求的话，我们还可以用os/exec包的方法将C编写的应用程序作为一个子进程运行。只有当你需要使用复杂而且性能更高的底层C接口时，就是使用cgo的场景了（译注：用os/exec包调用子进程的方法会导致程序运行时依赖那个应用程序）。下面我们将通过一个例子讲述cgo的具体用法。</p><p>译注：本章采用的代码都是最新的。因为之前已经出版的书中包含的代码只能在Go1.5之前使用。从Go1.6开始，Go语言已经明确规定了哪些Go语言指针可以直接传入C语言函数。新代码重点是增加了bz2alloc和bz2free的两个函数，用于bz_stream对象空间的申请和释放操作</p><p>其中<code>import &quot;C&quot;</code>的语句是比较特别的。其实并没有一个叫C的包，但是这行语句会让Go编译程序在编译之前先运行cgo工具。</p><h2 id="13-5-几点忠告"><a href="#13-5-几点忠告" class="headerlink" title="13.5. 几点忠告"></a>13.5. 几点忠告</h2><p>我们在前一章结尾的时候，我们警告要谨慎使用reflect包。那些警告同样适用于本章的unsafe包。</p><p>高级语言使得程序员不用再关心真正运行程序的指令细节，同时也不再需要关注许多如内存布局之类的实现细节。因为高级语言这个绝缘的抽象层，我们可以编写安全健壮的，并且可以运行在不同操作系统上的具有高度可移植性的程序。</p><p>但是unsafe包，它让程序员可以透过这个绝缘的抽象层直接使用一些必要的功能，虽然可能是为了获得更好的性能。但是代价就是牺牲了可移植性和程序安全，因此使用unsafe包是一个危险的行为。我们对何时以及如何使用unsafe包的建议和我们在11.5节提到的Knuth对过早优化的建议类似。大多数Go程序员可能永远不会需要直接使用unsafe包。当然，也永远都会有一些需要使用unsafe包实现会更简单的场景。如果确实认为使用unsafe包是最理想的方式，那么应该尽可能将它限制在较小的范围，这样其它代码就可以忽略unsafe的影响。</p><p>现在，赶紧将最后两章抛入脑后吧。编写一些实实在在的应用是真理。请远离reflect的unsafe包，除非你确实需要它们。</p><p>最后，用Go快乐地编程。我们希望你能像我们一样喜欢Go语言。</p>]]></content>
    
    
    <summary type="html">《Go语言圣经》阅读笔记</summary>
    
    
    
    <category term="书摘" scheme="https://changqingaas.github.io/categories/%E4%B9%A6%E6%91%98/"/>
    
    
    <category term="Go" scheme="https://changqingaas.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>《把时间当做朋友》阅读笔记</title>
    <link href="https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Others/%E6%8A%8A%E6%97%B6%E9%97%B4%E5%BD%93%E5%81%9A%E6%9C%8B%E5%8F%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Others/%E6%8A%8A%E6%97%B6%E9%97%B4%E5%BD%93%E5%81%9A%E6%9C%8B%E5%8F%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</id>
    <published>2022-02-05T14:00:33.000Z</published>
    <updated>2022-02-05T10:21:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="本书不是时间管理书籍"><a href="#本书不是时间管理书籍" class="headerlink" title="本书不是时间管理书籍"></a>本书不是时间管理书籍</h3><p>尽管本书的内容也包括任务管理等与常见“时间管理技巧”相关的内容，但是，本书主张时间不可管理、一切都靠积累。</p><p>更进一步地说，本书主张一个人必须在开启心智、提高思考能力之后，才能够用正确的方法做正确的事情。也只有这样，时间才是朋友，否则，它就是敌人。很多“时间管理技巧”并非无用，但往往由于使用者心智能力低下甚至尚未开启心智，致使那些技巧只能治标，不能治本，甚至既不治标，也不治本。</p><h3 id="这本书不是成功学书籍"><a href="#这本书不是成功学书籍" class="headerlink" title="这本书不是成功学书籍"></a>这本书不是成功学书籍</h3><p>成功从来都不是人人都可以做到的事情，过去不是，现在不是，将来依然不是。基于比较的成功观，是伤人的、害人的。事实上，对年轻人来说，成长比成功更重要，而且，这才是人人都可以做到的事情，才是人人都值得追求的事情。而成长其实只有一条路——积累。</p><h3 id="这本书不是心灵鸡汤式的书籍"><a href="#这本书不是心灵鸡汤式的书籍" class="headerlink" title="这本书不是心灵鸡汤式的书籍"></a>这本书不是心灵鸡汤式的书籍</h3><p>这本书里没有安慰，因为这本书不是写给脆弱的人的——只有脆弱的人才不断需要安慰。现实是残酷的，生活是艰难的，无论什么样的时代，无论对哪一个层次的人，都是如此，对大多数年轻人来说，更是如此。人的理性建立在接受现实的基础上，不能接受现实，一切成长都是虚妄。只有坚强的人才能接受现实，只有接受现实，才有可能开始运用心智作出理性的决定，进而才有可能做时间的朋友</p><h3 id="这不是一本讲大道理的书"><a href="#这不是一本讲大道理的书" class="headerlink" title="这不是一本讲大道理的书"></a>这不是一本讲大道理的书</h3><p>这本书所传递的信息，原本只不过属于常识，可由于种种原因，并没有被真正普及、理解，实在可惜。</p><h3 id="第2版前言"><a href="#第2版前言" class="headerlink" title="第2版前言"></a>第2版前言</h3><p>这本书在一个读者群中反应更为热烈——在职场上打拼过一两年的新人。当然，现在我已经可以理解个中原因：因为这本书所讲述的一些道理是需要一定的经验和挫折才能真正理解的。对尚未做过什么实事，尚未遇到什么挫折的人来说，这些道理看起来是那么简单、那么明显，乃至于和废话差不多——而所谓“越早醒悟越好”这样的言词，对他们来说是相当地苍白；所谓“苦口婆心”的态度，对他们来说是相当地腻歪。</p><p>有些道理就是很难传播——因为人们只传递自己认同的东西。有些道理就是不大可能被多数人认同，于是，即便它再合乎逻辑，再怎么有用，也不是很容易传播。</p><h3 id="第1版前言"><a href="#第1版前言" class="headerlink" title="第1版前言"></a>第1版前言</h3><p>无论是谁，都最终在某一刻意识到时间的珍贵，并且几乎注定会因懂事太晚而多少有些后悔。病了要投医，病急了就很可能乱投医。可是书店里各种各样的关于“时间管理”的书籍多半于事无补——至少这是我自己的经验。一方面是束手无策，另一方面是时间无情地流逝，恶性循环早已经形成——要做的事情越来越多，可用的时间越来越少；而因此时间越来越珍贵，时间越来越紧迫；时间越珍贵就越紧迫，时间越紧迫就越珍贵……压力越来越大，生活成了一团乱麻。</p><p>时间是个问题，可是“管理”它却不是正确有效的方法，因为那是几乎做不到的事情。之所以后来换成这个名字，在于“把时间当作朋友”更能体现本书的实质。我自己也是在写作的过程中才清楚地意识到“管理时间”的说法有多么荒谬。<strong>人是没办法管理时间的，时间也不听从任何人的管理</strong></p><p>终于有一天，我对自己说：<strong>“承认了吧，你对时间的流逝无能为力。”</strong>那一刻的醒悟，感觉就像凤凰涅槃一样浴火重生——这个说法多少有些矫情，但又确实过于准确而无可替代。那一瞬间，我已经30多岁——还好，并不算太晚。</p><p>要管理的不是时间，而是自己。人们生活在同一个世界，却又各自生活在自己的那个版本之中。改变自己，就意味着属于自己的那个版本的世界将会随之而变，其中也包括时间的属性。开启自己的心智，让自己能够用最可能准确的方式思考、观察、记录、总结、分享和行动，那么自己的时间就会拥有不同的质量，进而整个生活都必然因此焕然一新。</p><p>人生的幸运在于能够“用正确的方式做正确的事情”。而什么是正确的或者更好的方式，什么事情真的值得去做，需要运用良好的心智才能作出尽可能准确的判断。若真的做到“用正确的方式做正确的事情”，那一瞬间，时间无须管理（当然就算想管其实也没人能做到），它是你的朋友，陪你亦步亦趋走到最后的朋友。</p><h2 id="困境"><a href="#困境" class="headerlink" title="困境"></a>困境</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>完成任何任务都需要一定的时间。同时，任何任务都最好或必须在某个特定的时间点之前完成，即，任务都有一个最后期限。而且，只要是必须完成的任务，不管是否已经开始执行，ddl就在不断迫近，因为时间永不停歇。</p><p>问题好像很简单，看起来无非有以下几种情况。</p><ul><li>没有按时开始执行任务。</li><li>错误估算完成任务所需时间。</li><li>在任务的执行过程中出现了差错。</li></ul><p>果真如此的话，那么解决方案好像也很简单。</p><ul><li>按时开始执行任务。</li><li>正确估算完成任务所需时间。</li><li>在执行任务的过程中不要出差错。</li></ul><p>可事实上问题并非如此简单，否则也不会让那么多人一 生都束手无策。</p><h3 id="慌乱"><a href="#慌乱" class="headerlink" title="慌乱"></a>慌乱</h3><p>大多数人都一样，压力刻在额头，匆忙写在脸上。他们身上充满了矛盾——他们“<strong>既勤奋又懒惰</strong>”。</p><p>经过反复询问，认真观察，我终于明白了——很多学生“既勤奋又懒惰”的怪异现象来自他们对“时间压力”的感受。“没时间了”或者“时间不够了”的恐慌，使他们超乎寻常地勤奋。哪怕只是虚假的“勤奋”，一样能让他们恨不得废寝忘食。而同样的感受，也使他们终日不忘寻找捷径，美其名曰“提高效率”，而实际上却想着“最好不费吹灰之力”。无论哪一种行为，都肯定是不现实的，因为已经“没时间了”——这才是冷冰冰的事实。</p><p>“没时间了”，是“时间恐慌症”患者脑子里唯一反复闪现的一句话。巨大的压力，极度的恐慌，使“患者”身上综合了一切矛盾：他们既勤奋又懒惰，既聪明又愚蠢，既勇敢又懦弱，既满怀希望又分分秒秒面临绝望，既充满自信又随时随地体会自卑……</p><p>但是，生活中明显有另外一些人——尽管数量上并不占优——在用另外一种状态生活。他们从容，他们优雅，他们善于化解各种压力，安静地去做他们认为应该做的事情，并总能有所成就。他们甚至可以达到常人无法想象的境界——不以物喜，不以己悲。面对同样的困境，这另外的一些人究竟是如何保持从容的呢？</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>你想打开一扇门，可那门上有个锁，把门锁住了。“如果能找到钥匙就好了”，你想。可是钥匙在哪里呢？反正不在那把锁上。既然门被锁上了，钥匙就一定不会插在锁孔里。</p><p>“没时间了！”这种尴尬就像是一把我们想要打开的锁。</p><p>同样，要想摆脱这种尴尬，死盯着这把锁是没有用的。</p><p>很少有人会注意，所谓“管理时间”抑或“时间管理”是虚假的概念，是不可能完成的任务。时间不会服从任何人的管理，它只会自顾自地流逝。你不可能冲它大喊：“时间，你给我慢一点！”它只是自顾自地流逝。你也不可能向它大叫：“时间，你给我快一点！”它还是自顾自地流逝。时间不理任何人，它用自己特有的速度流逝，不受任何外界因素影响。</p><p>钥匙在其他地方，反正不在锁上。尝试着从“管理时间”开始解决问题，注定徒劳。尽管我们面临的尴尬是“没时间了”，可从本质上来看，这尴尬与时间的关系不是很大。没错，<strong>问题出在我们自己身上。</strong></p><p>看起来似乎很有道理，而实际的操作效果怎么样呢？并不好。为什么？因为你发现（或最终证明）自己没有足够的能力去区分一项任务是否重要、是否紧急。所以，到头来，尽管别人告诉你的方法是对的，可是你操作起来却得不到期望的结果。</p><p>没错，问题出在我们自己身上。</p><p>我们无法管理时间。<strong>我们真正能够管理的，是我们自己</strong>。只有接受这个简单的事实，才有解决问题的希望。“时间不可管理”，尽管听上去很简单，但是理解它，进而接受它，可不见得那么容易。因为，它未必是（甚至几乎肯定不是）你以往已经认同的观念。</p><p>其实，这本书的主旨非常简单：时间是不可能被管理的。必须开启心智，看清楚，想明白：问题出在我们自 己身上。而我们所面临的问题，与时间、管理或时间管理都没有多大的关系。解决方案只有一个，那就是“一切都靠积累”。深信积累的力量，时间就是你的朋友，否则，它就是你的敌人。</p><h2 id="醒悟"><a href="#醒悟" class="headerlink" title="醒悟"></a>醒悟</h2><h3 id="孰主孰仆"><a href="#孰主孰仆" class="headerlink" title="孰主孰仆"></a>孰主孰仆</h3><p><strong>你的大脑并不是你，你的大脑是（属于）“你的”大脑。</strong></p><p>尽管你用它思考，好像它也在指导你的行为，但是你要明白，你不应该隶属于你的大脑，而应该是它隶属于你，你“可以控制你的大脑”——分清主仆很重要。</p><p>“<strong>运用心智获得解放</strong>”。不要再让自己“跟着感觉走”，成为大脑的奴隶，而是翻身做大脑的主人。</p><h3 id="何谓心智"><a href="#何谓心智" class="headerlink" title="何谓心智"></a>何谓心智</h3><p>一个人的心智就是其过往获得的一切知识及经验的总和（包括基于这些知识和经验造就的思考方法、思考模式）。心智与智商不同。大多数人都拥有正常的智商，但并非每个拥有正常智商的人都拥有正常的心智。许多人的心智仍处于未开启的状态。我们常看到所谓的“聪明人办傻事”，其原因基本上都是他们的心智尚未开启。他们即使做出了错误的判断也会振振有词——绝非强词夺理，而是义正词严、双目炯炯、真诚满怀。</p><p>无论是正向还是反向，心智一旦开启，就会不断自我积累，自我过滤，直至根深蒂固。人与人之间心智力量的差异，就是这样一点点地积累，最终天差地别。既然一个人的心智是他的知识和经验的总和，当然也会包括他的思考方法和思考模式。因为无论是吸收知识还是总结经验，都需要经过思考才能得出结论。在此过程中，他的思考方法和思考模式都会多多少少产生变化，根据新的知识和经验，或巩固、或调整、或否定、或重建……</p><p>所以说，心智这东西“上不封顶、下无保底”。心智一旦开启，就可能因为学习而像病毒一样疯狂发展，与此同时，“学习能力”也会相应地大幅增长。于是，心智可以发展，可以培养，可以重建，甚至可以反复重建——怎么可能封顶？然而，反过来，如若这一过程中出现一些差错，那么心智的发展就有可能停滞，甚至倒退，弄不好还会“痴心不得反癫狂”——怎么可能保底？这就好比有些人一辈子都是“原始人”；有一些人“开窍”了，演化成了“现代人”，甚至<a href="http://goo.gl/Z7bo2">尼采</a>所说的“超人”；同时还有一些人也“开窍”了，退化成了“猴子”。</p><p>有些认识，哪怕是简单的常识，也需要亲身经历后才能真正体会”。只有拥有无与伦比的打字速度，才能体会打字速度快的好处。</p><blockquote><p>心智真正成熟的人在一些情况下能够做到无须亲自经历，仅凭思考就得到深刻的体会。</p></blockquote><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>人们可能会基于一模一样的原因做出截然相反的决定。</p><p>当有机会学习一项技能的时候，人们常常会问：“学这东西有什么用呢？”其实，在尚未学习之前，对提问者来说，答案只能是“不知道”——尽管很多书籍中都已经花费大量的篇幅去论述“为什么要学习（某项技能）”。而“不知道那东西（对自己）有什么用”，恰恰是一部分人（更多一些）决定不学的原因，同时，它也是另一部分人（更少一些）决定去学的原因。</p><p>为了表述方便，让我们把“因为不知道那东西有什么用而决定学习的人”称为“甲”，把“因为不知道那东西有什么用而拒绝学习的人”称为“乙”。</p><p>在更多的时候，甲很可能想都没有想过“学这东西有什么用”。他从来都不问用途，只是自顾自学去了。许多年后，他自然而然地找到了这项技能的用处，享受了其已有技能所带来的种种好处。于是，这个既有经验成为他心智的一部分。当遇到新的学习机会时，他会自然而然地采取同样的策略——管它有什么用呢，学呗，学了总有用处。他也会自然而然地理解并相信“技不压身”的道理。</p><p>说完甲我们来说乙。乙当然永远不会知道这东西对他究竟有什么用，因为他从未拥有过这项技能，更不可能有机会亲身体会。随着时间推移，他凭自己的经验能够得到的结论只能是：“我没学也没什么。”也许有一天，当他因为没有学习这项技能而遇到一点尴尬的时候，可能会慨叹：“当初不懂事，要是学过就好了……”然而，这对他来说，仅限于慨叹。再次遇到学习机会的时候，他依然会选择放弃，只不过除了“不知道学它有什么用”之外还多了一个理由：“现在学也来不及了。”这种拒绝学习的判断，渐渐融入他的心智，难以更易，最终，当他再次面临同样的机会时，他还会与过去一样，做出同样的选择。</p><p>问题的关键在于，做出截然相反决定的理由竟然是一模一样的！人们通常认为，恰当的逻辑训练能够提高一个人做出正确选择决定的几率。可在上述情况下，大多数逻辑都无能为力。这种情况在生活中并不罕见，相反，比比皆是。父母教育孩子的时候被孩子驳得哑口无言就是这类情况——并不是孩子不讲逻辑，也不是孩子的观点正确，只是他就是无法理解父母所要传递的经验或者道理。他们不相信的理由和父母相信的理由很可能是一模一样的！</p><h2 id="现实"><a href="#现实" class="headerlink" title="现实"></a>现实</h2><h3 id="速成绝无可能"><a href="#速成绝无可能" class="headerlink" title="速成绝无可能"></a>速成绝无可能</h3><p>期望速成，从微观层面上看，有两个主要原因。</p><p>第一个原因是人希望自己的欲望马上得到满足的天性。一个确定的事实是，几乎每个人都有无穷无尽的欲望。虽然每个人都知道，不是所有欲望都能被满足，但人们仍然不会放弃追逐尽可能多的欲望。于是，不劳而获成了每个人心中的诸多愿望之一，甚至可能是其中最大的愿望。如果达不到不劳而获，少劳多获也可以接受，而且最好是“劳”尽量少，“获”尽量多，多多益善。从这个角度更进一步地说，大多数人都抱着类似这样的想法：如果收获的可能性很大，最好马上看到成果；如果收获的可能性很小，最好马上知道结果。</p><p>每个人都有这种欲望，差别仅在程度或者表现上。</p><p>第二个原因，也是浮躁的根源，就是很多人不懂“有些阶段就是无法跨越”这个道理。因此，他们才那么不现实地希望找到一个方法，靠其迅速达成目标，完结任务，获得解脱。可是，无论做什么事都需要时间，而且可能需要很多时间。 </p><p>除了上面这两个微观上的原因外，还有一个宏观上的原因也使人们常常不由自主地奢望速成——哪怕之前已经“醒悟”过。这个宏观上的原因即所谓的“现状使然”。根据达特茅斯学院经济学教授<a href="http://goo.gl/vLrz8">布兰奇弗劳尔</a>的调查结论，通常情况下，一个人一生各个阶段的满意程度和其年龄分布可以连成一个U型曲线。</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220205095242.png" alt="img"></p><p>从这张图中可以看出，大多数人对其自身的满意程度从15岁左右开始持续下降，这大抵是不再无知无畏造成的。从那时起，一个人慢慢意识到自己在这个世界上其实微不足道，进而开始在所谓的理想和扭曲的现实中拼斗、挣扎，直到45岁左右才渐出苦海，曲线开始上扬。这就是以一个普通人的心智，观察、感受、思索、理解、实践、回顾，直至恍然大悟或者误入歧途的时间——30年。</p><p>在这漫长的 30 年里，由自我满意度持续下降所造成的浮躁形成了巨大的心理压力。越是浮躁，就越是对自己的现状不满；越是对自己的现状不满，就越是浮躁。</p><p>更大的问题在于，大多数人并不知道几乎所有的人都是这样。相反，现实好像总是提醒我们：有些人过得比我们好多了。这就是统计学的优势。它可以排除感情因素，用冷冰冰的数字展示现实。如果它所展示的现实与我们原本以为的并不相同甚至相反，这一优势就变得更为明显。掌握统计学常识的人，心智力量显然要比那些对此毫无了解的人强大——他们可以理解统计学结论的意义，即便那结论并非来自亲身经历，而他们也因此离现实更近一些。</p><p>总的来说，<strong>一方面是自己的无限欲望，一方面是要完成的事情太多，一方面是自我满意度的不断下降——这就是人们总是不由自主地期望速成的根源</strong>。出路肯定存在，但这出路只有一个起点——接受现实。<strong>告诉自己：我有不足，我需要时间，我没办法一蹴而就。</strong></p><h3 id="交换才是硬道理"><a href="#交换才是硬道理" class="headerlink" title="交换才是硬道理"></a>交换才是硬道理</h3><p>“我要”的欲望从来不会消减，只会不断增加。大多数人之所以会浮躁，是因为他们一无积累（或者积累太少，几乎无法换取任何东西），二无方法和经验（所以求而不得）。与此同时，“我要”的欲望恰恰因为无法获得而熊熊燃烧。情况更恶劣的时候，那欲望之火甚至可以烧掉他们所有的时间和精力，以至占用原本可以用于努力（或者投机）的时间，陷入死循环，无法挣脱。</p><p>积累多的人之所以稳健，是因为对他来说，“我要”的欲望可以用“我有”的东西来满足。即便“我有”的暂时不够，他也能借助已经拥有的足够的努力和勤奋（抑或投机取巧的方法和经验），只需假以时日，定能如愿以偿。一旦得偿所愿，<strong>不仅“我有”的更多，“我要”的也更容易获得，如此形成良性循环。</strong></p><p>生活的本质就是这样，你想要什么，它偏不给你什么。摆脱这个死循环的方法只有一个——给我什么我就用好什么，积累到一定程度再去换能换的东西。要不断想办法运用心智的力量去识别那些死循环和恶性循环，然后在好像不可能的情况下跳出去。</p><p>要想跳出去倒也简单。拿出一张纸，将其划分为左右两半，然后做两个列表，左边是“我有的”，右边是“我要的”，逐一罗列。完成后要尽量客观地判断：先划掉“我要的”当中那些无法用“我有的”换取的；再仔细判断在剩下的能用“我有的”换取的那些“我要的”之中，哪些是必须的、必要的、重要的、不可或缺的，并在其上做重点标记。偶尔会有一些“我要的”无法用现在“我有的”换来，却又是必须、必要，甚至不可或缺的，这需要我们认真考虑用什么样的手段再积累一些“我有的”，从而有足够资本换取那些“暂且换不到但极其想要的”——或努力勤奋，或投机取巧。投机的方式并非不能用，尽管它的成功概率实际上并没有看起来那么高，而它的失败概率甚至和它看起来的成功概率一样高。</p><p>还有一个辅助手段，就是在想到“我要什么”的时候马上提醒自己，接下来要花一些时间去思考“我有什么”。后者会在转瞬间让你“脚踏实地”。</p><p>最坏的情况是，拿出纸和笔认真面对自己，结果发现“自己什么都没有”。这也许令人气馁，但其实对任何一个正常人来说，“还有时间”、“还有精力”、“还有正常的智商”就已经足够了。只要努力，只要勤奋，机会总是存在的——我们必须要相信这一点，最好相信到毫不怀疑。</p><h3 id="完美永不存在"><a href="#完美永不存在" class="headerlink" title="完美永不存在"></a>完美永不存在</h3><p>越是能力差的人，越有那种非常不现实又极其脆弱的完美主义倾向。他们不现实，是因为他们不懂。因为他们不懂，所以他们不现实；因为他们不现实，所以他们脆弱。他们很容易受伤，因为他们的要求太高，也因此总是做不到。</p><p>有时，有些人会故意这样做，尽管他们自己不愿意承认。把自己标榜成完美主义者，是他们抬高自己的手段，是他们不去做一些事情的借口。他们把这个借口说出来的时候真个掷地有声：“做不好的事情我不做！”然而，这可能是装出来的。人就是这样，装得久了，就装得像了；装得太像、太久，不管事实怎样，自己倒是先信了。而这当然会影响之后的决定和行为。</p><p>这些人所说的“做不好”，其实是“不能一下子做好”，但问题在于，没有什么事情是一下子就能做好的。所以，他们这个也不做，那个也不做，到最后，已经不是“不做一些事情”了，而是“什么都没做”、“什么都不做”，结果“一事无成”。好笑的是，</p><h3 id="未知永远存在"><a href="#未知永远存在" class="headerlink" title="未知永远存在"></a>未知永远存在</h3><p>在进入任何一个新领域时，这种压力都能使新手窒息。而已经在那个领域里“浸泡”过一段时间的人，往往早已忘记了曾经面对的恐惧和压力，懒得（抑或不屑）开导新手、帮助新手。其实，更多的时候，一些老手实际上并不是“懒得”或者“不屑”，而是“没想到竟然连这个也需要解释”。</p><p>然而，为了进步，<strong>我们必须忍受一定的未知。</strong></p><p>首先，我们要承认自己不可能全知全晓。有些时候，有些问题没有答案，就好像“先有鸡还是先有蛋”一样。而有些时候，即便有了答案，其原因也不见得是我们能够搞懂的。</p><p>其次，我们要了解未知分为两种：一种是永远不能解决的，另一种是在可预见的未来也许能够解决的。对一个人来说，超过100年就可以算“永远”了，所以，第一种未知对个人来说意义不大；第二种未知却是我们必须面对的，学习的难度也在于此。“第一章的内容需要在掌握后面某一章的知识之后才能深入了解”，这几乎是所有高难知识体系的普遍特征。也就是说，在第一章，我们会有无数疑问，可这些疑问以当时的知识是无法全部解决的，需要我们继续学习，用接下来获得的知识解释今天的疑问。这就是那些爱钻牛角尖的人最终常常吃亏的重要原因——他们总是想“马上解决当时不可能解决的问题”。</p><p>再强调一次，我们必须接受这个现实——未知永远存在。而后，我们只能不断地尝试着去适应“在未知中不断前行”。</p><p>如果不能接受这个现实，就无法忍受未知的存在，也会平添无数的焦虑。焦虑是导致时间浪费、效率低下的根源之一。当人处于焦虑的时候，甚至可能出现一切理智都被清空的情况。另外，焦虑的情绪会让人觉得“必须要做点什么”，但是，在缺乏理智的状态下做出的任何决定和行为都可能带来灾难性的后果。一个相对有效的策略是：当有问题解决不了时，可以先把它记下来，然后继续前行。注意，一定要把它们记下来。</p><p>很多人没有记录的习惯，以至出现曾经因为思考（疑问就是思考的起点）后“忘了”而失去获得答案机会的情况。继续前行，并不意味着忽略这些问题，因为它们已被记下来了。而又因为它们被记了下来，所以可以在以后拿出来重新审视，不一定当什么时候、在什么地方、因为什么由头，它们之中的一部分就突然有了清楚的解决方案。当然，可能性最大的原因只有一个——你一直在前行，你一直在积累，你一直在成长。所以，到有了答案的那一刻，你不再是当初无能为力的你，你已经重生。</p><h3 id="现状无法马上摆脱"><a href="#现状无法马上摆脱" class="headerlink" title="现状无法马上摆脱"></a>现状无法马上摆脱</h3><p>与外界的无谓比较，让每个人凭空多出了一个根本不属于自己的目标，动辄被自己的理想绑架。很多人（应该是绝大多数人）的工作态度本质上是“骑驴找马”。基于种种原因（主要是概率问题），人们往往对自己正在从事的职业并不满意。很多人都心怀梦想，有一个“无论如何早晚都要从事的梦想职业”，而不幸的是，很多人正因如此最终沦为平庸之辈</p><p>尽管天分确实很重要，但一个人的能力主要靠积累获得。从一个人开始从事一个职业的那一瞬间起，只要足够认真、努力，他的能力就会不停地积累。如果这个人实际上向往的是另一个职业，那么他的所谓“梦想”几乎必然使他在当前这份职业上心不在焉、无甚积累。其实，世界上80%以上的职业并不过分依赖天分，更可能甚至几乎只依赖积累。天长日久，这个人在当前的职业中将逐渐落后于那些认真做事的人。但此时他不会因为自己的落后而奋起直追，反过来，更可能的是把“反正我的梦想不是这个”当作借口。</p><p>无论是谁，进入自己梦想职业的成本都很高昂——极少数运气好的人除外——有些相对依赖天分和运气的行业更是如此 。当初未能从事一个职业就已经能说明问题了——除了运气不好，更可能的是因为积累不够。几年过去，这个人在他的所谓“梦想职业”中的经验积累依然是零，仍旧只是空有梦想。还有一个他更可能宁愿视而不见的事实是，那些在他所谓“梦想职业”中拼搏努力的人在这段时间里已经积累了无数经验，磨炼出了他在“圈外”无法想象的各种能力。就算有一天，这个人有足够运气，进入了那个他梦寐以求的领域，结果可能还是发现自己一无所有、毫无竞争力，最后不过是一切清零、从头再来。</p><p>心怀“梦想”的时间越长，它的沉没成本就越高。很多人都在无意之间被自己的“梦想”所绑架，所以，很多时候，对很多人来说，所谓“梦想”也许只是陷阱。许多年来，我曾见过身边不少的人一点一点被他们珍爱的“梦想”毁掉。</p><p>越是不满现状，摆脱现状的欲望就越强烈，而这种欲望会让一个人最终迷失方向，因为无论是谁，从本质上看都无法摆脱现状——每一时刻的现状都是过去某一或者某些时刻的结果，而每一时刻的现状都是未来某一或者某些时刻的原因。没有人能够逃脱现实的束缚。</p><p>从某种意义上理解，“逆境造就成功、磨难令人成熟”之类的话纯属胡说八道。显然，在顺境中更容易成功，而且很多磨难根本没有必要——这更可能是失败者对他们自己一生都未曾有机会体验的成功以及成功者“意淫”式的猜想而已。失败者永远没有机会了解成功的真相，因为人最容易受自身经验的限制，而不曾有哪怕一点点成功经验的人更无从摆脱自身的局限。</p><p>对现状不满、急于摆脱现状，是人们常常不知不觉落入的陷阱（尽管偶尔这也是少数人真正的动力）。接受现状才是最优策略——有什么做什么，有什么用什么；做什么都做好，用什么都用好。不要常常觉得苦（这会让人忍不住顾影自怜，浪费精力与时间），而要想办法在任何情况下找到情趣——快乐是一种本事。这些年我遇到的几乎所有优秀的年轻人都有这样的特征：他们很少对现状不满（可能是他们的优秀使他们难以觉得不满吧），他们热爱自己的生活，他们相对更不在意外界的影响，他们更专注于做事而心无旁骛，他们身处良性循环之中，当然，他们也因此每时每刻都在进步。</p><h3 id="与时间做朋友"><a href="#与时间做朋友" class="headerlink" title="与时间做朋友"></a>与时间做朋友</h3><p>与时间做朋友的方法很简单：用正确的方法做正确的事情。</p><p>正确的方法究竟是什么稍后再说，这里先说说什么是正确的事情。最可怕的不是效率不高，而是干脆做错了事。如果做的事情是错误的，效率越高，结果越糟。如果做的事情是正确的，效率低一点也没关系，因为做一点是一点，多收获一点，多进步一点，动力就会更强一点，进而更容易持续地做下去。怎样判断所做的事情是否正确？核心的判断只有一个：看它是否现实。</p><p>几乎一切愚蠢的行为都来自否定现实、逃避现实。只有接受现实，才可能脚踏实地，避免心浮气躁、好高骛远。如果我们把成功朴素地定义为“用正确的方法做正确的事情，并在最后期限之前漂亮地完成”的话，那么，大多数所谓的“时间管理技巧”实际上发挥不了多大的作用，只不过是花拳绣腿。真正有用的往往是简单而又朴素的道理，例如“现实只能接受”。 </p><p>大量的实践结果与理论分析表明，大多数随机变量均服从或近似服从正态分布，如测量的误差、学生的成绩、人类的身高和体重、产品的质量数据、投资的收益率等。</p><p>这种资源分布上自然的“不均匀”，看上去简单易懂，但古今中外都有很多人拒绝理解和接受它。他们甚至拒绝使用“不均匀”这个词，而是用“不公平”取而代之。历史上有无数次战争、无数次掠夺，但从本质上看，不过是因为把“均匀”理解成“公平”造成的。把“不均匀”理解成“不公平”，就可以理直气壮地打着“公平正义”的旗号为所欲为。</p><p>平静并理性地接受“资源稀缺”这个现实，其困难程度超乎想象，</p><p>尽管现实总是如此难于接受，坚强的你却应该坦然。以上提到的种种现实，包括“速成绝无可能”、“只有付出才有收获”、“完美永不存在”、“未知永远存在”、“现状无法马上摆脱”，都既清楚又简单，你必须要接受——不仅要接受，还要牢记；不仅要牢记，还要坚信，不容半点动摇。最好时常把自己的一些念头记下来，然后与这几条现实对照，看看它们是否与这些现实相符。之后，你会和所有人一样，发现自己常常在不知不觉之间被一些实际上完全不现实的念头所左右。这是正常的。但是，通过不时地记录、思考与反省，你会越来越善于甄别那些不现实的念头，进而摆脱他们的影响。这就是差别。很多人一生都不知道自己究竟有多么不现实。之前提到的“既勤奋又懒惰”的人群，基本上都是把这些现实当作老生常谈的道理——视而不见、听而不闻、从不记录、从不反省，才常常做出荒唐的决定，最终堕落到那分田地。</p><p>时间是现实的人的朋友，是不现实的人的敌人。时间不是故意要这样做，只不过事实如此。</p><h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><h3 id="估算时间"><a href="#估算时间" class="headerlink" title="估算时间"></a>估算时间</h3><p>错误估算任务所需时间，是最常见，也是最致命的错误。在时间领域有一个貌似悖论的<code>侯世达法则</code> 值得牢记：</p><blockquote><p>完成一个任务实际花费的时间总会超过计划花费的时间，就算制定计划的时候考虑到本法则，也不能避免这种情况的发生。</p></blockquote><p>一旦开始做事，就会发现<code>意外</code>继踵而至。原本做的准备根本不能解决问题，因为“经过准备的就不再是问题”，而真正遇到的问题个个都是之前不曾想象抑或无法想象的，解决一个问题的同时往往会产生新的问题……因此，所谓“渐入佳境”最终只能是少数人的感受，大多数人在此之前早已溃败。</p><p>为什么人们总是错误估计完成任务所需要的时间</p><ul><li>执行任务前，没有分辨任务的属性：它是熟悉的还是陌生的<ul><li>熟悉的：由于已经做过一次（或多次），所以，你清楚地了解该任务的每一个环节，知道应该如何拆解任务、应该怎样分配拆解出来的子任务、每一个子任务有多少个步骤、每一个步骤需要耗费多长时间、哪些步骤需要格外小心……在这种情况下，正确估算完成任务需要的时间是很容易的。</li><li>陌生的：在执行过程中必然会遭遇各种所谓的“意外”。其实它们根本不是意外，只不过是因为你对任务不熟悉，它们才成为了“意外”。实际上，这些“意外”是任何完成该任务的人都必然会经历的事情。 只有完整地执行一次任务，该任务的属性由“陌生”变为“熟悉”之后，才有可能顺利解决这些“意外”。</li></ul></li></ul><p>对学习来说，任务“陌生”的可能性更大，因为学习本身是一个探索未知的过程。完成学习任务常常需要花费比我们想象中多得多的时间。对工作来说，任务“熟悉”的可能性更大。因为工作本身是一个应用已知的过程。当然，不同的工作，情况还是有所不同。例如，有些工作需要更多创新，有些工作可能前所未有……所以，在现实生活中，我们需要完成的任务的真实属性往往是“一部分熟悉，一部分陌生”。这就从根本上解释了为什么前文描述的那个貌似悖论的法则总是应验——我们必须处理未知，而从陌生到熟悉，就需要花费时间去学习，这个过程无法逾越。</p><p>要想提高估算时间的能力，就要从现在开始养成习惯：做任何事情之前先判断其熟悉程度（或陌生程度），再据此判断估算完成任务所需要的时间。通常情况下，“反正比一般人想得长多了”倒是一个屡试不爽的假设。</p><h3 id="及时行动"><a href="#及时行动" class="headerlink" title="及时行动"></a>及时行动</h3><p>比“越早开始越好”更切实的答案是“现在就开始”。所谓做事拖延，不是拖延着做事，而是拖延着不开始做事。明知自己拖延的人很痛苦，因为他们不是不知道该做什么，而是不知道为什么“无法进入状态”</p><p>一个常见的原因是前文所述的“错误估算任务所需时间”， 总以为可以在最后期限之前完成，心里想着“时间还多的是 嘛！”可这并不是本质原因。本质原因在于恐惧——无论是来自内部的，还是来自外部的。</p><p>来自内部的恐惧在于：只要开始做事，一个人就要面临做错、做不好的风险。这原本是任何人都逃不掉的事情，但最终患上“拖延症”的人犯了一个简单的认知性错误，即认为那些能够做对、做好的人都是直接做对、做好的。从表面上看也好像确是如此。那些能够做对、做好的人，总是显得从容不迫、轻车熟路。面对这样的人，那些犯了错、做不好的人根本没办法不自卑、不怀疑自己……</p><p>所以，很多人做事拖延的原因不过是“不求有功，但求无过”的想法。没有哪一个拖延的人愿意承认自己是这样想的，但当他们扪心自问的时候，他们都知道这描述一针见血。</p><p>只要做事，就一定会出问题。这是现实。无论何人，无论何事。如果在做事的过程中没有出现任何问题，那肯定不是在做事，而是在做梦。</p><p>认清并接受这个现实很重要。只有这样，才能心平气和地去做事。说一个人不怕困难，那是假话。谁不想一帆风顺、马到成功？可现实就是如此。做事情的时候，肯定会遇到困难，事情越有价值，困难就越具规模。遇到困难的时候，心平气和地面对就好，因为这只不过是生活常态。有时我们花费了很多时间和精力依然没能解决问题，却眼见别人轻松过关，这确实令人气馁。不过，这也是生活常态——在任何一个特定领域，总有一些人比另一些人表现更好、费力更少。然而，在大多数情况下，有4个字颇具道理并且值得相信——勤能补拙。不过，真正相信这4个字的前提是“接受现实”，否则，这4个字发挥不了任何实际作用。</p><p>来自外部的恐惧在于过分在意外界的评价。人是一种很有趣的动物，在自己做对、做好之前，通常已经了解做对、做好是什么样子。于是，无论能否做对、做好，人都觉得自己有能力判断别人是否做对、做好。所以，尽管自己不怎么样，却可以振振有词、理直气壮地评价别人做得对不对、好不好。所以，一个人一旦开始认真做事，被嘲弄、被耻笑的几率将远远高于被夸奖、被鼓励的几率——这几乎是肯定的。也正是由于这个原因，使很多人怀有前文提到的“不求有功，但求无过”的微妙心态。 事实上，那些真正能够做对、做好的人，绝不会随意嘲弄、打击别人，因为他们是做对过、做好过的人，他们一路走过来，心里非常清楚做对、做好有多么不易，所以，他们会不吝一切机会去鼓励那些尝试做事情的人。这甚至可以当作一种测试方法：如果一个人经常嘲弄他人，那只能说明他自己不怎么样；否则，他会像那些极少数已经做对、做好的人一样，给予别人真诚的鼓励而非嘲弄。尽管那些能真正做对、做好的人有时也会给出负面评价，但这些评价通常是“建设性的负面评价”，并不是为了获得优越感而发出的嘲弄。</p><p>所以，我们没有必要在意来自他人的、非建设性的负面 评价。没有谁从一开始就能做对、做好。所有做对、做好的 人都是一路磕磕绊绊走过来的，这就是生活常态。而动辄给 出非建设性负面评价的人，往往不是正经做事的人，他们和 那些正经做事的人身处不一样的世界，这也是生活常态。</p><p>还有一个微妙的现象需要注意。尽管在一般的环境中，时间的运动是匀速的，但实际上，就人的主观感受来说，时间的运动肯定是加速前进的。对“为什么随着年龄的增长每个人都会觉得时间过得越来越快”这个问题，心理学家有一个简单明了的解释：</p><p>对一个5岁的孩子来讲，未来的1年相当于他已经度过的人生的¹⁄₅，即20%；而对一个50岁的成年人来讲，未来的1年只相当于他已经度过的人生的¹⁄₅₀，即2%。所以，随着年龄的增加，人们会觉得时间运动得越来越快。</p><p>更重要的是，人在小时候没什么事情可做，就愈发感觉时间过得慢；随着年龄增加，要做的事情越来越多，当然就愈发感觉时间过得飞快，稍纵即逝。由此看来，小孩子的感觉自然是“那时候天总是很蓝，日子总过得太慢”，而“人生犹如白驹过隙，瞬间而已”大都是老年人的慨叹，也是他们的切身感受。</p><p>如果能将这种认识纳入自己的心智，你就不会再对“最后期限”有那么荒谬的幻觉了。只要接受了必须完成的任务，你就会有真切的紧迫感，因为你知道，时间必然越走越快。而且，你现在就已经明白：“最后期限”不是固定在将来的某一点，而是朝着你加速扑来。有的时候，也许还没开始就发现自己已经晚了。在这样的情况下，唯一的策略依然是“现在就开始”。否则更待何时？在起步晚了的情况下，问题不是“到时候能不能做好”，而是“<strong>到时候能做多好就做多好</strong>，总好过什么都不做”。明白了这个道理，不管遇到什么任务，永远不要再问“什么时候开始才好”，因为答案只有一个：“现在”！</p><h3 id="直面困难"><a href="#直面困难" class="headerlink" title="直面困难"></a>直面困难</h3><p>就算没有低估完成任务所需要的时间，就算已经按时开始执行任务，很多人还是没有按时完成任务。为什么有的人好像一直在忙，却总是拿不出成绩、做不出成效？</p><p>无疑，他们的效率低下。而效率低下的根本原因是什么？答案是：回避困难。</p><p>稍微思考一下就能明白，合理的时间安排应该是这样的：迅速做完简单的部分，把节约出来的时间放在困难部分的处理上。然而，很多人会下意识地回避困难，于是乎，他们的时间安排是这样的：用几乎全部时间处理简单的部分，至于困难的部分，干脆“掩耳盗铃”，视而不见，暗地里希望困难自动消失……</p><p>这样的行为与做事的动机有关。人做事的动机往往来自两个截然相反的原因：奖励与惩罚。人都喜欢被奖励，讨厌被惩罚。从最浅的层面上看，尽力做能够获得奖励的事情显然是划算的，回避做可能招致惩罚的事情显然是合理的。然而，从另一个层面上看，接受惩罚往往是积累经验的起点，甚至是唯一的起点。这就是俗话所说的“吃一堑，长一智”。很多时候，为了能够“长一智”，必须先“吃一堑”，西方称之为“挫折教育”。</p><p>很多事情并不是一过性的，总会阶段性地有奖有罚。受到奖励之后，原本有两个选项：“再次来过”和“见好就收”。有意思的是，绝大多数人会自动忽视第二个选项 。受到惩罚之后，同样有两个选项：“从此碰都不碰那件事情”和“挣扎着找一个出路”。同样有意思的是，绝大多数人还是会自动忽视第二个选项。</p><p>所以，<strong>很多人实际上根本不知道自己所谓的“喜欢做某件事情”很可能只是因为那件事情相对简单、容易获得奖励而已</strong>。拖延的人并非不做事，他们做事，甚至做很多事。拖延的人也并非不努力，他们会花很长时间去做事，但做的只是很多简单的事。他们每次回避困难的时候，都不是故意的，并且往往已经给自己找了恰当的借口。这借口太强大、太有力，以至他们真诚地相信：“我喜欢做有创意的事情，而现在手上的这些事情太枯燥，我确实提不起兴趣……”</p><p>如果不能控制这种逃避的倾向，再多、再好的任务管理技巧都是无效的，因为任务中相当重要的一部分（通常因为重要而困难，也因为困难而重要）永远无法完成。所谓效率，是在任务完成之后才能够衡量的。这样看来，对逃避困难的人来讲，因为没有完整地完成任务，所以无论他们花了多长时间，也都没有效率（相当于分子为零）。</p><p>现实中，这种现象无处不在。比如学习上，准备托福考试时只做阅读和听力但不练习口语和写作；比如工作上，做项目计划时只讨论做什么却从不提及怎么做；比如生活上，总是把“我爱你”挂在嘴边却从来不花时间想想恋人真正需要的是什么……这些问题都源自同一个习惯：专做简单的，回避困难的。</p><p>所有真正踏实做事的人都知道，任何任务的绝大部分都是枯燥而又无趣的，所谓有创意的部分，可能连1%都不到。 </p><h3 id="关注步骤"><a href="#关注步骤" class="headerlink" title="关注步骤"></a>关注步骤</h3><p>任何任务都起码具备3个属性：何事（What）、何因（Why）、何法（How）。清楚了解一个任务的这些属性，对最终能否完成该任务起着决定性的作用，所以应该多花一点时间去“三思”。</p><p>在大多数情况下，这3个方面中最为关键的实际上不是内容，也不是原因，而是方法。因为任务的内容与原因常常不言自明，而方法却并非唾手可得。</p><p>思考方法需要从领悟内容入手，不停地细分、拆解任务，而且越具体越好，直至每个小任务都可以由一个人独立完成。</p><p>对任务的每一次“具体化”与“细分拆解”都要反复询问“原因”。</p><p>做任何事情，学会思考方式最为重要。</p><p>要学着像一个项目管理者那样思考——他们更多地关注“方法”，他们会花费比别人更多（多出许多倍）的时间去落实每一个步骤，在确认无误之后，他们才会有效地分配任务，团队才能够切实可靠地完成任务。 只有学会像项目管理者一样思考，他才能给自己分配具体的任务、制定切实可行的计划，最终高效地完成任务。</p><p>在做任何事情之前，通过关注“方法”去反复拆分任务，最终确认每个子任务都是可完成的，这是一个人不可或缺的功课。这样的习惯，会使一个人变得现实、踏实。这是一种习惯，也是一种后天习得的技能。这种技能无比重要，却常常被忽视，因为掌握这种技能的人总是默默地应用它，而忽视这种技能的人从未看到过它的具体实施过程和巨大好处。</p><h3 id="并行串行"><a href="#并行串行" class="headerlink" title="并行串行"></a>并行串行</h3><p>在任务管理的过程中，可以运用类似的方式去思考任务与任务之间的关系：这两个任务之间究竟应该是串行关系，还是并行关系？</p><blockquote><blockquote><p>无论学到了什么东西，都可以接着问自己：“那……这个道理还可以运用在什么地方？”反复问自己这种简单问题，能够锻炼自己融会贯通、举一反三的能力。 为什么呢？上过中学的人都应该明白“省功不省力、省力不省功”的物理原理啊！其实，这些人缺乏的就是这种思考能力或者说思考习惯。</p></blockquote></blockquote><p>这个问题非常重要，因为在一般情况下，“提高效率”指的就是“本只能串行完成的两个任务现在可以并行完成”。</p><p>最直接的办法是尽量将两个任务并行。比如，在跑步的时候听英语，在写文章的时候听音乐，在等班车的时候看书等。</p><p>养成一个习惯——把要做的事情用纸笔写出来，把任务落到纸面上，就可以比较容易地分辨出哪些任务是简单而又机械的，哪些任务是相对复杂而又灵活的（对我个人来讲，需要思考的就是“非机械”的），然后，尝试把一个非机械的任务和一个机械的任务搭配起来完成。</p><p>并行两个任务的一个重要前提是执行者足够了解这两个任务，且对自己有足够清楚的认识，即，对执行者来说，这两个任务是“主动并行”的。被动发生的并行任务往往只能使效率变得更为低下。（我在生活中生生剔除的一个被动并行任务就是“接电话”。从好多年前开始，我就把自己的手机设定为“静音”状态，从不主动接电话——而是每隔一两个小时查看一下电话，有必要的就打回去。当我有条件给自己安排一间不受人打搅的“工作室”后，终于再一次大幅消减了“被动并行”造成的时间和精力的浪费。）</p><p>当一个任务比较庞大，需要划分为多个步骤或者多个子任务的时候，对这些子任务之间的关系需要仔细甄别。甄别后，可能会因此产生若干个行动方案，而针对这些方案可能还需要反复衡量才能找到最佳方案。</p><p>优化的前提是“大任务被划分成足够多又不太多的小任务”。有了这样的前提，你才有能力分辨哪些任务可以并行——所谓的“优化”，其实是很简单的。</p><p>让自己拥有“多任务操作系统”的另一个方法就是切分自己的时间。（多任务操作系统把一个长时间段划分成很多短小的时间片，每个时间片只让处理器执行一个进程。循环反复的过程中，有些任务完成了，另一些任务处于尚未完成的状态，如果有新的任务进来，只需要加入循环队列即可。看上去好像是操作系统同时运行着很多进程，而实际上，它靠的是类似视觉暂留现象的机制）</p><p>把自己的时间切分成“时间片”是一种很难习得的能力，不过这种能力在大多数时候用不上，只有在任务太多、时间太紧的情况下，我才使用这种能力。应用这种能力时，要先坐下来制定一个工作列表，把任务罗列出来，然后把自己的时间“切片”。我通常把“20分钟工作+5分钟休息”作为一个时间片，然后就开始像处理器一样处理任务。这样做可以<strong>保持相对长时间的高效率工作</strong>。</p><p>尽管说起来很简单，但其实需要反复应用才能把这种简单的思考模式变成习惯。一旦养成精细拆分任务的习惯，效率就会在不知不觉间提高了。</p><h3 id="感知时间"><a href="#感知时间" class="headerlink" title="感知时间"></a>感知时间</h3><p>李敖每天的“事件日志”：除了自己经历的事件之外，一概不记，而且尽量不记感想，不记感受，只记录事件本身。 </p><p> 做这件事其实每天只需要花10分钟左右。后来为了进一步节省时间，我干脆在这个本子上穿了根绳，挂在家里洗手间马桶面对的那面墙上，每天晚上睡觉前坐在马桶上，顺手就写完了。这样简单的日志是有巨大好处的——每年下来，我都知道自己去年都做了些什么，仅仅这一点，就非常宝贵了。到了30岁之后，我才觉得自己做的真正有意义的事情慢慢多了起来。 </p><p>柳比歇夫的日志，是“事件―时间日志”（Event-time Log）。他的方法要比李敖的方法更高级。李敖的事件日志，往往只能记录事件的名称，是一种基于结果的记录；而柳比歇夫的“事件―时间日志”是一种基于过程的记录。它们的细微差别在于，基于过程的记录要比基于结果的记录更为详尽。</p><p>权摘抄《奇特的一生》中柳比歇夫的日志为例。</p><blockquote><p>乌里扬诺夫斯克。一九六四年四月七日。分类昆虫学（画两张无名袋蛾的图）——三小时十五分。鉴定袋蛾——二十分（1.0）。</p><p>附加工作：给斯拉瓦写信——二小时四十五分（0.5）。</p><p>社会工作：植物保护小组开会——二小时二十五分。休息：给伊戈尔写信——十分；《乌里扬诺夫斯克真理报》——十分；列夫·托尔斯泰的《塞瓦斯托波尔纪事》——一小时二十五分。</p><hr><p>基本工作合计——六小时二十分。</p></blockquote><p>基于过程的记录，不仅更详尽，还有另外一个巨大的好处——结果不好的时候更容易找到缘由。想明白“基于过程的”与“基于结果的”两种记录之间的区别之后，我开始尝试着在自己记录的每个事件后面加上时间：它会使你对时间的感觉越来越精确。</p><p> 通过实践，我发觉这种基于过程的“事件―时间日志”记录可以调整我对时间的感觉，在估算任何任务的工作量的时候，都更容易确定“真正现实可行的目标”。此外，相对准确的估算又使得目标基本上都可以达成，由此可以算是“战胜了焦虑”。</p><p>网易的“Mr.Time”——一个用来记录时间开销的应用。Mr.Time用起来很简单：做任何事情之前，拿出手机，打开应用，摇一下，事情做完之后，再摇一下。如此这般确定了时间起点和终点之后，再抽空将具体事务分类、编辑、细化。Mr.Time解决了两个问题：一方面简化记录时间开销的过程，另一方面自动完成记录后的整理、分析、统计工作。有了这个应用，记录时间开销应该不算麻烦了。</p><p>既然管理时间是不可能的，那么解决方法就只能是：想尽一切办法真正了解自己、真正了解时间、精确感知时间，而后再想尽一切办法使自己以及自己的行为与时间“合拍”。按我的话说就是——“与时间做朋友”。</p><h3 id="制定预算"><a href="#制定预算" class="headerlink" title="制定预算"></a>制定预算</h3><p>除了每天记录时间开销之外，还要养成一个习惯：每天制作时间预算</p><p>在开始一天的活动之前，花费15至30分钟仔细制订当天的时间预算绝对是特别值得的，恰如另一段“陈词滥调”——磨刀不误砍柴工。</p><p>最直接的方法就是制作一个列表，把今天要做的事情列出来。为了表述方便，后文把这些列表中的事情称为“任务”。</p><p>当然，在罗列这些任务的时候，你的大脑就要自动开始估算完成每项任务究竟要花费多少时间了。很快，你就会遇到第一个问题：任务太多，无法全部完成。于是，你只好进行选择。</p><p>事实上，生活就是选择。</p><p>解决这个问题的方法倒也简单，就是给列表中的每项任务标上权重，例如可以用1～5分进行标注。但是请注意，不要像某些书籍建议的那样使用1～10进行标注，因为大多数情况下，人们很难那样精确地分辨事情的重要程度。实际上，我认为对大多数人来讲，用“1、2、3”已经足够，因为这种设计基本上可以代表：</p><blockquote><p>▷ 不重要</p><p>▷ 一般</p><p>▷ 重要</p></blockquote><p>当然，根据个人喜好，你也可以用“1、0、−1”进行标注。<strong>同样的事情可以通过很多种方法完成，选择自己喜欢的方法往往就是最优策略</strong></p><p>一旦开始尝试去给要做的事情标注权重，你会发现，这件事并没有那么容易，即便只用最简单的方法——只用“重要”和“不重要”进行标注，因为我们必须分辨“真的重要”和“显得重要”，以及“真的不重要”和“显得不重要”，可对照下图来看。</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220205152814.png" alt="img" style="zoom:50%;" /></p><p>判断一项任务是否“真的重要”其实只需要一个标准：这项任务的完成是否确实对目标达成有益。可是，作为一个正常的、健全的、拥有七情六欲的普通人来讲，不挣扎一下，就很难完全专注于这个最关键、最根本的决策标准。</p><p>每个人都喜欢做有趣的事情，做的时候往往并不关心这件事到底有没有用。可是，有趣的事不见得有用啊！</p><p>如果我们能甩甩头，强迫自己理智一些，就会知道：无用的事情，哪怕非常有趣都不应该去做；而有用的事情，哪怕非常无趣，都应该去做。 </p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220205153005.png" alt="img"></p><p>审视一下自己的生活，你就可能痛苦地发现自己经常仅仅因为非常有趣就去做的那些事其实没什么用。</p><p>目标不用向任何人学习，每个人都或多或少、或清楚明了或含混模糊地有自己的目标——不管是什么所谓的“理想”或者“痴心妄想”。现在就开始把自己的那些哪怕不切实际的目标作为标准来判断吧——判断每项任务的真实属性，然后选择“真的重要的”或者“显得不重要的”。</p><p>相信我，养成任何一个哪怕很小的习惯都需要挣扎。然而，貌似痛苦的挣扎过程，在将来的某个时刻终将变得其乐无穷。</p><h3 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h3><p>很多时候，我们面临的抉择就是“计划还是率性，是个问题”。在大多数情况下，计划总是必要的。在与计划相关的格言中，我最喜欢的是：“我们不是计划着失败，而是失败地计划</p><h4 id="计划成功的前提：目标现实可行"><a href="#计划成功的前提：目标现实可行" class="headerlink" title="计划成功的前提：目标现实可行"></a>计划成功的前提：目标现实可行</h4><p>对像我这样的普通人来说，证明我的目标现实可行的方法比较简单：</p><ol><li>已经有人做到了。</li><li>我与那个人没有太大的差距。</li></ol><p>“已经有人做到了”，并不代表我也能做到。他用多长时间做到的？他通过什么方式做到的？我和他的区别究竟在什么地方？哪些是我确实无法超越的？我的相对优势在哪里？我有没有可能通过一些方式弥补我的相对缺陷？也许还要问更多的问题，才能够确定我们的目标确实是现实并且可行的。</p><p>事情往往并不像想象中那么简单。我们更常面临的尴尬是：<strong>如果不开始行动，根本就无从判断目标是不是确实可行</strong>，或者反过来，目标是不是确实不可行。于是，往往只有开始行动之后，才能做出正确的判断。在行动过程中，<strong>如果发现既定的目标确实是不现实、不可行的，那么“半途而废”不仅不意味着失败，反而意味着决策者的无比理智。</strong></p><h4 id="长期计划是需要通过实践才能习得的能力"><a href="#长期计划是需要通过实践才能习得的能力" class="headerlink" title="长期计划是需要通过实践才能习得的能力"></a>长期计划是需要通过实践才能习得的能力</h4><p>有人说“计划总是没有变化快”。这话听上去挺现实，却没说到点子上。计划总是被变化打乱的深层次的原因在于：计划过于长远。事实上，无论变化多快，计划总应该是有的，只是在制定计划的时候，应该考虑到变化，应该以自身的情况分析自己究竟适合制定多久的计划。</p><p>通过实践发现：如果一个计划的期限只有一个星期，我是很容易坚持下来，并且往往可以出色完成的。这个发现令我非常开心，因为我发现自己还是可以做一些事情的。而随着时间的推移，我发现自己竟然可以慢慢把计划期限延长，两个星期、一个月，后来甚至可以制定一个季度的计划！</p><p>在目标现实可行、方向确定的情况下，辅以计划，才能成功。一般来讲，期限越短、内容越清晰，目标就越容易实现。长期目标、人生理想固然要有，但理想这东西往往太遥远，以至我们总是看不清楚。不过，看不清楚也没关系，“千里之行始于足下”，我们实际要做的事情只是一步一步地走，把每一步都走好，走得足够踏实。至于“千里”之外的终点，既然连看都看不清，就不用花时间去想了，因为想了也没用。</p><h3 id="有些时候没必要做计划"><a href="#有些时候没必要做计划" class="headerlink" title="有些时候没必要做计划"></a>有些时候没必要做计划</h3><p><strong>计划固然重要，行动更为重要。</strong></p><p>计划无论简单还是复杂，缺乏切实的行动就注定会失败或者失效。我的经验是：有些时候故意不做计划反倒是有益的。</p><p>综上所述，没必要做计划的原因主要有两个，除了前面提到过的“任务其实非常简单”之外，另一个原因是“初始状态下，我们往往并没有能力去制定合理有效的计划”。做任何事情，都可能经历相同的过程：逐步熟悉，小心摸索，失败、失败、再失败，认真反思，卷土重来，直至成功。而最初，在我们对任务连基本的认知都没有的时候，制定出来的计划十有八九只不过是空谈。</p><blockquote><p>基于经验： 所有的大额消费活动，乃至其他一切涉及金钱的活动，诸如投资之类，“马上行动”的建议肯定不适用。相反，这种情况下，一定要拖延，拖得越久越好 </p></blockquote><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>制作一个列表，往往会使自己做事井井有条，并保证自己不会白白浪费时间。 </p><h4 id="最方便的列表工具是纸和笔"><a href="#最方便的列表工具是纸和笔" class="headerlink" title="最方便的列表工具是纸和笔"></a>最方便的列表工具是纸和笔</h4><p>我建议，尽量不要使用安装在台式或便携式计算机上的列表管理软件——尽管那些程序都设计得非常好，但它们却远不如纸和笔来得方便、有效。台式计算机不大可能随身携带，便携式计算机倒是可以随身携带，但远比纸和笔笨重，而且从待机状态恢复到工作状态往往需要等待</p><p>纸和笔很难被完全替代的另一个重要原因是：除了它们之外，我们很难再找到可以用来随手写写画画的工具了。很多时候，画比写重要，哪怕可能仅仅是画一个圈或者几个箭头而已。</p><h4 id="列表没必要工整"><a href="#列表没必要工整" class="headerlink" title="列表没必要工整"></a>列表没必要工整</h4><p>列表的读者往往只有我们自己，所以列表只要自己能看懂就够了。用最简便的方式制作列表才最合理：大量的缩写、箭头、线条以及各种各样的符号和圈圈框框……</p><p>曾经突然发现自己着迷于把各种列表做得工工整整，但这对实现列表的价值而言毫无意义，纯粹是在浪费时间。想明白这一点后，我就开始有意识地控制自己，<strong>让自己不要去做那些没有实际意义的事情</strong></p><h4 id="列表一定要随手可及"><a href="#列表一定要随手可及" class="headerlink" title="列表一定要随手可及"></a>列表一定要随手可及</h4><h4 id="最重要的任务永远只有一个"><a href="#最重要的任务永远只有一个" class="headerlink" title="最重要的任务永远只有一个"></a>最重要的任务永远只有一个</h4><p>我见过很多专家讲解任务的重要和紧急与否之间的关系，以及如何分配任务的优先级。道理是很清楚的：先做既重要又紧急的；不重要又不紧急的当然不用理会；紧急却不重要的，亦可不必理会；可若是重要却不紧急的，反倒得优先处理</p><p>然而，我通过观察发现，大多数人面临的真正问题并不是弄不清楚这个道理，而是无从分辨“真的重要”和“显得重要”以及“真的紧急”和“显得紧急”。判断一件事情是否真的重要，标准只有一个：<strong>是否对目标（无论是长期还是短期）的实现有益</strong></p><p>然而，判断一项任务是否真的紧急，标准却并不好找，因为人总会觉得每一件事都很紧急。事实上，真正紧急的事少之又少，“十万火急”几乎只出现在故事里。</p><p>以，评价任务只需要一个判断标准，那就是：它是否真的重要。再往后的道理一目了然：最重要的任务永远只有一个——那个真正对目标的实现有帮助的任务。</p><h4 id="制作专门的下一阶段任务列表"><a href="#制作专门的下一阶段任务列表" class="headerlink" title="制作专门的下一阶段任务列表"></a>制作专门的下一阶段任务列表</h4><p>除非万不得已，否则千万不要在整个任务完成之前中途更改列表中的项目。一旦这么做了，那随之而来的就是发现自己“有必要”不停地更改这个列表中的某个或多个项目，最终甚至会导致整个任务永远无法完成。</p><p>所以，如果有了什么新鲜的主意，启用另一个列表，标题是“下一阶段务列表”，把它们记下来就好。然后，马上回到当前的任务列表，专注在现在应该完成的任务上。如果你又有了新鲜的主意，如法炮制即可。这样做的好处在于：一方面，不会影响当前任务的进度；另一方面，在当前任务完成之后，那个“下一阶段任务列表”上已经有相当数量、非常具体的待处理项目了</p><h3 id="给每个任务制定一个核对列表"><a href="#给每个任务制定一个核对列表" class="headerlink" title="给每个任务制定一个核对列表"></a>给每个任务制定一个核对列表</h3><p>为了万无一失，我们需要提前制作一个可以勾画的核对列表，逐一核对，避免缺漏。</p><p>列表一旦开始运作，就一定要执行到底。</p><p>事无成的最根本原因就是放弃。放弃的方法有很多种， 最常见的是“换一个更好的方向”。如果确实是一个更好的 方向倒也罢了，但事实上更好的方向并不存在，因为照此下去， “更好的方向”会不断出现。千万不要觉得认为自己能够不停地找到“更好的方向”的人不多，其实大家都会不停地“找到更好的方向”。</p><p>走向成功的过程就好比项目的起点是南极，而终点在北极——无论最初往哪走，只要中途不改变方向，早晚会到达终点。但是，如果中途改变过方向，更极端的——经常改变方向，就怎样都无法到达终点，甚至可能返回起点。所以，开始行动之前要先判断列表所代表的任务是否现实。如果确实觉得自己能够也应该完成这个任务，那就着手去做，而且一定要执行到底。</p><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>无论是学习、工作还是生活，我们面临的任务大都是重复性的。要想加快执行重复性任务的速度，只需在遇到重复性任务时先将其做完一次，然后马上总结、整理，搞清流程，再靠进一步的实践把它变成“闭着眼睛也能做好”的事。这是提高效率、减少失误的根本手段。</p><p>为常见任务制定流程是一个必须养成的习惯。一个人在梳理流程的过程中，会不由自主地思考个中细节。有些人做事仔细，其实只不过是因为他们很早就养成了这个简单的习惯而已。而另一些人，总感觉自己够聪明，却在实际工作中频繁出错，也只不过是因为他们尚未养成这个简单的习惯而已。这个简单的习惯，日久天长，会让人与人之间产生巨大差异。</p><h3 id="预演"><a href="#预演" class="headerlink" title="预演"></a>预演</h3><p>需要执行的任务越重要，这种预演就越关键。只有经过大量的预演或者练习，我们才能够在实际执行任务的过程中有出色的表现。这也是良性循环和恶性循环之间的选择和差异。准备充分的人，常常会有出色的表现，最终能够顺利地完成任务，而这样的经验会使他更加坚信提前准备的重要。准备不充分的人，执行任务时必然表现欠佳，但不管表现多差，他也提前做了一点准备（或者自认为做了一点准备），但这样的经验却会让他觉得准备是没什么用的，至少是没什么大用的，于是下一次他还会采取同样的行动，还会面临相同甚至更为严重的尴尬……</p><p>我认为，万事皆可提前准备，万事皆需提前准备。只有前期准备充分，才能在实际执行任务的时候有出色的表现。</p><h3 id="验收"><a href="#验收" class="headerlink" title="验收"></a>验收</h3><p>很多人做事半途而废、不了了之的根本原因在于从未想过要给自己执行任务时的表现设计一个验收机制。最基本的验收机制是针对最终结果的，部分有经验的人因为在做事之前总是更关注步骤，并会按照需求将任务拆分成若干个子任务，所以，他们甚至会为每一个步骤设计相应的验收机制。</p><p>由此可见，验收机制相当重要。从这个角度讲，我们不管遇到什么任务，都应该对其认真审视，同时向自己提出一个问题并要想办法回答清楚：“怎样才算‘做好’？”如果能把任务拆分成若干个子任务，那么确定“做好”的标准可能更容易一些，因为每个子任务的验收标准可能已经自然存在，起码有这么一条：“如果这个做不好，那么下一个就没法开始……”</p><p>为了能将验收机制落到实处，我们应该在做一件事情之前，拿出纸和笔写下每一个预定的验收标准。</p><p>从更高的层面上说，<strong>设计验收机制也是任何一个领导者必须拥有的基本能力</strong>。哪怕你领导的只是一个很小的团队，你也都必然要向团队成员指派各种各样的任务。在这种情况下，如果你没有设计验收机制，最终的结果肯定会让你非常失望，因为缺少验收机制会使团队成员对自己的工作质量毫不介意，长此以往，团队的执行力将等于零，作为团队领导者的你也必须承担失败的责任。</p><h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><h3 id="效率本质"><a href="#效率本质" class="headerlink" title="效率本质"></a>效率本质</h3><p>学习”最关键的一点是：任何知识的获取，都是不可逆的。在知道它的那一瞬间，它就已经改变了一切，生活因它而变，却无法还原。我们再也不可能对它视而不见、听而不闻、置之不理，它瞬间就能根深蒂固，无法铲除。</p><h3 id="摒弃经验-主义-局限"><a href="#摒弃经验-主义-局限" class="headerlink" title="摒弃经验(主义)局限"></a>摒弃经验(主义)局限</h3><p>所有的人获取知识最为基础的手段就是“体验”。“经验”在一定的层面上是适用的，不能否定它的重要价值，但与此同时，必须认清“经验主义”的局限。</p><p>在知识正确传播的过程中，语言、文字以及逻辑思维很重要。</p><h3 id="自学能力"><a href="#自学能力" class="headerlink" title="自学能力"></a>自学能力</h3><p>本科教育之“本”在于培养学生的自学能力。从理论上讲，一个人本科毕业之后，应该有能力自学他所需要的任何知识。</p><h4 id="检索能力建立在相当熟练的阅读理解能力的基础之上"><a href="#检索能力建立在相当熟练的阅读理解能力的基础之上" class="headerlink" title="检索能力建立在相当熟练的阅读理解能力的基础之上"></a>检索能力建立在相当熟练的阅读理解能力的基础之上</h4><h4 id="实践能力是自学能力最终转化为真正价值的根本"><a href="#实践能力是自学能力最终转化为真正价值的根本" class="headerlink" title="实践能力是自学能力最终转化为真正价值的根本"></a>实践能力是自学能力最终转化为真正价值的根本</h4><p>我看到过一句令人非常震撼的话：很多人正是因为没有目标才不停地“学习”。许多人都曾慨叹：工作之后才知道什么真正有用</p><p>道自己需要的是什么之后，真正的学习才算开始。比如学英语：很多人天天在学却从来不用。背单词坚决不造句，却去练习什么词根词缀记忆法或联想记忆法；背了那么多单词，却从不读英文文档，从不写英文文章。 其实，掌握2000个基础词汇、了解基本语法规则之后，就应该去“用”英语了。</p><h3 id="永远保持开放的心态"><a href="#永远保持开放的心态" class="headerlink" title="永远保持开放的心态"></a>永远保持开放的心态</h3><p>我们的大脑有一个运行机制叫“选择性输入”，其具体表征在很多人身上都有体现：他们只能听到自己喜欢听的，只能看到自己想要看的。</p><p>对抗“选择性输入”的最好办法就是借助我们最好的记录工具——纸和笔——有条件的话，最好固定一段时间来把那些目前暂时无法理解的、支持的、反对的、无所谓的论点和观点记录下来。对无法理解的，写下自己当时的疑惑何在；对支持的，记录几个理由或者实例；对反对的，同样记录几个理由或者实例；甚至对那些无所谓的，也记录其原因。一个有着这样良好记录习惯的人会获得他人无法拥有的处理信息和知识的能力——“反刍”。这种“反刍”能力是我们避免成为“选择性输入”受害者的重要保障。</p><h3 id="了解学习的进程"><a href="#了解学习的进程" class="headerlink" title="了解学习的进程"></a>了解学习的进程</h3><h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><h3 id="勤于思考"><a href="#勤于思考" class="headerlink" title="勤于思考"></a>勤于思考</h3><p>一旦开始尝试独立思考，我们就会发现，陷阱无处不在。这些陷阱直接导致无数人放弃思考——因为在很多时候，思考虽然不费力气，但实在是太麻烦了。为了避免麻烦而把思考推给别人是一种常见的解脱手段，由此，大多数人身上出现了大量“迷信权威”的现象，只不过是程度不同。“迷信权威”本身就是一个典型的陷阱：权威的意见可能更加准确，可是，权威也好、专家也罢，滥竽充数的实在不少。为此我们不得不常常采取“求人不如求己”策略。这也展现了一个无奈的事实——我们生活在一个信任成本极高的社会。</p><p>独立思考的一把钥匙是这样的——</p><p>首先要了解：权威不一定等于正确。进一步要明白：就算权威正确，也只是权威表达了正确，而非正确属于权威。最后要清楚：准确地说，权威只是权威、正确就是正确，它们俩什么时候都不是一回事。</p><p>从另一个角度看，拒绝独立思考、把思考的工作交给别人，不仅不省时间，恰恰相反，非常浪费时间——甚至浪费一生的时间。</p><h3 id="思维陷阱"><a href="#思维陷阱" class="headerlink" title="思维陷阱"></a>思维陷阱</h3><h4 id="概念不清"><a href="#概念不清" class="headerlink" title="概念不清"></a>概念不清</h4><p>学习任何知识最重要的一点，就是搞清楚它所有的基础概念。不夸张地讲，任何一个学科的所有知识，都是由这些概念一点一点搭建起来的。</p><h3 id="感悟与道理"><a href="#感悟与道理" class="headerlink" title="感悟与道理"></a>感悟与道理</h3><p>“道理”应该是普适的，而“感悟”只来自个体经验。 很多的“感悟”是有局限的，甚至可能是有很大误导性的。</p><p>——成功者其实没有必要、没有义务，也往往没有足够的时间去讲述所有的细节。相信我，如果仅仅用财富、权力、地位来衡量成功（即世俗意义上的成功），那么所有的成功背后都有数不尽的磨难，同时，也往往充斥着大量不可告人的细节。比如，国内某大企业的老板肯定不会对所有人说他在受到各个方面的巨大压力后才做出某些决定。追求巨大财富的人是如此，追求巨大权力和至高无上地位的人更是如此。</p><p>如果某个人把他们说的当作全部，把他们没说的当作没有，那么这就是掩耳盗铃了。</p><p>一定要了解这样一个事实：有些时候，“成功者”的经验没什么用，因为那些经验根本就是错误的，关键在于“成功者”自己可能也并不了解。比如，他们遇到了一个经济飞速增长的时代，无论做什么都赚钱，并且赚得很多，所以从宏观上来看，根本就不是他们自己所认为的宝贵经验在起作用，而是宏观经济给了他们这样的机会。但是，有谁愿意承认自己的成功跟自己的经验没有关系呢？人类普遍拥有的一个认知偏差就是：把成功揽到自己身上，把失败归咎于别人或者坏运气。</p><p>最后，要知道有些“宝贵经验”就算正确，放到别人身上也可能并不那么灵验。最可能让一个人误入歧途的，就是他对自己的了解。</p><p>比如，成功者们常说，他们并不在意钱，他们知道人格的可贵。但是，大部分听众和他们不一样。大部分听众现在没有足够的钱！相信我，绝大多数人，在没有钱的时候，对“人格可贵”的理解很难非常深刻。人活着是要吃饭的，一个人的家眷是不应该被饿着的，在基本条件都不能保障的时候，“人格有个屁用”就成了很多人的选择。</p><p>与其关注成功者，不妨反其道而行之——努力从失败者身上汲取经验。因为失败者的失败往往是显然的、确定的，失败的真正原因也往往很容易查实（尽管失败者会找各种各样的借口）。并且，我们身边失败者的数量，显然要多于成功者的数量。如此，我们也就有了更多的观察机会。</p><h2 id="交流"><a href="#交流" class="headerlink" title="交流"></a>交流</h2><h3 id="说与不说"><a href="#说与不说" class="headerlink" title="说与不说"></a>说与不说</h3><p>在我年纪很小的时候，父亲就告诉我：一定要想办法不时做出令人敬佩的事情，这样就会有人主动找你做朋友。我当时并不懂得其中的道理，直到自己过了30岁才意识到一直按他说的去做所带来的巨大好处。“赢得尊重”是最不能急于求成的，也绝对不可能靠临时抱佛脚实现。</p><p>“话说出来之后有没有人听”是一个极为有效的自我评估标准。有人听，就说明自己所处的状态；话说了，别人却“听而不闻”，甚至有（对自己来说意外的）异常反应，就说明自己积累得还不够。积累得不够就接着攒罢。我一直觉得“攒人品”的说法不仅是有趣的，还是相当精巧的。</p><p>对很多人来说，“知无不言，言无不尽”在大部分情况下是最浪费时间和精力的做法。 </p><p>我个人认为，在分享知识的时候，“知无不言，言无不尽”是正确的；而在日常交流中，这个原则的适用性非常差。</p><h3 id="共生状态"><a href="#共生状态" class="headerlink" title="共生状态"></a>共生状态</h3><p> 如果我们在任何讨论中发现参与者里面有“自以为是”者存在，那么最好的选择只有一个：退出讨论。因为，只要他们存在，讨论就不再是讨论，也不会得出任何有意义的结果，继续下去只会浪费自己的时间。而我们千万不要自以为是到认为自己有能力、有时间、有责任、有义务教会他们“想明白”的本领，甚至带他们跨越那道难倒大多数人的障碍，这任务几近不可能完成。</p><h3 id="正确复述"><a href="#正确复述" class="headerlink" title="正确复述"></a>正确复述</h3><p>如果甲与乙两个人需要沟通，过程是：甲将他的想法用他的语言表达出来（即“编码”），乙用自己的方式去理解甲的语言（即“解码”），然后反过来再次进行。此过程可能重复数次。</p><p>但是，不同人的“编码/解码”机制常常也不相同。每个人的“编码/解码”机制都是依靠长期积累获得的，而且深受环境的影响。</p><p>况且，发送者生成他的想法——所谓“想明白”——本身就不见得是一件容易的事情，“编码/传递/解码”这3个过程也不一定能够协调无误地实现。再加上即便接收者“解码”正确，他还要把结果与自己的现有知识体系融合，而这也不一定能顺利完成。正确、顺利、有效的沟通到底有多难？ </p><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="兴趣"><a href="#兴趣" class="headerlink" title="兴趣"></a>兴趣</h3><p>其实并不是对自己正在做的事情没有兴趣，而是没有能力把目前正在做的事情做好。几乎没有人会喜欢做自己做不好的事情，每个人都会不自觉地尽量回避自己的短处</p><p>但不管整体怎样，对一个人来说，一定要问自己这个问题：我不喜欢做某件事情，是不是仅仅因为这件事我没有做好？若是因为自己没有做好而不喜欢，就要考虑另一个问题：做好这件事情究竟对自己有没有意义？如果有，那就要努力做，直到做好为止，没有其他选择。反过来，自己做得挺好，但就是不喜欢，纯粹因为那件事对自己确实没有什么吸引力——事实上这种情况少之又少——那就直接换一件事情做吧。谁能逼你去做一件你确实不喜欢做的事情呢？退一步说，如果你被逼着去做自己能做好的事情，应该也会有些兴趣的。</p><p>其次，人们总说他们真正感兴趣的是其他事情。可事实上，出现这种感觉应该仅仅是因为他们还没有开始做那件事，也还没有在那件事上遭受挫折而已。其实，很多人真的放弃原来做的事情，转去做新的“真正感兴趣的”事情的时候，往往会发现，这件事想要做好同样困难重重，挫折不断。没过多久，这些人又会因为做不好这件事情而对其失去兴趣，然后开始幻想做另外的事情，并且将这一行为“合理化”：“我（才知道）自己真正感兴趣的并不是这个……”</p><p>综上所述，我觉得兴趣并不是很重要，至少没有我们想象得那么重要。对一个人来说，某件事情只要能做好，并且做到比大多数人好，他就不会对那件事情没兴趣。</p><p>说来说去，<strong>是顺序出了问题：往往并不是有兴趣才能做好，而是做好了才有兴趣。</strong></p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>所有学习上的成功，都只依靠两件事——策略和坚持，而坚持本身就是最重要的策略。</p><p>很多时候，哪怕说“方法不重要到几乎可以忽略不计的地步”，其实也不是特别过分。更何况，所谓的“好方法”实际上是因人而异的。适合这个人的方法，放到那个人身上，很可能适得其反。换言之，适合所有人的方法很可能根本不存在。所以，有那么多的人将宝贵的时光虚掷在不停地寻找方法上，是一件非常可笑却又不得不令人扼腕叹息的事情。</p><p>与其不停地寻找“更好的方法”，还不如马上开始行动。</p><h3 id="效率"><a href="#效率" class="headerlink" title="效率"></a>效率</h3><p>没有任何机器可以一直用100%的功率运转，人也一样。</p><p>记住，任何人都不可能100%地有效率，至少不可能总是100%地有效率。</p><p>有些时候，我们会非常有效率，但是，这种情况不可能永远维持。如果一个人强迫自己一定要如此，他必会像那些始终用100%的功率运转的机器一样，由于损耗太大而提前报废。</p><blockquote><p>纯时间要比毛时间少得多。所谓毛时间，就是你花在这项工作上的时间。</p><p>常常有人说，他们一天工作十四五个小时。这样的人可能是有的。可是拿纯时间来说，我一天干不了　那么多。我做学术工作的时间，最高纪录是11小时30分。一般，我能有七八个小时的纯工作时间，我就心满意足了。我最高纪录的一个月是1937年7月，我一个月工作了316小时，每日平均纯工作时间是7小时。如果把纯时间折算成毛时间，应该增加25%到30%；我逐渐改进我的统计，最后形成了我现在使用的方法……</p><p>当然，每个人每天都要睡觉，都要吃饭。换句话说，每个人都有一定的时间用在标准活动上。工作经验表明，约有12至13小时毛时间可以用于非标准活动，诸如上班办公、学术工作、社会工作、娱乐，等等。</p></blockquote><p>从这里就可以看出，在做时间预算的时候，一定要留有空间。一方面，我们必须清楚肯定会有意外事件发生，所以要留出时间处理这些意外事件；另一方面，我们必须使用适当的方法休息、放松，以便恢复精力，在良好的状态下做更多的事情。一个人除了工作、学习之外，一定要保证自己有足够的其他活动。</p><h3 id="节奏"><a href="#节奏" class="headerlink" title="节奏"></a>节奏</h3><p>我们应该记住的是：凡是值得做的事情，都值得慢慢去做，做很久很久。</p><h3 id="自我证明"><a href="#自我证明" class="headerlink" title="自我证明"></a>自我证明</h3><p>证明自己是大多数人自然的愿望。“证明自己”本身没有任何错误，但是，很多人实际上是挣扎着想“证明自己给别人看”。殊不知，“证明自己给别人看”恰恰是最浪费生命的一种行为。如果某个人本身是出色的，那么不需要他去证明自己是出色的，别人自然会看到。如果某个人本身是平庸的，那么也不需要他去证明自己是平庸的，别人同样会看到。如果某个人出色，却仍然要刻意证明，可能招致不必要的麻烦</p><p>实际上，尽管我们总是说“人贵自知”，但是，很多时候，对很多人来讲，“自知”可能是非常残忍的。</p><p>如果你想不开，一定要让别人承认自己比他们强，那就听我的劝告，记住一件事：你比别人强一点根本没用，真正有用的是你比别人强很多很多。</p>]]></content>
    
    
    <summary type="html">《把时间当做朋友》阅读笔记，根据自己的喜好，做了一点删减</summary>
    
    
    
    <category term="书摘" scheme="https://changqingaas.github.io/categories/%E4%B9%A6%E6%91%98/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>matlab学习笔记</title>
    <link href="https://changqingaas.github.io/%E5%BB%BA%E6%A8%A1/Math/matlab%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://changqingaas.github.io/%E5%BB%BA%E6%A8%A1/Math/matlab%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2022-02-03T14:00:33.000Z</published>
    <updated>2022-02-04T04:55:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>注： </p><ul><li>虽然文档很全面，但是这篇文章主要是为了在一天内速成，所以不足之处请多包涵。</li><li>代码基于vscode/py 3.6调用的matlab terminal</li></ul><h1 id="基本的数学运算与矩阵运算"><a href="#基本的数学运算与矩阵运算" class="headerlink" title="基本的数学运算与矩阵运算"></a>基本的数学运算与矩阵运算</h1><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul><li>不需声明</li><li>用 = 给变量赋值</li></ul><h4 id="变量名"><a href="#变量名" class="headerlink" title="变量名"></a>变量名</h4><ul><li>变量名大小写敏感（不知道是不是因为在windows的原因</li><li>变量名只能由[<code>0~9</code>,<code>a~z</code>,<code>A~z</code>,<code>_</code>]组成,且变量名不能以数字开头.</li><li>保留变量不适合做变量名<ul><li>使用<code>iskeyword</code>命令可以查看程序关键字,这些关键字不允许被用作变量名.</li></ul></li></ul><div class="table-container"><table><thead><tr><th>变量</th><th>意义</th></tr></thead><tbody><tr><td>ans</td><td>上一句运算的结果</td></tr><tr><td><strong>i,j</strong></td><td>复数算子，（这里需要留意）</td></tr><tr><td>Inf</td><td>无穷</td></tr><tr><td>eps</td><td>浮点相对精度,即1.0到下一个浮点数之间的距离(值为2.2204e-16)</td></tr><tr><td>NaN</td><td>非数字</td></tr><tr><td>pi</td><td>圆周率</td></tr></tbody></table></div><ul><li><p>变量名不应当覆盖内置函数名</p><ul><li><p>在MATLAB中,变量的调用优先级(calling priority)高于函数,因此变量名不应该覆盖内置函数.</p><p><img src='https://img-blog.csdnimg.cn/20191112184241114.png'></p></li><li><p>例如：</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">cos &#x3D; &#39;changqingaas&#39;;cos(8)% disp([&#39;ans is &#39;, num2str(ans)])clear; % 若某函数被变量名所覆盖,则调用clear &lt;变量名&gt;可以取消绑定在该函数名上的变量名cos(8)% disp([&#39;ans is &#39;, num2str(ans)])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注：<code>clear</code>是一个比较危险的命令,因为该命令后若不加参数,则表示清除当前工作区内的所有变量.</p></li></ul></li></ul><pre><code>输出：<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">ans &#x3D;    &#39;n&#39;ans &#x3D;   -0.1455<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre><h4 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h4><p><code>logical</code>,<code>char</code>,<code>numeric</code>,<code>cell</code>,<code>struct</code>以及由他们组成的数组或矩阵.</p><p><img src="https://img-blog.csdnimg.cn/20191112184307618.png" alt="MATLAB中的变量类型"></p><h5 id="数字型变量的显示格式"><a href="#数字型变量的显示格式" class="headerlink" title="数字型变量的显示格式"></a>数字型变量的显示格式</h5><p>数字型变量,默认以<code>double</code>形式存储的.</p><p>可以通过<code>format &lt;显示格式&gt;</code>改变数字型变量的显示格式.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203182051.png" alt="image-20220203182051494"></p><h3 id="MATLAB命令行"><a href="#MATLAB命令行" class="headerlink" title="MATLAB命令行"></a>MATLAB命令行</h3><ul><li><p>使用行尾<code>;</code>抑制输出: </p><ul><li>在一行命令后使用<code>;</code>抑制输出,否则运算结果将被显示在终端上.</li></ul></li><li><p>| 命令    | 作用                                                         | 运行结果                                                     |<br>| ———- | —————————————————————————————— | —————————————————————————————— |<br>| <code>clc</code>   | 清除终端的输出                                               |                                                              |<br>| <code>clear</code> | 默认清除当前工作区内所有变量                                 |                                                              |<br>| <code>who</code>   | 以简略格式显示工作区内所有变量                               | 您的变量为:<br>ans                                           |<br>| <code>whos</code>  | 以复杂格式显示工作区内所有变量                               | Name      Size            Bytes  Class     Attributes<br/>  ans       1x1                 8  double |<br>| which   | 查看内置函数源代码文件的位置,与<code>edit</code>命令结合可以查看内置函数的源代码. |                                                              |</p></li></ul><h2 id="使用MATLAB进行数字运算"><a href="#使用MATLAB进行数字运算" class="headerlink" title="使用MATLAB进行数字运算"></a>使用MATLAB进行数字运算</h2><h3 id="使用MATLAB计算数学表达式"><a href="#使用MATLAB计算数学表达式" class="headerlink" title="使用MATLAB计算数学表达式"></a>使用MATLAB计算数学表达式</h3><ul><li>数学表达式被计算后，其值被存入变量ans</li><li>log 表示 ln</li><li>exp(x) 表示 e^x</li></ul><h3 id="MATLAB内置的数学函数"><a href="#MATLAB内置的数学函数" class="headerlink" title="MATLAB内置的数学函数"></a>MATLAB内置的数学函数</h3><ul><li><p><a href="https://www.mathworks.com/help/matlab/arithmetic.html">MATLAB内置的算数运算函数</a></p><ul><li><p>基本运算:</p><ul><li>加: <code>+</code>,<code>sum</code>,<code>cumsum</code>,<code>movsum</code></li><li>减: <code>-</code>,<code>diff</code></li><li>乘: <code>.*</code>,<code>*</code>,<code>prod</code>,<code>cumprod</code></li><li>除: <code>./</code>,<code>.\</code>,<code>/</code>,<code>\</code></li><li>乘方: <code>.^</code>,<code>^</code></li></ul></li><li><p>取模运算: <code>mod</code>,<code>rem</code>,<code>idivide</code>,<code>ceil</code>,<code>fix</code>,<code>floor</code>,<code>round</code></p></li></ul></li><li><p><a href="http://www.mathworks.com/help/matlab/trigonometry.html">MATLAB内置的三角运算函数</a></p><ul><li>正弦: sin,sind,sinpi,asin,asind,sinh,asinh</li><li>余弦: cos,cosd,cospi,acos,acosd,cosh,acosh</li><li>正切: tan,tand,atan,atand,atan2,atan2d,tanh,atanh</li><li>余割: csc,cscd,acsc,acscd,csch,acsch</li><li>正割: sec,secd,asec,asecd,sech,asech</li><li>余切: cot,cotd,acot,acotd,coth,acoth</li><li>斜边: hypot</li><li>转换: deg2rad,rad2deg,cart2pol,cart2sph,pol2cart,sph2cart</li></ul></li><li><p><a href="https://ww2.mathworks.cn/help/matlab/exponents-and-logarithms.html">MATLAB内置的指数对数函数: </a></p><ul><li>exp,expm1,log,log10,log1p,log2,nextpow2,nthroot,pow2,reallog,realpow,realsqrt,sqr</li></ul></li><li><p><a href="https://www.mathworks.com/help/matlab/complex-numbers.html">MATLAB内置的复函数: </a></p><ul><li>abs,angle,complex,conj,cplxpair,i,imag,isreal,j,real,sign,unwrap</li></ul></li></ul><h2 id="使用MATLAB进行矩阵运算"><a href="#使用MATLAB进行矩阵运算" class="headerlink" title="使用MATLAB进行矩阵运算"></a>使用MATLAB进行矩阵运算</h2><h3 id="定义矩阵"><a href="#定义矩阵" class="headerlink" title="定义矩阵"></a>定义矩阵</h3><h4 id="向终端输入矩阵"><a href="#向终端输入矩阵" class="headerlink" title="向终端输入矩阵"></a>向终端输入矩阵</h4><p>在MATLAB中,使用[]将待输入的矩阵内容括起来,使用空格或逗号,分隔行内变量,使用;分隔每一行.</p><div class="table-container"><table><thead><tr><th><strong>MATLAB命令</strong></th><th><strong>得到的矩阵</strong></th></tr></thead><tbody><tr><td>[1 2 3 4]</td><td>[1 2 3 4]</td></tr><tr><td>[1; 2; 3; 4]</td><td>$\begin{bmatrix}1 \\ 2 \\ 3 \\ 4\end{bmatrix}$</td></tr><tr><td>[1 21 6; 5 17 9; 31 2 7]</td><td>$\begin{bmatrix} 1 &amp; 21 &amp; 6 \\ 5 &amp; 17 &amp; 9 \\ 31 &amp; 2 &amp; 7 \end{bmatrix}$</td></tr></tbody></table></div><h4 id="使用冒号运算符创建向量"><a href="#使用冒号运算符创建向量" class="headerlink" title="使用冒号运算符创建向量"></a>使用冒号运算符创建向量</h4><p>使用冒号运算符:可以创建一个长向量,其语法如下:</p><div class="table-container"><table><thead><tr><th><strong>冒号表达式</strong></th><th><strong>得到的结果</strong></th></tr></thead><tbody><tr><td>j:k</td><td>[j,j+1,j+2,…,k]</td></tr><tr><td>j:i:k</td><td>[j,j+i,j+2*i,…,j+m∗i]</td></tr></tbody></table></div><p> 例如：</p><div class="table-container"><table><thead><tr><th><strong>MATLAB语句</strong></th><th><strong>得到的结果</strong></th></tr></thead><tbody><tr><td>1:5</td><td>[1 2 3 4 5]</td></tr><tr><td>1:3:5</td><td>[1 4]</td></tr><tr><td>[1:3; 2:3:10]</td><td>$\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 2 &amp; 5 &amp; 8 \end{bmatrix}$</td></tr><tr><td>‘a’:2:’z’</td><td>‘acegikmoqsuwy’</td></tr></tbody></table></div><h4 id="定义特殊矩阵"><a href="#定义特殊矩阵" class="headerlink" title="定义特殊矩阵"></a>定义特殊矩阵</h4><div class="table-container"><table><thead><tr><th><strong>命令</strong></th><th><strong>得到的结果</strong></th></tr></thead><tbody><tr><td>eye(n)</td><td>得到一个n × n 的单位矩阵</td></tr><tr><td>zeros(n1, n2)</td><td>得到一个n1 × n2  的全0矩阵</td></tr><tr><td>ones(n1, n2)</td><td>得到一个n1 × n2  的全1矩阵</td></tr><tr><td>diag(vector)</td><td>得到一个以向量<code>vector</code>中内容为对角线的对角矩阵</td></tr></tbody></table></div><h3 id="矩阵的索引"><a href="#矩阵的索引" class="headerlink" title="矩阵的索引"></a>矩阵的索引</h3><ul><li><p>MATLAB中的矩阵是以<strong>列</strong>序存储的.且索引下标从1开始.</p></li><li><p>矩阵有两种索引方式: 按一维索引和按二维索引.对于一个一般的矩阵,其索引顺序如下:</p><ul><li>$\begin{bmatrix} 1或(1,1) &amp; 4或(1,2) &amp; 7或(1,3) \\ 2或(2,1) &amp; 5或(2,2) &amp; 8或(2,3) \\ 3或(3,1) &amp; 6或(3,2) &amp;9或(3,3)  \end{bmatrix}$</li></ul></li><li><p>矩阵的索引可以使用冒号<code>:</code>,表示选取所有行或所有列.</p></li><li><p>矩阵的索引可以是一个或两个向量,表示选中向量内的所有行或所有列.</p><p>| <strong>原矩阵</strong>                                                   | <strong>索引</strong>        | <strong>得到的结果</strong>                                          |<br>| —————————————————————————————— | ———————- | ———————————————————————————- |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A(8)            | 6                                                       |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A([1 3 5])      | [1 7 5]                                                 |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A([1 2; 3 4])   | $\begin{bmatrix} 1 &amp; 4 \\ 7 &amp; 2\end{bmatrix}$           |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A(3,2)          | 8                                                       |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A([1,2], :)     | $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp;  5 &amp; 6 \end{bmatrix}$ |<br>| $\begin{bmatrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6\\ 7 &amp; 8 &amp; 9 \end{bmatrix}$ | A([1 3], [1 2]) | $\begin{bmatrix} 1 &amp; 2 \\ 7 &amp; 8 \end{bmatrix}$          |</p></li></ul><h3 id="矩阵的操作"><a href="#矩阵的操作" class="headerlink" title="矩阵的操作"></a>矩阵的操作</h3><h4 id="操作矩阵的运算符"><a href="#操作矩阵的运算符" class="headerlink" title="操作矩阵的运算符"></a>操作矩阵的运算符</h4><div class="table-container"><table><thead><tr><th>运算符</th><th>操作</th><th>形式</th><th>例子</th></tr></thead><tbody><tr><td><code>+</code></td><td>矩阵与向量相加</td><td><code>A+b</code></td><td><code>[6 3] + 2 = [8 5]</code></td></tr><tr><td><code>-</code></td><td>矩阵与向量相减</td><td><code>A-b</code></td><td><code>[6 3] - 2 = [4 1]</code></td></tr><tr><td><code>+</code></td><td>矩阵与矩阵对应位置相加</td><td><code>A+B</code></td><td><code>[6 3] + [4 8] = [10 11]</code></td></tr><tr><td><code>-</code></td><td>矩阵与矩阵对应位置相减</td><td><code>A-B</code></td><td><code>[6 3] - [4 8] = [2 -5]</code></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td><code>*</code></td><td>矩阵与矩阵相乘</td><td><code>A*B</code></td><td><code>[6 3] * [4 8]&#39; = 48</code></td></tr><tr><td><code>.*</code></td><td>矩阵与矩阵对应位置相乘</td><td><code>A.*B</code></td><td><code>[6 3] * [4 8] = [24 24]</code></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td><code>/</code></td><td>矩阵与矩阵右除(等价于<code>A*inv(B)</code>)</td><td><code>A/B</code></td><td><code>[6 3] / [4 8] = 0.6</code></td></tr><tr><td><code>\</code></td><td>矩阵与矩阵左除(等价于<code>inv(A)*B</code>)</td><td><code>A\B</code></td><td><code>[6 3] / [4 8] = [0.06667 1.3333; 0 0]</code></td></tr><tr><td><code>./</code></td><td>矩阵与矩阵对应位置右除</td><td><code>A./B</code></td><td><code>[6 3] ./ [4 8] = [1.5 0.375]</code></td></tr><tr><td><code>.\</code></td><td>矩阵与矩阵对应位置左除</td><td><code>A.\B</code></td><td><code>[6 3] .\ [4 8] = [0.6667 2.6667]</code></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td><code>^</code></td><td>矩阵与向量乘方</td><td><code>A^b</code></td><td><code>[1 2; 3 4]^3 = [37 54; 81 118]</code></td></tr><tr><td><code>.^</code></td><td>矩阵与矩阵对应位置乘方</td><td><code>A.^B</code></td><td><code>[1 2; 3 4].^[1 2; 3 4] = [1 4; 27 256]</code></td></tr></tbody></table></div><h4 id="操作矩阵的函数"><a href="#操作矩阵的函数" class="headerlink" title="操作矩阵的函数"></a>操作矩阵的函数</h4><p>对下面的矩阵</p><script type="math/tex; mode=display">A=\begin{bmatrix} 1 & 2 & 3 \\ 0 & 5 & 6 \\ 7 & 0 & 9 \end{bmatrix}</script><p>进行操作以演示操作矩阵的常见函数</p><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th><th>例子</th><th>结果</th></tr></thead><tbody><tr><td><code>max(A, [], dim)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上的最大值</td><td><code>max(A, [], 1)</code></td><td>$\begin{bmatrix} 7 &amp; 5 &amp; 9 \end{bmatrix}$</td></tr><tr><td><code>min(A, [], dim)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上的最小值</td><td><code>min(A, [], 2)</code></td><td>$\begin{bmatrix} 1 &amp; 0 &amp; 0 \end{bmatrix}$</td></tr><tr><td><code>sum(A, dim)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上的和</td><td><code>sum(A, 1)</code></td><td>$\begin{bmatrix} 8 &amp; 7 &amp; 18 \end{bmatrix}$</td></tr><tr><td><code>mean(A, dim)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上的平均值</td><td><code>mean(A, 1)</code></td><td>[2.66672.33336.0000]</td></tr><tr><td><code>sort(A, dim, direction)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上按<code>direction</code>顺序排序结果</td><td><code>sort(A, 1, &#39;descend&#39;)</code></td><td>$\begin{bmatrix} 7 &amp; 5 &amp; 9 \\\ 1 &amp; 2 &amp; 6 \\ 0 &amp; 0 &amp; 3 \end{bmatrix}$</td></tr><tr><td><code>sortrows(A, column)</code></td><td>获取矩阵<code>A</code>按照每行第<code>column</code>个元素升序排序结果.</td><td><code>sortrows(A, 2)</code></td><td>$\begin{bmatrix}  7 &amp; 0 &amp; 9\\ 1 &amp; 2 &amp; 3\\ 0 &amp; 5 &amp; 6\end{bmatrix}$</td></tr><tr><td><code>size(A, dim)</code></td><td>获取矩阵<code>A</code>的<code>dim</code>维度上的形状.若不指定<code>dim</code>,则返回整个矩阵的形状.</td><td><code>size(A)</code></td><td>[3 3]</td></tr><tr><td><code>find(A, n)</code></td><td>获取矩阵<code>A</code>前<code>n</code>个非零元素的索引</td><td>`find(A,5)</td><td>[1 3 4 5 7]</td></tr></tbody></table></div><p>对于上面这些函数,除第一个参数以外,其它参数都是可选的.</p><h1 id="结构化编程和函数定义"><a href="#结构化编程和函数定义" class="headerlink" title="结构化编程和函数定义"></a>结构化编程和函数定义</h1><h2 id="结构化编程"><a href="#结构化编程" class="headerlink" title="结构化编程"></a>结构化编程</h2><h3 id="流程控制语句和逻辑运算符"><a href="#流程控制语句和逻辑运算符" class="headerlink" title="流程控制语句和逻辑运算符"></a>流程控制语句和逻辑运算符</h3><div class="table-container"><table><thead><tr><th>流程控制语句</th><th>作用</th></tr></thead><tbody><tr><td><code>if, elseif, else</code></td><td>若<code>if</code>语句为真,则执行子句</td></tr><tr><td><code>switch, case, otherwise</code></td><td>根据<code>switch</code>语句内容判断执行哪个子句</td></tr><tr><td><code>while</code></td><td>重复执行子句直到<code>while</code>中的条件为假</td></tr><tr><td><code>for</code></td><td>执行子句固定次数</td></tr><tr><td><code>try, catch</code></td><td>执行子句并捕获执行过程中的异常</td></tr><tr><td><code>break</code></td><td>跳出循环</td></tr><tr><td><code>continue</code></td><td>直接进入下一次循环</td></tr><tr><td><code>end</code></td><td>结束子句</td></tr><tr><td><code>pause</code></td><td>暂停程序</td></tr><tr><td><code>return</code></td><td>返回到调用函数处</td></tr></tbody></table></div><p>上述所有循环和条件语句都要在末尾以<code>end</code>闭合.</p><p>MATLAB还有以下逻辑运算符:</p><div class="table-container"><table><thead><tr><th>运算符</th><th>意义</th></tr></thead><tbody><tr><td><code>==</code></td><td>等于</td></tr><tr><td><code>~=</code></td><td>不等于</td></tr><tr><td><code>&amp;&amp;</code></td><td>且(支持逻辑短路)</td></tr><tr><td>`</td><td></td><td>`</td><td>或(支持逻辑短路)</td></tr></tbody></table></div><h4 id="流程控制语句示例"><a href="#流程控制语句示例" class="headerlink" title="流程控制语句示例"></a>流程控制语句示例</h4><h5 id="if-语句："><a href="#if-语句：" class="headerlink" title="if 语句："></a>if 语句：</h5><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">if condition1statement1elseif condition2statement2else statement3end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="switch语句"><a href="#switch语句" class="headerlink" title="switch语句"></a>switch语句</h5><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">switch expression    case value1        statement1    case value2        statement2    otherwise         statementend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a>while语句</h5><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">while expressionstatementend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a>for语句</h5><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">for variable &#x3D; start:increment:endcommandsend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="break语句"><a href="#break语句" class="headerlink" title="break语句"></a>break语句</h5><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; 2; k &#x3D; 0; error &#x3D; inf;error_threshold &#x3D; 1e-32;while error &gt; error_threshold    if k &gt; 100        break    end    x &#x3D; x - sin(x) &#x2F; cos(x);    error &#x3D; abs(x - pi);    k &#x3D; k + 1;end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="使用循环语句应尽量预先分配内存空间"><a href="#使用循环语句应尽量预先分配内存空间" class="headerlink" title="使用循环语句应尽量预先分配内存空间"></a>使用循环语句应尽量预先分配内存空间</h4><h3 id="编写脚本时应注意的问题"><a href="#编写脚本时应注意的问题" class="headerlink" title="编写脚本时应注意的问题"></a>编写脚本时应注意的问题</h3><h4 id="在脚本开头应添加语句清空工作区"><a href="#在脚本开头应添加语句清空工作区" class="headerlink" title="在脚本开头应添加语句清空工作区"></a>在脚本开头应添加语句清空工作区</h4><p>在每个脚本的开头,应添加下述语句,清空工作区缓存以及之前程序运行的痕迹:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">clear all% 清空工作区内存中的变量close all % 关闭之前程序绘制的图像clc% 清空之前程序在终端的输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="在运算和赋值语句后应添加分号-抑制输出"><a href="#在运算和赋值语句后应添加分号-抑制输出" class="headerlink" title="在运算和赋值语句后应添加分号;抑制输出"></a>在运算和赋值语句后应添加分号<code>;</code>抑制输出</h4><p>在所有运算和赋值语句都应该添加分号<code>;</code>抑制输出,若需要向终端输出一个变量,应对其调用<code>disp</code>方法.</p><h4 id="使用省略号-拼接多行语句"><a href="#使用省略号-拼接多行语句" class="headerlink" title="使用省略号...拼接多行语句"></a>使用省略号<code>...</code>拼接多行语句</h4><p>在MATLAB中,省略号<code>...</code>可以将多行语句拼接为一行,灵活使用该语句可以提高代码可读性.</p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>与脚本类似,函数可以被存入<code>函数名.m</code>文件中,也可以以函数句柄的形式定义在内存中.</p><h3 id="查看内置函数"><a href="#查看内置函数" class="headerlink" title="查看内置函数"></a>查看内置函数</h3><p>我们可以使用<code>which</code>命令查看内置函数源代码文件的位置,与<code>edit</code>命令结合可以查看内置函数的源代码.</p><p>运行下面语句可以打开MATLAB内置的<code>mean</code>函数的源文件:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">edit(which(&#39;mean.m&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203200209.png" alt="mean函数源代码"></p><h3 id="以函数名-m文件形式定义函数"><a href="#以函数名-m文件形式定义函数" class="headerlink" title="以函数名.m文件形式定义函数"></a>以<code>函数名.m</code>文件形式定义函数</h3><p>在MATLAB文件中定义函数的格式如下:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">function [输出变量名] &#x3D; 函数名(输入变量名) % 函数的文档函数代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>function</code>是一个关键字,声明该文件中保存的是一个函数.</li><li><code>输入变量</code>和<code>输出变量</code>是非必须的,函数既可以没有输入变量,也可以没有输出变量.</li><li><code>函数名</code>应与<code>.m</code>文件名相同,且不包含特殊字符(最好不要有中文).</li></ul><h4 id="MATLAB内置的函数参数"><a href="#MATLAB内置的函数参数" class="headerlink" title="MATLAB内置的函数参数"></a>MATLAB内置的函数参数</h4><div class="table-container"><table><thead><tr><th>函数参数</th><th>意义</th></tr></thead><tbody><tr><td><code>imputname</code></td><td>输入变量名列表</td></tr><tr><td><code>mfilename</code></td><td>函数源代码文件名</td></tr><tr><td><code>nargin</code></td><td>输入变量数</td></tr><tr><td><code>nargout</code></td><td>输出变量个数</td></tr><tr><td><code>varargin</code></td><td>可变长输入参数列表</td></tr><tr><td><code>varargout</code></td><td>可变长输出参数列表</td></tr></tbody></table></div><p>MATLAB不提供其他高级语言的指定默认参数值以及函数重载等语法,但灵活使用上述内置的函数参数,可以在一定程度上实现指定默认参数值以及方法重载:</p><h4 id="MATLAB函数定义示例1"><a href="#MATLAB函数定义示例1" class="headerlink" title="MATLAB函数定义示例1"></a>MATLAB函数定义示例1</h4><p>面程序用来计算自由落体运动中位移量:<br>$x = x_{0} + v_{0}t + \frac{1}{2} g t^2 $</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">function x &#x3D; freebody(x0,v0,t)% calculation of free falling% x0: initial displacement in m% v0: initial velocity in m&#x2F;sec% t: the elapsed time in sec% x: the depth of falling in mx &#x3D; x0 + v0.*t + 1&#x2F;2*9.8*t.*t;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该函数演示了一个MATLAB编程技巧: 计算乘法时应尽量使用<code>.*</code>而非<code>*</code>,因为前者不仅对参数<code>t</code>为标量的情况可用,也对变量<code>t</code>为向量或矩阵的情况可用.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">freebody(0, 0, 2)% 得到 19.6000freebody(0, 0, [0 1 2 3])% 得到 [0 4.9000 19.6000 44.1000]freebody(0, 0, [0 1; 2 3])% 得到 [0 4.9000; 19.6000 44.1000]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="MATLAB函数定义示例2"><a href="#MATLAB函数定义示例2" class="headerlink" title="MATLAB函数定义示例2"></a>MATLAB函数定义示例2</h4><p>下面函数实现了从华氏温度到摄氏温度的转换,该函数可以识别输入的待转换样例的个数,当输入的待转换样例个数为0时,退出函数.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">function F2C()while 1    F_degree &#x3D; input(&#39;tempreature in Fahrenheit: &#39;, &#39;s&#39;);    F_degree &#x3D; str2num(F_degree);    if isempty(F_degree)        return    end    C_degree &#x3D; (F_degree-32)*5&#x2F;9;    disp([&#39;tempreature in Celsius: &#39; num2str(C_degree)])end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203201516.png" alt="F2C函数执行结果"></p><h3 id="以函数句柄形式定义函数"><a href="#以函数句柄形式定义函数" class="headerlink" title="以函数句柄形式定义函数"></a>以函数句柄形式定义函数</h3><p>我们也可以使用函数句柄的形式定义函数,这更接近数学上的函数定义,其语法如下:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">函数句柄 &#x3D; @(输入变量) 输出变量 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以直接通过函数句柄调用该方法.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">f &#x3D; @(x) exp(-2*x);x &#x3D; 0:0.1:2;plot(x, f(x));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="数据类型与文件读写"><a href="#数据类型与文件读写" class="headerlink" title="数据类型与文件读写"></a>数据类型与文件读写</h1><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>MATLAB中主要的数据类型如下:</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203202237.png" alt="MATLAB中的数据类型"></p><h3 id="数值类型-numeric"><a href="#数值类型-numeric" class="headerlink" title="数值类型(numeric)"></a>数值类型(numeric)</h3><p>MATLAB支持的数值类型见下表:</p><div class="table-container"><table><thead><tr><th>数值类型</th><th>描述</th></tr></thead><tbody><tr><td><code>double</code></td><td>双精度浮点数</td></tr><tr><td><code>single</code></td><td>单精度浮点数</td></tr><tr><td><code>int8</code></td><td>8位带符号整数</td></tr><tr><td><code>int16</code></td><td>16位带符号整数</td></tr><tr><td><code>int32</code></td><td>32位带符号整数</td></tr><tr><td><code>int64</code></td><td>64位带符号整数</td></tr><tr><td><code>uint8</code></td><td>8位无符号整数</td></tr><tr><td><code>uint16</code></td><td>16位无符号整数</td></tr><tr><td><code>uint32</code></td><td>32位无符号整数</td></tr><tr><td><code>uint64</code></td><td>64位无符号整数</td></tr></tbody></table></div><p>在MATLAB中,数值类型的变量被默认为<code>double</code>类型的,可以使用类型转换将其转换为其他数值类型.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">n &#x3D; 3;class(n) n &#x3D; int8(3);class(n) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">ans &#x3D;    &#39;double&#39;ans &#x3D;    &#39;int8&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="字符串类型-char"><a href="#字符串类型-char" class="headerlink" title="字符串类型(char)"></a>字符串类型(char)</h3><ul><li><p>在MATLAB中,字符串类型由一对单引号<code>&#39;</code>包裹一段文字来定义.标准ASCII字符可以被转换为对应的ASCII码.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">s1 &#x3D; &#39;h&#39;;uint16(s1)% 得到 104<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>字符串在内存中是以字符矩阵的形式存储的,可以对其进行矩阵的索引以及赋值操作:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">str1 &#x3D; &#39;hello&#39;;str2 &#x3D; &#39;world&#39;;str3 &#x3D; [str1 str2];size(str3)% 得到 [1 10]str4 &#x3D; [str1; str2];size(str4)% 得到 [2 5]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">str &#x3D; &#39;aardvark&#39;;&#39;a&#39; &#x3D;&#x3D; str% 得到 [1 1 0 0 0 1 0 0]str(str &#x3D;&#x3D; &#39;a&#39;) &#x3D; &#39;Z&#39;% 得到 &#39;ZZrdvZrk&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="结构体-structure"><a href="#结构体-structure" class="headerlink" title="结构体(structure)"></a>结构体(structure)</h3><p>在MATLAB中,结构体是一个键值对</p><h4 id="结构体的基本使用"><a href="#结构体的基本使用" class="headerlink" title="结构体的基本使用"></a>结构体的基本使用</h4><ul><li>与大多数编程语言类似,MATLAB使用<code>.</code>来访问结构体中的字段:</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203202908.png" alt="结构体"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">student.name &#x3D; &#39;John Doe&#39;;student.id &#x3D; &#39;jdo2@sfu.ca&#39;;student.number &#x3D; 301073268;student.grade &#x3D; [100, 75, 73; ...                 95, 91, 85.5; ...                 100, 98, 72];student<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>对结构体列表使用下标表达式可以扩充或缩减结构体列表.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203203208.png" alt="结构体数组"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">student.name &#x3D; &#39;John Doe&#39;;student.id &#x3D; &#39;jdo2@sfu.ca&#39;;student.number &#x3D; 301073268;student.grade &#x3D; [100, 75, 73; 95, 91, 85.5; 100, 98, 72];studentstudent(2).name &#x3D; &#39;Ann Lane&#39;;student(2).id &#x3D; &#39;aln4@sfu.ca&#39;;student(2).number &#x3D; 301078853;student(2).grade &#x3D; [95 100 90; 95 82 97; 100 85 100];student(1) &#x3D; [] % 删除student列表第一项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>结构体可以级联,即结构体中字段的取值也可以是结构体:</p>  <pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">A &#x3D; struct(&#39;data&#39;, [3 4 7; 8 0 1], ...&#39;nest&#39;, struct(&#39;testnum&#39;, &#39;Test 1&#39;, ...&#39;xdata&#39;, [4 2 8], ...&#39;ydata&#39;, [7 1 6]));A(2).data &#x3D; [9 3 2; 7 6 5];A(2).nest.testnum &#x3D; &#39;Test 2&#39;;A(2).nest.xdata &#x3D; [3 4 2];A(2).nest.ydata &#x3D; [5 0 9];A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="结构体的常用函数"><a href="#结构体的常用函数" class="headerlink" title="结构体的常用函数"></a>结构体的常用函数</h4><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>struct</code></td><td>创建结构体</td></tr><tr><td><code>struct2cell</code></td><td>将结构体转换为元胞数组</td></tr><tr><td><code>cell2struct</code></td><td>将元胞数组转换为结构体</td></tr><tr><td><code>isstruct</code></td><td>判断某变量是否是结构体</td></tr><tr><td><code>structfun</code></td><td>对结构体的每个字段都应用某函数</td></tr><tr><td></td><td></td></tr><tr><td><code>fieldnames</code></td><td>获取结构体的所有字段名</td></tr><tr><td><code>isfield</code></td><td>判断结构体是否包含某字段</td></tr><tr><td><code>getfield</code></td><td>获取结构体某字段的值</td></tr><tr><td><code>setfield</code></td><td>为结构体中的某字段赋值</td></tr><tr><td><code>rmfield</code></td><td>删除结构体中的某字段</td></tr><tr><td><code>orderfields</code></td><td>为结构体字段排序</td></tr></tbody></table></div><h3 id="元胞数组-cell"><a href="#元胞数组-cell" class="headerlink" title="元胞数组(cell)"></a>元胞数组(cell)</h3><p>在MATLAB中,元胞数组是一个可以容纳不同类型元素的数据结构,类似于Python语言中的列表.</p><h4 id="元胞数组的基本使用"><a href="#元胞数组的基本使用" class="headerlink" title="元胞数组的基本使用"></a>元胞数组的基本使用</h4><ul><li><p>使用<code>&#123;&#125;</code>像定义矩阵一样定义元胞数组:</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203205945.png" alt="元胞数组"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">A &#x3D; &#123; [1 4 3; 0 5 8; 7 2 9]&#39;Anne Smith&#39; ;...3+7i-pi:pi:pi&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">A(1,1)&#x3D;&#123;[1 4 3; 0 5 8; 7 2 9]&#125;;A(1,2)&#x3D;&#123;&#39;Anne Smith&#39;&#125;;A(2,1)&#x3D;&#123;3+7i&#125;;A(2,2)&#x3D;&#123;-pi:pi:pi&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">A&#123;1,1&#125;&#x3D;[1 4 3; 0 5 8; 7 2 9];A&#123;1,2&#125;&#x3D;&#39;Anne Smith&#39;;A&#123;2,1&#125;&#x3D;3+7i;A&#123;2,2&#125;&#x3D;-pi:pi:pi;A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面三种方式是等价的,其中第二种方式使用<strong>单元索引</strong>赋值,而第三种方式使用<strong>内容索引</strong>赋值.</p><ul><li><p>有两种方式访问元胞数组中的数据,分别是: <strong>单元索引</strong><code>()</code>和<strong>内容索引</strong><code>&#123;&#125;</code></p><p>因为元胞数组的子集仍为元胞数组,在索引器内容的使用,我们有必要指明我们要访问的的是一个<strong>子元胞数组</strong>还是<strong>元胞数组对应区域中的内容</strong>.</p><ul><li><p>使用<strong>单元索引</strong><code>()</code>,我们得到的是一个<strong>子元胞数组</strong>.</p><ul><li>使用<strong>内容索引</strong><code>&#123;&#125;</code>,我们得到的是<strong>元胞数组对应区域中的内容</strong>.</li></ul></li></ul></li></ul><h4 id="元胞数组的常用函数"><a href="#元胞数组的常用函数" class="headerlink" title="元胞数组的常用函数"></a>元胞数组的常用函数</h4><h3 id="元胞数组的常用函数-1"><a href="#元胞数组的常用函数-1" class="headerlink" title="元胞数组的常用函数"></a>元胞数组的常用函数</h3><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>cell</code></td><td>创建一个元胞数组</td></tr><tr><td><code>iscell</code></td><td>判断某变量是否为元胞数组</td></tr><tr><td></td><td></td></tr><tr><td><code>cell2mat</code></td><td>将元胞数组转为矩阵</td></tr><tr><td><code>cell2struct</code></td><td>将元胞数组转为结构体</td></tr><tr><td><code>mat2cell</code></td><td>将数组转换为指定大小元胞数组</td></tr><tr><td><code>num2cell</code></td><td>将数组转换为相同大小的元胞数组</td></tr><tr><td><code>struct2cell</code></td><td>将结构体转换为元胞数组</td></tr><tr><td></td><td></td></tr><tr><td><code>celldisp</code></td><td>递归显示元胞数组中的内容</td></tr><tr><td><code>cellplot</code></td><td>以图像形式绘制元胞数组的结构</td></tr><tr><td><code>cellfun</code></td><td>对元胞数组的每个元胞应用某函数</td></tr></tbody></table></div><p>其中<code>mat2cell</code>函数可以在转换的时候指定元胞数组各元胞的尺寸.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">a &#x3D; magic(3)b &#x3D; num2cell(a)% 得到% [8] [1] [6]% [3] [5] [7]% [4] [9] [2]c &#x3D; mat2cell(a, [1 2], [2, 1])% 得到% [1x2 double] [6]% [2x2 double] [2x1 double]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="高维元胞数组"><a href="#高维元胞数组" class="headerlink" title="高维元胞数组"></a>高维元胞数组</h4><p>一个三维的元胞数组可以有<strong>行</strong>(row),<strong>列</strong>(column),<strong>层</strong>(layer)三个维度.在对元胞数组进行索引时,优先级从高到低的顺序分别是: 行→列→层.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203210656.png" alt="高维元胞数组"></p><p>使用<code>cat</code>函数可以在指定维度上对元胞数组进行拼接.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203210809.png" alt="元胞数组的拼接"></p><h3 id="判断变量数据类型的函数"><a href="#判断变量数据类型的函数" class="headerlink" title="判断变量数据类型的函数"></a>判断变量数据类型的函数</h3><p>下列函数可以对变量类型进行判断:</p><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>isinteger</code></td><td>判断输入参数是否为整型数数组</td></tr><tr><td><code>islogical</code></td><td>判断输入参数是否为逻辑量数组</td></tr><tr><td><code>isnumeric</code></td><td>判断输入参数是否为数值数组</td></tr><tr><td><code>isreal</code></td><td>判断输入参数是否为实数数组</td></tr><tr><td><code>ischar</code></td><td>判断输入参数是否为字符数组</td></tr><tr><td><code>iscell</code></td><td>判断输入参数是否为元胞数组</td></tr><tr><td><code>isfloat</code></td><td>判断输入数组是否为浮点数组</td></tr><tr><td><code>ishandle</code></td><td>判断输入数组是否有效的图形句柄</td></tr><tr><td><code>isempty</code></td><td>判断输入数组是否为空</td></tr><tr><td><code>isprime</code></td><td>确定哪些数组元素为质数</td></tr><tr><td><code>isnan</code></td><td>确定哪些数组元素为<code>NaN</code></td></tr><tr><td><code>isinf</code></td><td>确定哪些数组元素为<code>Inf</code></td></tr><tr><td><code>isequal</code></td><td>判断数组是否相等</td></tr></tbody></table></div><h2 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h2><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><p>支持的文件类型如下:</p><div class="table-container"><table><thead><tr><th>文件内容</th><th>扩展名</th><th>读取文件的函数</th><th>写入文件的函数</th></tr></thead><tbody><tr><td>MATLAB数据</td><td><code>*.mat</code></td><td><code>load</code></td><td><code>save</code></td></tr><tr><td>Excel表格</td><td><code>*.xls</code>,<code>*.xlsx</code></td><td><code>xlsread</code></td><td><code>xlswrite</code></td></tr><tr><td>空格分隔的数字</td><td><code>*.txt</code></td><td><code>load</code></td><td><code>save</code></td></tr></tbody></table></div><h3 id="读写MATLAB格式的数据"><a href="#读写MATLAB格式的数据" class="headerlink" title="读写MATLAB格式的数据"></a>读写MATLAB格式的数据</h3><p>MATLAB工作区内的数据可以以<code>*.mat</code>格式保存在文件中.使用<code>save</code>函数将数据存入文件,使用<code>load</code>函数从文件中读取数据.</p><ul><li><p><code>save</code></p><p>函数的语法如下:</p><ul><li><code>save(filename,variables)</code>将变量<code>variables</code>以二进制形式存入文件中.</li><li><code>save(filename,variables,&#39;-ascii&#39;)</code>将变量<code>variables</code>以文本形式存入文件中.</li></ul></li><li><p><code>load</code></p><p>函数的语法如下:</p><ul><li><code>load(filename)</code>从二进制形式文件中读取数据.</li><li><code>load(filename,&#39;-ascii&#39;)</code>从文本形式文件中读取数据.</li></ul></li></ul><p>其中参数<code>filename</code>和<code>variables</code>都是字符串格式,若不指定<code>variables</code>参数,则将当前工作区内所有变量存入文件中.</p><blockquote><p>复杂的数据格式,如<code>struct</code>和<code>cell</code>,不支持以二进制格式存储.</p></blockquote><h3 id="读写Excel表格"><a href="#读写Excel表格" class="headerlink" title="读写Excel表格"></a>读写Excel表格</h3><p>使用<code>xlsread</code>和<code>xlswrite</code>函数可以读写Excel数据,语法如下:</p><ul><li><p>读取Excel文件的语法:<code>[num,txt,raw] = xlsread(filename,sheet,xlRange)</code></p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203211325.png" alt="在这里插入图片描述"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">Score &#x3D; xlsread(&#39;04Score.xlsx&#39;)Score &#x3D; xlsread(&#39;04Score.xlsx&#39;, &#39;B2:D4&#39;)[Score Header] &#x3D; xlsread(&#39;04Score.xlsx&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>写入Excel的语法:<code>xlswrite(filename,A,sheet,xlRange)</code></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">M &#x3D; mean(Score);xlswrite(&#39;04Score.xlsx&#39;, M, 1, &#39;E2:E4&#39;);xlswrite(&#39;04Score.xlsx&#39;, &#123;&#39;Mean&#39;&#125;, 1, &#39;E1&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h1><h2 id="图线的绘制与装饰"><a href="#图线的绘制与装饰" class="headerlink" title="图线的绘制与装饰"></a>图线的绘制与装饰</h2><h3 id="使用plot-函数绘制图线"><a href="#使用plot-函数绘制图线" class="headerlink" title="使用plot()函数绘制图线"></a>使用<code>plot()</code>函数绘制图线</h3><p>在MATLAB中,使用<code>plot()</code>函数绘制图线,其语法为:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">plot(x,y,LineSpec)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>LineSpec</code>: 图线的线条设定,三个指定<strong>线型</strong>,<strong>标记符号</strong>和<strong>颜色</strong>的<strong>设定符</strong>组成一个字符串,设定符不区分先后.具体细节请参考<a href="https://www.mathworks.com/help/matlab/ref/linespec.html">官方文档</a>.</p><div class="table-container"><table><thead><tr><th>线型符号</th><th>线型设定符</th><th>标记</th><th>标记设定符</th><th>颜色</th><th>颜色设定符</th></tr></thead><tbody><tr><td><code>-</code></td><td>实线（默认）</td><td><code>o</code></td><td>圆圈</td><td><code>y</code></td><td>黄色</td></tr><tr><td><code>--</code></td><td>虚线</td><td><code>+</code></td><td>加号</td><td><code>m</code></td><td>品红色</td></tr><tr><td><code>:</code></td><td>点线</td><td><code>*</code></td><td>星号</td><td><code>c</code></td><td>青蓝色</td></tr><tr><td><code>-.</code></td><td>点划线</td><td><code>.</code></td><td>点</td><td><code>r</code></td><td>红色</td></tr><tr><td></td><td></td><td><code>x</code></td><td>叉号</td><td><code>g</code></td><td>绿色</td></tr><tr><td></td><td></td><td><code>s</code></td><td>方形</td><td><code>b</code></td><td>蓝色</td></tr><tr><td></td><td></td><td><code>d</code></td><td>菱形</td><td><code>w</code></td><td>白色</td></tr><tr><td></td><td></td><td><code>^</code></td><td>上三角</td><td><code>k</code></td><td>黑色</td></tr><tr><td></td><td></td><td><code>v</code></td><td>下三角</td><td></td><td></td></tr><tr><td></td><td></td><td><code>&gt;</code></td><td>右三角</td><td></td><td></td></tr><tr><td></td><td></td><td><code>&lt;</code></td><td>左三角</td><td></td><td></td></tr><tr><td></td><td></td><td><code>p</code></td><td>五角形</td><td></td><td></td></tr><tr><td></td><td></td><td><code>h</code></td><td>六角形</td><td></td></tr></tbody></table></div><p>注：Python中的matplotlib的画图方式和这里几乎一样</p><h3 id="装饰图线"><a href="#装饰图线" class="headerlink" title="装饰图线"></a>装饰图线</h3><ul><li><p>使用<code>legend()</code>函数为图片增加图例</p><p>  使用<code>legend(label1, ..., labelN)</code>函数可以为图片添加图例.</p>  <pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x&#x3D;0:0.5:4*pi;y&#x3D;sin(x); h&#x3D;cos(x); w&#x3D;1.&#x2F;(1+exp(-x)); g&#x3D;(1&#x2F;(2*pi*2)^0.5).*exp((-1.*(x-2*pi).^2).&#x2F;(2*2^2));plot(x,y,&#39;bd-&#39; ,x,h,&#39;gp:&#39;,x,w,&#39;ro-&#39; ,x,g,&#39;c^-&#39;);% 绘制多条图线legend(&#39;sin(x)&#39;,&#39;cos(x)&#39;,&#39;Sigmoid&#39;,&#39;Gauss function&#39;);% 添加图例<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>  <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213101.jpeg" alt="使用legend增加图例"></p></li><li><p>使用<code>title()</code>和<code>*label()</code>为图片增加标题和标签</p>  <pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; 0:0.1:2*pi; y1 &#x3D; sin(x); y2 &#x3D; exp(-x);plot(x, y1, &#39;--*&#39;, x, y2, &#39;:o&#39;);xlabel(&#39;t &#x3D; 0 to 2\pi&#39;);ylabel(&#39;values of sin(t) and e^&#123;-x&#125;&#39;)title(&#39;Function Plots of sin(t) and e^&#123;-x&#125;&#39;);legend(&#39;sin(t)&#39;,&#39;e^&#123;-x&#125;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213130.jpeg" alt="使用title()和*label()为图片增加标题和标签"></p></li></ul><ul><li><p>使用<code>text()</code>和<code>annotation()</code>为图片增加注解</p>  <pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; linspace(0,3); y &#x3D; x.^2.*sin(x); plot(x,y);line([2,2],[0,2^2*sin(2)]);str &#x3D; &#39;$$ \int_&#123;0&#125;^&#123;2&#125; x^2\sin(x) dx $$&#39;;text(0.25,2.5,str,&#39;Interpreter&#39;,&#39;latex&#39;);annotation(&#39;arrow&#39;,&#39;X&#39;,[0.32,0.5],&#39;Y&#39;,[0.6,0.4]); <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213259.jpeg" alt="使用text()和annotation()为图片增加注解"></p></li></ul><h3 id="控制坐标轴-边框与网格"><a href="#控制坐标轴-边框与网格" class="headerlink" title="控制坐标轴,边框与网格"></a>控制坐标轴,边框与网格</h3><div class="table-container"><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><code>grid on/off</code></td><td>设置网格可见性</td></tr><tr><td><code>box on/off</code></td><td>设置边框可见性</td></tr><tr><td><code>axis on/off</code></td><td>设置坐标轴可见性</td></tr><tr><td><code>axis normal</code></td><td>还原默认行为,将图框纵横比模式和数据纵横比模式的属性设置为自动</td></tr><tr><td><code>axis square</code></td><td>使用相同长度的坐标轴线,相应调整数据单位之间的增量</td></tr><tr><td><code>axis equal</code></td><td>沿每个坐标轴使用相同的数据单位长度</td></tr><tr><td><code>axis tight</code></td><td>将坐标轴范围设置为等同于数据范围,使轴框紧密围绕数据</td></tr></tbody></table></div><p>下面的例子演示<code>axis</code>命令的效果:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">t &#x3D; 0:0.1:2*pi; x &#x3D; 3*cos(t); y &#x3D; sin(t);subplot(2, 2, 1); plot(x, y); axis normalsubplot(2, 2, 2); plot(x, y); axis squaresubplot(2, 2, 3); plot(x, y); axis equalsubplot(2, 2, 4); plot(x, y); axis equal tight<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213545.png" alt="axis命令的效果"></p><h2 id="绘制多条图线"><a href="#绘制多条图线" class="headerlink" title="绘制多条图线"></a>绘制多条图线</h2><h3 id="在一个图像上绘制多条图线"><a href="#在一个图像上绘制多条图线" class="headerlink" title="在一个图像上绘制多条图线"></a>在一个图像上绘制多条图线</h3><p>默认情况下,每次执行<code>plot()</code>函数都会清除上一次绘图的结果,多次执行<code>plot()</code>只会保留最后一次绘制的图形.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213755.jpeg" alt="多次执行plot只会保留最后一次绘制的图形"></p><p>我们可以使用<code>hold on</code>和<code>hold off</code>命令控制绘图区域的刷新,使得多个绘图结果同时保留在绘图区域中.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">hold on% 提起画笔,开始绘制一组图片plot(cos(0:pi&#x2F;20:2*pi));plot(sin(0:pi&#x2F;20:2*pi));hold off% 放下画笔,该组图片绘制完毕<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203213800.jpeg" alt="使用hold命令控制绘图区域的刷新"></p><h3 id="在一个窗口内绘制多个图像"><a href="#在一个窗口内绘制多个图像" class="headerlink" title="在一个窗口内绘制多个图像"></a>在一个窗口内绘制多个图像</h3><p>subplot</p><h2 id="图形对象的操作"><a href="#图形对象的操作" class="headerlink" title="图形对象的操作"></a>图形对象的操作</h2><p>在MATLAB中,图形都是以对象的形式储存在内存中,通过获取其图形句柄可以对其进行操作.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203214106.png" alt="在MATLAB中图形都是以对象的形式储存的"></p><h3 id="获取图形句柄"><a href="#获取图形句柄" class="headerlink" title="获取图形句柄"></a>获取图形句柄</h3><p>图形句柄本质上就是一个浮点数,可以唯一确定一个图形对象.下面几个函数用于获取图形句柄.</p><div class="table-container"><table><thead><tr><th>Function</th><th>Purpose</th></tr></thead><tbody><tr><td><code>gca()</code></td><td>获取当前坐标轴的句柄</td></tr><tr><td><code>gcf()</code></td><td>获取当前图像的句柄</td></tr><tr><td><code>allchild(handle_list)</code></td><td>获取该对象的所有子对象的句柄</td></tr><tr><td><code>ancestor(h,type)</code></td><td>获取对象最近的<code>type</code>类型的祖先节点</td></tr><tr><td><code>delete(h)</code></td><td>删除某对象</td></tr><tr><td><code>findall(handle_list)</code></td><td>获取该对象的后代对象</td></tr></tbody></table></div><p>所有绘图函数也会返回图形对象的句柄.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203214204.png" alt="绘图函数也会返回图形对象的句柄"></p><h3 id="通过图形句柄操作图形属性"><a href="#通过图形句柄操作图形属性" class="headerlink" title="通过图形句柄操作图形属性"></a>通过图形句柄操作图形属性</h3><p>使用<code>get()</code>和<code>set()</code>函数可以对图形对象的属性进行访问和修改.访问<a href="http://www.mathworks.com/help/matlab/ref/figure-properties.html">官方文档</a>可以查看所有图形对象的属性.</p><ul><li><p><code>set(H,Name,Value)</code></p></li><li><p><code>v = get(h,propertyName)</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203214258.png" alt="图形对象的属性"></p><p>下面两个例子演示使用图形句柄操作图形对象:</p><ol><li><p>改变坐标轴属性:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">% 第一张图set(gca, &#39;FontSize&#39;, 25);% 第二张图set(gca, &#39;XTick&#39;, 0:pi&#x2F;2:2*pi);set(gca, &#39;XTickLabel&#39;, 0:90:360);% 第三张图set(gca, &#39;FontName&#39;, &#39;symbol&#39;);set(gca, &#39;XTickLabel&#39;, &#123;&#39;0&#39;, &#39;p&#x2F;2&#39;, &#39;p&#39;, &#39;3p&#x2F;2&#39;, &#39;2p&#39;&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203214348.jpeg" alt="句柄操作实例1"></p></li><li><p>改变线型</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">h &#x3D; plot(x,y); set(h, &#39;LineStyle&#39;,&#39;-.&#39;, ...&#39;LineWidth&#39;, 7.0, ...&#39;Color&#39;, &#39;g&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203214348.jpeg" alt="句柄操作实例2"></p></li></ol><h3 id="将图形保存到文件"><a href="#将图形保存到文件" class="headerlink" title="将图形保存到文件"></a>将图形保存到文件</h3><p>使用<code>saveas(fig,filename)</code>命令可以将图形对象保存到文件中,其中<code>fig</code>为图形句柄,<code>filname</code>为文件名.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">saveas(gcf, &#39;myfigure.png&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="绘制高级图表"><a href="#绘制高级图表" class="headerlink" title="绘制高级图表"></a>绘制高级图表</h1><h2 id="二维图表"><a href="#二维图表" class="headerlink" title="二维图表"></a>二维图表</h2><h3 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h3><div class="table-container"><table><thead><tr><th>函数</th><th>图形描述</th></tr></thead><tbody><tr><td><code>loglog()</code></td><td>x轴和y轴都取对数坐标</td></tr><tr><td><code>semilogx()</code></td><td>x轴取对数坐标,y轴取线性坐标</td></tr><tr><td><code>semilogy()</code></td><td>x轴取线性坐标,y轴取对数坐标</td></tr><tr><td><code>plotyy()</code></td><td>带有两套y坐标轴的线性坐标系</td></tr><tr><td><code>ploar()</code></td><td>极坐标系</td></tr></tbody></table></div><h4 id="对数坐标系图线"><a href="#对数坐标系图线" class="headerlink" title="对数坐标系图线"></a>对数坐标系图线</h4><p>下面例子演示对数坐标系图线:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; logspace(-1,1,100); y &#x3D; x.^2;subplot(2,2,1);plot(x,y);title(&#39;Plot&#39;);subplot(2,2,2);semilogx(x,y);title(&#39;Semilogx&#39;);subplot(2,2,3);semilogy(x,y);title(&#39;Semilogy&#39;);subplot(2,2,4);loglog(x, y);title(&#39;Loglog&#39;); <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203215844.jpeg" alt="对数坐标系"></p><p>对数坐标系可以加上<strong>网格</strong>,以区分线性坐标系与对数坐标系.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">set(gca, &#39;XGrid&#39;,&#39;on&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203220009.jpeg" alt="对数坐标加网格的重要性"></p><h4 id="双y轴图线"><a href="#双y轴图线" class="headerlink" title="双y轴图线"></a>双y轴图线</h4><p><code>plotyy()</code>的返回值为数组<code>[ax,hlines1,hlines2]</code>,其中:</p><ul><li><code>ax</code>为一个向量,保存两个坐标系对象的句柄.</li><li><code>hlines1</code>和<code>hlines2</code>分别为两个图线的句柄.</li></ul><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; 0:0.01:20;y1 &#x3D; 200*exp(-0.05*x).*sin(x);y2 &#x3D; 0.8*exp(-0.5*x).*sin(10*x);[AX,H1,H2] &#x3D; plotyy(x,y1,x,y2);set(get(AX(1),&#39;Ylabel&#39;),&#39;String&#39;,&#39;Left Y-axis&#39;)set(get(AX(2),&#39;Ylabel&#39;),&#39;String&#39;,&#39;Right Y-axis&#39;)title(&#39;Labeling plotyy&#39;);set(H1,&#39;LineStyle&#39;,&#39;--&#39;); set(H2,&#39;LineStyle&#39;,&#39;:&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203220101.jpeg" alt="双y轴图线"></p><h3 id="统计图表"><a href="#统计图表" class="headerlink" title="统计图表"></a>统计图表</h3><div class="table-container"><table><thead><tr><th>函数</th><th>图形描述</th></tr></thead><tbody><tr><td><code>hist()</code></td><td>直方图</td></tr><tr><td><code>bar()</code></td><td>二维柱状图</td></tr><tr><td><code>pie()</code></td><td>饼图</td></tr><tr><td><code>stairs()</code></td><td>阶梯图</td></tr><tr><td><code>stem()</code></td><td>针状图</td></tr></tbody></table></div><h4 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h4><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203220732.jpeg" alt="直方图"></p><h4 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h4><ul><li><p>使用<code>bar()</code>和<code>bar3()</code>函数分别绘制二维和三维直方图</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; [1 2 5 4 8]; y &#x3D; [x;1:5];subplot(1,3,1); bar(x); title(&#39;A bargraph of vector x&#39;);subplot(1,3,2); bar(y); title(&#39;A bargraph of vector y&#39;);subplot(1,3,3); bar3(y); title(&#39;A 3D bargraph&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191116210529183.jpg" alt="在这里插入图片描述"></p><blockquote><p><code>hist</code>主要用于查看变量的频率分布,而<code>bar</code>主要用于查看分立的量的统计结果.</p></blockquote></li><li><p>使用<code>barh()</code>函数可以绘制纵向排列的柱状图</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; [1 2 5 4 8];y &#x3D; [x;1:5];barh(y);title(&#39;Horizontal&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191116212011255.jpg" alt="纵向排列的柱状图"></p></li><li><p>向<code>bar()</code>传入<code>&#39;stack&#39;</code>参数可以让柱状图以堆栈的形式画出.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; [1 2 5 4 8];y &#x3D; [x;1:5];bar(y,&#39;stacked&#39;);title(&#39;Stacked&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203220924.jpeg" alt="堆栈式柱状图"></p></li></ul><h4 id="饼图"><a href="#饼图" class="headerlink" title="饼图"></a>饼图</h4><p>使用<code>pie()</code>和<code>pie3()</code>可以绘制二维和三维的饼图.向其传入一个bool向量表示每一部分扇区是否偏移.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">a &#x3D; [10 5 20 30];subplot(1,3,1); pie(a);subplot(1,3,2); pie(a, [0,0,0,1]);subplot(1,3,3); pie3(a, [0,0,0,1]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221246.jpeg" alt="饼图"></p><h4 id="阶梯图和针状图-绘制离散数字序列"><a href="#阶梯图和针状图-绘制离散数字序列" class="headerlink" title="阶梯图和针状图:绘制离散数字序列"></a>阶梯图和针状图:绘制离散数字序列</h4><p><code>stairs()</code>和<code>stem()</code>函数分别用来绘制阶梯图和针状图,用于表示离散数字序列.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; linspace(0, 4*pi, 40); y &#x3D; sin(x);subplot(1,2,1); stairs(y);subplot(1,2,2); stem(y);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221311.jpeg" alt="在这里插入图片描述"></p><h2 id="三维图表"><a href="#三维图表" class="headerlink" title="三维图表"></a>三维图表</h2><h4 id="二维图转为三维图"><a href="#二维图转为三维图" class="headerlink" title="二维图转为三维图"></a>二维图转为三维图</h4><p>在MATLAB中,所有的图都是三维图,二维图只不过是三维图的一个投影.点击图形窗口的<code>Rotate 3D</code>按钮,即可通过鼠标拖拽查看该图形的三维视图.</p><h4 id="三维图转换为二维图"><a href="#三维图转换为二维图" class="headerlink" title="三维图转换为二维图"></a>三维图转换为二维图</h4><p>使用<code>imagesc()</code>函数可以将三维图转换为二维俯视图,通过点的颜色指示高度.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">[x, y] &#x3D; meshgrid(-3:.2:3,-3:.2:3); z &#x3D; x.^2 + x.*y + y.^2; subplot(1, 2, 1)surf(x, y, z); subplot(1, 2, 2)imagesc(z);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221702.jpeg" alt="在这里插入图片描述"></p><p>使用<code>colorbar</code>命令可以在生成的二维图上增加颜色与高度间对应关系的图例,使用<code>colormap</code>命令可以改变配色方案.具体细节请参考<a href="https://ww2.mathworks.cn/help/matlab/ref/colormap.html?lang=en">官方文档</a></p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221742.png" alt="在这里插入图片描述"></p><h3 id="三维图的绘制"><a href="#三维图的绘制" class="headerlink" title="三维图的绘制"></a>三维图的绘制</h3><h4 id="绘制三维图前的准备工作"><a href="#绘制三维图前的准备工作" class="headerlink" title="绘制三维图前的准备工作"></a>绘制三维图前的准备工作</h4><ul><li>使用<code>meshgrid()</code>生成二维网格</li></ul><p><code>meshgrid()</code>函数将输入的两个向量进行相应的行扩充和列扩充以得到两个增广矩阵,对该矩阵可应用二元函数.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; -2:1:2;y &#x3D; -2:1:2;[X,Y] &#x3D; meshgrid(x,y)Z &#x3D; X.^2 + Y.^2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="绘制三维线"><a href="#绘制三维线" class="headerlink" title="绘制三维线"></a>绘制三维线</h4><p>使用<code>plot3()</code>函数即可绘制三维面,输入应为三个向量.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x&#x3D;0:0.1:3*pi; z1&#x3D;sin(x); z2&#x3D;sin(2.*x); z3&#x3D;sin(3.*x);y1&#x3D;zeros(size(x)); y3&#x3D;ones(size(x)); y2&#x3D;y3.&#x2F;2;plot3(x,y1,z1,&#39;r&#39;,x,y2,z2,&#39;b&#39;,x,y3,z3,&#39;g&#39;); grid on;xlabel(&#39;x-axis&#39;); ylabel(&#39;y-axis&#39;); zlabel(&#39;z-axis&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221905.jpeg" alt="三维曲线"></p><h4 id="绘制三维面"><a href="#绘制三维面" class="headerlink" title="绘制三维面"></a>绘制三维面</h4><p>使用<code>mesh()</code>和<code>surf()</code>命令可以绘制三维面,前者不会填充网格而后者会.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; -3.5:0.2:3.5; y &#x3D; -3.5:0.2:3.5;[X,Y] &#x3D; meshgrid(x,y);Z &#x3D; X.*exp(-X.^2-Y.^2);subplot(1,2,1); mesh(X,Y,Z);subplot(1,2,2); surf(X,Y,Z);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203221954.png" alt="在这里插入图片描述"></p><h4 id="绘制三维图形的等高线"><a href="#绘制三维图形的等高线" class="headerlink" title="绘制三维图形的等高线"></a>绘制三维图形的等高线</h4><p>使用<code>contour()</code>和<code>contourf()</code>函数可以绘制三维图形的等高线,前者不会填充网格而后者会.</p><p>向<code>contour()</code>函数传入参数或操作图形句柄可以改变图像的细节:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; -3.5:0.2:3.5; y &#x3D; -3.5:0.2:3.5;[X,Y] &#x3D; meshgrid(x,y); Z &#x3D; X.*exp(-X.^2-Y.^2);subplot(1,3,1); contour(Z,[-.45:.05:.45]); axis square;subplot(1,3,2); [C,h] &#x3D; contour(Z); clabel(C,h); axis square;subplot(1,3,3); contourf(Z); axis square;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203222505.jpeg" alt="在这里插入图片描述"></p><p>使用<code>meshc()</code>和<code>surfc()</code>函数可以在绘制三维图形时绘制其等高线.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; -3.5:0.2:3.5; y &#x3D; -3.5:0.2:3.5;[X,Y] &#x3D; meshgrid(x,y); Z &#x3D; X.*exp(-X.^2-Y.^2);subplot(1,2,1); meshc(X,Y,Z);subplot(1,2,2); surfc(X,Y,Z);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203222646.jpeg" alt="在这里插入图片描述"></p><h4 id="绘制三维体"><a href="#绘制三维体" class="headerlink" title="绘制三维体"></a>绘制三维体</h4><p>使用<code>patch()</code>函数可以绘制三维体.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">v &#x3D; [0 0 0; 1 0 0 ; 1 1 0; 0 1 0; 0.25 0.25 1; 0.75 0.25 1; 0.75 0.75 1; 0.25 0.75 1];f &#x3D; [1 2 3 4; 5 6 7 8; 1 2 6 5; 2 3 7 6; 3 4 8 7; 4 1 5 8];subplot(1,2,1); patch(&#39;Vertices&#39;, v, &#39;Faces&#39;, f, &#39;FaceVertexCData&#39;, hsv(6), &#39;FaceColor&#39;, &#39;flat&#39;);view(3); axis square tight; grid on;subplot(1,2,2); patch(&#39;Vertices&#39;, v, &#39;Faces&#39;, f, &#39;FaceVertexCData&#39;, hsv(8), &#39;FaceColor&#39;,&#39;interp&#39;);view(3); axis square tight; grid on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203222800.jpeg" alt="在这里插入图片描述"></p><h3 id="三维图的视角与打光"><a href="#三维图的视角与打光" class="headerlink" title="三维图的视角与打光"></a>三维图的视角与打光</h3><h4 id="调整视角"><a href="#调整视角" class="headerlink" title="调整视角"></a>调整视角</h4><p>使用<code>view()</code>函数可以调整视角,<code>view()</code>函数接受两个浮点型参数,分别表示两个方位角<code>azimuth</code>和<code>elevation</code>.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203222959.png" alt="在这里插入图片描述"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">sphere(50); shading flat;material shiny;axis vis3d off;view(-45,20);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220203223018.png" alt="image-20220203223018744"></p><h1 id="符号运算"><a href="#符号运算" class="headerlink" title="符号运算"></a>符号运算</h1><h2 id="创建符号变量"><a href="#创建符号变量" class="headerlink" title="创建符号变量"></a>创建符号变量</h2><h3 id="创建符号数字"><a href="#创建符号数字" class="headerlink" title="创建符号数字"></a>创建符号数字</h3><p>使用<code>sym</code>函数可以创建符号数字.使用符号数字可以精确地保存无理数,不会产生误差.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">sym(1&#x2F;3)% 得到 1&#x2F;31&#x2F;3% 得到 0.3333<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>将无理数保存为符号数字可以避免将其转换为浮点数的误差:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">sin(sym(pi))% 得到 0sin(pi)% 得到 1.2246e-16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="创建符号变量-1"><a href="#创建符号变量-1" class="headerlink" title="创建符号变量"></a>创建符号变量</h3><p>使用<code>sym</code>和<code>syms</code>可以创建符号变量,区别在于:</p><ol><li><p><code>sym</code>每次只能创建一个符号变量,而<code>syms</code>一次可以创建多个符号变量.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms a% sym命令只能创建一个符号变量syms b c d% syms命令可以创建多个符号变量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>若所指定的符号变量已存在,<code>sym</code>不会保留其原有的值,而<code>syms</code>会清空其值.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yf &#x3D; x+y;% 隐式创建符号变量fsym f% 不清空变量f原有的值,即f &#x3D; x + y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yf &#x3D; x+y;% 隐式创建符号变量fsyms f% 清空变量f原有的值,即f &#x3D; f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>使用<code>sym</code>可以创建符号变量矩阵.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">A &#x3D; sym(&#39;a&#39;, [2 5])% 创建一个2*5的符号变量矩阵whos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>得到的输出如下:</p><pre class="line-numbers language-none"><code class="language-none">A &#x3D;[ a1_1, a1_2, a1_3, a1_4, a1_5][ a2_1, a2_2, a2_3, a2_4, a2_5]    Name      Size            Bytes  Class    Attributes  A         2x5               112  sym      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>联合使用<code>sym</code>和<code>syms</code>可以快速创建一系列带下标的变量</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">clear allsyms(sym(&#39;a&#39;, [1 5]))whos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>得到输出如下:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">Name      Size            Bytes  Class    Attributesa1        1x1                 8  sym                a2        1x1                 8  sym                a3        1x1                 8  sym                a4        1x1                 8  sym                a5        1x1                 8  sym                <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="符号运算-1"><a href="#符号运算-1" class="headerlink" title="符号运算"></a>符号运算</h2><h3 id="符号表达式的化简与代入"><a href="#符号表达式的化简与代入" class="headerlink" title="符号表达式的化简与代入"></a>符号表达式的化简与代入</h3><h4 id="符号表达式的化简"><a href="#符号表达式的化简" class="headerlink" title="符号表达式的化简"></a>符号表达式的化简</h4><p>使用<code>simplify()</code>函数可以化简符号表达式.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x a b csimplify(sin(x)^2 + cos(x)^2);% 得到 1simplify(exp(c*log(sqrt(a+b))));% 得到 (a + b)^(c&#x2F;2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>表达式化简的标准是不确定的,下面三个函数分别按照不同标准化简表达式:</p><ul><li><p><code>expand()</code>函数可以展开表达式</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xf &#x3D; (x ^2- 1)*(x^4 + x^3 + x^2 + x + 1)*(x^4 - x^3 + x^2 - x + 1);expand(f);% 得到 x^10 - 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>factor()</code>函数可以分解因式</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xg &#x3D; x^3 + 6*x^2 + 11*x + 6;factor(g);% 得到 (x + 3)*(x + 2)*(x + 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>horner()</code>函数可以将多项式变为嵌套形式</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xh &#x3D; x^5 + x^4 + x^3 + x^2 + x;horner(h);% 得到 x*(x*(x*(x*(x + 1) + 1) + 1) + 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="符号表达式的代入"><a href="#符号表达式的代入" class="headerlink" title="符号表达式的代入"></a>符号表达式的代入</h4><p>使用<code>sub(expr, old, new)</code>函数可以将符号表达式<code>expr</code>中的<code>old</code>替换为<code>new</code>.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yf &#x3D; x^2*y + 5*x*sqrt(y);subs(f, x, 3);% 得到 9*y + 15*y^(1&#x2F;2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="求方程的解析解"><a href="#求方程的解析解" class="headerlink" title="求方程的解析解"></a>求方程的解析解</h3><p>使用<code>solve(eqn,var)</code>和<code>solve(eqns,vars)</code>可以求取方程式的解析解.</p><h4 id="解单变量方程"><a href="#解单变量方程" class="headerlink" title="解单变量方程"></a>解单变量方程</h4><p>使用<code>==</code>定义一个方程,并对其调用<code>solve</code>函数求解.（若不指定<code>==</code>符号右边的值,则默认等式右边为0.）</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xeqn &#x3D; x^3 - 6*x^2 &#x3D;&#x3D; 6 - 11*x;solve(eqn);% 得到 [1 2 3]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="解多变量方程"><a href="#解多变量方程" class="headerlink" title="解多变量方程"></a>解多变量方程</h4><p>对于多变量方程,我们需要指定针对哪个变量进行求解.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yeqn &#x3D; [6*x^2 - 6*x^2*y + x*y^2 - x*y + y^3 - y^2 &#x3D;&#x3D; 0];solve(eqn, y);% 得到 [1, 2*x, -3*x]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="解方程组"><a href="#解方程组" class="headerlink" title="解方程组"></a>解方程组</h4><p>向<code>solve()</code>函数传入方程组可以解方程.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms u veqns &#x3D; [2*u + v &#x3D;&#x3D; 0, u - v &#x3D;&#x3D; 1];S &#x3D; solve(eqns,[u v]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以通过变量名索引方程的解,并可以将该解代入其他表达式中.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">S.u;% 得到 1&#x2F;3S.v;% 得到 -2&#x2F;3subs(3*v + u, S);% 得到 -3&#x2F;5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="符号微积分运算"><a href="#符号微积分运算" class="headerlink" title="符号微积分运算"></a>符号微积分运算</h3><h4 id="求极限"><a href="#求极限" class="headerlink" title="求极限"></a>求极限</h4><p>使用<code>limit(expr, var, a)</code>函数可以求取符号表达式<code>expr</code>在变量<code>var</code>趋近于<code>a</code>时的极限,添加参数<code>&#39;left&#39;</code>或<code>&#39;right&#39;</code>可以指定左极限或右极限.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x;expr &#x3D; 1&#x2F;x;limit(expr,x,0);% 得到NaNlimit(expr,x,0,&#39;left&#39;);% 得到-Inflimit(expr,x,0,&#39;right&#39;);% 得到Inf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="微分"><a href="#微分" class="headerlink" title="微分"></a>微分</h4><p>使用<code>diff(expr, var, n)</code>函数可以求取符号表达式<code>expr</code>对变量<code>var</code>的<code>n</code>阶微分.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms a b c x;expr &#x3D; a*x^2 + b*x + c;diff(expr, a);% 得到 x^2diff(expr, b);% 得到 xdiff(expr, x);% 得到 b + 2*a*xdiff(expr, x, 2);% 得到 2*a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h4><p>使用<code>int(expr, var)</code>函数可以求取符号表达式<code>expr</code>对变量<code>var</code>的不定积分.使用<code>int(expr, var, [a, b])</code>函数可以指定上下限求定积分,<code>a</code>和<code>b</code>可以是符号表达式.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x a bexpr &#x3D; -2*x&#x2F;(1+x^2)^2;int(expr, x);% 得到 1&#x2F;(x^2 + 1)int(expr, x, [1, 2]);% 得到 -0.3int(expr, x, [1, Inf]);% 得到 -0.5int(expr, x, [a, b]);% 得到 1&#x2F;(b^2 + 1) - 1&#x2F;(a^2 + 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于一些函数,MATLAB不能求出其积分,这时MATLAB会返回一个未解析(unsolved)的积分形式.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xint(sin(sinh(x)));% 一个无解的积分,MATLAB返回 int(sin(sinh(x)),<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="级数求和"><a href="#级数求和" class="headerlink" title="级数求和"></a>级数求和</h4><p>使用<code>symsum(expr, k, [a b])</code>计算级数<code>expr</code>的索引<code>k</code>从<code>a</code>到<code>b</code>的加和.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms k xsymsum(k^2, k)% 得到 k^3&#x2F;3 - k^2&#x2F;2 + k&#x2F;6symsum(k^2, k, [0 10])% 得到 385symsum(x^k&#x2F;factorial(k),k,1,Inf)% 得到 exp(x) - 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="泰勒展开"><a href="#泰勒展开" class="headerlink" title="泰勒展开"></a>泰勒展开</h4><p>使用<code>taylor(expr,var,a)</code>计算表达式<code>expr</code>在<code>var=a</code>处的泰勒级数.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms xtaylor(exp(x))% 得到 x^5&#x2F;120 + x^4&#x2F;24 + x^3&#x2F;6 + x^2&#x2F;2 + x + 1taylor(sin(x))% 得到 x^5&#x2F;120 - x^3&#x2F;6 + xtaylor(cos(x))% 得到 x^4&#x2F;24 - x^2&#x2F;2 + 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h2><p>可以对符号表达式绘制图像,常用的绘图函数如下:</p><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>fplot()</code></td><td>绘制符号表达式的二维线图像</td></tr><tr><td><code>fplot3()</code></td><td>绘制符号表达式的三维线图像</td></tr><tr><td><code>ezpolar()</code></td><td>绘制符号表达式的极坐标线图像</td></tr><tr><td><code>fmesh()</code></td><td>绘制网状面图像</td></tr><tr><td><code>fsurf()</code></td><td>绘制带颜色的面图像</td></tr><tr><td><code>fcontour()</code></td><td>绘制轮廓图像</td></tr><tr><td><code>fimplicit()</code></td><td>绘制隐含函数关系的图像</td></tr></tbody></table></div><ol><li><p>下面例子展示二维和三维线图像的绘制</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">subplot(1, 2, 1)syms xf &#x3D; x^3 - 6*x^2 + 11*x - 6;fplot(f, x)subplot(1, 2, 2)syms tfplot3(t^2*sin(10*t), t^2*cos(10*t), t)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191123174049841.png" alt="在这里插入图片描述"></p></li><li><p>下面例子演示三维面的绘制</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yfsurf(x^2 + y^2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191123194055609.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25jZXB1X0NoZW4=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>下面例子演示隐含函数关系图像的绘制</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">syms x yeqn &#x3D; (x^2 + y^2)^4 &#x3D;&#x3D; (x^2 - y^2)^2;fimplicit(eqn, [-1 1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191123174144464.png" alt="在这里插入图片描述"></p></li></ol><h1 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h1><h2 id="多项式的数值运算"><a href="#多项式的数值运算" class="headerlink" title="多项式的数值运算"></a>多项式的数值运算</h2><h3 id="使用MATLAB表示多项式"><a href="#使用MATLAB表示多项式" class="headerlink" title="使用MATLAB表示多项式"></a>使用MATLAB表示多项式</h3><h4 id="使用向量表示多项式"><a href="#使用向量表示多项式" class="headerlink" title="使用向量表示多项式"></a>使用向量表示多项式</h4><p>在MATLAB中,多项式可以用向量表示,向量中的元素为多项式的系数(降幂排序):第一位为多项式最高次项系数,最后一位为常数项.</p><p>例如多项式:<br>f(x) = x^3 - 2x - 5f(x)=x3−2x−5</p><p>可以用向量<code>p = [1 0 -2 -5]</code>表示.</p><h4 id="多项式求值-polyval"><a href="#多项式求值-polyval" class="headerlink" title="多项式求值:polyval()"></a>多项式求值:<code>polyval()</code></h4><p>使用<code>polyval(p, x)</code>可以计算多项式<code>p</code>在<code>x</code>的每个点处的值.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">a &#x3D; [9,-5,3,7]; x &#x3D; -2:0.01:5;f &#x3D; polyval(a,x);plot(x,f);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204115820.jpeg" alt="在这里插入图片描述"></p><h4 id="多项式的乘法-conv"><a href="#多项式的乘法-conv" class="headerlink" title="多项式的乘法:conv()"></a>多项式的乘法:<code>conv()</code></h4><p>使用<code>conv(p1, p2)</code>函数可以对两个向量<code>p1</code>和<code>p2</code>进行卷积相乘,用于计算多项式的乘法.</p><p>例如多项式:<br>f(x) = (x^2+1) (2x+7)f(x)=(x2+1)(2x+7)</p><p>可以使用<code>conv()</code>函数得到展开后的多项式:</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">p &#x3D; conv([1 0 1], [2 7])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到<code>p = [2 7 2 7]</code>.</p><h3 id="多项式的数值运算-1"><a href="#多项式的数值运算-1" class="headerlink" title="多项式的数值运算"></a>多项式的数值运算</h3><h4 id="多项式的因式分解-roots"><a href="#多项式的因式分解-roots" class="headerlink" title="多项式的因式分解:roots()"></a>多项式的因式分解:<code>roots()</code></h4><p>使用<code>roots(p)</code>函数可以对多项式<code>p</code>进行因式分解,即求表达式值为0的根.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">p &#x3D; roots([1 -3.5 2.75 2.125 -3.875 1.25])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到<code>p = [2 -1, 1+0.5i, 1-0.5i, 0.5]</code>,表示x^5 -3.5 x^4 +2.75 x^3 + 2.125 x^2 + -3.875 x+1.25 = (x-2)(x+1)(x-1-0.5i)(x-1+0.5i)(x-0.5)x5−3.5x4+2.75x3+2.125x2+−3.875x+1.25=(x−2)(x+1)(x−1−0.5i)(x−1+0.5i)(x−0.5).</p><h4 id="多项式的微分-polyder"><a href="#多项式的微分-polyder" class="headerlink" title="多项式的微分:polyder()"></a>多项式的微分:<code>polyder()</code></h4><p>使用<code>polyder(p)</code>函数可以计算多项式的导数.</p><p>例如对下面多项式求导:<br>f(x) = 5x^4 - 2x^2 + 1f(x)=5x4−2x2+1</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">p &#x3D; polyder([5 0 -2 0 1]);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到<code>p = [20 0 -4 0]</code>,表示计算得到导数f’(x) = 20 x^3 - 4xf′(x)=20x3−4x.</p><h4 id="多项式的积分-polyint"><a href="#多项式的积分-polyint" class="headerlink" title="多项式的积分:polyint()"></a>多项式的积分:<code>polyint()</code></h4><p>使用<code>polyint(p, k)</code>函数可以计算多项式<code>p</code>的积分,积分结果的常数项设为<code>k</code>.</p><p>例如对下面多项式求导:<br>f(x) = 5x^4 - 2x^2 + 1f(x)=5x4−2x2+1</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">p &#x3D; polyint([5 0 -2 0 1], 3)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到<code>p = [1 0 -0.6667 0 1 3]</code>,表示计算得到积分\int f(x) dx = x^5 -0.6667x^3 + x + 3∫f(x)dx=x5−0.6667x3+x+3.</p><h2 id="非线性表达式的数值运算"><a href="#非线性表达式的数值运算" class="headerlink" title="非线性表达式的数值运算"></a>非线性表达式的数值运算</h2><h3 id="方程-组-求根fsolve"><a href="#方程-组-求根fsolve" class="headerlink" title="方程(组)求根fsolve()"></a>方程(组)求根<code>fsolve()</code></h3><p>使用<code>fsolve(fun, x0)</code>求非线性方程组的根,<code>fun</code>为待求方程的函数句柄,<code>x0</code>为初值.</p><ol><li><p>求方程1.2x+x\sin(x)+0.3=01.2x+xsin(x)+0.3=0在x=0x=0附近的解.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">f2 &#x3D; @(x) (1.2*x+x*sin(x)+0.3);fsolve(f2,0)% 得到 -0.3500<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>解方程组<br>\begin{aligned} \left\{ \begin{aligned} e^{-e^{-(x_1+x_2)}} - x_2(1+x_1^2) = 0 \\ x_1 \cos x_2 + x_2 \sin x_1 - \frac{1}{2} = 0 \end{aligned} \right. \end{aligned}⎩⎪⎨⎪⎧​e−e−(x1​+x2​)−x2​(1+x12​)=0x1​cosx2​+x2​sinx1​−21​=0​​</p><p>设定初值为[0, 0][0,0]</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">fun &#x3D; @(x) [exp(-exp(-(x(1)+x(2))))-x(2)*(1+x(1)^2)...    x(1)*cos(x(2)) + x(2)*sin(x(1)) - 0.5]x0 &#x3D; [0,0];x &#x3D; fsolve(fun,x0)% 得到[0.3532 0.6061]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="数值微分"><a href="#数值微分" class="headerlink" title="数值微分"></a>数值微分</h3><h4 id="求差分-diff"><a href="#求差分-diff" class="headerlink" title="求差分:diff()"></a>求差分:<code>diff()</code></h4><p>使用<code>diff(X, n)</code>计算向量<code>X</code>的<code>n</code>阶差分,<code>n</code>默认为<code>1</code>.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; [1 2 5 2 1];diff(x);% 得到 [1 3 -3 -1]diff(x,1);% 得到 [1 3 -3 -1]diff(x,2);% 得到 [2 -6 2]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="求导数-diff-y-diff-x"><a href="#求导数-diff-y-diff-x" class="headerlink" title="求导数:diff(y)./diff(x)"></a>求导数:<code>diff(y)./diff(x)</code></h4><p>使用导数的定义</p><script type="math/tex; mode=display">f'(x_0) = \lim_{h\rarr 0} \frac{f(x_0 + h) - f(x_0)}{h}$</script><p>可以计算函数在某点的近似导数.</p><p>下面程序计算f(x) = x^3f(x)=x3的一阶和二阶导数的值.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; -2:0.005:2; y &#x3D; x.^3;m &#x3D; diff(y).&#x2F;diff(x);% 计算一阶导数m2 &#x3D; diff(m).&#x2F;diff(x(1:end-1));% 计算二阶导数plot(x,y,x(1:end-1),m,x(1:end-2),m2);xlabel(&#39;x&#39;); ylabel(&#39;y&#39;);legend(&#39;f(x) &#x3D;x^3&#39;,&#39;f&#39;&#39;(x)&#39;,&#39;f&#39;&#39;&#39;&#39;(x)&#39;, 4);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204120807.jpeg" alt="在这里插入图片描述"></p><h3 id="数值积分"><a href="#数值积分" class="headerlink" title="数值积分"></a>数值积分</h3><h4 id="数值积分原理"><a href="#数值积分原理" class="headerlink" title="数值积分原理"></a>数值积分原理</h4><p>有三种常见算法用于计算数值积分: <strong>矩形法</strong>,<strong>梯形法</strong>,<strong>抛物线法</strong>,它们分别把微分区间的图形视为矩形,梯形,抛物线以计算面积.</p><div class="table-container"><table><thead><tr><th>算法</th><th>图示</th><th>表达式</th></tr></thead><tbody><tr><td>矩形法(Midpoint Rule)</td><td><img src="https://img-blog.csdnimg.cn/20191120165104999.png" alt="在这里插入图片描述"></td><td><script type="math/tex">\int_a^b f(x) dx = 2h \sum_{i=0}^{(n/2)-1} f(x_{2i+1})</script></td></tr><tr><td>梯形法(Trapezoid Rule)</td><td><img src="https://img-blog.csdnimg.cn/20191120165114624.png" alt="在这里插入图片描述"></td><td><script type="math/tex">\int_a^b f(x) dx = \frac{h}{2} \left[ f(a) + 2\sum_{i=1}^{n-1} f(x_i) +f(b) \right]</script></td></tr><tr><td>抛物线法(Simpson’s Rule)</td><td><img src="https://img-blog.csdnimg.cn/20191120165124685.png" alt="在这里插入图片描述"></td><td><script type="math/tex">\int_a^b f(x) dx = \frac{h}{3} \left[ f(a) + 2\sum_{i=1}^{(n/2)-1} f(x_{2i}) + 4\sum_{i=1}^{n/2} f(x_{2i-1}) + f(b) \right]</script></td></tr></tbody></table></div><p><img src="https://img-blog.csdnimg.cn/20191120180550884.png" alt="在这里插入图片描述"></p><p>下面分别使用三种方法计算f(x) = 4x^3f(x)=4x3在区间(0, 2)(0,2)内的积分.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">h &#x3D; 0.05; x &#x3D; 0:h:2;% 使用矩形法计算近似积分midpoint &#x3D; (x(1:end-1)+x(2:end)).&#x2F;2;y &#x3D; 4*midpoint.^3;s &#x3D; sum(h*y)% 得到 15.9950% 使用梯形法计算近似积分trapezoid &#x3D; (y(1:end-1)+y(2:end))&#x2F;2;s &#x3D; h*sum(trapezoid)% 得到 15.2246% 使用抛物线法计算数值积分s &#x3D; h&#x2F;3*(y(1)+2*sum(y(3:2:end-2))+4*sum(y(2:2:end))+y(end))% 得到 15.8240<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="数值积分函数-integral"><a href="#数值积分函数-integral" class="headerlink" title="数值积分函数:integral()"></a>数值积分函数:<code>integral()</code></h4><p><code>integral()</code>,<code>integral2()</code>,<code>integral3()</code>分别对函数在<code>xmin</code>至<code>xmax</code>间进行一重,二重,三重积分.</p><p>它们的第一个参数都应该是一个函数句柄,下面例子演示他们的用法:</p><ol><li><p>计算\int_0^2 \frac{1}{x^3-2x-5}∫02x3−2x−51</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">f &#x3D; @(x) 1.&#x2F;(x.^3-2*x-5);integral(f,0,2)% 得到 -0.4605<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>计算\int_0^\pi \int_\pi^{2\pi} (y\sin(x) + x \cos(y)) dx dy∫0π∫π2π(ysin(x)+xcos(y))dxdy</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">f &#x3D; @(x,y) y.*sin(x)+x.*cos(y);integral2(f,pi,2*pi,0,pi)% 得到 -9.8696<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>计算\int_{-1}^1 \int_0^1 \int_0^\pi (y\sin(x) + z \cos(y)) dx dy dz∫−11∫01∫0π(ysin(x)+zcos(y))dxdydz</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">f &#x3D; @(x,y,z) y.*sin(x)+z.*cos(y);integral3(f,0,pi,0,1,-1,1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h1 id="统计与拟合"><a href="#统计与拟合" class="headerlink" title="统计与拟合"></a>统计与拟合</h1><h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><h3 id="描述性统计-Descriptive-Statistics"><a href="#描述性统计-Descriptive-Statistics" class="headerlink" title="描述性统计(Descriptive Statistics)"></a>描述性统计(Descriptive Statistics)</h3><p>描述性统计主要研究数据的<strong>中心趋势</strong>(Central Tendency)和Variation</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204121855.png" alt="在这里插入图片描述"></p><h4 id="中心趋势-Central-Tendency"><a href="#中心趋势-Central-Tendency" class="headerlink" title="中心趋势(Central Tendency)"></a>中心趋势(Central Tendency)</h4><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>mean()</code></td><td>计算平均值</td></tr><tr><td><code>median()</code></td><td>计算中位数</td></tr><tr><td><code>mode()</code></td><td>计算众数</td></tr><tr><td><code>prctile(X,num)</code></td><td>数据X的num%分位数为多少</td></tr><tr><td><code>max()</code></td><td>计算最大值</td></tr><tr><td><code>min()</code></td><td>计算最小值</td></tr></tbody></table></div><p>下列函数绘制统计图表:</p><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>bar()</code></td><td>绘制条形图</td></tr><tr><td><code>stem()</code></td><td>绘制针状图</td></tr><tr><td><code>area()</code></td><td>绘制填充图</td></tr><tr><td><code>boxplot()</code></td><td>绘制箱线图</td></tr></tbody></table></div><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; 1:14;freqy &#x3D; [1 0 1 0 4 0 1 0 3 1 0 0 1 1];subplot(1,3,1); bar(x,freqy); xlim([0 15]);subplot(1,3,2); area(x,freqy); xlim([0 15]);subplot(1,3,3); stem(x,freqy); xlim([0 15]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191125180936445.jpg" alt="在这里插入图片描述"></p><p>  箱线图可以突出显示数据的四分位点.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204122616.png" alt="在这里插入图片描述"></p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">marks &#x3D; [80 81 81 84 88 92 92 94 96 97];boxplot(marks) % prctile(marks, [25 50 75])% 得到 [81 90 94]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/2019112517244367.jpg" alt="在这里插入图片描述"></p><h4 id="Variation"><a href="#Variation" class="headerlink" title="Variation"></a>Variation</h4><h5 id="离散程度"><a href="#离散程度" class="headerlink" title="离散程度"></a>离散程度</h5><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>std()</code></td><td>计算数据的标准差</td></tr><tr><td><code>var()</code></td><td>计算数据的方差</td></tr></tbody></table></div><h5 id="偏度-Skewness"><a href="#偏度-Skewness" class="headerlink" title="偏度(Skewness"></a>偏度(Skewness</h5><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>skewness()</code></td><td>计算数据的偏度</td></tr></tbody></table></div><p><img src="https://img-blog.csdnimg.cn/20191125164908565.png" alt="在这里插入图片描述"></p><p>偏度反映数据的对称程度</p><ul><li>数据左偏时,其偏度小于0.</li><li>数据完全对称时,其偏度等于0.</li><li>数据右偏时,其偏度大于0.</li></ul><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">X &#x3D; randn([10 3]);% 构造10*3的矩阵X(X(:,1)&lt;0, 1) &#x3D; 0; % 将第一列数据右偏X(X(:,3)&gt;0, 3) &#x3D; 0;% 将第二列数据左偏boxplot(X, &#123;&#39;Right-skewed&#39;, &#39;Symmetric&#39;, &#39;Left-skewed&#39;&#125;);skewness(X);% 得到 [0.5162 -0.7539 -1.1234]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/20191125172206776.jpg" alt="在这里插入图片描述"></p><h5 id="峰度-Kurtosis"><a href="#峰度-Kurtosis" class="headerlink" title="峰度(Kurtosis)"></a>峰度(Kurtosis)</h5><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>kurtosis()</code></td><td>计算数据的峰度</td></tr></tbody></table></div><p>峰度(Kurtosis)表征概率密度分布曲线在平均值处峰值的高低.直观来看,峰度反映了峰部的尖度.</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204123115.png" alt="在这里插入图片描述"></p><h3 id="统计推断-Inferential-Statistics"><a href="#统计推断-Inferential-Statistics" class="headerlink" title="统计推断(Inferential Statistics)"></a>统计推断(Inferential Statistics)</h3><p>推论统计的核心即为假设检验.下列函数用于进行假设检验.</p><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>ttest()</code></td><td>进行T检验</td></tr><tr><td><code>ztest()</code></td><td>进行Z检验</td></tr><tr><td><code>ranksum()</code></td><td>进行秩和检验</td></tr><tr><td><code>signrank()</code></td><td>进行符号秩检验</td></tr></tbody></table></div><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">load examgradesx &#x3D; grades(:,1);y &#x3D; grades(:,2);[h,p] &#x3D; ttest(x,y);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>执行上述程序,得到<code>[h p] = [0 0.9805]</code>,表示在默认显著性水平(5%)下我们没有理由拒绝<code>x</code>与<code>y</code>同分布.</p><h2 id="拟合"><a href="#拟合" class="headerlink" title="拟合"></a>拟合</h2><h3 id="多项式拟合"><a href="#多项式拟合" class="headerlink" title="多项式拟合"></a>多项式拟合</h3><h4 id="一元多项式拟合-polyfit"><a href="#一元多项式拟合-polyfit" class="headerlink" title="一元多项式拟合:polyfit()"></a>一元多项式拟合:<code>polyfit()</code></h4><p>使用<code>polyfit(x, y, n)</code>函数对数据<code>x</code>和<code>y</code>进行<code>n</code>次多项式拟合.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">x &#x3D; [-1.2 -0.5 0.3 0.9 1.8 2.6 3.0 3.5];y &#x3D; [-15.6 -8.5 2.2 4.5 6.6 8.2 8.9 10.0];for i &#x3D; 1:3 % 分别进行一次,二次,三次拟合    p &#x3D; polyfit(x, y, i);    xfit &#x3D; x(1):0.1:x(end); yfit &#x3D; polyval(p, xfit);    subplot(1, 3, i); plot(x, y, &#39;ro&#39;, xfit, yfit);    legend(&#39;Data points&#39;, &#39;Fitted curve&#39;, &#39;Location&#39;, &#39;southeast&#39;);end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204123618.png" alt="untitled"></p><h4 id="多元线性拟合-regress"><a href="#多元线性拟合-regress" class="headerlink" title="多元线性拟合:regress()"></a>多元线性拟合:<code>regress()</code></h4><p>使用<code>regress(y, X)</code>函数对数据<code>X</code>和<code>y</code>进行多元线性回归.</p><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">load carsmall;y &#x3D; MPG; x1 &#x3D; Weight; x2 &#x3D; Horsepower;% 导入数据集X &#x3D; [ones(length(x1),1) x1 x2];% 构建增广X矩阵b &#x3D; regress(y,X);% 进行线性回归% 下面是绘图语句x1fit &#x3D; min(x1):100:max(x1); x2fit &#x3D; min(x2):10:max(x2);[X1FIT,X2FIT] &#x3D; meshgrid(x1fit,x2fit);YFIT &#x3D; b(1)+b(2)*X1FIT+b(3)*X2FIT;scatter3(x1,x2,y,&#39;filled&#39;); hold on;mesh(X1FIT,X2FIT,YFIT); hold off;xlabel(&#39;Weight&#39;); ylabel(&#39;Horsepower&#39;); zlabel(&#39;MPG&#39;); view(50,10);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204123757.png" alt="untitled"></p><h3 id="非线性拟合"><a href="#非线性拟合" class="headerlink" title="非线性拟合"></a>非线性拟合</h3><p>对于非线性拟合,需要使用曲线拟合工具箱.在命令窗口输入<code>cftool()</code>打开曲线拟合工具箱.</p><h2 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h2><h3 id="一维插值"><a href="#一维插值" class="headerlink" title="一维插值"></a>一维插值</h3><div class="table-container"><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>interp1(x,v)</code>或<code>interp1(x,v,xq)</code></td><td>线性插值</td></tr><tr><td><code>spline(x,v)</code>或<code>spline(x,v,xq)</code></td><td>三次样条插值</td></tr><tr><td><code>pchip(x,v)</code>或<code>pchip(x,v,xq)</code></td><td>三次Hermite插值</td></tr><tr><td><code>mkpp(breaks,coefs)</code></td><td>生成分段多项式</td></tr><tr><td><code>ppval(pp,xq)</code></td><td>计算分段多项式的插值结果</td></tr></tbody></table></div><p>下面例子演示使用<code>interp1(x, v, xq)</code>进行线性插值和使用<code>spline(x, v, xq)</code>进行三次样条插值.各参数意义如下:</p><ul><li><code>x</code>,<code>v</code>: 待插值样本点.</li><li><code>xq</code>: 查询点,函数返回在这些点处的插值结果.</li></ul><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">% 构造数据x &#x3D; linspace(0, 2*pi, 40); x_m &#x3D; x; x_m([11:13, 28:30]) &#x3D; NaN; y_m &#x3D; sin(x_m);plot(x_m, y_m, &#39;ro&#39;, &#39;MarkerFaceColor&#39;, &#39;r&#39;); hold on; % 对数据进行线性插值m_i &#x3D; ~isnan(x_m);y_i &#x3D; interp1(x_m(m_i), y_m(m_i), x);plot(x,y_i, &#39;-b&#39;); hold on;% 对数据进行三次样条插值m_i &#x3D; ~isnan(x_m);y_i &#x3D; spline(x_m(m_i), y_m(m_i), x);plot(x,y_i, &#39;-g&#39;); legend(&#39;Original&#39;, &#39;Linear&#39;, &#39;Spline&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204124746.jpeg" alt="在这里插入图片描述"></p><h3 id="二维插值"><a href="#二维插值" class="headerlink" title="二维插值"></a>二维插值</h3><p>使用<code>interp2()</code>可以进行二维插值,向其<code>method</code>参数传入字符串可以指定插值算法.</p><div class="table-container"><table><thead><tr><th>方法</th><th>说明</th><th>连续性</th></tr></thead><tbody><tr><td><code>&#39;linear&#39;</code></td><td>(默认)在查询点插入的值基于各维中邻点网格点处数值的线性插值.</td><td>C0</td></tr><tr><td><code>&#39;spline&#39;</code></td><td>在查询点插入的值基于各维中邻点网格点处数值的三次插值.插值基于使用非结终止条件的三次样条.</td><td>C2</td></tr><tr><td><code>&#39;nearest&#39;</code></td><td>在查询点插入的值是距样本网格点最近的值.</td><td>不连续</td></tr><tr><td><code>&#39;cubic&#39;</code></td><td>在查询点插入的值基于各维中邻点网格点处数值的三次插值.插值基于三次卷积.</td><td>C1</td></tr><tr><td><code>&#39;makima&#39;</code></td><td>修改后的Akima三次Hermite插值.在查询点插入的值基于次数最大为3的多项式的分段函数,使用各维中相邻网格点的值进行计算.为防过冲,已改进 Akima 公式.</td><td>C1</td></tr></tbody></table></div><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">% 构建样本点xx &#x3D; -2:.5:2; yy &#x3D; -2:.5:3; [x,y] &#x3D; meshgrid(xx,yy); xx_i &#x3D; -2:.1:2; yy_i &#x3D; -2:.1:3; [x_i,y_i] &#x3D; meshgrid(xx_i,yy_i);z &#x3D; x.*exp(-x.^2-y.^2);% 线性插值subplot(1, 2, 1); z_i &#x3D; interp2(xx,yy,z,x_i,y_i);surf(x_i,y_i,z_i); hold on;plot3(x,y,z+0.01,&#39;ok&#39;,&#39;MarkerFaceColor&#39;,&#39;r&#39;); hold on;% 三次插值subplot(1, 2, 2); z_ic &#x3D; interp2(xx,yy,z,x_i,y_i, &#39;spline&#39;);surf(x_i,y_i,z_ic); hold on;plot3(x,y,z+0.01,&#39;ok&#39;,&#39;MarkerFaceColor&#39;,&#39;r&#39;); hold on;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220204125228.png" alt="untitled"></p>]]></content>
    
    
    <summary type="html">在b站学习‘MATLAB教程_台大郭彦甫（14课）’的笔记，梳理原课程的过程中，做了一点改动。</summary>
    
    
    
    <category term="建模" scheme="https://changqingaas.github.io/categories/%E5%BB%BA%E6%A8%A1/"/>
    
    
    <category term="数学" scheme="https://changqingaas.github.io/tags/%E6%95%B0%E5%AD%A6/"/>
    
    <category term="建模" scheme="https://changqingaas.github.io/tags/%E5%BB%BA%E6%A8%A1/"/>
    
  </entry>
  
  <entry>
    <title>美赛校选培训课笔记</title>
    <link href="https://changqingaas.github.io/others/Math/%E7%BE%8E%E8%B5%9B%E6%A0%A1%E9%80%89%E5%9F%B9%E8%AE%AD%E8%AF%BE%E7%AC%94%E8%AE%B0/"/>
    <id>https://changqingaas.github.io/others/Math/%E7%BE%8E%E8%B5%9B%E6%A0%A1%E9%80%89%E5%9F%B9%E8%AE%AD%E8%AF%BE%E7%AC%94%E8%AE%B0/</id>
    <published>2022-01-17T01:29:34.000Z</published>
    <updated>2022-02-04T05:53:22.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="多元统计分析"><a href="#多元统计分析" class="headerlink" title="多元统计分析"></a>多元统计分析</h1><h2 id="聚类分析"><a href="#聚类分析" class="headerlink" title="聚类分析"></a>聚类分析</h2><h3 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h3><ul><li>事先不知道类别的个数与结构；</li><li>进行分析的数据是对象间的相似性或相异性（距离）；</li><li>将距离近的对象归入一类。</li></ul><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul><li><p>根据分类对象不同分为</p><ul><li><p>Q型聚类：对样本进行聚类</p></li><li><p>R型聚类：对变量进行聚类</p></li></ul></li><li><p>根据聚类方法主要分为</p><ul><li>系统聚类法</li><li>动态聚类法</li></ul></li></ul><h3 id="距离"><a href="#距离" class="headerlink" title="距离"></a>距离</h3><h4 id="Minikowski距离："><a href="#Minikowski距离：" class="headerlink" title="Minikowski距离："></a>Minikowski距离：</h4><script type="math/tex; mode=display">d(x,y) = [\sum\limits_{k=1}^p|x_{k} - y_{k}|^{m}]^{\frac{1}{m}}，  x,y为p维列向量</script><ul><li>m = 1时，为绝对距离</li><li>m = 2时，为欧氏距离</li><li>m = $\infty$,  为切比雪夫距离，即 $\mathop{max}\limits_{1\le k \le p}|x_{k} - y_{k}|$</li></ul><h4 id="Mahalanobis距离-聚类分析中常用"><a href="#Mahalanobis距离-聚类分析中常用" class="headerlink" title="Mahalanobis距离(聚类分析中常用)"></a>Mahalanobis距离(聚类分析中常用)</h4><script type="math/tex; mode=display">d(x,y) = \sqrt{(x - y)^{T} \sum\nolimits^{-1} (x - y)}</script><p>其中x, y为来自 p 维总体Z的样本观测值，Σ为Z 的协方差矩阵，实际中Σ往往是不知道的，常常需要用样本协方差来估计。马氏距离对一切线性变换是不变的，故不受量纲的影响。 </p><h4 id="R语句："><a href="#R语句：" class="headerlink" title="R语句："></a>R语句：</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">dist(x,method&#x3D;“euclidean”, diag&#x3D;FALSE, upper&#x3D;FALSE, p&#x3D;2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>method: 计算距离的方法</p><ul><li><p>“euclidean”: 欧式距离</p></li><li><p>“maximum”: Chebyshev距离</p></li><li><p>“manhattan”: 绝对值距离</p></li><li><p>“minkowski”: Minkowski距离，p是Minkowski距离的阶数</p></li></ul></li><li><p>diag=TRUE: 输出对角线上的距离</p></li><li>upper=TRUE: 输出上三角矩阵的值（默认值仅输出下 三角矩阵的值）</li></ul><h4 id="python语句："><a href="#python语句：" class="headerlink" title="python语句："></a>python语句：</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">import rpy2.robjects as robjectsx &#x3D; [1, 2, 6, 8, 11]r &#x3D; robjects.rres &#x3D; r.dist(x)print(res)#    1  2  3  4# 2  1# 3  5  4# 4  7  6  2# 5 10  9  5  3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">import rpy2import rpy2.robjects.numpy2riR &#x3D; rpy2.robjects.rr_code &#x3D; &quot;&quot;&quot;x&lt;-c(1,2,6,8,11)y&lt;-dist(x)print(y)&quot;&quot;&quot;R(r_code)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注：我用rpy2来实现这个感觉比较费劲。可能不太能从python 调用R语言，建议直接用R语言吧</li></ul><h3 id="标准化处理"><a href="#标准化处理" class="headerlink" title="标准化处理"></a>标准化处理</h3><p>当指标的测量值相差悬殊时，应先对数据进行标准化处理，再利用标准化的数据计算距离。</p><h4 id="普通标准化变换"><a href="#普通标准化变换" class="headerlink" title="普通标准化变换"></a>普通标准化变换</h4><script type="math/tex; mode=display">X_{ij}^{*} = \frac{X_{ij} - \overline{X}_{j}}{S_{j}}</script><p>i=1,2,…n表示第i个样本，j=1,2,…p表示样本的第j个指标，每个样本均有p个观测指标.       是第j个指标的样本均值</p><h4 id="极差标准化变换"><a href="#极差标准化变换" class="headerlink" title="极差标准化变换"></a>极差标准化变换</h4><script type="math/tex; mode=display">X_{ij}^{*} = \frac{X_{ij} - \overline{X}_{j}}{R_{j}} \\其中，R_{j} = \mathop{\max}\limits_{1\le k \le n}X_{kj} - \mathop{\max}\limits_{1 \le k \le n}X_{kj}</script><h4 id="极差正规化变换"><a href="#极差正规化变换" class="headerlink" title="极差正规化变换"></a>极差正规化变换</h4><script type="math/tex; mode=display">X_{ij}^{*} = \frac{X_{ij} - \mathop{\min}\limits_{1\le k\le n} X_{kj}}{R_{j}}</script><h4 id="程序语句"><a href="#程序语句" class="headerlink" title="程序语句"></a>程序语句</h4><h5 id="数据的中心化和标准化处理"><a href="#数据的中心化和标准化处理" class="headerlink" title="数据的中心化和标准化处理"></a>数据的中心化和标准化处理</h5><h6 id="R语句"><a href="#R语句" class="headerlink" title="R语句"></a>R语句</h6><pre class="line-numbers language-R" data-language="R"><code class="language-R">scale(X,center &#x3D; True, scale &#x3D; True)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>X:样本数据矩阵，center = TURE表示对数据做中心化变换，scale=TRUE表示对数据做标准化变化</p><h6 id="python语句"><a href="#python语句" class="headerlink" title="python语句"></a>python语句</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python">import rpy2import numpyimport rpy2.robjects.numpy2rirpy2.robjects.numpy2ri.activate()R &#x3D; rpy2.robjects.rx &#x3D; numpy.array([[1.0, 2.0], [3.0, 1.0]])res &#x3D; R.scale(x, center&#x3D;True, scale&#x3D;True)print(res)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="数据做极差标准化处理"><a href="#数据做极差标准化处理" class="headerlink" title="数据做极差标准化处理"></a>数据做极差标准化处理</h5><pre class="line-numbers language-R" data-language="R"><code class="language-R">x &lt;- data.frame(    points &#x3D; c(99, 97, 104, 79, 84, 88, 91, 99),    rebounds &#x3D; c(34, 40, 41, 38, 29, 30, 22, 25),    blocks &#x3D; c(12, 8, 8, 7, 8, 11, 6, 7))# apply（）函数必须应用于dataframe或matrixcenter &lt;- sweep(x, 2, apply(x, 2, mean))R &lt;- apply(x, 2, max) - apply(x, 2, min)x_star &lt;- sweep(center, 2, R, &quot;&#x2F;&quot;)# 若x_star&lt;-sweep(center, 2, sd(x), &quot;&#x2F;&quot;), 则得到（普通）标准化变换后的数据；print(x_star)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220117160257.png" alt="image-20220117160237414"></p><p>sweep(x, MARGIN, STATS, FUN=”-“, …)</p><ul><li><p>x:数组或矩阵；MARGIN:运算区域，对矩阵1表示行，2表示列；</p></li><li><p>STATS是统计量，apply(x, 2, mean)表示各列的均值；</p></li><li><p>FUN表示函数的运算，缺省值为减法运算。</p></li></ul><h3 id="相似系数"><a href="#相似系数" class="headerlink" title="相似系数"></a>相似系数</h3><p>计算样本不同指标间的相关系数，适用于对变量进行聚类。</p><h3 id="系统聚类法"><a href="#系统聚类法" class="headerlink" title="系统聚类法"></a>系统聚类法</h3><h4 id="聚类分析方法中最常用"><a href="#聚类分析方法中最常用" class="headerlink" title="聚类分析方法中最常用"></a>聚类分析方法中最常用</h4><h4 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h4><ul><li>（1）视各样本（或变量）自成一类，规定类与类之间的距离（或相似系数）；</li><li>（2）把最相似的样本（或变量）聚为小类，再将已聚合的小类按相似性再聚合；</li><li>（3）最后将一切子类都聚合到一个大类，从而得到一个按相似性大小聚集起来的谱系关系</li></ul><h4 id="3-根据距离定义的不同分为"><a href="#3-根据距离定义的不同分为" class="headerlink" title="3.根据距离定义的不同分为"></a>3.根据距离定义的不同分为</h4><ul><li>（1）最短距离法：类与类之间的距离定义为两类中最近样本间的距离；</li><li>（2）最长距离法：类与类之间的距离定义为两类中最远样本间的距离；</li><li>（3）类平均法：类与类之间的距离定义为两类中两两样本间距离的平均数；</li></ul><h4 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R"> x&lt;-c(1,2,6,8,11); dim(x)&lt;-c(5,1); d&lt;-dist(x) #生成距离结构hc1&lt;-hclust(d, &quot;single&quot;); hc2&lt;-hclust(d, &quot;complete&quot;)hc3&lt;-hclust(d, &quot;median&quot;); hc4&lt;-hclust(d, &quot;mcquitty&quot;) #生成系统聚类opar &lt;- par(mfrow &#x3D; c(2, 2))plot(hc1,hang&#x3D;-1); plot(hc2,hang&#x3D;-1)plot(hc3,hang&#x3D;-1); plot(hc4,hang&#x3D;-1)par(opar)#  画出所有树形结构图，以2*2的形式画在一张图上<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hclust():进行系统聚类的计算<br>plot():画出系统聚类的树形图<br>hclust(d, method = “complete”)<br>d:dist构成的距离结构，<br>method:系统聚类的方法（默认为最长距离法），其参数有：<br>（1）“single”：最短距离法<br>（2）“complete”：最长距离法<br>（3）“average”：类平均法<br>……<br>plot(x, labels = NULL, hang = 0.1, main = “Cluster<br>Dendrogram”, sb = NULL, xlab = NULL, ylab =”Height”, …)</p><p>x: hclust()函数生成的对象<br>hang: 表明树形图中各类的位置，取负值表示树形图中的类从底部画起<br>main: 绘图名称</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20220117165301.png" alt="image-20220117165300798"></p><h3 id="动态聚类法"><a href="#动态聚类法" class="headerlink" title="动态聚类法"></a>动态聚类法</h3><p>系统聚类：一次形成类后就不再改变；<br>动态聚类：逐步聚类</p><h4 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h4><p>首先粗略分类，然后按某种最优原则修改不合理的分类，直至分得比较合理为止，形成最终分类结果。</p><h4 id="程序-1"><a href="#程序-1" class="headerlink" title="程序"></a>程序</h4><p>kmeans(x, centers, <em>iter.max</em>=10, <em>nstart</em>=1, algorithm*=c(“Hartigan-Wong”, “Lloyd”, “MacQueen”))</p><ul><li>x是由数据构成的矩阵或数据框，</li><li>centers是聚类的个数或者初始类的中心，</li><li>iter.max为最大迭代次数（最大值为10），</li><li>nstart是随机集合的个数，</li><li>algorithm是动态聚类的算法。</li></ul><pre class="line-numbers language-R" data-language="R"><code class="language-R">X&lt;-data.frame(   x1&#x3D;c(2959.19, 2459.77, 1495.63, 1046.33, 1303.97, 1730.84, 1561.86, 1410.11, 3712.31, 2207.58, 2629.16, 1844.78, 2709.46, 1563.78, 1675.75, 1427.65, 1783.43, 1942.23, 3055.17, 2033.87, 2057.86, 2303.29, 1974.28, 1673.82, 2194.25, 2646.61, 1472.95, 1525.57, 1654.69, 1375.46, 1608.82),    x2&#x3D;c(730.79, 495.47, 515.90, 477.77, 524.29, 553.90, 492.42, 510.71, 550.74, 449.37, 557.32, 430.29, 428.11, 303.65, 613.32, 431.79, 511.88, 512.27, 353.23, 300.82, 186.44, 589.99, 507.76, 437.75, 537.01, 839.70, 390.89, 472.98, 437.77, 480.99, 536.05),   x3&#x3D;c(749.41, 697.33, 362.37, 290.15, 254.83, 246.91, 200.49, 211.88, 893.37, 572.40, 689.73, 271.28, 334.12, 233.81, 550.71, 288.55, 282.84, 401.39, 564.56, 338.65, 202.72, 516.21, 344.79, 461.61, 369.07, 204.44, 447.95, 328.90, 258.78, 273.84, 432.46),    x4&#x3D;c(513.34, 302.87, 285.32, 208.57, 192.17, 279.81, 218.36, 277.11, 346.93, 211.92, 435.69, 126.33, 160.77, 107.90, 219.79, 208.14, 201.01, 206.06, 356.27, 157.78, 171.79, 236.55, 203.21, 153.32, 249.54, 209.11, 259.51, 219.86, 303.00, 317.32, 235.82),   x5&#x3D;c(467.87, 284.19, 272.95, 201.50, 249.81, 239.18, 220.69, 224.65, 527.00, 302.09, 514.66, 250.56, 405.14, 209.70,272.59, 217.00, 237.60, 321.29, 811.88, 329.06, 329.65, 403.92, 240.24, 254.66, 290.84, 379.30, 230.61, 206.65, 244.93, 251.08, 250.28),   x6&#x3D;c(1141.82, 735.97, 540.58, 414.72, 463.09, 445.20, 459.62, 376.82, 1034.98, 585.23, 795.87, 513.18, 461.67, 393.99, 599.43, 337.76, 617.74, 697.22, 873.06, 621.74, 477.17, 730.05, 575.10, 445.59, 561.91, 371.04, 490.90, 449.69, 479.53, 424.75, 541.30),   x7&#x3D;c(478.42, 570.84, 364.91, 281.84, 287.87, 330.24, 360.48, 317.61, 720.33, 429.77, 575.76, 314.00, 535.13, 509.39, 371.62, 421.31, 523.52, 492.60, 1082.82, 587.02, 312.93,438.41, 430.36, 346.11, 407.70, 269.59, 469.10, 249.66, 288.56, 228.73, 344.85),   x8&#x3D;c(457.64, 305.08, 188.63, 212.10, 192.96, 163.86, 147.76, 152.85, 462.03, 252.54, 323.36, 151.39, 232.29, 160.12, 211.84, 165.32, 182.52, 226.45, 420.81, 218.27, 279.19, 225.80, 223.46, 191.48, 330.95, 389.33, 191.34, 228.19, 236.51, 195.93, 214.40),   row.names &#x3D; c(&quot;北京&quot;, &quot;天津&quot;, &quot;河北&quot;, &quot;山西&quot;, &quot;内蒙古&quot;, &quot;辽宁&quot;, &quot;吉林&quot;, &quot;黑龙江&quot;, &quot;上海&quot;, &quot;江苏&quot;, &quot;浙江&quot;, &quot;安徽&quot;, &quot;福建&quot;, &quot;江西&quot;, &quot;山东&quot;,  &quot;河南&quot;, &quot;湖北&quot;, &quot;湖南&quot;, &quot;广东&quot;, &quot;广西&quot;, &quot;海南&quot;, &quot;重庆&quot;, &quot;四川&quot;, &quot;贵州&quot;, &quot;云南&quot;, &quot;西藏&quot;, &quot;陕西&quot;, &quot;甘肃&quot;, &quot;青海&quot;, &quot;宁夏&quot;, &quot;新疆&quot;))kmeans(scale(X),5)K-means clustering with 5 clusters of sizes 10, 7, 3, 7, 4Clustering vector:  北京   天津   河北   山西 内蒙古   辽宁   吉林 黑龙江   上海   江苏      5      4      3      3      3      3      3      3      5      4   浙江   安徽   福建   江西   山东   河南   湖北   湖南   广东   广西      5      1      2      1      4      1      1      4      5      2   海南   重庆   四川   贵州   云南   西藏   陕西   甘肃   青海   宁夏      2      4      1      1      4      4      1      3      3      3   新疆     3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="主成分分析法"><a href="#主成分分析法" class="headerlink" title="主成分分析法"></a>主成分分析法</h2><h3 id="基本思想-1"><a href="#基本思想-1" class="headerlink" title="基本思想"></a>基本思想</h3><p>实际问题中的变量的重要性有所不同，且众多变量间有一定的相关关系。通过这种相关性对这些变量加以改造，用为数较少的新变量反映原变量提供的大部分信息，简化原问题。即数据降维</p><p>主成分分析法就是在这种降维思想下产生的处理高维数据的统计方法。</p><h3 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h3><p>通过适当构造原变量的线性组合，产生一列互不相关的新变量，从中选出少数几个新变量并使它们含有尽可能多的原变量带有的信息，从而使用少数几个新变量代替原变量，以分析原问题。</p><p>变量中所含“信息”的大小通常用该变量的方差或样本方差来度量。</p><p>如常数a,Var(a) = 0 ,我们通过a，只能知道a这个常数，其所含信息少。</p><h3 id="主成分的定义"><a href="#主成分的定义" class="headerlink" title="主成分的定义"></a>主成分的定义</h3><p>设$X = (X_{1}, X_{2},……,X_{p})^{T}$为实际问题涉及的p个随机变量构成的向量，记X的均值为$\mu$，协方差阵为$\sum$.</p><p>考虑线性组合</p><script type="math/tex; mode=display">\left\{\begin{aligned}Y_{1} &  = & a_{1}^{T}X \\. \\. \\Y_{p} &  = & a_{p}^{T}X \\\end{aligned}\right.</script><p>………………………………………………………………………………………………………</p><p>warning： 直接写代码了</p><h3 id="程序-2"><a href="#程序-2" class="headerlink" title="程序"></a>程序</h3><h4 id="求矩阵的特征值和特征向量"><a href="#求矩阵的特征值和特征向量" class="headerlink" title="求矩阵的特征值和特征向量"></a>求矩阵的特征值和特征向量</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">a &lt;- c(1, -2, 0, -2, 5, 0, 0, 0, 2)# 由向量a构造一3列的矩阵， byrow&#x3D;T表示生成矩阵的数据按行放置；b &lt;- matrix(data &#x3D; a, ncol &#x3D; 3, byrow &#x3D; T)c &lt;- eigen(b) # 求b的特征值与特征向量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="线性模型"><a href="#线性模型" class="headerlink" title="线性模型"></a>线性模型</h1><p>1.变量之间的关系一般分为两类</p><ul><li>完全确定的关系，即可表达为函数解析式</li><li>非确定的关系，也称相关关系</li></ul><p>2.回归分析研究的主要内容</p><ul><li><p>通过观察或实验数据的处理，找出变量间相关系数的定量数学表达式—经验公式，即进行参数估计，并确定经验回归方程的具体形式</p></li><li><p>检验所建立的经验回归方程是否合理</p></li><li><p>利用合理的回归方程对随机变量Y进行预测和控制。</p></li></ul>]]></content>
    
    
    <summary type="html">美赛培训课：多元统计分析，线性模型</summary>
    
    
    
    
    <category term="数学" scheme="https://changqingaas.github.io/tags/%E6%95%B0%E5%AD%A6/"/>
    
    <category term="美赛" scheme="https://changqingaas.github.io/tags/%E7%BE%8E%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>WSL踩坑</title>
    <link href="https://changqingaas.github.io/%E8%B8%A9%E5%9D%91/Pitfalls/wsl%E8%B8%A9%E5%9D%91/"/>
    <id>https://changqingaas.github.io/%E8%B8%A9%E5%9D%91/Pitfalls/wsl%E8%B8%A9%E5%9D%91/</id>
    <published>2021-10-03T15:30:16.000Z</published>
    <updated>2022-01-17T01:14:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WSL踩坑"><a href="#WSL踩坑" class="headerlink" title="WSL踩坑"></a>WSL踩坑</h1><p>大二上学期期末，稀里糊涂装了wsl, 一直用到现在。<br>本来是打算，和OS相关，那就装到C盘把。<br>这么一大意，在大三上装东西的时候出了不少问题。（当时没仔细装，而且也不懂）<br>这次为了装temu的交叉编译环境，装了不少东西，直接把C盘干到2G了，这么下去肯定不行。（Ubuntu20。04的主要文件夹就有至少15G了）<br>于是，我就上网搜，发现别人早就整好了vhdx(一个叫虚拟硬盘的东西，我当时没有做，现在做也来不及了），<br>所以别人的限制硬盘占用的方法，转移到别的位置的办法，我都没办法用了。</p><p>打算卸载重装到D盘。用这个帖子解决问题了：<a href="https://blog.csdn.net/LaughingMei/article/details/109736965">https://blog.csdn.net/LaughingMei/article/details/109736965</a> </p><p>卸载完C盘有16G了。</p><p>比较脑瘫，当时看到的有两种方式，第一种要vhdx，第二种不用</p>]]></content>
    
    
    <summary type="html">稀里糊涂</summary>
    
    
    
    <category term="踩坑" scheme="https://changqingaas.github.io/categories/%E8%B8%A9%E5%9D%91/"/>
    
    
    <category term="踩坑" scheme="https://changqingaas.github.io/tags/%E8%B8%A9%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>GAMES101</title>
    <link href="https://changqingaas.github.io/CG/CG/GAMES101%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"/>
    <id>https://changqingaas.github.io/CG/CG/GAMES101%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/</id>
    <published>2021-09-13T11:50:19.000Z</published>
    <updated>2022-10-24T02:38:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Lecture1-intro"><a href="#Lecture1-intro" class="headerlink" title="Lecture1:  intro"></a>Lecture1:  intro</h2><h3 id="计算机图形学"><a href="#计算机图形学" class="headerlink" title="计算机图形学"></a>计算机图形学</h3><p>使用计算机synthesize(合成)  manipulate（操作) 可视化信息</p><h3 id="why-study-computer-graphics"><a href="#why-study-computer-graphics" class="headerlink" title="why study computer graphics?"></a>why study computer graphics?</h3><ul><li>Application<ul><li>video games 电子游戏</li><li>animations 动画</li><li>visualization 可视化</li><li>virtual reality</li><li>augmented reality 增强现实</li><li>digital illustration 数码插画</li><li>simulation 模拟</li><li>graphical user interfaces 图形用户界面</li><li>typography  排版</li></ul></li><li>technical chanllenges </li></ul><h3 id="Course-topics"><a href="#Course-topics" class="headerlink" title="Course topics"></a>Course topics</h3><ul><li><p>Rasterization  光栅化</p><ul><li><p>project geometry primitives (3D triangles / polygons) onto the screen</p><p>将几何图形（3D三角形 / 多边形）投射到屏幕上</p></li><li><p>break projected primitives into fragments (pixels)</p><p>将投影图元分解到片段(像素)</p></li><li><p>gold standard in video games (real-time applications)</p></li></ul></li><li><p>curves and meshes 曲线和栅格</p><ul><li>怎样represent geometry in CG</li></ul></li><li><p>ray tracing 光线追踪</p><ul><li>shoot rays from camera though each pixel<ul><li>calculate intersection and shading 交叉点和阴影</li><li>continue to bounce the rays till they hit light sources</li></ul></li><li>gold standard in animations / movies (offline离线 application)</li></ul></li><li><p>animation simulation</p><ul><li>key frame animation 关键帧动画</li><li>mass-spring system 弹簧振子系统</li></ul></li></ul><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h3 id="differences-between-cg-and-cv"><a href="#differences-between-cg-and-cv" class="headerlink" title="differences between cg and cv"></a>differences between cg and cv</h3><p>No clear boundaries</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231736.png" alt="image-20210913210044004"></p><h2 id="Lecture2-review-of-linear-algebra"><a href="#Lecture2-review-of-linear-algebra" class="headerlink" title="Lecture2:  review of linear algebra"></a>Lecture2:  review of linear algebra</h2><h3 id="Graphics’-dependcies"><a href="#Graphics’-dependcies" class="headerlink" title="Graphics’ dependcies"></a>Graphics’ dependcies</h3><ul><li>basic mathematics<ul><li>Linear algebra 线性代数<ul><li>mostly dependent on linear algebra</li><li>vectors（dot products点乘,cross products叉乘<ul><li>An operation like translating or rotating objects  can be matrix-vector multiplication</li></ul></li><li>matrices 矩阵（复数</li></ul></li><li>calculus 微积分</li><li>statistics 统计</li></ul></li><li>basic physics <ul><li>Optics, 光学的</li><li>Mechanics  机械的</li></ul></li><li>misc 杂项<ul><li>Numerical analysis  数值分析</li><li>signal processing 信号处理</li><li>aesthetics 审美</li></ul></li></ul><h3 id="vectors"><a href="#vectors" class="headerlink" title="vectors"></a>vectors</h3><p>noting: 只记了part</p><ul><li><p>unit vector </p><ul><li>单位向量，</li><li>用来代表方向</li></ul></li><li><p>dot  product in graphics</p><ul><li><p>$\vec{a}\cdot\vec{b} = |\vec{a}|\cdot|\vec{b}|cos\theta$ </p></li><li><p>Find angle between two vectors  (e.g. cosine of angle between light source 光源 and surface表面)</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231823.png" alt="image-20210913215253056"></p></li><li><p>Finding <strong>projection</strong> of one vector on another</p><ul><li><p>measure how close two directions are</p></li><li><p>decompose分解 a vector </p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231937.png" alt="image-20210913215715680" style="zoom:50%;" /></p></li><li><p>determine forward or backward</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231938.png" alt="image-20210913215758162" style="zoom: 50%;" /></p></li></ul></li></ul></li><li><p>cross product in graphics</p><p>​    <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231939.png" alt="image-20210913220439863" style="zoom: 50%;" /></p><ul><li>Direction determined by right-hand rule</li></ul></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231940.png" alt="image-20210913220739158"></p><ul><li>Useful in constructing coordinate systems (later)</li><li>Determine left / right</li><li>Determine inside / outside</li></ul></li><li>Orthonormal bases and coordinate frames  正交基底和坐标系<ul><li>Critical issue is transforming between these systems/ bases</li></ul></li></ul><h3 id="matrices"><a href="#matrices" class="headerlink" title="matrices"></a>matrices</h3><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231941.png" alt="image-20210913223344462" style="zoom:50%;" /></p><ul><li>$(AB)^{T} = B^{T}A^{T}$</li><li>$AA^{-1} = A^{-1}A = I$</li><li>$(AB)^{-1} = B^{-1}A^{-1}$</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210913231942.png" alt="image-20210913223854494" style="zoom: 50%;" /></p><p>In Graphics, pervasively used to represent transformations</p><ul><li>translation, rotation,shear剪切,scale缩放</li></ul><h2 id="Lecture-3-Transformation"><a href="#Lecture-3-Transformation" class="headerlink" title="Lecture 3: Transformation"></a>Lecture 3: Transformation</h2><h3 id="why-study-transformation"><a href="#why-study-transformation" class="headerlink" title="why study transformation"></a>why study transformation</h3><ul><li>modeling<ul><li>translation</li><li>rotation</li><li>scaling</li></ul></li><li>viewing<ul><li>3D (projection)</li><li>2D (projection)</li></ul></li></ul><h3 id="2D-transformations"><a href="#2D-transformations" class="headerlink" title="2D transformations:"></a>2D transformations:</h3><ul><li><p>representing transformations using matrices</p></li><li><p>rotation</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914135044.png" alt="image-20210914135044036" style="zoom:50%;" /></p><ul><li>$R_{\theta} = \begin{bmatrix} cos\theta &amp; -sin\theta \\ sin\theta &amp; cos\theta \end{bmatrix} $</li><li>$R_{-\theta} = \begin{bmatrix} cos\theta &amp; sin\theta \\ -sin\theta &amp; cos\theta \end{bmatrix} = R_{\theta}^{T} = R_{\theta}^{-1}(by \quad definition) $</li><li>正交矩阵： A·A^T^ = E</li><li>默认绕原点旋转</li><li>默认逆时针旋转</li></ul></li><li><p>scale matrix</p><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \end{bmatrix} = \begin{bmatrix} s_{x} &amp; 0 \\ 0 &amp; s_{y} \end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix}$</p></li><li><p>reflection matrix 反射（镜像）矩阵</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914124142.png" alt="image-20210914124142211" style="zoom: 50%;" /></p><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \end{bmatrix} = \begin{bmatrix} -1 &amp; 0 \\ 0 &amp; 1\end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix}$</p></li><li><p>shear matrix</p><p>​    <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914134639.png" alt="image-20210914134632720" style="zoom: 50%;" /></p><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \end{bmatrix} = \begin{bmatrix} -1 &amp; a \\ 0 &amp; 1\end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix}$</p><ul><li>Hints:<ul><li>horizontal shift is 0 at y = 0</li><li>horizontal shift is a at y = 1</li><li>vertical shift is always</li></ul></li></ul></li><li><p>Linear transforms </p><ul><li>线性变换：可以用一个矩阵表示的变换</li><li>x’ = ax + by</li><li>y’ = cx + dy</li><li>$\begin{bmatrix} x^{‘} \\ y^{‘} \end{bmatrix} = \begin{bmatrix} a &amp; b \\ c &amp; d \end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix}$</li></ul></li></ul><h3 id="Homogeneous-coordinates-齐次坐标"><a href="#Homogeneous-coordinates-齐次坐标" class="headerlink" title="Homogeneous coordinates 齐次坐标"></a>Homogeneous coordinates 齐次坐标</h3><ul><li><p>Why homogeneous coordinates  </p><p>for example:  translation</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914135553.png" alt="image-20210914135548707" style="zoom:50%;" /></p><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \end{bmatrix} = \begin{bmatrix} a &amp; b \\ c &amp; d \end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix} + \begin{bmatrix} t_{x} \\ t_{y} \end{bmatrix} $</p><ul><li><p>so, translation is not linear transform!</p></li><li><p>因为平移变换不能直接用一个矩阵表示，必须加一个向量；  </p></li><li><p>add a third coordinates</p><p>引入齐次坐标可以解决问题，让平移也能只用一个矩阵表示</p></li><li><p>2D point = (x,y,1)^T^</p></li><li><p>2D vector = (x,y,0)^T^</p></li><li><p>向量 + 向量，结果齐次项是0，还是向量</p></li><li><p>点 - 点，得到的是一个向量，齐次项也变成0 </p></li><li><p>点 + 向量，表示一个点的移动，结果 还是点 ！</p></li><li><p>点 + 点是什么呢？齐次项变成2。将所有项除以2，齐次项又变为1 。所以点 + 点结果实际上是两个点的中点。</p></li></ul></li><li><p>Affine  transformation 仿射变换</p><ul><li><p>仿射变换：先线性变换再加上一次平移</p></li><li><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \\ 1 \end{bmatrix} = \begin{bmatrix} a &amp; b &amp; t_{x}\\ c &amp; d  &amp; t_{y}  \\ 0 &amp; 0 &amp; 1 \end{bmatrix} \begin{bmatrix} x \\  y \\ 1 \end{bmatrix} $</p></li><li><p>scale </p><p>$ S(s_{x}, s_{y}) = \begin{bmatrix} s_{x} &amp; 0 &amp; 0 \\ 0 &amp; s_{y}  &amp; 0  \\ 0 &amp; 0 &amp; 1 \end{bmatrix}$</p></li><li><p>rotation </p><p>$ R(\alpha) = \begin{bmatrix} cos\alpha &amp; -sin\alpha &amp; 0 \\ sin\alpha &amp; cos\alpha  &amp; 0  \\ 0 &amp; 0 &amp; 1 \end{bmatrix}$</p></li><li><p>translation</p><p>$ T(t_{x}, t_{y}) = \begin{bmatrix} 1 &amp; 0 &amp; t_{x} \\ 0 &amp; 1  &amp; t_{y} \\ 0 &amp; 0 &amp; 1 \end{bmatrix}$</p></li></ul></li><li><p>transform ordering matters</p><ul><li>matrix multiplication is not commutative 可交换的</li></ul></li></ul><h3 id="composing-transforms"><a href="#composing-transforms" class="headerlink" title="composing transforms"></a>composing transforms</h3><ul><li><p>decomposing complex transforms</p><ul><li>translate center to origin</li><li>rotate</li><li>translate back</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914142248.png" alt="image-20210914142248083"></p><p>which means $T(c) · R(\alpha) · T(-c)$</p><ul><li><p>分解：变换可以分解，注意先后顺序是从右到左</p></li><li><p>2D变换矩阵（缩放，旋转，平移变换）</p></li></ul></li><li></li></ul><h2 id="Lecture-4：-Transformation-Cont"><a href="#Lecture-4：-Transformation-Cont" class="headerlink" title="Lecture 4： Transformation Cont"></a>Lecture 4： Transformation Cont</h2><h3 id="3D-transformations"><a href="#3D-transformations" class="headerlink" title="3D transformations"></a>3D transformations</h3><ul><li><p>3D point = (x,y,z,1)^T^</p></li><li><p>3D vector = (x,y,z,0)^T^</p></li><li><p>$\begin{bmatrix} x^{‘} \\ y^{‘} \\ z_{‘} \\ 1 \end{bmatrix} = \begin{bmatrix} a &amp; b &amp; c &amp; t_{x}\\ d &amp; e &amp; f &amp; t_{y}\\g &amp; h &amp; i &amp; t_{z}  \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} \begin{bmatrix} x \\ y \\z \\ 1 \end{bmatrix} $</p></li><li><p>三维空间中的齐次变换，最后一行和二维变换类似，是0 0 0 1，平移还是在矩阵最后一列</p></li><li><p>对于仿射变换，是先应用线性变换，再加上平移</p></li><li><p>what is order?</p><ul><li><p>linear transform first or translation first?</p></li><li><p>scale </p><p> $S(s_{x}, s_{y},s_{z}) = \begin{bmatrix} s_{x} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp;  s_{y} &amp; 0 &amp; 0\\0 &amp; 0 &amp;  s_{z} &amp; 0  \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}  $</p></li><li><p>translation</p><p> $T(t_{x}, t_{y}, t_{z}) = \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; t_{x}\\ 0 &amp;  1 &amp; 0 &amp; t_{y} \\0 &amp; 0 &amp;  1 &amp; t_{z}  \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}  $</p></li><li><p>rolation</p><ul><li>rolation around x-, y-,or  z-axis</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914203113.png" alt="image-20210914203043532" style="zoom:50%;" /></p><ul><li>绕哪个轴旋转，哪个坐标就不变</li><li><p>不过𝑅𝑦矩阵稍微不同，其他两个都是右上角𝑠𝑖𝑛是负的，只有他是左下角𝑠𝑖𝑛是负的 因为𝑥叉乘𝑦得到𝑧，𝑧叉乘𝑦得到𝑥，但是𝑧叉乘𝑥得到𝑦（而不是𝑥叉乘𝑧），所以是反的</p></li><li><p>$R_{xyz}(\alpha, \beta, \gamma) = R_{x}(\alpha)R_{y}(\beta)R_{z}(\gamma)$</p></li></ul></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914220209.png" alt="image-20210914220208915"></p></li></ul></li></ul><h3 id="Viewing-观测-transformation"><a href="#Viewing-观测-transformation" class="headerlink" title="Viewing (观测) transformation"></a>Viewing (观测) transformation</h3><ul><li><p>View (视图) / Camera transformation  </p><ul><li>Think about how to take a photo <ul><li>Find a good place and arrange people (model transformation) </li><li>Find a good “angle” to put the camera (view transformation)</li><li>Cheese! (projection transformation)<ul><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914224154.png" alt="image-20210914224154439"></li><li>定义相机</li><li>位置</li><li>往哪看</li><li>向上方向</li><li>现实中是移动相机，变换景物</li><li>图形学中，相机不动，永远在原点</li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914223830.png" alt="image-20210914223829896" style="zoom:50%;" /></li><li>经过变换，把相机的位置移动到原点，同时保持看到的景物不变</li></ul></li></ul></li></ul></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914225726.png" alt="image-20210914225726865"></p></li><li><p>这个从“歪”的坐标轴旋转回正的坐标轴，不太好写。 但是这个变换的逆过程，即：从正的坐标轴旋转到“歪”的坐标轴，是好写的， 于是我们先写从“正”坐标轴变换到“歪”坐标轴的变换矩阵，再求其逆矩阵，就可以得到待求的变换矩阵。 又因为旋转矩阵是正交矩阵，所以他的逆矩阵就只需要转置一下就可以得到了！ 注意，不但相机要做这个变换，其他物体也要做这个变换，因为我们想让相机看到的景物相对不变。 （以上部分个人认为非常巧妙和关键！）</p></li><li><p>Projection (投影) transformation</p><ul><li><p>3D to 2D</p></li><li><p>Orthographic (正交) projection  </p><p> <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914230822.png" alt="image-20210914230821994"></p><ul><li><em>没有近大远小</em></li><li>平行投影<ul><li>首先定义空间中一个立方体，将其translate，使其中心在原点，再scale成标准立方体（边长为2</li></ul></li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915120758.png" alt="image-20210915120758604"></li><li>再次提醒，注意𝑧轴是近大远小 OpenGL等API是反过来的</li></ul></li><li><p>Perspective (透视) projection</p><p> <img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210914230840.png" alt="image-20210914230840011"></p><ul><li><p>更像人眼看到的场景</p></li><li><p>Most common in Computer Graphics, art, visual system </p></li><li><p>Further objects are smaller </p></li><li><p>Parallel lines not parallel; converge to single point</p></li><li>Recall: property of homogeneous coordinates<ul><li>(x, y, z, 1), (kx, ky, kz, k != 0), (xz, yz, z2, z != 0) all represent  the same point (x, y, z) in 3D </li><li>e.g. (1, 0, 0, 1) and (2, 0, 0, 2) both represent (1, 0, 0)</li></ul></li><li>how to do perspective projection<ul><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915122816.png" alt="image-20210915122816233"></li><li>先将frustum远平面，挤压成和近平面一样大（从左图变成右图）</li><li>再做正交投影，投影到近平面</li><li>上述操作过程中几点假设：<ul><li>1）近平面保持不变 </li><li>2）z值保持不变，只是向内收缩</li></ul></li></ul></li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915122907.png" alt="image-20210915122907760"></li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915122956.png" alt="image-20210915122956833"></li><li>挤压这一步怎么做？ 上图是从侧面观察frustum 用相似三角形知识可以得到新坐标的表达式，但是第三个分量目前还不知道（这里利用之前讲的那个性质： 齐次坐标，如果我们对点的坐标所有分量同时乘以k，他表示的还是原来那个点！  </li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123123.png" alt="image-20210915123123207"></li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123140.png" alt="image-20210915123140120"></li><li>如何求解第三行<ul><li>任何近平面上的点不会改变（也就是对于任意的(𝑥, 𝑦, 𝑛, 1)，经过这个矩阵变换后，点的位置仍然不变）</li><li>任何远平面上的点，𝑧值不会改变</li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123415.png" alt="image-20210915123415483"></li><li>点(𝑥, 𝑦, 𝑧, 1)是可以通过矩阵变换得到(𝑛𝑥, 𝑛𝑦, 𝑢𝑛𝑘𝑛𝑤𝑜𝑛, 𝑧)向量的。 根据上文提到的性质（1），经过这个变换，点实际没有改变 而同时，(𝑥, 𝑦, 𝑧, 1)本身可以写成(𝑥, 𝑦, 𝑛, 1)（为什么把𝑧替换成𝑛？因为近平面的𝑧坐标就是都是𝑛，所以可以做这个替换。）然后同时乘以𝑛， 变成(𝑛𝑥, 𝑛𝑦, 𝑛 ଶ , 𝑛) 经过上面两个推导，可以看出，第三行前两个数一定是0 因为𝑛 ଶ这个分量和𝑥和𝑦都毫无关系，因此前两个数必定是0 这样，我们就解出了第三行前两个数，都是0 接下来求A和B</li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123500.png" alt="image-20210915123459854"></li><li>远平面上有一个特殊点，(0, 0, 𝑓)经过变换挤压仍然不变 所以(0, 0, 𝑓)经过变换仍然是(0, 0, 𝑓) 根据近平面我们得到$An + B = n^{2}$,根据远平面的中心点我们得到$Af + B = f^{2}</li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123625.png" alt="image-20210915123625508"></li><li>这样我们就能解出A和B了， 这样终于把从透视投影挤压成正交投影的矩阵，解出来了</li><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123651.png" alt="image-20210915123651566"></li></ul></li></ul></li><li><p>思考题</p><ul><li><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/image/20210915123710.png" alt="image-20210915123709902"></li></ul></li></ul></li></ul><h2 id="Lecture05-Rasterization-1-Triangles"><a href="#Lecture05-Rasterization-1-Triangles" class="headerlink" title="Lecture05: Rasterization 1(Triangles)"></a>Lecture05: Rasterization 1(Triangles)</h2><h3 id="Finishing-up-Viewing"><a href="#Finishing-up-Viewing" class="headerlink" title="Finishing up Viewing"></a>Finishing up Viewing</h3><ul><li>Viewport(视口) transformation</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005190732.png" alt="image-20211005190731847" style="zoom: 50%;" /></p><p>上节课把透视投影转化成正交投影 这里引入另外一个概念 Field of View，表示你能看到的角度的范围 注意看上图中红色线的夹角，就是垂直可视角度，他越大，可视角度越大 同理还有水平可视角度</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005190927.png" alt="image-20211005190926969"></p><p>MVP这三个变换之后，所有东西都会停留在一个1，1，1的位于原点的标准立方体中 下一步就要把这立方体画在屏幕上</p><h3 id="Rasterization（光栅化，即把东西花在屏幕上"><a href="#Rasterization（光栅化，即把东西花在屏幕上" class="headerlink" title="Rasterization（光栅化，即把东西花在屏幕上"></a>Rasterization（光栅化，即把东西花在屏幕上</h3><h4 id="屏幕"><a href="#屏幕" class="headerlink" title="屏幕"></a>屏幕</h4><ul><li><p>像素是最小的屏幕单位</p></li><li><p>每个像素有不同的颜色</p></li><li><p>屏幕空间：就是给屏幕定义一个坐标系 比如，可以定义左下角是原点。 </p></li><li><p>实际上像素的中心是(𝑥 + 0.5, 𝑦 + 0.5)</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005191523.png" alt="image-20211005191523440"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005191557.png" alt="image-20211005191556944"></p><p>我们要做的就是把标准立方体空间映射到屏幕这个二维世界中去 𝑧暂时不管 其他两个坐标是[−1, 1] ଶ转换到 [0, 𝑤𝑖𝑑𝑡ℎ] ∗ [0, ℎ𝑒𝑖𝑔ℎ𝑡] 使用上面这个矩阵做变换</p></li></ul><h4 id="Rasterizing-a-triangle"><a href="#Rasterizing-a-triangle" class="headerlink" title="Rasterizing  a triangle"></a>Rasterizing  a triangle</h4><ul><li><p>三角形可以拼接在三维空间中的面，或者二维空间中复杂的图形 </p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005191718.png" alt="image-20211005191718242"></p></li><li><p>三角形内部一定是平面的 </p></li><li>给三角形顶点定义不同属性，可以在三角形内部进行插值</li><li>通过采样的方式，来画出三角形<ul><li>采样就是把函数离散化的过程</li><li>可以对时间，面积，方向，体积… 进行采样</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005191941.png" alt="image-20211005191941468"></p><p>定义二值函数：</p><script type="math/tex; mode=display">inside(tri, x,y) = \left\{\begin{array}{rcl}1  &      & {Point(x,y) \ in  \ triangle \ t}\\0  &      & {otherwise}\\\end{array}\right.</script><ul><li><p>这里我们要做的就是给定一个三角形，判断像素中心是否在三角形内部。</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005192820.png" alt="image-20211005192820679"></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005192920.png" alt="image-20211005192920137"></p><p>那么，如何判断一个点是否在三角形内？用叉乘！！ 比如对上图，判断Q是否在三角形内部 首先$𝑃1𝑃2 \  X \ 𝑃1𝑄 $，将会得到一个z为正数的向量，也就是结果向量朝向屏幕外的，利 用右手定则，可以得知𝑄在𝑃1𝑃2的左侧（因为如果在右侧，那么结果将会是向量𝑧为负 数，那么结果向量就朝向屏幕内部） 类似的𝑃2𝑃0 𝑋 𝑃2𝑄，得到𝑄在右侧，不对劲！ 𝑃0𝑃1 𝑋 𝑃0𝑄，得到𝑄在左侧</p><p>注意，向量按照一定的顺序去判断，比如我们上面是按照P1, P2, P0去判断的</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005193137.png" alt="image-20211005193137111"></p><p>检查屏幕所有的像素太花时间！ 可以只检查蓝色的包围盒（Bounding box）部分</p><p><img src="https://cdn.jsdelivr.net/gh/ChangQingAAS/for_picgo/img/20211005193213.png" alt="image-20211005193213667"></p><p>也可以每一行设置一个包围盒，进一步减小包围盒 很适用于那种三角形很小，但是包围盒很大的（窄长三角形</p>]]></content>
    
    
    <summary type="html">GAMES101:现代计算机图形学入门</summary>
    
    
    
    <category term="CG" scheme="https://changqingaas.github.io/categories/CG/"/>
    
    
    <category term="CG" scheme="https://changqingaas.github.io/tags/CG/"/>
    
  </entry>
  
  <entry>
    <title>墨子平台训练教程</title>
    <link href="https://changqingaas.github.io/MARL/MADRL/%E5%A2%A8%E5%AD%90%E5%B9%B3%E5%8F%B0%E8%AE%AD%E7%BB%83%E6%95%99%E7%A8%8B/"/>
    <id>https://changqingaas.github.io/MARL/MADRL/%E5%A2%A8%E5%AD%90%E5%B9%B3%E5%8F%B0%E8%AE%AD%E7%BB%83%E6%95%99%E7%A8%8B/</id>
    <published>2021-09-03T15:00:33.000Z</published>
    <updated>2021-09-04T11:34:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>下面介绍一下windows版本墨子平台的使用流程：</p><ol><li><h2 id="进入华戍防务-官网-hs-defense-com-下载软件"><a href="#进入华戍防务-官网-hs-defense-com-下载软件" class="headerlink" title="进入华戍防务 官网(hs-defense.com)下载软件"></a>进入<a href="http://www.hs-defense.com/col.jsp?id=105">华戍防务 官网(hs-defense.com)</a>下载软件</h2></li></ol><p>我下载的是<code>墨子·联合作战推演系统（个人版）</code> </p><p><code>墨子·AI开发包</code>主要是一些开发会用到的代码和文档。代码也可以在gitee.com上找到：<a href="https://gitee.com/hs-defense/moziai">moziai: 墨子AI开发包及“子牙”智能体开源代码  </a></p><p><code>竞赛客户端(互联网)</code> 主要是用来军事推演比赛的，与强化学习训练关系不大，可以不下载。</p><p><code>墨子·AI版（Linux)</code> 因为一开始没办法下载，后面断断续续也没有弄出什么效果</p><p>注：</p><ul><li><p>文件采用ftp协议下载，下载链接格式为：ftp: ip/port/文件夹s/文件</p></li><li><p>由于部分浏览器不支持，推荐使用QQ浏览器下载</p></li><li><p>一般点击下载按钮后，会默认让迅雷接管下载</p></li></ul><ol><li><h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><p>​    根据安装手册安装该软件，基本上按照手册进行就可以了</p></li><li><h2 id="启动该软件"><a href="#启动该软件" class="headerlink" title="启动该软件"></a>启动该软件</h2><ol><li>进入安装目录下的\MoziData，右键点击<code>mysql.bat</code>，以管理员身份运行它，随后退出</li><li>进入安装目录下的\MoziServer，运行MoziServer.exe，尽量关掉杀毒软件，最好以管理员身份运行<ul><li>这里大概会遇到一个问题：<code>临时许可码过期，请联系华戍防务重新授权</code>，具体解决方案略</li><li>我在数据库方面也出过问题，不过忘了具体细节了</li></ul></li></ol></li><li><h2 id="运行代码，进行仿真训练"><a href="#运行代码，进行仿真训练" class="headerlink" title="运行代码，进行仿真训练"></a>运行代码，进行仿真训练</h2><ol><li><p>获取代码，在IDE打开代码</p></li><li><p>加载代码所需的scen想定文件</p><ul><li>进入墨子平台，可以在想定一栏下找到<code>加载想定</code>的选项，想定文件是从<code>安装路径\MoziServer\bin\Scenarios\</code>获取的，因此需要把代码包里的scen文件放到这里。</li><li>加载想定文件，选择推演方</li><li>随后可以看到墨子平台上有了具体的想定环境</li><li>如果要更改想定文件，改完之后，需要保存，再重新加载<ul><li>因为训练的每个回合都会刷新环境，如果不保存更改到新scen文件，那么这个更改只能用于一个回合</li></ul></li></ul></li><li><p>运行main.py代码即可看到效果</p><ul><li><p>注：</p><ul><li><p>这里可能需要指定一下 墨子平台的路径，可以执行代码</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os.environ[&#39;MOZIPATH&#39;] &#x3D; &#39;D:\\MoZiSystem\\Mozi\\MoziServer\\bin&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也可以在<code>编辑系统环境变量</code>中添加路径</p></li></ul></li></ul></li></ol></li></ol><p>注：Linux版本的墨子平台还在折腾，因为虚拟机比较卡，服务器上又没办法弄出显示界面，还折腾了一堆配置，最近还没弄，如果有结果了，会在这里更新的</p>]]></content>
    
    
    <summary type="html">墨子推演平台强化学习训练教程，主要是写给队友用的</summary>
    
    
    
    <category term="MARL" scheme="https://changqingaas.github.io/categories/MARL/"/>
    
    
    <category term="MARL" scheme="https://changqingaas.github.io/tags/MARL/"/>
    
    <category term="机器学习" scheme="https://changqingaas.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>SurviveSJTUManual阅读笔记</title>
    <link href="https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Others/SurviveSJTUManual%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>https://changqingaas.github.io/%E4%B9%A6%E6%91%98/Others/SurviveSJTUManual%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</id>
    <published>2021-09-01T14:00:33.000Z</published>
    <updated>2022-02-05T01:54:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>这本书不是《逃课手册》或者《考前突击宝典》。我希望帮助各位读者做到的，绝不是简单的拿高分、或者顺利毕业。我衷心希望这本书能够带给读者一些新鲜的思考，让同学们能看到人生道路上不同的风景。至少在读过本书之后，各位读者应该能够有勇气、有智慧，去发现并挑战那些比上课更为重要的追求。</p><h2 id="立志篇"><a href="#立志篇" class="headerlink" title="立志篇"></a>立志篇</h2><h3 id="欢迎来到上海交通大学"><a href="#欢迎来到上海交通大学" class="headerlink" title="欢迎来到上海交通大学"></a>欢迎来到上海交通大学</h3><p>在本书的开始，不得不遗憾地告诉大家一个消息。国内绝大部分大学的本科教学，不是濒临崩溃，而是早已崩溃。我只是看到了无数充满求知欲、激情、与年轻梦想的同学们，将要把自己的四年青春，充满希望与信任地交给大学来塑造。这使我心中非常不安。</p><p>在当今流水线式的教育体制下，我们就像廉价的零件一样被生产出来。因为数量巨大，没人会对每一个人的教学质量负责。</p><p>领导不会为你负责。对于一个争做世界一流大学的研究型学校，管好科研，管好实验室才是当务之急。相比之下，本科生教学显得无利可图。教授也不会为你负责。拉到足够的经费发表足够的论文，满足学院要求才是生存大计。要说管学生，也肯定先要管好自己实验室的硕士博士，而非那一百多人大课堂里的某个本科生。就算是科研任务不太重的一些任课教师，他们也不会为你负责。</p><p>真正在课堂上口传心授的教学，其质量是不会有人过问的。教学评估会考察实验报告格式是否合格，出勤率是否够，但是绝对不会考察上百人的班上到底有几个听懂了的。</p><h3 id="你想要什么"><a href="#你想要什么" class="headerlink" title="你想要什么"></a>你想要什么</h3><h4 id="认清自己的技术栈"><a href="#认清自己的技术栈" class="headerlink" title="认清自己的技术栈"></a>认清自己的技术栈</h4><p>随着本科、硕士、博士的扩招下，中国开始享受着“工程师红利”，各行业从业人员受教育程度稳步提升，中国制造产业升级也是国家大计之一，但目前我国存在着新增中高端就业岗位数量跟不上大学、研究生毕业生数量增长的问题，与经济增速下滑相叠加，每年都会看到类似“大学生最难就业季”的新闻，交大的出身足以让你在找工作的时候拿到多份offer，但想要去理想的公司以及职位，你需要对自己的技术栈和目标职位的需求技术栈有足够清醒的认知，及时补足短板。你未来可能会用到的能力包括但不限于：</p><ol><li><p>本专业的专业知识，这是你安身立命的根本，对本领域有中长期的判断</p></li><li><p>表达能力，如何去说服你的上司还有顾客理解并接受你的idea和产品</p></li><li><p>相关信息检索、过滤、总结、可视化等的能力</p></li><li><p>交际能力，向别人展现自己的价值，在自己需要帮助的时候也能找到最合适的朋友寻求帮助</p></li><li><p>抗压能力，主要是对逆境的适应力、容忍力、耐力，能较好应对生活工作中的挫折</p></li><li><p>独立思考，在信息过载的当下尽量避免被错误消息带节奏</p></li><li><p>时间管理，以后的日子里你会被生活的柴米油盐和很多工作学习以外的杂事消耗精力，再也不是大学以前父母帮你操办大部分事情了，你需要高效管理利用剩余的时间</p></li></ol><h4 id="本科毕业之后你想做什么"><a href="#本科毕业之后你想做什么" class="headerlink" title="本科毕业之后你想做什么"></a>本科毕业之后你想做什么</h4><p>四年很长，四年也很短，大学里会有一部分同学享受着校园的舒适生活，不知不觉间被温水煮了青蛙（尤其是文社科专业的同学），校园相对稳定安逸的生活在已经成为“社畜”的人看来是非常奢侈的。日后在社会上安身立命的技能多还是在校园中培养，你也需要在恰当的时间点跳出这种舒适生活的幻象为以后工业界/学术界的工作打好基础，如若拖延症到本科晚期才发现四顾茫然不知如何在社会上立足，GPA高的同学或许还能靠保研直博暂缓进入社会的进度条（当然很多同学保研直博也是一开始就定下的目标，并未考虑过直接进入社会），学业不佳的同学或许要再像准备高考一样备战考研了，而近些年考研难度也是在肉眼可见地提升。进入社会之后人生的分支要比学校里多得多，在此也不一一举例，在象牙塔里被保护得久了容易跟现实社会脱节，这些东西要留给你自己去摸索。</p><h4 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h4><p>“懂得很多道理，却依旧过不好这一生”以后阅读这本小册子的人可能千千万，但大家毕业后的境遇会千差万别，这可能是由于同学们认知能力、运气与机遇、执行能力、家里提供的支持等等不同所导致的。</p><h3 id="失败的思维方式"><a href="#失败的思维方式" class="headerlink" title="失败的思维方式"></a>失败的思维方式</h3><h4 id="分数至上"><a href="#分数至上" class="headerlink" title="分数至上"></a>分数至上</h4><p>我们的体制总倾向于用一个量化的分数来概括衡量一个人。</p><p>如果一个人把政策评分作为自己的至高追求，那么他就是这个政策的牺牲品。</p><p>就算你把课本上的内容搞得再烂熟，绝不代表你真正对这门课能有什么理解（相反，那些真正理解的人，却不一定能针对考点答出高分）。</p><p>请务必牢记：大学四年留给你的是你的人生，在你毕业之时，那一串苍白的分数其实就已经作废了。</p><h4 id="被动思维"><a href="#被动思维" class="headerlink" title="被动思维"></a>被动思维</h4><p>无论做什么，我们都需要给自己一个理由。每天迫于生活压力，毫无主见地忙碌着，可称得上人生一大悲哀。</p><p>在迈进大学校门的时候，我们面临的最大问题是：为什么要上课？ </p><p>“怕老师点名”、“为了抄笔记作业”、“记录考试重点” . . . 这些话，充其量只是我们被迫上课的借口，却不能成为我们心悦诚服去上课的理由。</p><p>真正能成为我们上课理由的，只有我们对科学文化知识的渴望。</p><p>如果是否上课对你的考试成绩影响不大；如果我们感兴趣的知识不在学校的课程表上；如果上课学习的效果足够差，效率足够低，以至于通过自习，能够在更短的时间掌握知识；那么，我想你已经有答案了。</p><h3 id="悲壮的学习方式"><a href="#悲壮的学习方式" class="headerlink" title="悲壮的学习方式"></a>悲壮的学习方式</h3><p> 挖空心思研究解题技巧的学生们，与同样挖空心思研究出题技巧的老师们，构成了一个完美的圆环。在二者日复一日的机械劳动中，我只看到纸张、电力，以及粮食不断被浪费，却看不到中华之崛起。</p><p>我无意全盘否定同学们吃苦耐劳的精神，但这份精神充其量只能称为悲壮。我们耗费了大量的时间和精力掌握的那些考点、技巧，在真正的知识殿堂里根本登不上大雅之堂。哪怕我们特征值求得再熟练，积分积得再复杂，中国的载人飞船也不会因此而顺利上天。</p><p>一个真正有志于建造科学大厦的人，是不应抱着一块儿砖头精雕细琢的。</p><p>学习最需要的，不是悲壮的毅力，而是对无限未知的渴求。</p><p>最终来说，学习知识的目的是为后继的知识铺垫，以及培养创造性的思维。所谓有效率的学习，应当是以最高的效率获取知识，服务这两个目标。从现状来看，我们想要把什么都搞扎实的学习习惯，其效率是极端低下的，而在我们通过大量习题，最终扎实掌握的信息里，有效的“知识”却又是如此的少。</p><h3 id="你的身价是多少"><a href="#你的身价是多少" class="headerlink" title="你的身价是多少"></a>你的身价是多少</h3><p> 从本质上说，绝大部分同学们之所以选择大学毕业后再参加工作，是看上了更加体面的薪资待遇——大学毕业之后，我们的劳动会变得更有价值。在此，请不要提及所谓“劳动平等”之类的错误观点。劳动所创造的价值从来都不是均等的，而且不同行业的劳动早已明码标价了。</p><p>作为一名大学生，我们要对自己的能力和将来的身价有一份清醒而客观的期望。在面对各种兼职的时候，我们必须先说服我们的自尊：</p><p>参加这样的工作，我们是不是正在以过于低廉的价格出卖自己的劳动力？</p><p>对于生计无虞的同学们，我们更应该做的不是为了蝇头小利在最底层的劳动中苦苦挣扎，而是应当积极地利用这份时间来提高我们的身价，为今后出卖高价值劳动创造机会。</p><h3 id="正确地浪费剩下的时间"><a href="#正确地浪费剩下的时间" class="headerlink" title="正确地浪费剩下的时间"></a>正确地浪费剩下的时间</h3><p> 如果说，毕业文凭是一项增值服务，那么大学四年就是一笔投资。</p><p>相比宝贵的青春，我们在上学期间所需要的学费和生活开销几乎可以忽略不计。我们真正投下的有价值的筹码，是时间。面对着足以改变你人生轨迹的黄金时间，你是否感到了它的沉重？你又是否想过要如何计划这笔巨额投资？</p><p>如果你是一名乖孩子，每天从早晨开始好好上课，好好做作业，好好预习、复习，直到熄灯时间好好睡觉，过着这种积极健康，平稳中庸的生活，但是缺乏有效自我支配的生活（如果按照学校的规划，你会发现你可以自由支配的业余时间少得可怜）。那么，你这样退守下去，无异于把自己的青春放在保险箱里让他随着时间而凋谢。我们必须牢记这样的黄金规则：</p><p>平庸的生活方式是麻醉药。他只会束缚你，让你没有作为，甚至没有出息地度过大学的四年。</p><p>无论你做的事情是否有意义——哪怕任何事情都不做，时间也会从我们的身边溜走。我们必须一日三省问自己，今天的时间是否过得有价值。</p><p>一般来说，一项任务的价值，取决于它在时间尺度上的作用效率。花同样的功夫，我们应该尽量多做那些对整个人生都产生正面影响的事情，少做对中期的未来产生影响的事情，不做那些只对近期产生影响的事情。当然，产生负面影响的事是最应该避免的。从这个意义上说，花适当的时间锻炼身体能让我们终身受益，值得做；但是即便只花同样时间，我们也不应该打游戏，因为那只能获得转瞬即逝的空虚的精神愉悦。</p><p>其实，何止是体育锻炼与打游戏。我们上课、学习、考试这些事情是否真的值得去做，也都必须经过理性而批判的思考才能做出正确的决定。</p><p>有不少同学是为了 GPA 而上课。这些同学的错误在于，首先他们没有意识到，有许多提升 GPA 的办法比上课更为有效。</p><p>同时，这些同学更没有想过 GPA 本身是否是一件重要的事情。我们很遗憾地承认，由于舆论的导向， GPA 几乎成为了我们大学的一切。在短期，它绝对是重要的。除非你要保研或者转专业，其余的情况下 GPA 绝对不是最重要的因素。 </p><p>如果把目光放得稍微长远些，哪怕只是毕业后一两年， GPA 就会贬得一文不值。我们是不是应该为了这一块“敲门砖”而折衷了我们的远期目标？</p><p>安排时间道理真的很浅显：成功人士往往会津津乐道于他们在校期间锻炼出的专业素养，但几乎没有成熟（甚至不需要成功）的人，喜欢炫耀自己当年高数考了年级第一。</p><p>在另外一些时候，我们会给“上课”找一个更加堂而皇之的理由：学习知识。</p><p>关于大学课堂的教学质量以及课堂所关注的所谓“解题技巧”，我已经不想再作赘述。简而言之，上课中，我们获得有用知识的效率是如此之低，以至于任何一种有效的自习方式都会轻松地获得更大的回报。打比方说，一个学期的英语课，每周四节共计48小时。在课堂上，我们有一半时间要忍受台上同学支离破碎的英语。然而，花同样的时间，一个智力正常的同学完全可以熟练背诵2000个单词（这个数字是根据广大 GRE 考生的备考状况进行的保守估测）。这2000单词足够让你的英语水平整体上一个台阶。敢问，一个学期的英语课，你又能学到什么呢？最多不过是熟练背诵那本来就已经很寒碜的课文而已。当然，英语课只是例子，你会发现你身边几乎充满了更值得谴责的例子，其中不少比英语课更甚。这些事情经常会包括（但不限于）：</p><p>• 学生会议。几乎所有的学生会议，无论是在大礼堂举办的全校大会，还是社团头目临时占用教室举行的小规模会议，都有一个共同点，那就是毫无效率可言。</p><p>• 毫无组织的学生活动。通常在无组织的集体活动中，等人、闲谈总要花半个小时的时间。甚至让人怀疑活动的主题就是等人和闲谈。</p><p>• 费时费力不讨好，但是碍于面子不好推脱的临时工作。学校很多老师或者学生领导，喜欢把人当壮丁使唤。但是你要时刻清醒，你的身份不是临时工。“帮忙救急”和“工作”这两个概念必须区别对待。</p><p>我们应该对计划时间下的工作量有足够认识。小到一小时、一天，大到一个暑假、一个学期，或者是大学四年，制定切实可行的计划，并为不能完成计划自责是最基本的要求。所谓的牛人和大多数庸人的主要差别，一方面在于有没有时间可以利用；再一方面，就是时间的利用率。我们必须时刻保持一种紧迫感，以保证时间不被虚度。只要你能把在校期间的时间正确地加以利用。不需要超人的天分——甚至不需要特别努力，你都有望在你的专业领域里出类拔萃。</p><h3 id="总有更值得做的事情"><a href="#总有更值得做的事情" class="headerlink" title="总有更值得做的事情"></a>总有更值得做的事情</h3><p> 当我们迫于学校的教学计划，被迫选一些看上去比较没用的课程时，总会听到一些充满善意的劝慰：“这些知识多学一些也没有什么不好，没准哪天就能用得到呢！”这种话乍听起来仿佛很有道理，但实际上却是不折不扣的谎言。</p><p>我们之所以拒绝学习那些对自己不是特别有用的知识，是因为这些知识对我们的价值太低。</p><p>事务对我们都会有影响，其价值必须定量，而非定性地讨论。出去义务扫马路可以陶冶你的情操，还可以锻炼身体。坐在家里背单词背一天你可以学会数百个新单词，提升英语水平。按照上面提到的“善意的逻辑”，这两者各有好处，仿佛难以取舍。但是我想在实际操作中，不会有人认为前者对你的益处更大。</p><p>在打着各种华丽口号的诱惑面前，我们要保持清醒，并且时刻告诫自己</p><p>总有更值得做的事。</p><h3 id="做研究的兴趣"><a href="#做研究的兴趣" class="headerlink" title="做研究的兴趣"></a>做研究的兴趣</h3><p> 当你站在巨人的肩膀上，开始进行独立研究的时候，你最需要的，是兴趣。不要说，“有研究经历好出国”，不要说“没什么其他好出路所以选择做研究”。浩然高科技大楼下的白骨告诉我们，没有兴趣的徒劳坚持通常是很危险的。在科研这条道路上，只有对一门学科的喜爱，才能成为你唯一和全部的动力。</p><p>走进一个学科之前，最先应该知道的是该学科的研究对象、研究方法，以及当前研究中的热点难点问题，而不应该被广告一样的花哨演示糊弄住。</p><p>开始搞研究，并不必然意味着你要和学校里一个实验室有行政上的关系。真正扎实的认识应当是从阅读和学习中开始的。你可以试着去看这个学科最新的影印版教科书。（顺便说一下，在绝大多数高新技术领域，对于教科书的选择，我们能接受的下限是外文作者的中文翻译。尝试阅读所谓国内专家的专著只会让你的思维变得更为混乱）如果在大致看完这些书籍之后，你还能保持之前的热情，那么我非常鼓励你尝试进入该方向进行更深入的研究。</p><p>如果去做研究，那么你从一开始就应该期望着自己能够做出影响到其他科研工作者的原创性工作。绝对不要随便跑到研究小组里给人端茶倒水，指望着通过打杂来获得一段所谓的“研究经历”，或者是一篇文章第N作者的署名权。在研究过程中，相关知识不够没关系，数学不好也没关系；但是无论如何，你需要保持一个独立思考的心态。如果有好一点的工作，可以发牛一点的文章；价值略低的工作也有名气小些的出版物可以发表。但归根结底，发表文章需要的是你的原创性思考。至于那些一年上百篇论文的高产教授和一年数十篇论文的高产学生们。我们只能很遗憾地说，他们的工作是不值一提的垃圾，这种人的存在，简直就是丢中国人的脸。</p><h2 id="访谈集"><a href="#访谈集" class="headerlink" title="访谈集"></a>访谈集</h2><h3 id="为了留学而出国"><a href="#为了留学而出国" class="headerlink" title="为了留学而出国"></a>为了留学而出国</h3><h4 id="为什么要出国"><a href="#为什么要出国" class="headerlink" title="为什么要出国?"></a>为什么要出国?</h4><p>我们希望你拥有的是一个“积极”的理由，也就是说，你是为了得到你想要的某样东西而选择出国这条道路，而不是因为你厌倦了当前的生活、想逃避现状而走上这条道路。在出国的问题上，这山看着那山高的心理是极其可怕的。如果在一个对你的血统没有歧视的国度里，在一个竞争并不算激烈、甚至生活上还称得上有保障的社会中，在一个对你来说没有任何语言、文化障碍的环境下，你都算不上一个成功者的话，你有什么资本可以奢望在出国后，自己能够摇身一变，以胜者的姿态生存下来？你又有什么理由不继续失败？你怎么就那么自信地说因为我在国内做不好，所以我出国就能做好？成功的人在不同的地方有不同的成功方式，但是失败的人在不同的地方会有完全相同的失败方法。</p><p>海的那边，一样很残酷。</p><p>某个环境的条件如何如何之好并不是你去到某个环境中的理由，你能从这个环境中获得什么样的成就，才是你前往某个环境的原因。</p><p>对一个人来说，事业上的成功需要很多的要素。那么，你所追求的事业，到底是需要更多知识？更广的人脉？还是实践能力？抑或是其他因素？对于绝大多数人，我们会惊奇地发现，我们并不是那么急迫地需要学术能力来带给自己更好的前途。若真如此，那么国外大学的学术优势对你就是毫无意义。于是，付出大量时间，换取一张文凭就不是一个很合理的选择。用同样的时间，你完全可以积累实践经验，并锻炼更有用的能力。高学历的文凭不是万能的，而青春实却又太过宝贵，是不是真的要下定决心毕业后读书，需要经过每个人的深思熟虑。</p><p>那么，什么样的人需要更多知识呢？当然，我们认为，那些希望继续从事学术研究工作的人。我们不仅鼓励这类人出国，而且我们还要更坚定地反对他们留在国内深造。</p><p>在国内的学术圈里，一方面大家忙于恶性竞争：导师划山头分派系，人际关系极度复杂，各种包括造假、剽窃等学术不端行为屡见不鲜；而另一方面，政府对科研的支持力度也小得可怜：我们怎么能指望一个博士生每个月工资不到800块钱，一边饿着肚子一边做出惊人的研究呢？这诸多的弊端，使得中国高校成为学术研究领域最差的环境之一。想在这样一个几乎没有高水平学术成果的泥潭中拔足前行，需要你付出的代价实在太大太大！这还只是从客观条件来说，而从对你的前途的影响来说，一个学术工作者，在博士阶段如果没有受到国外一流名校的严格训练的话，那么以后从事科研工作是非常困难的，因为在科研领域，做不到最好，就意味着你没有任何用途，你只有做出全世界最前沿最顶尖，别人没有做出来过的东西，才能算是科研。如果你没有在学生阶段受到良好的训练，那么以后你想靠学术研究作为谋生之计，基本没有可能。</p><p>如果你的目标只是出国，读书是代价最高昂，效率最低的下下策（如果你想在美国落地生根，需要的时间往往超过15年）。与外国人或者可以出国的人结婚，或者通过中介办理移民手续，都比读书要容易许多。（尤其是通过与外国人结婚，俗称的“抱白大腿”，可以几乎100%保证你在3年之内成功拿到外国国籍）</p><p>回顾一下，如果你属于以下几类中的一类，那么我们相对比较推荐你出国读书：</p><p>• 以科学研究作为自己事业目标的人。</p><p>• 经过认真考虑的希望通过学习知识来增加自己技术背景的人。</p><p>• 经过非常认真的考虑希望通过出国读书来达到定居国外的目的的人。</p><p>特别需要提醒的是，现在“海归”变“海待”的情况越来越多。而国内的用人单位也越来越理智，不会因为你在海外留过学，就断定你如何出色并加以重用。如果你自己没有就读 Harvard, Yale, Princeton 那种中国老百姓耳熟能详的名校，也没有在能力上真的比国内的同龄人有长足进步，就不要指望有哪个公司会因为一张海外文凭而重用你。更有可能发生的情况是：你出国镀金，回来之后发现你的同学早就已经变成了真金白银，但是人家一看你就知道你只是表面镀金，但肚子里没东西的水货。</p><h4 id="出国读什么学位什么专业"><a href="#出国读什么学位什么专业" class="headerlink" title="出国读什么学位什么专业?"></a>出国读什么学位什么专业?</h4><p>关于读博士，我们一再声明：不想做学术的人请务必不要读博士学位。</p><p>一个事实是，设置博士学位的唯一目的是培养顶尖科研人才。这个学位不考虑你的就业前景，不考虑你精神所能承受的压力，它唯一考虑的，是你在某一个领域做出了多大的开创性贡献。很多大学对培养博士生的期望，就是毕业之后成为专业领域的世界级专家。你在攻读博士学位期间所付出的努力，如果换算成金钱，绝对会比你在那几年拿到的奖学金多太多了！钱绝对不是读博士的原因。</p><p>我们要注意的第二个事实是，在读博士过程中，被导师压迫几乎是理所当然的事情。经常是学生第一个学期过来，老板就扔过来几篇乃至几十篇文章，要你写综述、或者实现文章中提到的研究方法、甚至被要求在这些论文的基础上做进一步改进。而到了后来，老板要求你每个学期都必须发领域顶级的会议或者期刊论文也是家常便饭。自然，与国内不同的是，这里的老板都很懂这一行，只要你有做不出来的东西去和老板交流，老板一定会帮助你。但是如果你天生就不具备独立的科研能力和科研素养，也没有热情和耐心去做，那么你就会天经地义地被博士项目淘汰了。</p><p>关于博士的第三个事实是，当你终于有一天博士生毕业后，你学到的东西往往太过于细化和深入，不能帮助你在工业界找到合适的工作。而去读博士后，继续混迹学术圈，又会是另外一道鬼门关。想继续做教授，那竞争的惨烈程度比博士入学申请更要血腥无数倍。每年有多少博士毕业，但是每个大学又有多少个教职位空缺？所以，如果你不是醉心学术，没有浓厚的兴趣，或者不觉得自己以后会以研究为生，那么读博士之前最好再考虑一下。在美国，很多名校毕业的冷门专业的博士因为在学术界和工业界都不能谋到工作，最后不得不再花上一两年选个护理、会计之类的好就业的专业读硕士然后就业。</p><p>那么读硕士呢？对于那些家里有钱，能自费读硕士的人们，虽然你们不如家里有钱，出去读本科的。在国外读一个硕士，你可以见识到很多人体会到更多的文化以及完全不同的生活方式，还有最重要的，一张烫金文凭和不错的前途。而且，对于还没有下定决心要不要读博士的人来说，你也可以通过一个硕士学位，给自己更多的经历来感受是否真的要做科研，同时读硕士的过程还可以对你的博士申请有很大的推动作用。因此读硕士除了花钱多一点以外，真的是有百利而无一害的事情。</p><p>我们强烈建议家庭能够负担的同学先去读一个硕士看看。当然，如果是没钱读硕士的同学，你也不要太灰心，人生本来就是如此的不公平，一个人的家庭比你多一点钱可以让他读硕士实在不算什么大不了的事，有太多太多的人根本不需要读硕士，甚至根本不需要读书，就可以坐拥万贯家产，一辈子都比你过得好。所以大家只要尽自己能力去努力，好好规划自己的人生，能够过上自己能达到的最好的生活，也就可以了。</p><p>至于专业的选择，这个问题就更简单了。许多盲目性很强的申请者错很容易错误地用“是否容易申请”，“是否好就业”来作为引导他们人生轨迹的风向标。要知道，越好申请的专业，恰好是那些不好就业的专业。相反，那些有光明前途的职业，通常也就意味着惨烈的竞争。比如医学博士 MD (Doctor of Medicine) 和法学博士 JD (Doctor of Jurisprudence) ，这两个专业的学生一毕业就有很高的社会地位和很光明的前途。但是我们几乎没有听说过有大陆应届毕业生被这样的博士项目录取。另外，一些名校的 MBA (Master of Business Administration) 的竞争惨烈度甚至要比博士还要强许多。所以说，不管是申请的难度还是就业的难度，根本不应该 成为左右我们选择专业的理由。</p><p>读什么专业，要看你自己的长处和兴趣。你经过深思熟虑后投身的专业，必须要能让你获得最大程度的智力满足。</p><h4 id="为了申请出国，大学期间需要准备什么"><a href="#为了申请出国，大学期间需要准备什么" class="headerlink" title="为了申请出国，大学期间需要准备什么"></a>为了申请出国，大学期间需要准备什么</h4><p>其实这个问题本身就有严重的误导性，出国不是你的目的，而是你变得更强的手段。你未来的人生规划是什么，那么你大学期间要做的，自然就是为你的人生目标奋斗而准备</p><p>在 GPA 方面我们的建议是，但凡你能做一些比 GPA 更有意义的事情，显然会比死磕 GPA 更有帮助。毕竟不管大家怎么努力，每个专业的第一名永远只有一个人，卷入这种恶性竞争只会让你荒废时间和精力。</p><p>我们应该做什么？做研究！而且要做一流的研究！如果你肯努力，那么做出好的研究成果并非不可能。随着海外院校对中国学校 GPA 含金量的重新认识，研究成果在出国申请过程中的权重日渐增加。它甚至可以扭转你的一切劣势，把你送进最顶尖的名校。这直接导致出国申请的竞争从 GPA ，渐渐地转移到论文上来了。国外大学也发现，与其冒险去招一个可能除了考试什么都不会的人，不如招一个可以实实在在做出研究成果的人。一篇优秀的论文压倒众多 GPA 狂人的例子已成了常见的现象。所以如果你要出国留学，那么提前接触研究是极端有必要的。它不仅在申请学校的竞争中能让你脱颖而出，更且能让你自己思考自己是不是适合做研究，甚至在选校、联系教授阶段，都会带给你非常好的先机。</p><p>当然，既然是出国念书，那么语言方面的准备自然是必不可少的了。我们不应该把对英语的学习当成一个负担。如果你真的想要做有意义的学问，那么你没有任何理由不看英文的著作和论文，没有任何理由不去了解国外的最新科研进展。而很自然地，你的英语能力会随着你在专业方面的努力而不断提高。多读英文原著，多和国外的优秀研究者交流，尽可能地让自己融入到科研的前沿，那么你的英语能力很快会有质的飞跃。当然为了能够出国，你必须得参加几项英语考试，比如 TOEFL 和 GRE 考试。不过，这些都是你到了大二可以慢慢了解和准备的，而且只要你足够的重视和一定的时间，通常都可以得到不错的分数，所以我们不建议你为了它们过分担心。</p><h4 id="警惕出国中介"><a href="#警惕出国中介" class="headerlink" title="警惕出国中介"></a>警惕出国中介</h4><p> 到目前为止，在我接触过的数百申请者中，靠中的“华丽包装”让自身实力得到提升并获得名校认可的案例，一个都没有！如果中介声称，有些人通过他们的服务进入了顶级学校的顶级项目，那我有八成把握认为该事件属于下面两种情况之一：</p><ol><li>中介在撒谎。出于保护客户利益的考虑，中介没有义务向你证明他们去年那个去 Harvard 的客户到底是谁。也就是说，客户这边根本无法证明是不是真的有人在中介的推荐下去了 Harvard 。</li><li>客户是中介聘来的。有的时候，中介宁肯倒贴钱，也会让一些自身条件极为优异的学生成为自己的客户。通常，这些客户的“硬实力”足够强（例如已经发表了世界顶级的论文），不需要什么技巧也有实力冲击全球最顶尖的学校。 </li></ol><p>中介的骗局还不止这些。哪怕你是一个背景和水准都非常一般的同学，他们也会将一些很著名的学校列在合同中，但要注意的是，最近美国经济情况很差，以至于一些听上去颇为华丽的名字（例如常春藤联盟中的某些学校），每年也会发出数额惊人的 Master Program Admission 来支撑财政。此类项目每年要收取极其高昂的学费，并且不提供任何奖学金机会。对于自费项目，拿到 Admission 并不是什么难事，根本不需要所谓的高人给你指点什么特别的“申请技巧”。</p><p>至于“无效退款”的保证，就更是纯粹的噱头了。一个公司每年可能会接待数百客户。就算你的申请一败涂地，连很差的保底学校都没有拿到，到了让他们退款的地步，他们也不过只是损失了百分之一的暴利（中介的边际成本很低，有的完全是在用去年某人的文章，稍作修改就成为你的申请材料，几乎无需额外太多成本。自然，失败也不会有什么损失），但是你失去的却是一年宝贵的时间。</p><p>你愿意将希望寄托在中介身上么？如果连将自己推销给目标学校都全盘需要第三方帮忙，留学的意义在哪里呢？</p><h3 id="做真正的研究"><a href="#做真正的研究" class="headerlink" title="做真正的研究"></a>做真正的研究</h3><h4 id="合理的研究态度"><a href="#合理的研究态度" class="headerlink" title="合理的研究态度"></a>合理的研究态度</h4><p>我们不应该为了 PhD 学位而含辛茹苦地做研究，正如我们不应该为了特长生加分而痛苦地练钢琴、提琴一样。基础知识、研究灵感、交流能力、吃苦耐劳的精神之类的较高要求暂且不说，要想成为一名研究人员，一个人至少不能讨厌研究（相对他所能从事的其他工作而言，不讨厌研究）。</p><p>不少同学之所以进实验室做研究是为了出国。他们甚至明目张胆地说自己不喜欢也不适合做研究。这种为了出国而做研究的想法本末倒置，是非常错误的。出国念书的核心目的，本应是为了争取一个更好的做研究的环境。对于一个不适合做研究的人而言，花五六年甚至更长时间读博士，那就像坐牢一样痛苦！我认识好几名同学，他们在本科的时候信誓旦旦地要投身科学事业，但是真正坐在实验室里，不到一年就坐不住了。最后只拿硕士学位就匆匆走人。我很想告诫这类同学：费尽心思把自己往 PhD 的火坑里推，是一件可悲而且可怕事情</p><h4 id="区分上学与研究"><a href="#区分上学与研究" class="headerlink" title="区分上学与研究"></a>区分上学与研究</h4><p>各位平时上课、学习、考试、升学，仿佛是在挤一条独木桥：考点就那么多，题型就那么几种，学生不需要天分，甚至不需要太多技巧，只要投入足够多的时间，闷着头往前冲，总可以高分过关。而对于一名研究者而言，摆在你面前的是一片开阔的汪洋大海，仅靠毅力闭着眼睛向前冲是很难看到新大陆的。研究中没有辅导书，也没有老师告诉你教学大纲，在脑海中勾勒出一个清晰的知识结构是每名研究人员自己的事。新进入研究领域的学生，必须学会如何自己归纳知识结构。如果有人问及你正在做的工作，你应该能像从 Google Earth 中找自己家一样，把自己的工作在一年、五年、十年、甚至整个世纪的时间尺度下，并且清晰、准确、不带偏见地勾勒出你正在做的工作在整个学科中的位置。可以说，清醒的位置感和准确的方向感，是比雄厚的基础知识更为重要的成功要素。</p><p>在研究中，知道做什么比知道怎样做更为重要。</p><p>没人能保证哥德巴赫猜想一定是对的或是错的，也没人能保证你正在做的研究是否一定会有漂亮的结果。如果知识掌握没什么大问题，做作业通常会带给你一帆风顺但是平淡无奇的感觉，而做研究则是正相反。在绝大部分研究人员的绝大部分时间里，工作经常是没有效果没有方向甚至没有头绪的。但伴随着这长期的压抑，攻克难关所带来的瞬间的欢乐也绝非做出习题可比。</p><p><strong>一个成熟的研究人员必须学会习惯失败。</strong></p><h4 id="知识积累"><a href="#知识积累" class="headerlink" title="知识积累"></a>知识积累</h4><p>知识积累是一个很有技巧并且很注重效率的工作。刚刚进入研究领域的同学们，最大的障碍往往是要面对浩如烟海的文献资料，不知从何处入手。在这个时候，我们首先应该为自己绘制一张关于知识的地图。在这张地图上，我们要标明自己所在领域的研究对象，主流研究方法，研究分支的结构，以及当前存在的最大问题和最新进展。只有搞明白这些事情之后，我们才能朦胧地知道自己是否适合这个学科，自己最欠缺哪方面的知识，以及最重要的，应当按照什么样的顺序去获取知识。</p><p>在进入研究领域的第一步，我不推荐直接读论文，因为论文总是给人一种承前启后的感觉：他们大都是建立在前人理论的基础之上，并且里面所记述的工作通常也并未完结。这些显然不适合一个初学者来阅读。</p><p>我们在研究起步阶段，应该仔细阅读该领域的权威教科书。一般来讲，知识会随着时间而沉淀，在一代代人的努力下变得精炼而富有结构性。一本好的教科书则可以很好地总结记录这样的结构。较新的教科书可以涵盖上个世纪末到本个世纪初的绝大部分科学成果，对当今的研究热点一般也会有较好的介绍。负责任的教科书还会提供翔实的参考文献，并推荐进一步的参考读物。</p><p>对于教科书的选择容不得半点马虎。对于初学者想在短时间评估书籍质量，首先应该咨询学长，让他从他确实读过的书里给你一个合理的推荐。或者，你可以重点关注教材作者的身份，以及教材的应用范围（被哪些名校选为教材）。一个简单的技巧是多关注国内的影印版书籍。因为各大出版社在引进影印版图书时，肯定会做谨慎的评估。经过这样评估甄选出来的教材，通常是广受好评，多次再版，并被诸多国际顶级学府选定为教材的佳作；并且，引进影印版的目的之一就是为了填补国内相关领域的空白。所以在条件允许的情况下，我们鼓励阅读此类书籍——哪怕是对于英文阅读比较吃力的同学也是如此。如果你因为语言问题，正在考虑选择影印版图书的中文译本，那要请你慎重。由于现在很多专业图书译者的水平低劣，职业道德缺失，我们经常可以碰到读得懂英文原文却搞不明白中文译文的情况。</p><p>如果想选择中文书籍进行阅读，那你就要更慎重了。除了极少数专家外，大部分中国学者用中文所撰写的科技类教科书，其质量让人遗憾。而且一般来说，越是前沿的科技，国内教材质量越差。这些书籍摆在身旁查阅尚可容忍。但是他们非常不适合作为初学者的启蒙读物！</p><p>一般教科书上每一个章节都是一个相对独立的研究方向。当我们对框架有了一定认识之后，就可以选择其中的一个或者几个分支定为自己中短期的研究课题。继而开始综述（review）类文章的阅读。所谓综述，其最大的看点在于对于过去知识的总结和回顾——他们记录了关于知识的知识。不少学科都有专门的综述类杂志，例如Annual Review, Nature Review。各大学术索引擎诸如 Google 和 Scopus，也都支持对综述类文章的搜索。另外，综述类文章的参考文献列表也极具参考价值。</p><p>通过阅读综述，我们很容易找到近年来优秀文章。从这些文章开始学习，我们就可以较为全面地了解一个学科的全貌，因为无论从思维方式，解决问题的方法，还是实验设计、数据处理的细节。能被综述类文章大加赞赏的论文，一定有他独到的地方。</p><h4 id="衡量学术价值"><a href="#衡量学术价值" class="headerlink" title="衡量学术价值"></a>衡量学术价值</h4><p>没有老师给你判分，也没有参考答案可以借鉴。在做研究的时候，我们只能靠自己思考来辨别一个理论的学术价值。</p><p>真正能断定一个理论是不是垃圾，有多大价值，要看他会不会被后人记住。真正好的理论往往会引发人们广泛而深刻的探讨，甚至是争论。后来的人们会站在该理论的基础之上做出更为充实的科学贡献。如果在一个学术会议上，你的文章能让大家在上厕所时候还在讨论，我敢说这文章一定是个好理论。如果用量化指标做参照，论文的引用数可以从侧面说明一些问题。当今学术界的顶尖科学家基本上都有几篇引用数（ cite index ）达数千的成名之作。而实际上，学术界比较通用的“影响因子”，也是通过引用数计算得到的。</p><p>但是即使参考引用数这个指标，也仍然存在特例：有些极端功利的作者在意识到引用数的重要性后，通过不必要的“自引”（在自己后来写的文章中引用自己原来的文章）来提高论文引用率。</p><p>除了衡量别人已经发表的文章的学术地位，我们也要学会如何客观地衡量自己未发表理论的价值。下面三条原则可以简单地衡量一个理论的内在价值：</p><p>新颖的好理论必须包含足够新颖的思考。那些你看到题目后就能猜到八九不离十的文章一般不是好文章。所谓科技论文，与实验报告的区别在于：文章的目的是宣扬新思想，报告的目的是记录实验过程。</p><p>简单。我只听说过某个理论复杂得臭名昭著，但却从来没听说过某个理论因复杂而受到赞扬。而实际上，越复杂的理论越有可能是堆砌着补丁的伪装——其内在思想却是肤浅的。为了避免把一个研究问题进行不必要的复杂化，我们必须攥紧 Occam 的剃刀： Entities must not be multiplied beyond necessity</p><p>普适好的理论要有广泛的听众。从这个意义上说，我们不应该把主要研究精力放在某个领域中某个特定子问题的某种特例上  </p><h4 id="一些常见误区"><a href="#一些常见误区" class="headerlink" title="一些常见误区"></a>一些常见误区</h4><p>你给思路，我来实现：有些学生，他们具有不错的基本功，实验动手能力也很强。但是却缺乏独立精神。在身边我每每可以看见这些同学日夜辛勤，但是却从事着低级的，缺乏创造性的工作。这些人可以成为很好的工人，但他们绝对不是称职的研究者。</p><p>虽说任何一个研究小组都必须有人来承担具体的工作，但我们的态度必须鲜明：我们不应因这些机械性工作而满足，更不可能期望“你说方向，我来实现”这样的工作模式。</p><p>如果你真正立志做研究，那么基础知识，尤其是数学方面的知识是非常重要的。但这些知识和上课关系真的不大。哪怕你交大的高数考了100分，充其量证明了你具有很好的应考能力。但是你用应用数学解决科学问题的本领到底有了多少提高呢？不要寄希望于通过上课、做作业就能掌握应用的能力。相比来说，更加直接而且高效的方法是早日进入研究领域，带着问题进行学习和锻炼。</p><p>这个课题太难太简单：很多人会为自己的懒惰寻找各种各样的借口，比如“这个理论太难，一定做不出什么东西”，或者“这个理论太简单，做起来没什么意思”。的确存在很难，或者很简单的理论，我们的取舍也是非常有必要的。但如果一个人习惯性地把新方向要么归为太难，要么归为太简单，这就是一个非常差的研究习惯了，会让他的研究根本无从下手。</p><p>担心自己理论太简单：不得不说，故弄玄虚是现在学术界一个很坏的风气。很多人喜欢把自己的简单理论包装起来，冠以时髦的数学或者物理名词，以为这样就会显得自己很渊博。实际上，这种做法乍一看也许会显得很花哨，但是在时间的考验下，过不了多久就会原形毕露。没意义的复杂包装只会让理论显得更丑陋和拙劣。</p><h3 id="管理者的智慧"><a href="#管理者的智慧" class="headerlink" title="管理者的智慧"></a>管理者的智慧</h3><p>作为管理者，必须要有很强的责任心。这是所有优秀管理行为的出发点。虽然管理者不用（也不应该）事必躬亲，但是管理者承担着比团队其它任何成员都重大的责任。而且我们在学生阶段能接触到的管理工作，基本不存在太多的利益关系。在这种时候，更需要我们用责任心来决定下一步行动。</p><h4 id="培养团队"><a href="#培养团队" class="headerlink" title="培养团队"></a>培养团队</h4><p>凭借个人英雄主义式的单打独斗并不是团队精神所倡导的。过分依靠个人能力会使团队变得不稳定，并且效率低下。作为一名管理者，必须思考如何将团队连接成一个整体。这需要靠全体成员的热情和士气作为纽带。为了有效地培养团队成员对于工作的热情，与你达成一致的目标，为了大家共同的理想去奋斗，这需要两个要素：</p><ol><li>价值观。你们的工作应该是充实而有意义的工作。这需要管理者潜意识中去引导，让团队成员切身感受到肩负重任。别人可以不在乎你们做了什么，但是团队自身应该要有共同的价值观，在工作的过程中体会到团队创造的价值。</li><li>来自团队成员的认可。管理者要在人际上组织好团队，让团队成员间相互信任与敬佩，营造良好的工作环境。管理者应多听每一个来自团队的声音，友善地对待每一位成员。不同管理者的管理手段可以不同，并不是说只有塑造具有亲和力的形象才算是管理上的成功。但至少，管理者不能因为担任管理职务就沾沾自喜，对团队的成员指手画脚。无论是在学校的各级组织，还是在外的公司，成功管理者都会以平和的心态对待他们工作上的每一位同事，并且主动地给予能够给予的帮助。</li></ol><h4 id="重在参与"><a href="#重在参与" class="headerlink" title="重在参与"></a>重在参与</h4><p>校园活动的目的是锻炼我们的能力。自打一开始就不应该期望这种活动能产生什么惊天动地的效果。</p><h4 id="认识设计类课程"><a href="#认识设计类课程" class="headerlink" title="认识设计类课程"></a>认识设计类课程</h4><p>对待课程的态度</p><p>如果你不是第一次参加设计类课程，那你一定知道，把全部精力放在设计课上是对时间的极大浪费。因为缺乏有效的指导，这种课程通常都会变成一次次无的放矢的演练。它无法有效提高设计能力，无法训练思维，也不会让你的设计类手法有什么提高。对于这类课程，希望同学们能牢记三个字——别当真！</p><p>请务必理性分配时间，追求更有效的学习方式，而不要把自己困死在“设计课”的泥沼中！</p><p>对待自己的态度</p><p>有很多同学在设计课上钻进了完美主义的死胡同。设计是工程，设计课更是工程。如果把课堂作业当成艺术的话，我不知道该说你幼稚还是愚蠢。要知道，方案设计永远没有尽头，但<strong>对一门设计课程作业，你的上限是多少小时？</strong>这在一开始就要规划好。绝对不要不计代价地追求所谓“更合理”的设计。</p><p>对待老师的态度</p><p>我们也不应对老师的水平和能力产生病态的崇拜。叫他看一眼你的图纸，他不太可能看得出你的设计理念，也不太可能了解你的设计过程，更不太可能给你一个建议让你觉得醍醐灌顶，胜读十年书。老师不可能对每个人的作品做出什么深入而客观的评价。事实上，影响你分数的，通常还是那些肤浅但容易量化的因素——诸如出勤、态度、书面报告。</p><h4 id="进度控制"><a href="#进度控制" class="headerlink" title="进度控制"></a>进度控制</h4><p>在老师面前控制好进度是取得高分的关键。我们给老师看图，并不是为了获得什么指导，而是要通过交图告诉老师，我有一个积极的态度。</p><p>切忌本着好大喜功，想一鸣惊人的心态，攒很长时间的工作，一次甩给老师。老师会被你那令人眼花缭乱的工作量惊呆么？绝对不会！相反，东西多了看着烦，还容易被挑毛病。老师完全可以轻易地在细枝末节的地方抓二十个莫须有的问题，然后把你的工作贬得一文不值。</p><p>在同等工作量的前提下，明智的进度控制应该是把自己的全部工作平均分配在各次课上提交。即便你已经做完了更多，也必须像说评书一样娓娓道来，说一半藏一半，不要一股脑呈现完。</p><p>因为不是所有同学都有新东西，所以我们更要保证每次上课都有新的东西给老师看，并注意和老师多加“探讨”。只要混个脸熟，你的印象分就会有很大提升。</p><p>在设计的最后阶段，尤其不要进行无谓的修改,不要把时间浪费在徒劳的心理抚慰上。即使老师提出了一些修改要求，你也没必要完全照办。把现有阶段的设计表现清楚，按时交图，这是想拿高分的基本要求。</p><h3 id="小心项目的陷阱"><a href="#小心项目的陷阱" class="headerlink" title="小心项目的陷阱"></a>小心项目的陷阱</h3><p>交大部分老师的科研水平很令人失望，他们自己完全没什么像样的研究。跟着这样的老师做项目，我们通常也很难得到研究素养上的锻炼。如果你因为参与一些低层次但是没有任何锻炼价值的项目而耽误了大量时间，打乱了自己计划的进度，将会是一件非常得不偿失的事情。</p><p>所谓项目不外乎老师的私活，或学校的 PRP ——传说中的本科生研究项目；再不然就是一些带有政治色彩的竞赛项目。总体上说，带本科生项目的老师的水平和责任心都是让人失望的。如果你已经有了充分的思想准备，但仍然还是对某个老师的某个项目有兴趣，那么你必须在决定参加之前，进一步确定该课题是否属于自己的学术兴趣，或者是否对自己的研究有帮助。而你能做出合理判断的前提，必须是你很清楚自己发展的大方向。作为一名学生，不清楚自己的学术兴趣本该是一件极其不正常的现象。</p><p>绝大多数所谓项目，都是极其空泛的。不要寄希望于通过做一些项目“发现”自身的学习兴趣。</p><h4 id="辨别项目的质量"><a href="#辨别项目的质量" class="headerlink" title="辨别项目的质量"></a>辨别项目的质量</h4><p>PRP 项目</p><p>通过 PRP 项目的题目，我们通常就能看出这个项目的质量。没有针对性的课题通常不会意味着高质量的研究成果。很多 PRP 项目，一看题目就知道是非常空洞且好大喜功的。例如《历年世博会建筑场馆的研究》之类。我们必须放弃脑中残存的对老师的盲目崇拜，用我们的独立思考能力想想，这样的题目，在一个学期到一年的业余时间里，以我的水平到底能研究出多少有意义的东西？具体来说，世博会始于1851年，每届场馆数量上百，性质不一，统统放在一起研究，用一个学期时间，你难道能得到一个不是很肤浅的结论么？</p><p>如果题目看不出究竟，我们还可以看研究提纲。一般你在参与一个项目前，可以向导师咨询具体的研究提纲。当然了，因为很多老师本身组织 PRP 就很敷衍，他们自然也拿不出深入思考的提案。最多说两句官腔味道十足的空谈。顺便说一句，如果有老师不断强调这样的观点“因为还没开始研究，于是拿不出一个足够细致足够切实可行的方案”。那么你要特别提高警惕。因为这种话，通常是学术骗子在申请经费想空手套白狼的时候才会说的。</p><p>接下来，我们还可以认真阅读项目的研究方式。很多 PRP 的实质不是研究，而是收集整理资料。我们再拿《历年世博会建筑场馆的研究》举例。2010年的上海世博会是第五十一届，前五十届世博会都不是在中国召开的。我们能对那些远在异国的建筑有多少接触——且不说这里面很多建筑在世博会闭幕后不久就都被拆除。显然老师不会组织境外考察，所以，我们所谓“研究”的手段只剩下上网搜索和读书。整理他人的看法和说法最终形成一份报告，这顶多算是文秘的工作，可绝对算不上“研究”。</p><p>最后，我们还需要关注项目团队的数量和质量。一个导师，要是想做好研究，他一定会认真选择参与者，并有效控制人数。要知道，做研究不是打群架，人数的堆积不会带来任何优势。面对这样巨大的团队，不要说导师还有其他工作，就算是全职来带这一个项目，也不可能给每个人都提供有意义的指导。当然，实际情况是导师通常更忙，所谓的“辅导”，实际效果也会更糟糕。</p><p>老师的“私活”</p><p>说到老师的横向项目，或者通俗点说，“私活”，我们就需要更加慎重了。大多数情况下，你是以听话、廉价、高效的劳动力的身份参与到一个横向项目中来的。你的角色只是一个不拿工资的打工仔——或者稍好些，有微薄的工资。无论如何，任何学生都不要妄想成为项目的合作者。因此，问清楚项目周期和工作任务是决定加入的必须前提。我们必须明白自己头上的工作，究竟在哪个层面对自己有帮助。要知道，老师“私活”的商业性质多于学术性质，甚至可以因商业牺牲学术原则。</p><p>可以的话，再多询问已经在项目组里的同学，听听他们的经历和经验，你会得到很多内幕消息。</p><h4 id="选择导师"><a href="#选择导师" class="headerlink" title="选择导师"></a>选择导师</h4><p>一个可以参考的匿名导师评价网站为<a href="https://mysupervisor.org">导师评价网</a>，不过可惜的是很多老师都缺少评价，想要了解一个老师以下特点，需要跟他手下的在读学生或者已毕业学生联系获取更准确的信息。</p><h5 id="导师类型"><a href="#导师类型" class="headerlink" title="导师类型"></a>导师类型</h5><p>可以简单把高校教授们分为四类，但一部分老师可能同时具有两到三类的特征。</p><ol><li>功成名就的大老板，在国内就是有院士长江杰青千人的title，在国外就是本领域有影响力的学术组织的fellow，在计算机领域即为ACM、IEEE fellow。大老板们往往手下会招聘一些青年教师和博士后帮他管理团队，自己大概率脱离科研一线，主要精力花在与领域内其他大佬social拉经费、项目，维持庞大团队的运转，这样的老师不一定是个好的advisor，但大概率是个好的lab manager。大老板不会亲自带学生尤其是本科生，你会被组内小老板或者博士生指导，如何跟到一个靠谱的小老板需要运气，想要在一个庞大的组里做出吸引大老板的成果也相对难度较高。</li><li>青年教师，也被称为青椒，他们刚在学术界独立出来，拥有了自己的实验室，有了招收硕士和博士生的资格，在当下国内高校全面铺开海外tenure-track非升即走的制度下，他们需要在六年的时间中达到系里副教授的门槛，评价指标包括论文发表、拉到经费数额、开设课程数量等。由于中国高校吸引人才归国的能力稳步提升，近些年来国内顶级高校招聘的助理教授往往都是欧美不错的博士毕业生，他们一般比一些八九十年代土博毕业留校的老师视野更广阔，了解本领域下最前沿的科研脉络，研究的品味相对较好。他们不像大老板们有很多科研以外的杂事需要处理，你能得到更多hands-on的指导，他们的学生是否成功也将与他们自己的命运（能否tenure）紧密相连，他们会尽最大努力帮助你，出成果的速度会快一些，相应的导师传导给学生的压力也会更大，但是助理教授们的起步资源相对有限（拿到青年千人title的会好很多）。</li><li>养老型教授，不管是国内高校老体制下的教授或者海外tenure-track体制下已经拿到终身教职的教授，他们的职位已经非常稳定，会有一部分比例的教授在40岁之后的阶段进入养老阶段，原因可能包括进一步评职称无望干脆开始享受轻松生活、或者事业发展进入平稳期等，他们对发更多文章已经没有很高的欲望，这种导师一般适合只要一纸文凭的学生，期间比较自由，但自制力不强的学生可能毕业时成长很有限。</li><li>创业或者热衷于接工业界横向项目的教授。这类教授有些是想通过接工业界横向项目为自己捞钱，也有一部分是想完成科研成果转化，扩大自己的影响力到工业界扬名立万，他们往往更多精力放在公司上，对学生的指导比较有限。</li></ol><h5 id="人品与指导学生态度"><a href="#人品与指导学生态度" class="headerlink" title="人品与指导学生态度"></a>人品与指导学生态度</h5><p>参与科研项目虽然跟上课是很不一样的过程，但是除了个人的努力之外，老师愿意花费多少精力指导你，给予你多少科研资源（在计算机领域比如提供服务器，在实验学科则是提供良好的实验设备，还包括一些隐形的资源如当遇到导师不熟悉的问题他是否能为你介绍合适的老师协助你解决问题），给你是否靠谱有前途的课题等等都是你很难控制的因素。科研项目也存在较大不确定性，当项目卡住时，问题可能是多方面的：1）课题本身不靠谱。2）提出的解决办法有问题。3）学生在实现细节上出了问题。一个好的导师应该利用自己过往的经验帮助学生解决问题而不是一味批判学生笨，灌类似“你要相信自己一定可以解决这个问题”的鸡汤同样对解决问题帮助很小，如果该条路的确失败风险较大，导师应该及时调整航向避免更大的沉没成本，保护好学生的科研积极性也是导师应该考虑到的问题。为了保证课题平稳推进，青椒应该跟学生有固定的每周一对一meeting，大老板应该跟学生有相对低频率的meeting或者在学生遇到问题主动寻求帮助的时候给予支持。这一点需要自己多接触不同类型的导师，多感受才能知道自己真正适合什么样的指导风格。</p><h5 id="在读和已毕业学生出路"><a href="#在读和已毕业学生出路" class="headerlink" title="在读和已毕业学生出路"></a>在读和已毕业学生出路</h5><p>私以为作为老师，最好的状态是“桃李满天下”，一个老师最大的财富是他培养出来的学生，一个把论文和经费看的比学生更重的老师有较大可能把学生当成他的“学术工具人”。学生毕业后的出路是老师在学界/业界影响力+老师是否用心推荐学生找工作+学生在组内深造期间成长的综合体现，一般不要期望自己能超过组内毕业生出路的上限，多考虑平均值更合理，同时可以观察在读学生平均文章发表情况，第一篇文章发表耗时以及质量等</p><h5 id="实验室文化"><a href="#实验室文化" class="headerlink" title="实验室文化"></a>实验室文化</h5><p>这是一个很抽象的概念，你在适应导师的指导风格的前提下，同时也需要考虑是否适应实验室的一些固定文化比如：</p><ol><li>实验室学生需要打卡吗？每周有固定工作时间限制吗？40小时，60小时还是更多？</li><li>组内学生合作氛围如何？还是每个学生有自己独立的项目要完成。</li><li>实验室会组织一些集体活动如春游秋游吗？</li></ol><h4 id="好老师与坏老师"><a href="#好老师与坏老师" class="headerlink" title="好老师与坏老师"></a>好老师与坏老师</h4><p>在此很难为好老师下一个通用的定义，简单来说一个老师人好且在乎你自己的研究兴趣，支持你自主独立的想法，并且在自己能力范围内为你提供研究的软硬件条件——哪怕这些工作和他的项目并没有直接的关系，若还能做到因材施教那便是非常难得的了，一个好老师在你毕业后依然会是你终身的好朋友。这里可以列举一些经常出现在坏老师身上的特征：</p><ol><li>安排学生为实验室做很多杂活如经费报销、跑项目手续到处找领导盖章签字、取快递、写材料等。</li><li>不将精力用在指导学生完成科研项目而用在训斥学生上，试图通过威胁学生让学生害怕，试图通过夸夸其谈（画饼）让学生信服，不尊重学生的个人意愿和研究兴趣。</li><li>用不合理要求卡学生毕业，组内学生延毕比例较高。</li><li>克扣学生的助研补助到自己腰包。</li><li>自身学术水平一般喜欢瞎指导。</li><li>不尊重学生的私人时间、身体健康和个人隐私。</li><li>把学生当成工具人，压榨学生帮自己完成横向项目赚钱。</li><li>抢学生的一作authorship</li><li>依靠advisor-advisee的不平衡关系对学生实施精神控制等</li></ol><h5 id="碎碎念-1"><a href="#碎碎念-1" class="headerlink" title="碎碎念"></a>碎碎念</h5><p>本科期间参与研究是因材施教的体现，并不意味着好学校的本科生都需要如此，切忌随大流卷入本科生科研低龄化的趋势中去，科研不是本科教育中最重要的组成部分，博士毕业后也只有很小一部分人能终身以科研作为一份工作。本科期间加入靠谱的实验室，参与合适的研究课题，能锻炼同学各方面的能力，如果课题进展顺利最后能有高水平论文发表带来的自信心提升也是跟获得高GPA的乐趣是完全不一样的。即使项目进展不如人意，这也是在试错成本可接受范围内的，记得积极定期与导师保持高效沟通，与导师共享一致的目标，在科研的道路上相互成就</p><h4 id="团队与合作伙伴"><a href="#团队与合作伙伴" class="headerlink" title="团队与合作伙伴"></a>团队与合作伙伴</h4><p>团队协作精神，应当是各展所长、互为补充的高效率工作。我们不能以“团队合作”的名义，迁就或容忍那些低效率、无责任心的合作者。</p><p>我们不能保证每位合作者都和你做项目的初衷一致，我们更不能保证每位合作者都有足够的道德水平。在一个病态的团队中，低效率、抢风头、拈轻怕重的情况会时常出现。这种团队合作变成了勾心斗角的训练。这对正直的人进行严肃的研究来说，是百害而无一利的事情。当然，在这样的团队中，不太可能做出什么成果，反倒甚至会让自己沾染上一些不良的习惯。所以如果你发现你周围的环境就是这样，那么请尽快离开这样的团队。</p><h3 id="保研者说"><a href="#保研者说" class="headerlink" title="保研者说"></a>保研者说</h3><p>路没有好坏之分，只有适不适合之别。不是说工作的人一定有闯劲，也不能说出国的人就一定有更光明的前途。</p><p>有个问题在一开始就要问自己：读研，是一条什么样的道路？</p><h4 id="明确目的"><a href="#明确目的" class="headerlink" title="明确目的"></a>明确目的</h4><p>读研的动机主要有两种：</p><ol><li>需要一个硕士的文凭提高社会地位，方便就业。</li><li>想积累一定的研究经验，为将来出国或者工作做准备。</li></ol><p>这两方面的动机都有它自己的道理。我认为，只要一个动机能激励你积极向上，那这就是正确的动机。但是根据交大的现状，我们做出“读研”这样的决定，还是需要相当的深思熟虑。</p><p>我们先说说“社会需要硕士”这件事。撇开能力不谈，硕士文凭对各专业就业前景的影响可以说是千差万别。所以，抱着这样打算的同学们不要轻信所谓“硕士好就业”这样的谣言。在选择读研之前，一定要真正了解这个行业，认清学历在未来几年的工作中可能起到的作用，比如具体薪金、升职期望等要素。</p><p>如果你是从积累研究经验的角度考虑读研，这种想法我比较认同。有的人可能会以为早一点参加工作也可以积累研究经验，为将来出国做准备。但实际上，公司的环境和学校里面还是有很大差异的。虽然劳动法早就规定了八小时工作制，但是一般研发部门是不会给你朝九晚五的机会的——不加班绝对是小概率事件！在高度紧张的工作中，你是一个出卖劳动力的角色。你的工作统统是上级指派下来的，而你不能选择做什么或不做什么。长此以往，你会发现自己在工作之外的积累少之又少。相比来说，交大的研究生生活，不管如何糟糕，至少不会让你为每天的生计发愁。可以说，学校帮你缓冲掉了许多压力。同时，你也可以利用这几年时间做一些自己喜欢的事情。如果你还想继续提升一下自己的价值，读研是一个不错的选择。</p><p>这里有一点需要强调，每年我们看到保研后都有无数人后悔，我们也能听到工作的人对读研的无不羡慕。这都是围城心态。一些工作的人怀念读书的生活，觉得读研更好，比做打工仔更有前途；但读研的人又觉得还是工作好，可以赚钱和积累经验，也不用和某个讨厌的导师在一起工作。</p><h4 id="硕士之后"><a href="#硕士之后" class="headerlink" title="硕士之后"></a>硕士之后</h4><p>读研，充其量只是一种缓冲——当你不知道做什么好的时候，或者你知道了做什么好但是时间已经不足以让你获得理想的结果的时候，你没有更多的选择，于是才继续读硕士，寄希望于给自己一段可以继续努力的时间。但是，在这段时间里，如果你再不认真思考（很多优秀的人本科时候就做过这些思考了），那么可能你还会浑浑噩噩地留校读个博士。再之后呢？</p><h2 id="生存技巧"><a href="#生存技巧" class="headerlink" title="生存技巧"></a>生存技巧</h2><h3 id="选课原则与选课技巧"><a href="#选课原则与选课技巧" class="headerlink" title="选课原则与选课技巧"></a>选课原则与选课技巧</h3><h4 id="选课选什么"><a href="#选课选什么" class="headerlink" title="选课选什么"></a>选课选什么</h4><p>我们选课并非选课程，而是选上课老师。</p><p>选择正确的老师，仍然是对整门课程最终成绩影响最大的一个因素——甚至要远大于你前半个学期是否认真上课！</p><p>具体来说，我们选一个老师，应该从下面几点情报综合考虑：</p><p>• 点名方式：老师上课是否点名？点名是以什么方式进行的？一般来说，签到、喊到、随堂测验，想蒙混的难度逐渐递增。我们关注是否点名，重点应该看的是这个老师面对学生的态度。有的老师睁一只眼闭一只眼，即使不来上课，也不会太为难学生。而另外一些比较自卑的老师却把学生不来上课当成对自己的奇耻大辱，甚至会想出课前课后点两次名外加数人头这样的手段防止学生翘课。其实，如果老师想不计代价查出谁没来上课，这真的是太简单的一件事情。所以我们重点还是看这个老师的态度，而非他上个学期具体采用了哪种点名手段。</p><p>• 期末考试成绩的比重：对于一门考试分数普遍不高，大多数人没把握拿到90+ 的课程（诸如 A 类的高数、大物），我们要尽量选那些平时成绩（包括作业成绩、小论文成绩之类）占比重比较大的老师。因为经验上说，只要稍微动动脑筋，勤快一点，最多再留意下和研究生助教交流的谈话技巧，平时成绩拿满分绝对要比考试拿满分轻松很多。所以，对于考试难度大的课程，我们的基本策略就是通过选课减小期末考试成绩所占的比重。但是对于一些非常简单的课程，情况就正好相反了。</p><p>• 关于考前透题的误解：关于这一点大家可能存在一些误解。一般情况下，是否透题并不是一个可靠的选老师指标。越是出题的老师，就越会避嫌而对考点三缄其口。相反，没有出题的老师也许会凭经验押题或者是看到考卷后间接地把考点告诉大家。</p><h3 id="突击备考"><a href="#突击备考" class="headerlink" title="突击备考"></a>突击备考</h3><p>从学习知识而言，上课是一件奢侈的事情。对突击复习考试而言，所谓的“慢工出细活”也是奢侈的。如果你认为这门课不重要，请不要在两个星期以前开始复习，因为两个星期足够让你忘掉其中一大半的知识。通常，有效的复习是在3天之内开始的，因人略有差异。我不否认个人之间的IQ存在差异，但是这种差异是如此之小，以至于甚至不能成为左右考试成绩的主导因素。充其量，有些同学可以以笨鸟先飞的名义，把一门课程需要的复习时间从3天延长到5天，不会更多。当然，我们这里说的是针对大多数靠突击有可能能拿高分的课程。</p><h4 id="注意复习范围"><a href="#注意复习范围" class="headerlink" title="注意复习范围"></a>注意复习范围</h4><p>通常老师在复习课上都会把考点和考试范围告诉大家。对考点的正确解读可以让你事半功倍。比如，有一些脸皮比较薄的老师在划考点的时候，不喜欢明目张胆地说“这章不考”，而是会换一种更加委婉的说法，比如“这章的内容主要是介绍性的，有兴趣的同学们可以进一步拓展”。我相信大部分同学对于这样的话都能有正确的理解。至于考点的准确性，我认为我们不应该心中有任何疑问。虽然的确存在过老师说不考的地方真的考了，但是那种事情出现几率非常低。</p><p>我们在考前最后一节课上，一定要毫无保留地相信老师、相信考点，并且，还要相信不同老师考点的交集。</p><h4 id="三天冲刺"><a href="#三天冲刺" class="headerlink" title="三天冲刺"></a>三天冲刺</h4><p>3天之内，你需要准备的：</p><p>• 课本（没错，就是这门课的教材）</p><p>• 上课 PPT ，如果你的老师的PPT只是把教材原样照搬的话</p><p>• 一位懂得这门课程的朋友</p><p>• 平时作业列表</p><p>• 全书考点（或者不考的点）的列表</p><p>首先，请懂得这门课程的朋友吃饭，让他用半小时的时间，用通俗语言，按章节给你介绍这门课是做什么的，每一部分的考点是什么。吃饭结束之后，和他约考试前一天下一次见面的时间。然后翻开教材，看目录，将不需要考的内容划掉。回忆那位朋友的话，想象每一章的标题所代表的内容。以3倍速的速度将书翻一遍，无论看懂不看懂，进一步领会朋友所说的话，如果是理工类课程，争取每章自己总结一个能够说服自己的理论。</p><p>找出平时作业列表，当然了，通常来说你肯定是一道题目也不会做。这很正常，你不必为此感到紧张或绝望，不上课直接做作业本这本身就是让人绝望的。你需要做的是，把作业和答案放在一起，开始扫荡，用半天的时间保证你知道答案的那些数是怎么算出来的。注意：你没有时间一道一道题目去做，把你高中老师告诉你的要扎扎实实的说法抛到脑后吧，扎扎实实你应该好好上课去。</p><p>如果顺利搞明白了作业，你现在大约可以考40分了。你会遇到一些情况，比如作业题目你看不懂，你不知道答案上面那些鬼东西是在说什么。勾上相关的章节。将刚刚勾过的章节逐一以两倍速浏览，注意看公式和黑体字。你会发现你小学套公式，中学套公式，到了大学，还是在套公式。接下来你只需要把你不会的题代到相关章节的相关公式下，做好字母和中文的对应翻译工作。</p><p>现在你不会的题目应该很少了。这会儿开始看 PPT 。注意，不要一开始就看 PPT ，当然，更不要一边看 PPT 一边看 Comic 。知识是书上来的， PPT 是演讲稿，不要因为懒不去翻书。</p><p>有些关键点，看课本看不懂，就去看 PPT （因为教课书在关键点上总喜欢使用脑残体），看 PPT 看不懂（部分 PPT 写的和书一样脑残，而且还有错），就去看课本；再不行还有 Google 。如果在非常关键的知识点遇到了无论如何都不明白的情况，那就赶紧抄起电话，找到你的那个朋友求助。</p><p>在考试之前前一天之内，把所有的公式或者解题步骤都写在一张纸上，用剩下除睡觉之外的时间去熟悉这张纸，根据例题的形式在脑中按照这个套路演练。但是不要试图拿着这张纸作弊——风险太大回报太低不合算；把上面的内容抄到桌子上也不可取——在考试时，你根本不会有机会去把桌面当图书馆查来查去，这样做只会让你心虚，一边惦记这个事儿一边浪费大量时间。考试的时候，尽量不要抄周围同学的，因为你周围的人复习的不一定比你好。</p><p>如果你前面工作做的足够好，那你一定要有信心。题目要么你都会做，要么大家都不会做。关于选择题，请尽量用你的大脑，不要胡猜。</p><h4 id="考试结束后"><a href="#考试结束后" class="headerlink" title="考试结束后"></a>考试结束后</h4><p>一哭二闹三上吊是下下策，只有当其他的手段都无效时，再考虑这样的办法。对于某些老师，你唯一的选择就是考到80+。对于另外一些比较好说话的老师，你可以跟他们谈谈你对课程的理解，以及对这门学科的看法。在谈话中，最佳的切入点是学术。你要尽可能地讨论学术方面的问题，而不是去强调你要出国，你要保研。每个人都有各种各样的私人借口来要求一个好的成绩，但是这些借口并不一定都能成为让老师帮你一把的理由。</p><h4 id="复习箴言"><a href="#复习箴言" class="headerlink" title="复习箴言"></a>复习箴言</h4><p> 有一些课程没有习题，或者说老师布置的作业没有代表性，那你必须需要去购买一本习题集，或者看别人的上课笔记</p><p>做题一定要找有答案的，你没有时间去自己确定你做的每一个答案是否正确。</p><h3 id="旁门左道"><a href="#旁门左道" class="headerlink" title="旁门左道"></a>旁门左道</h3><h4 id="学术灌水"><a href="#学术灌水" class="headerlink" title="学术灌水"></a>学术灌水</h4><p>介绍如何在垃圾学术期刊上灌水的技巧并非我们所鼓励的。在学校里，我们愤怒地发现有同学以为做研究就是灌水。本段的主旨就是要通过消除信息不对称，纠正这种错误思想。我们有必要指出，不论质量地发表论文，并不是什么神秘的事情。只要知道了相关的流程，你能，我能，甚至连机器都能。</p><p>首先，我们要明白，水刊、水会和正经学术期刊会议的差别在于，前者靠发表别人的文章盈利——通常还都是暴利。所谓“核心期刊”的版面费，收你每篇两千块钱就已经是很客气的了。这没什么好奇怪的。学生毕业要靠论文，老师评职称也要靠论文。对于那些没有任何学术水平的混子们，自然也就只能靠“买论文”这种手段确保生存。而我们的现状是，中国的科研队伍中，有相当数量的人都是混子，这一大群人的生存需求促进了水期刊、水会议如雨后的狗尿苔（实在无法用春笋形容它们）般滋生出来。如果你愿意交钱，自然有人愿意接受你的文章——不管你的文章写得多烂。 </p><p>期刊</p><p>在万方数据库上查找相关方向关键词，多找一些期刊，看每个期刊每月能刊登多少篇文章。如果一个月有100篇以上或更多，那想也不要想，这期刊一定是水刊。随便写两笔，直接投就可以了。进一步地，可以通过查找每篇文章作者的信息确认该刊物是否是水刊。有的时候你会发现一些xx学报上的作者都是些没名气小学校的老师/学生，那就更可以放心大胆地投了。要注意，国内有不少“核心期刊”的目录，找到这些目录的差别，可以方便你的投稿。比如：交通大学的核心期刊目录和北大核心期刊目录不同，这时，你可以投不在“北大目录”却在“交大目录”里面的期刊，这样的期刊</p><p>一般稿件相对数量略少。另外是一些小细节：</p><p>• 在致谢里写上牛人，可以给自己撑腰。</p><p>• 有些期刊有页数限制，超过页数就需要加钱，这时读者可以先投稿，中稿后，然后再将文章压缩到最便宜的长度。</p><p>• 能写大老板的名字就加上去，因为一般的期刊都不是盲审。</p><p>• 文章投出去后，不要死等。记得经常和编辑电话交流感情（仅限于那些水刊，正常刊物或者牛刊物的话，编辑都很忙，通常没功夫理你）。要让糟糕杂志的编辑觉得自己很受重视，很有成就感。</p><p>• 参考文献多引用你要投的期刊上的论文。</p><p>会议</p><p>近年来，由于供求关系的压力，很多杂牌会议也不断在国内涌现。举办学术会议，通常比办杂志，更加有利可图。除了拿注册费赚钱之外，更有人觉得通过组织会议能够提升自己的“声望”。有人图名，有人图利，还不怎么费事（会议组织期间，真正跑腿的还是主办教授手下的研究生们），何乐而不为！甚至我认识某个会议的组织者还说过这样的话：“其实我们不会怎么审文章，就是在审稿截止日前随便看看，没什么大问题就直接接收了。”</p><p>对于这些会议，你只要老老实实地按照规定格式提交，别说内容烂，甚至没有内容也一样能中。毫不夸张地说，读者只要使用前文介绍过的 SCI Generator ，投稿到上述的会议，您的论文大抵会被接收。</p><p>只要你想灌水，把你写的中文课程设计的报告提炼一下，翻译出主要内容，再根会议指定的论文模板排排版。一定可以被某些IEEE XXXX 国际会议接收。</p>]]></content>
    
    
    <summary type="html">SurviveSJTUManual阅读笔记。第一次看完觉得挺好的，清理收藏夹时，又读了一遍，并整理出了一些笔记</summary>
    
    
    
    <category term="书摘" scheme="https://changqingaas.github.io/categories/%E4%B9%A6%E6%91%98/"/>
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>什么是node.js</title>
    <link href="https://changqingaas.github.io/js/JS/%E4%BB%80%E4%B9%88%E6%98%AFnode.js/"/>
    <id>https://changqingaas.github.io/js/JS/%E4%BB%80%E4%B9%88%E6%98%AFnode.js/</id>
    <published>2021-08-31T08:56:30.000Z</published>
    <updated>2022-10-24T02:40:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="node-js简介"><a href="#node-js简介" class="headerlink" title="node.js简介"></a>node.js简介</h1><ul><li><p>node.js是运行在服务端的JavaScript,是一个事件驱动I\O服务端JavaScript环境</p></li><li><p>查看版本</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">node -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>node版本管理工具nvm</p></li></ul><h1 id="Node-js应用"><a href="#Node-js应用" class="headerlink" title="Node.js应用"></a>Node.js应用</h1><ul><li>Node.js应用的构成：<ul><li>引入required模块</li><li>创建服务器</li><li>接收请求与相应请求</li></ul></li></ul><h2 id="创建Node-js应用"><a href="#创建Node-js应用" class="headerlink" title="创建Node.js应用"></a>创建Node.js应用</h2><ul><li><p>步骤一：引入required模块</p><ul><li>使用require指令来载入http模块，并将实例化的HTTP复制给变量http，实例如下：  <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p>步骤二： 创建服务器</p><ul><li>创建一个server.js的文件：<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>http<span class="token punctuation">,</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 发送http头部</span>    <span class="token comment">//HTTP状态值：200：OK</span>    <span class="token comment">//内容类型：text/plain</span>    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'Content-Type'</span><span class="token operator">:</span>'text<span class="token operator">/</span>plain<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//发送响应数据 “Hello World"</span>    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//终端打印如下信息</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8888/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用node命令执行以上代码</p>  <pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">node server.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>访问<a href="http://127.0.0.1:8888">http://127.0.0.1:8888</a></p></li></ul></li></ul><h2 id="npm使用介绍"><a href="#npm使用介绍" class="headerlink" title="npm使用介绍"></a>npm使用介绍</h2><ul><li><p>查看npm版本</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm -v <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>升级版本</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm install npm -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>安装包</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm install &lt;Module Name&gt; # 本地安装npm install &lt;Module Name&gt; -g # 全局安装<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>查看安装信息</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm list -g # 查看全局安装的模块npm ist &lt;Module Name&gt;# 查看某个模块的版本号npm ls# 查看当前目录下的包信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>卸载模块</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm un &lt;Module Name&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>更新模块</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm update &lt;Module Name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>搜索模块</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">npm search &lt;Module Name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>创建模块</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$npm init# 会自动生成package.json$npm adduser # 在npm资源库中注册用户Username:XXXXPassword:XXXXEmail:XXXX$npm publish# 发布模块<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="Node-js-REPL-交互式解释器"><a href="#Node-js-REPL-交互式解释器" class="headerlink" title="Node.js REPL(交互式解释器)"></a>Node.js REPL(交互式解释器)</h2><ul><li><p>REPL(Read Eval Print Loop:交互式解释器)，Node自带交互式解释器，可以执行读取,执行,打印,循环等任务</p></li><li><p>在Node的REPL中可以执行：</p><ul><li>简单的表达式计算</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$node&gt;1 + 45&gt; 5 &#x2F; 22.5&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用变量</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ node&gt; 1+45&gt; 5&#x2F;22.5&gt; x&#x3D;1010&gt; var y&#x3D;10undefined&gt; x+y20&gt; console.log(&quot;Hello World!&quot;)Hello World!undefined&gt;   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>多行表达式</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ node&gt; do &#123;... x++;... console.log(&quot;x:&quot;+x);... &#125;while(x&lt;5);x:1x:2x:3x:4x:5undefined&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>下划线变量<strong>[使用下划线(_)获取上一个表达式的运算结果]</strong></p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ node&gt; var x&#x3D;10;undefined&gt; y&#x3D;10;10&gt; x+y20&gt; var sum&#x3D;_undefined&gt; console.log(sum)20undefined&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>两次ctrl+c停止REPL</p><h2 id="Node-js的回调函数"><a href="#Node-js的回调函数" class="headerlink" title="Node.js的回调函数"></a>Node.js的回调函数</h2><ul><li><p>Node.js异步编程的直接体现就是回调</p></li><li><p>阻塞代码实例</p><ul><li><p>创建一个文件 input.txt ，内容如下：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">Hello world!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>创建 main.js 文件, 代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"程序执行结束!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>以上代码执行结果如下：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ node main.jsHello World！程序执行结束!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>非阻塞代码实例</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"程序执行结束!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上代码执行结果如下：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">$ node main.js程序执行结束!Hello World!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>第一个实例在文件读取完后才执行完程序。 第二个实例我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。</p></li><li><p>因此，阻塞是按顺序执行的，而非阻塞是不需要按顺序的，所以如果需要处理回调函数的参数，我们就需要写在回调函数内。</p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">学习node.js</summary>
    
    
    
    <category term="js" scheme="https://changqingaas.github.io/categories/js/"/>
    
    
  </entry>
  
  <entry>
    <title>How-to-be-a-good-programmer</title>
    <link href="https://changqingaas.github.io/%E7%A2%8E%E7%A2%8E%E5%BF%B5/Others/To-be-a-good-programmer/"/>
    <id>https://changqingaas.github.io/%E7%A2%8E%E7%A2%8E%E5%BF%B5/Others/To-be-a-good-programmer/</id>
    <published>2021-08-29T12:30:16.000Z</published>
    <updated>2022-01-17T01:18:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实例驱动学习"><a href="#实例驱动学习" class="headerlink" title="实例驱动学习"></a>实例驱动学习</h2><p>在知识爆炸的年代, 想成为一个好的程序员, 要具备这样一个精神:</p><p><strong>开发者精神</strong></p><blockquote><p>开发者精神是指, 从学习编程第一天起, 你的目标, 你所做的事, 永远不是以<code>要学会XX</code>为目标, 而是以<code>开发出XX</code>为目标, 深刻意识到你学习的一切, 最终是为了你的开发而服务的。</p></blockquote><p>而开发者精神的反面则是<code>学生气</code>:</p><p><strong>学生气</strong></p><blockquote><p>从学习编程的第一天起, 就把自己当学生, 上课听讲记笔记为第一位, 记忆知识点为第一位, 买教材读教材为第一位, 追求<code>学会XX</code>, 而不是<code>用它开发出XX</code>。</p></blockquote><p>我们举个例子， 假如你要学习Java，<code>学生气</code>的学生行为模式:</p><pre><code>读教材, 听课, 记笔记, 追求把这个语言的每个知识点都记得很清楚, 追求一种&quot;内功&quot;的修炼, 在这个过程中, 从来不想着用它去&quot;创造&quot;什么. 在学习的第一天起, 他给自己定下了一个目标:&quot;我这个学期一定要把这个语言的基础打牢, 最后在考试中取得高分, 并且为以后的学习提供更坚实的基础.&quot;</code></pre><p>那么具有<code>开发者精神</code>的人会这样做:</p><pre><code>先大体了解一下Java语言在哪些领域比较强势, 做一个简单的调研, 得出了Java在Web领域很强势这一个信号, 于是在学习Java的第一天起, 他就给自己定下了一个目标: &quot;我要在半年内通过学习Java, 运用Java做出一个中小型的, 基于Web的企业管理后台&quot;</code></pre><p>这两种人, 起点都一样, 都是<code>完全不会Java</code>, 但是最后的结果往往是, 后者无论是知识熟练度还是实用性都会超过前者, 而且整个学习过程会有源源不断地动力.</p><p><code>夯实基础</code>这个目标, 其实是空洞的, 什么叫做夯实? 什么叫做基础? 而且就算你真的夯实了基础, 你也极有可能陷入一种<code>虚无感</code>中, 因为你的所有知识, 都会遗忘.</p><p>这就是为什么很多计算机专业学生很爱问的一个问题:</p><pre><code>&quot;学了这么多知识, 忘了怎么办?&quot;</code></pre><p>如果你具备<code>开发者精神</code>, 那么你根本不会理会这个问题, 因为, 你开发出的东西, 你做出的产品, 它就是永久存在在这个世界上的, 你的成就感来源于真实的, 具体的, 可持久延续的项目中, 而不是来源于”我学会了什么”.</p><p>我们一定要明白:</p><pre><code>一切不谈成就感, 不谈反馈的学习劝导, 都是在耍流氓</code></pre><p>既然我们想获得反馈, 那么一个很现实的建议就是, 在Github上创建你的第一个开源代码仓库, 长期地, 稳定地commit, 当然, 至于这个仓库到底是干啥的, 这个因人而异, 有可能是你自己开发的一个VScode插件, 有可能是你自己写的读书笔记, 在这个不断地commit的过程中, 感受你的代码仓库不断增长不断完善的过程中, 你会获得一个比较持久的反馈和成就感, 一旦有了反馈和成就感, 那么你的学习动力就会一直保持, 也可以从学习中获得快乐.</p><p><strong>记住, 你不是学生, 你是开发者.</strong></p><h2 id="知识输入与输出"><a href="#知识输入与输出" class="headerlink" title="知识输入与输出"></a>知识输入与输出</h2><p>当你学习一个东西的时候, 如果学完马上用语言讲给别人听, 你会学的更好, 而且会发现新问题.</p><p>很多学习理论都指出, 知识的学习, 输入固然重要, 输出更为重要.</p><p>输入就是学习别人的知识, 输出就是把自己学会的知识用文字, 语言的形式表达出来, 很多人的学习, 只有输入, 没有输出, 这样的学习肯定是不行的.</p><p>几乎所有优秀的程序员, 都有撰写技术文章的习惯, 很多时候, 并不是他们什么都懂, 而是他们刚学会了什么, 然后就围绕着这个刚学会的东西, 用自己的语言讲出来, 久而久之, 就会被别人觉得是大牛, 但是他和你的区别, 有可能仅仅是是否输出的区别.</p><p>建议所有计算机学习者, 都要有写技术文章/读书笔记的习惯, 可以发表在自己的个人主页, 其他平台上, 攥写技术文章也可以很好地增加面试官对你的好感.</p><p>写技术文章的时候, 最好用<code>MarkDown</code>哦, 程序员是不需要用<code>Word</code>这种东西的, 我们的内容是要方便发表在网站上, <code>Word</code>不能直接在网站里显示, 而<code>MarkDown</code>可以轻易地转换成<code>html</code>格式文件, 在浏览器中显示.</p><h2 id="代码风格篇"><a href="#代码风格篇" class="headerlink" title="代码风格篇"></a>代码风格篇</h2><p>现在几乎所有主流语言都有相应的代码风格检查工具, 一般已IDE或Editor的插件或扩展形式给出</p><h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><p>设计模式并不是针对任何一种语言, 而是一种用编程语言描述现实世界问题广泛采用的各种模式, 比如, 观察者模式, 工厂模式, 依赖注入模式等.</p><p>好的设计模式, 是好代码的保证, 只有先学会了设计模式, 才能在软件设计中游刃有余, 而且更现实的问题是, 现在很多框架, 比如Spring, Angular等, 都充斥了大量的设计模式, 比如<code>Factory Pattern</code>, <code>Dependency Injection Pattern</code>, 你必须理解这些设计模式, 你才能理解这个框架.</p><p>个人认为设计模式没有必要买本教材, 结合视频和技术文章, 就足以理解和运用.</p><h3 id="小习惯"><a href="#小习惯" class="headerlink" title="小习惯"></a>小习惯</h3><ol><li>不要嫌变量名长, 最好可以直接通过变量名推测变量的作用.</li><li>重复出现的代码, 封装成独立的类或函数.</li><li>提前降低代码的耦合度, 不同作用, 不同类别的代码, 不要混在一起, 最好分成独立的文件</li><li>将代码进行业务分层, 比如在Web开发中, 有数据层, 服务层, DTO层, Controller层, 渲染层等, 只有将层次分开了, 才能获得足够的可拓展性, 不然代码多了你就全乱了.</li><li>用良好的设计模式去”设计”软件, 在执行一些算法的时候, 可以想一想它的时空复杂度, 想一想怎么可以让它执行地更快.</li></ol><h2 id="如何管理自己的电脑"><a href="#如何管理自己的电脑" class="headerlink" title="如何管理自己的电脑"></a>如何管理自己的电脑</h2><h3 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h3><p>为了更好的管理我们的各种应用包，最好使用包管理工具来进行各种包，软件的安装和使用, 方便进行卸载, 更新, 安装, 无需打开浏览器即可完成一系列操作.</p><blockquote><p>linux : apt-get (ubuntu distro)<br>    osx : brew<br>    windows: Chocolatey</p></blockquote><p>另外, windows平台上的包管理工具, 在国内的网络环境下经常慢的感人, 所以<code>Chocolatey</code>可能使用体验并不好.  推荐使用今年微软新发布的 <code>WSL2</code>, 这个东西不是那种传统的虚拟机, 有了它你可以像操作linux系统那样操作windows系统, 而且支持 <code>docker</code>, 甚至我推荐以后大家所有命令都可以在<code>WSL2</code>里执行.</p><h3 id="容器-Docker"><a href="#容器-Docker" class="headerlink" title="容器 - Docker"></a>容器 - Docker</h3><p>为了更方便的进行开发环境配置，我推荐所有计算机学生尽早了解和使用Docker。</p><p>Docker 就是为了解决复杂的环境配置问题而生的。</p><p>它将你的软件和软件所依赖的所有环境打包成一个镜像(Image), 该镜像可以在任何一台装有docker 的电脑上运行, 和操作系统无关, 也就是docker 把运行环境和你的操作系统隔离开来了，中间隔了一层docker engine 。</p><p>写过不少代码的你一定见过这种现象：你的代码在自己电脑上能运行，但是在别人电脑上就会报错，无法运行，原因很简单，任何软件的运行都需要环境。</p><p>比如，jar包的运行需要jre ，python脚本的运行需要python 解释器安装在电脑上，以后你可能还需要运行一些服务，比如数据库mysql server , redis , rabbitmq , 随着软件运行环境复杂度的增加, 你的软件运行条件也变得苛刻，如果你想把本地的应用部署到服务器上，那事更多，需要的环境得一个个地装到你的linux服务器上，如何彻底解决这个问题？</p><p>只需在你的电脑中安装docker , 你就可以毫无后顾之忧。</p><p>所有的环境，服务，软件都是以Image 的形式打包的，Image 中包含了运行你软件的所有东西，比如你的软件是个python 脚本, 并且使用了第三方库flask，那这个Image 中就包含了python ,也就是它的base image , 也同时包含了flask, 这样的话任何一个装有docker的电脑都可以运行你的image。</p>]]></content>
    
    
    <summary type="html">记住, 你不是学生, 你是开发者.</summary>
    
    
    
    <category term="碎碎念" scheme="https://changqingaas.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="Advice" scheme="https://changqingaas.github.io/tags/Advice/"/>
    
  </entry>
  
  <entry>
    <title>Python爬虫</title>
    <link href="https://changqingaas.github.io/%E7%88%AC%E8%99%AB/Python/Python%E7%88%AC%E8%99%AB/"/>
    <id>https://changqingaas.github.io/%E7%88%AC%E8%99%AB/Python/Python%E7%88%AC%E8%99%AB/</id>
    <published>2021-08-27T06:25:32.000Z</published>
    <updated>2022-02-04T05:46:46.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="爬虫概念"><a href="#爬虫概念" class="headerlink" title="爬虫概念"></a>爬虫概念</h1><h2 id="1-robots协议"><a href="#1-robots协议" class="headerlink" title="1.robots协议"></a>1.robots协议</h2><p>也叫robots.txt，是存放在网站根目录下的文本文件，用来告诉搜索引擎该网站哪些内容是不应该被抓取的，哪些是可以抓取的。</p><p>如<a href="https://www.csdn.net/robots.txt">https://www.csdn.net/robots.txt</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">User-agent: *Disallow: &#x2F;scriptsDisallow: &#x2F;publicDisallow: &#x2F;css&#x2F;Disallow: &#x2F;images&#x2F;Disallow: &#x2F;content&#x2F;Disallow: &#x2F;ui&#x2F;Disallow: &#x2F;js&#x2F;Disallow: &#x2F;scripts&#x2F;Disallow: &#x2F;article_preview.html*Disallow: &#x2F;tag&#x2F;Disallow: &#x2F;*?*Disallow: &#x2F;link&#x2F;Sitemap: https:&#x2F;&#x2F;www.csdn.net&#x2F;sitemap-aggpage-index.xmlSitemap: https:&#x2F;&#x2F;www.csdn.net&#x2F;article&#x2F;sitemap.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-常见的反爬虫措施"><a href="#2-常见的反爬虫措施" class="headerlink" title="2.常见的反爬虫措施"></a>2.常见的反爬虫措施</h2><h4 id="1-请求头校验"><a href="#1-请求头校验" class="headerlink" title="1.请求头校验"></a>1.请求头校验</h4><p>一般网站会对请求头进行校验，比如Host，UA，Content-Type字段等，模拟请求的时候，这些常见的请求头最好是带上。</p><h4 id="2-IP访问次数控制"><a href="#2-IP访问次数控制" class="headerlink" title="2.IP访问次数控制"></a>2.IP访问次数控制</h4><p>同一个IP地址短时间内大量发起请求，会引起IP限制，解决方法是用代理IP，或者构建自己的代理IP池。</p><h4 id="3-接口请求频率限制"><a href="#3-接口请求频率限制" class="headerlink" title="3.接口请求频率限制"></a>3.接口请求频率限制</h4><p>有的网站会控制接口访问的频率，比如有些查询接口，控制两三秒访问一次。</p><h4 id="4-接口访问次数限制"><a href="#4-接口访问次数限制" class="headerlink" title="4.接口访问次数限制"></a>4.接口访问次数限制</h4><p>每天限制某个IP或账号访问接口的次数，达到上限后出现二次验证或者直接封账号/IP.比如登录接口</p><h4 id="5-行为认证"><a href="#5-行为认证" class="headerlink" title="5.行为认证"></a>5.行为认证</h4><p>请求次数过多会出现人工认证，如图片验证码，滑动认证，点击认证等，可以对接打码平台。</p><h4 id="6，自动化环境检测"><a href="#6，自动化环境检测" class="headerlink" title="6，自动化环境检测"></a>6，自动化环境检测</h4><p>selenium自动化工具有的网站会检测出来，大部分可以通过下面两种方式跳过检测,下面两种方式无法处理的话，还可以尝试把页面改为移动端页面(手机模式)，最后还有一种方法就是代理服务器拦截修改js代码，把检测selenium的js修改掉。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">options &#x3D; webdriver.ChromeOptions()# 躲避部分网站selenium检测options.add_experimental_option(&#39;excludeSwitches&#39;, [&#39;enable-automation&#39;])options.add_experimental_option(&quot;useAutomationExtension&quot;, False)driver &#x3D; webdriver.Chrome(executable_path&#x3D;chromedriver_path, options&#x3D;options)# 躲避部分网站selenium检测script &#x3D; &quot;Object.defineProperty(navigator, &#39;webdriver&#39;, &#123;get: () &#x3D;&gt; undefined&#125;);&quot;driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;&quot;source&quot;: script&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于移动端appium的检测，可以尝试替换为uiautomator2实现自动化</p><h4 id="7-数据动态加载"><a href="#7-数据动态加载" class="headerlink" title="7.数据动态加载"></a>7.数据动态加载</h4><p>有的数据不是通过html页面的接口请求返回的，抓包分析请求，找到正确的数据接口。</p><h4 id="8-请求参数加密"><a href="#8-请求参数加密" class="headerlink" title="8.请求参数加密"></a>8.请求参数加密</h4><p>网易云音乐的post请求的请求体就是前端经过js加密后计算得到的，需要逆向js代码</p><h4 id="9-返回数据加密"><a href="#9-返回数据加密" class="headerlink" title="9.返回数据加密"></a>9.返回数据加密</h4><p>需要逆向js代码，分析如何解密。还有一种像大众点评的评论，需要通过定位去找到文本。</p><h4 id="10-动态更新cookies"><a href="#10-动态更新cookies" class="headerlink" title="10.动态更新cookies"></a>10.动态更新cookies</h4><p>华为手机云服务，每次请求接口都会重新设置cookies，并且请求头参数也需要跟着cookies一起变化</p><h1 id="Python爬虫之requests库"><a href="#Python爬虫之requests库" class="headerlink" title="Python爬虫之requests库"></a>Python爬虫之requests库</h1><h2 id="一-发送请求"><a href="#一-发送请求" class="headerlink" title="一.发送请求"></a>一.发送请求</h2><p>requests提供了http的所有基本请求方式：<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsr &#x3D; requests.post(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;post&quot;)r &#x3D; requests.put(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;put&quot;)r &#x3D; requests.delete(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;delete&quot;)r &#x3D; requests.head(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;get&quot;)r &#x3D; requests.options(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;get&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>基本get请求中参数的传递：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"># requests允许使用params关键字参数，以字典的形式来提供get请求url中的参数。payload &#x3D; &#123;&#39;key1&#39;: &#39;value1&#39;, &#39;key2&#39;: &#39;value2&#39;&#125;r &#x3D; requests.get(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;get&quot;, params&#x3D;payload)print(r.url)  # http:&#x2F;&#x2F;httpbin.org&#x2F;get?key2&#x3D;value2&amp;key1&#x3D;value1# 字典中的value还可以以列表的形式传入payload &#x3D; &#123;&#39;key1&#39;: &#39;value1&#39;, &#39;key2&#39;: [&#39;value2&#39;, &#39;value3&#39;]&#125;r &#x3D; requests.get(&#39;http:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;, params&#x3D;payload)print(r.url)http:&#x2F;&#x2F;httpbin.org&#x2F;get?key1&#x3D;value1&amp;key2&#x3D;value2&amp;key2&#x3D;value3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加请求头headers<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">url &#x3D; &#39;https:&#x2F;&#x2F;api.github.com&#x2F;some&#x2F;endpoint&#39;headers &#x3D; &#123;&#39;user-agent&#39;: &#39;my-app&#x2F;0.0.1&#39;&#125;r &#x3D; requests.get(url, headers&#x3D;headers)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>Post请求<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">payload &#x3D; &#123;&#39;key1&#39;: &#39;value1&#39;, &#39;key2&#39;: &#39;value2&#39;&#125;r &#x3D; requests.post(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;post&quot;, data&#x3D;payload)print(r.text)# 可以为 data 参数传入一个元组列表# 在表单中多个元素使用同一 key 的时候，这种方式尤其有效：payload &#x3D; ((&#39;key1&#39;, &#39;value1&#39;), (&#39;key1&#39;, &#39;value2&#39;))r &#x3D; requests.post(&#39;http:&#x2F;&#x2F;httpbin.org&#x2F;post&#39;, data&#x3D;payload)print(r.text)&#123;  ...  &quot;form&quot;: &#123;    &quot;key1&quot;: [      &quot;value1&quot;,      &quot;value2&quot;    ]  &#125;,  ...&#125;# post的为json对象url &#x3D; &#39;https:&#x2F;&#x2F;api.github.com&#x2F;some&#x2F;endpoint&#39;payload &#x3D; &#123;&#39;some&#39;: &#39;data&#39;&#125;r &#x3D; requests.post(url, json&#x3D;payload)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>超时设置：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">requests.get(&#39;http:&#x2F;&#x2F;github.com&#39;, timeout&#x3D;0.001)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二-响应内容"><a href="#二-响应内容" class="headerlink" title="二.响应内容"></a>二.响应内容</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsr &#x3D; requests.get(&#39;https:&#x2F;&#x2F;github.com&#x2F;timeline.json&#39;)r.encoding&#x3D;&#39;utf-8&#39;r.text# [&#123;&quot;repository&quot;:&#123;&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https:&#x2F;&#x2F;github.com&#x2F;...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>网页乱码问题:<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 查看网页编码print(res.apparent_encoding)# 设置编码res.encoding &#x3D; &#39;GB2312&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>二进制响应内容(r.content)<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">from PIL import Imagefrom io import BytesIO#BytesIO用于操作内存中的二进制数据img&#x3D;Image.open(BytesIO(r.content))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>JSON响应内容（r.json()）<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsr &#x3D; requests.get(&#39;https:&#x2F;&#x2F;github.com&#x2F;timeline.json&#39;)r.json()# [&#123;u&#39;repository&#39;: &#123;u&#39;open_issues&#39;: 0, u&#39;url&#39;: &#39;https:&#x2F;&#x2F;github.com&#x2F;...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>响应状态码（r.status_code）<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">r &#x3D; requests.get(&#39;http:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;)r.status_code200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>响应头(r.headers)<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">r.headers&#123;    &#39;content-encoding&#39;: &#39;gzip&#39;,    &#39;transfer-encoding&#39;: &#39;chunked&#39;,    &#39;connection&#39;: &#39;close&#39;,    &#39;server&#39;: &#39;nginx&#x2F;1.0.4&#39;,    &#39;x-runtime&#39;: &#39;148ms&#39;,    &#39;etag&#39;: &#39;&quot;e1ca502697e5c9317743dc078f67693f&quot;&#39;,    &#39;content-type&#39;: &#39;application&#x2F;json&#39;&#125;r.headers[&#39;Content-Type&#39;]&#39;application&#x2F;json&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="三-Cookies"><a href="#三-Cookies" class="headerlink" title="三.Cookies"></a>三.Cookies</h2><p>如果某个响应中包含一些 cookie，你可以快速访问它们：<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">url &#x3D; &#39;http:&#x2F;&#x2F;example.com&#x2F;some&#x2F;cookie&#x2F;setting&#x2F;url&#39;r &#x3D; requests.get(url)r.cookies[&#39;example_cookie_name&#39;]# &#39;example_cookie_value&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>要想发送你的cookies到服务器，可以使用 cookies 参数：<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">url &#x3D; &#39;http:&#x2F;&#x2F;httpbin.org&#x2F;cookies&#39;cookies &#x3D; dict(cookies_are&#x3D;&#39;working&#39;)r &#x3D; requests.get(url, cookies&#x3D;cookies)r.text# &#39;&#123;&quot;cookies&quot;: &#123;&quot;cookies_are&quot;: &quot;working&quot;&#125;&#125;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="四-会话"><a href="#四-会话" class="headerlink" title="四.会话"></a>四.会话</h2><p>requests.Session()这样可以在会话中保留状态，保持cookie等<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestss &#x3D; requests.Session()s.headers.update(&#123;&#39;x-test&#39;: &#39;true&#39;&#125;)r &#x3D; s.get(&#39;http:&#x2F;&#x2F;httpbin.org&#x2F;headers&#39;, headers&#x3D;&#123;&#39;x-test2&#39;: &#39;true&#39;&#125;)print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="五-代理"><a href="#五-代理" class="headerlink" title="五.代理"></a>五.代理</h2><p>如果需要使用代理，你可以通过为任意请求方法提供 proxies 参数来配置单个请求<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"># http代理import requestsproxies &#x3D; &#123;  &quot;https&quot;: &quot;http:&#x2F;&#x2F;41.118.132.69:4433&quot;&#125;r &#x3D; requests.post(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;post&quot;, proxies&#x3D;proxies)# socks代理proxies &#x3D; &#123;    &#39;http&#39;: &#39;socks5:&#x2F;&#x2F;user:pass@host:port&#39;,    &#39;https&#39;: &#39;socks5:&#x2F;&#x2F;user:pass@host:port&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="六-Prepared-Request"><a href="#六-Prepared-Request" class="headerlink" title="六.Prepared Request"></a>六.Prepared Request</h2><p>构造requests.Request对象，将Request对象作为参数传入requests.Session()对象的prepare_request()方法中，最后通过Session对象的send()方法发送请求。<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsfrom requests import Requesturl &#x3D; &#39;http:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;# 创建Session对象s &#x3D; requests.Session()# 构造Request对象req &#x3D; Request(&#39;GET&#39;,url)# 将Request对象转换成 PreparedRequest对象prepped &#x3D; s.prepare_request(req)# 利用Session对象的send()方法，发送PreparedRequest对象res &#x3D; s.send(prepped)print(res.text)print(type(prepped))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Python爬虫之BeautifulSoup"><a href="#Python爬虫之BeautifulSoup" class="headerlink" title="Python爬虫之BeautifulSoup"></a>Python爬虫之BeautifulSoup</h1><h4 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">html_doc &#x3D; &quot;&quot;&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;p class&#x3D;&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;&lt;p class&#x3D;&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;elsie&quot; class&#x3D;&quot;sister&quot; id&#x3D;&quot;link1&quot;&gt;Elsie&lt;&#x2F;a&gt;,&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;lacie&quot; class&#x3D;&quot;sister&quot; id&#x3D;&quot;link2&quot;&gt;Lacie&lt;&#x2F;a&gt; and&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;tillie&quot; class&#x3D;&quot;sister bro&quot; id&#x3D;&quot;link3&quot;&gt;Tillie&lt;&#x2F;a&gt;;and they lived at the bottom of a well.&lt;&#x2F;p&gt;&lt;p class&#x3D;&quot;story&quot;&gt;...&lt;&#x2F;p&gt;&quot;&quot;&quot;soup &#x3D; BeautifulSoup(html_doc, &#39;html.parser&#39;)print(soup.prettify())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="find-all-name-attrs-recursive-string-kwargs"><a href="#find-all-name-attrs-recursive-string-kwargs" class="headerlink" title="find_all(name , attrs , recursive , string , **kwargs)"></a>find_all(name , attrs , recursive , string , **kwargs)</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 查找所有的a标签res &#x3D; soup.find_all(&#39;a&#39;)# # 查找所有的a标签和p标签res &#x3D; soup.find_all([&#39;a&#39;, &#39;p&#39;])# 查找class&#x3D;title的p标签res &#x3D; soup.find_all(&#39;p&#39;, &#39;title&#39;)# 指定属性查找  可支持字符串，正则表达式，或者函数# 指定id查找元素res &#x3D; soup.find_all(id&#x3D;&quot;link1&quot;)# 指定href查找 [&lt;a class&#x3D;&quot;sister&quot; href&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;elsie&quot; id&#x3D;&quot;link1&quot;&gt;Elsie&lt;&#x2F;a&gt;]res &#x3D; soup.find_all(href&#x3D;re.compile(&#39;elsie&#39;))# 指定多个属性查找res &#x3D; soup.find_all(id&#x3D;&#39;link1&#39;, href&#x3D;re.compile(&#39;elsie&#39;))# 指定多个属性查找 attrs参数res &#x3D; soup.find_all(attrs&#x3D;&#123;&#39;id&#39;: &#39;link1&#39;, &#39;href&#39;: re.compile(&#39;elsie&#39;)&#125;)# 通过css搜索res &#x3D; soup.find_all(class_&#x3D;&quot;sister bro&quot;)# 通过函数过滤,查找类名长度大于6的元素res &#x3D; soup.find_all(class_&#x3D;lambda x: x is not None and len(x) &gt; 6)# recursive参数，如果只想搜索直接子节点  recursive&#x3D;Falseres &#x3D; soup.find_all(&#39;title&#39;, recursive&#x3D;False)# find_all() 方法的返回结果是值包含一个元素的列表# 而find()方法直接返回第一个结果，没有则返回None.res &#x3D; soup.find(&#39;a&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 类查找res &#x3D; soup.select(&#39;.sister&#39;)# ID查找res &#x3D; soup.select(&#39;#link1&#39;)res &#x3D; soup.select(&#39;a#link1&#39;)# 通过是否存在某个属性查找res &#x3D; soup.select(&#39;a[href]&#39;)# 指定属性值查找res &#x3D; soup.select(&#39;a[href&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;tillie&quot;]&#39;)# 查找返回第一个元素res &#x3D; soup.select_one(&#39;a[href]&#39;)# 获取元素的属性值res &#x3D; soup.select_one(&#39;a[href]&#39;).get(&#39;href&#39;)# 获取元素的文本res &#x3D; soup.select_one(&#39;a[href]&#39;).text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Selenium自动化"><a href="#Selenium自动化" class="headerlink" title="Selenium自动化"></a>Selenium自动化</h1><h2 id="1-基础操作"><a href="#1-基础操作" class="headerlink" title="1.基础操作"></a>1.基础操作</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">from selenium import webdriverimport timefrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECfrom selenium.webdriver.common.by import Byif __name__ &#x3D;&#x3D; &#39;__main__&#39;:    # 谷歌浏览器驱动    chromedriver_path &#x3D; &#39;chromedriver72.exe&#39;    options &#x3D; webdriver.ChromeOptions()    # 躲避部分网站selenium检测    options.add_experimental_option(&#39;excludeSwitches&#39;, [&#39;enable-automation&#39;])    options.add_experimental_option(&quot;useAutomationExtension&quot;, False)    driver &#x3D; webdriver.Chrome(executable_path&#x3D;chromedriver_path, options&#x3D;options)    # 躲避部分网站selenium检测    script &#x3D; &quot;Object.defineProperty(navigator, &#39;webdriver&#39;, &#123;get: () &#x3D;&gt; undefined&#125;);&quot;    driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;&quot;source&quot;: script&#125;)    # 浏览器最大化    driver.maximize_window()    url &#x3D; &#39;https:&#x2F;&#x2F;www.python.org&#x2F;&#39;    driver.get(url)    # 显式等待    wait &#x3D; WebDriverWait(driver, 20, 1)    # 在主页输入框搜索requests，并点击搜索    input_ &#x3D; wait.until(EC.presence_of_element_located((By.ID, &#39;id-search-field&#39;)))    input_.send_keys(&#39;requests&#39;)    time.sleep(1)    btn &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;button[@title&#x3D;&quot;Submit this Search&quot;]&#39;)    btn.click()    time.sleep(10)    driver.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-元素定位"><a href="#2-元素定位" class="headerlink" title="2.元素定位"></a>2.元素定位</h2><h4 id="查找单个元素"><a href="#查找单个元素" class="headerlink" title="查找单个元素"></a>查找单个元素</h4><p>最常用的定位元素的两个方法是通过Xpath和id来定位。</p><ul><li>find_element_by_id</li><li>find_element_by_xpath</li></ul><h4 id="查找多个元素"><a href="#查找多个元素" class="headerlink" title="查找多个元素"></a>查找多个元素</h4><ul><li>find_elements_by_xpath</li><li>find_elements_by_name</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 通过xpath查找元素driver.find_element_by_xpath(&#39;&#x2F;&#x2F;button[@title&#x3D;&quot;Submit this Search&quot;]&#39;)# 通过id查找元素driver.find_element_by_id(&#39;id-search-field&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="获取元素内部内容"><a href="#获取元素内部内容" class="headerlink" title="获取元素内部内容"></a>获取元素内部内容</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">text &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;ISDCaptcha&quot;]&#x2F;div[2]&#x2F;div&#39;).get_attribute(&#39;innerHTML&#39;)if &#39;请绘制图中手势&#39; in text:    print(&#39;出现行为认证&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="获取元素指定属性的属性值"><a href="#获取元素指定属性的属性值" class="headerlink" title="获取元素指定属性的属性值"></a>获取元素指定属性的属性值</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">driver.find_element_by_xpath(&#39;&#x2F;&#x2F;div[@id&#x3D;&quot;find-step3-phone&quot;]&#39;).get_attribute(&#39;style&#39;)driver.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;imgVerifyCodeP&quot;]&#39;).get_attribute(&#39;src&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="切换到指定iframe"><a href="#切换到指定iframe" class="headerlink" title="切换到指定iframe"></a>切换到指定iframe</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 通过id或者名称driver.switch_to.frame(&quot;iframeLoginIfm&quot;)driver.switch_to.frame(0)frame &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;div[@id&#x3D;&quot;loginDiv&quot;]&#x2F;iframe&#39;)driver.switch_to.frame(frame)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="切换到指定窗口"><a href="#切换到指定窗口" class="headerlink" title="切换到指定窗口"></a>切换到指定窗口</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">driver.switch_to.window(browser.window_handles[1])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="切换到alert弹窗"><a href="#切换到alert弹窗" class="headerlink" title="切换到alert弹窗"></a>切换到alert弹窗</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">text &#x3D; driver.switch_to.alert.textif &#39;图片验证码输入错误&#39; in text:    print(&#39;图片验证码识别错误&#39;)    driver.switch_to.alert.accept()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-元素交互"><a href="#3-元素交互" class="headerlink" title="3.元素交互"></a>3.元素交互</h2><h4 id="按钮点击"><a href="#按钮点击" class="headerlink" title="按钮点击"></a>按钮点击</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">btn &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;div[@role&#x3D;&quot;button&quot;]&#x2F;div&#x2F;span&#x2F;span&#39;)btn.click()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="执行js代码"><a href="#执行js代码" class="headerlink" title="执行js代码"></a>执行js代码</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">style_ &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;passport-login-pop&quot;]&#39;).get_attribute(&#39;style&#39;)style_ &#x3D; style_.replace(&#39;display: none;&#39;, &#39;&#39;)if not style_:    style_ &#x3D; &#39;left: 259px; top: 212px; z-index: 60001;&#39;js &#x3D; &#39;document.getElementById(&quot;passport-login-pop&quot;).setAttribute(&quot;style&quot;,&quot;&#123;&#125;&quot;);&#39;.format(style_)driver.execute_script(js)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="表单输入"><a href="#表单输入" class="headerlink" title="表单输入"></a>表单输入</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">input_ &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;input[@name&#x3D;&quot;session[password]&quot; and @dir&#x3D;&quot;auto&quot;]&#39;)input_.send_keys(&#39;123qwe&#39;)from selenium.webdriver.common.keys import Keysinput_.send_keys(Keys.BACK_SPACE)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="页面滚动"><a href="#页面滚动" class="headerlink" title="页面滚动"></a>页面滚动</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">driver.execute_script(&quot;&quot;&quot;                (function () &#123;                    var y &#x3D; document.body.scrollTop;                    var step &#x3D; 100;                    window.scroll(0, y);                    function f() &#123;                        if (y &lt; document.body.scrollHeight) &#123;                            y +&#x3D; step;                            window.scroll(0, y);                            setTimeout(f, 50);                        &#125;                        else &#123;                            window.scroll(0, y);                            document.title +&#x3D; &quot;scroll-done&quot;;                        &#125;                    &#125;                    setTimeout(f, 1000);                &#125;)();                &quot;&quot;&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="模拟拖动"><a href="#模拟拖动" class="headerlink" title="模拟拖动"></a>模拟拖动</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">from selenium.webdriver.common.action_chains import ActionChainsdef get_track(self, distance):    track &#x3D; []    current &#x3D; 0    mid &#x3D; distance * 3 &#x2F; 4    t &#x3D; 0.2    v &#x3D; 0    while current &lt; distance:        if current &lt; mid:            a &#x3D; 2        else:            a &#x3D; -3        v0 &#x3D; v        v &#x3D; v0 + a * t        move &#x3D; v0 * t + 1 &#x2F; 2 * a * t * t        current +&#x3D; move        track.append(round(move))    return track# 模拟拖动btn &#x3D; wait.until(EC.presence_of_element_located((By.XPATH, xpath_)))track &#x3D; get_track(500)action &#x3D; ActionChains(browser)action.click_and_hold(btn).perform()action.reset_actions()for i in track:    action.move_by_offset(xoffset&#x3D;i, yoffset&#x3D;0).perform()    action.reset_actions()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-等待"><a href="#4-等待" class="headerlink" title="4.等待"></a>4.等待</h2><h4 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"># 显式等待wait &#x3D; WebDriverWait(driver, 20, 1)input_ &#x3D; wait.until(EC.presence_of_element_located((By.ID, &#39;id-search-field&#39;)))input_.send_keys(&#39;requests&#39;)time.sleep(1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">from selenium import webdriverdriver &#x3D; webdriver.Chrome()# 隐式等待driver.implicitly_wait(10)driver.get(&#39;https:&#x2F;&#x2F;www.zhihu.com&#x2F;explore&#39;)logo &#x3D; driver.find_element_by_id(&#39;zh-top-link-logo&#39;)print(logo)driver.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-其他操作"><a href="#5-其他操作" class="headerlink" title="5.其他操作"></a>5.其他操作</h2><h4 id="解决页面加载时间过长问题"><a href="#解决页面加载时间过长问题" class="headerlink" title="解决页面加载时间过长问题"></a>解决页面加载时间过长问题</h4><p>有时候页面有些静态文件加载比较耗时，selenium可以不需要等待页面全部加载完全在去查找元素<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">options &#x3D; webdriver.ChromeOptions()# 解决页面加载阻塞问题options.set_capability(&#39;pageLoadStrategy&#39;, &#39;none&#39;)driver &#x3D; webdriver.Chrome(executable_path&#x3D;self.chromedriver_path, options&#x3D;options)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="添加请求头"><a href="#添加请求头" class="headerlink" title="添加请求头"></a>添加请求头</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">options.add_argument(&quot;user-agent&#x3D;&#123;&#125;&quot;.format(&#39;Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.100 Safari&#x2F;537.36&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="添加代理"><a href="#添加代理" class="headerlink" title="添加代理"></a>添加代理</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">socks5 &#x3D; &quot;socks5:&#x2F;&#x2F;&#123;&#125;:&#123;&#125;&quot;.format(socks5_proxy_ip, socks5_proxy_port)options.add_argument(&quot;--proxy-server&#x3D;&#123;&#125;&quot;.format(socks5))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="捕捉F12控制台中所有请求记录"><a href="#捕捉F12控制台中所有请求记录" class="headerlink" title="捕捉F12控制台中所有请求记录"></a>捕捉F12控制台中所有请求记录</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">from selenium.webdriver.common.desired_capabilities import DesiredCapabilitiesd &#x3D; DesiredCapabilities.CHROMEd[&#39;loggingPrefs&#39;] &#x3D; &#123;&#39;performance&#39;: &#39;ALL&#39;&#125;d[&#39;goog:chromeOptions&#39;] &#x3D; &#123;    &#39;perfLoggingPrefs&#39;: &#123;        &#39;enableNetwork&#39;: True,    &#125;,    &#39;w3c&#39;: False,&#125;options.add_experimental_option(&#39;perfLoggingPrefs&#39;, &#123;&#39;enableNetwork&#39;: True&#125;)options.add_experimental_option(&#39;w3c&#39;, False)driver &#x3D; webdriver.Chrome(executable_path&#x3D;self.chromedriver_path, options&#x3D;options, desired_capabilities&#x3D;d)# 保存loglog_list &#x3D; []for entry in driver.get_log(&#39;performance&#39;):    log_list.append(entry)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="屏幕截图-可以截取图片验证码加以识别"><a href="#屏幕截图-可以截取图片验证码加以识别" class="headerlink" title="屏幕截图,可以截取图片验证码加以识别"></a>屏幕截图,可以截取图片验证码加以识别</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">import win32conimport win32guiimport win32printfrom win32api import GetSystemMetricsfrom PIL import Imagedef get_real_resolution():    &quot;&quot;&quot;获取真实的分辨率&quot;&quot;&quot;    hDC &#x3D; win32gui.GetDC(0)    # 横向分辨率    w &#x3D; win32print.GetDeviceCaps(hDC, win32con.DESKTOPHORZRES)    # 纵向分辨率    h &#x3D; win32print.GetDeviceCaps(hDC, win32con.DESKTOPVERTRES)    return w, hdef get_screen_size():    &quot;&quot;&quot;获取缩放后的分辨率&quot;&quot;&quot;    w &#x3D; GetSystemMetrics(0)    h &#x3D; GetSystemMetrics(1)    return w, hreal_resolution &#x3D; get_real_resolution()screen_size &#x3D; get_screen_size()screen_scale_rate &#x3D; round(real_resolution[0] &#x2F; screen_size[0], 2)pic_name &#x3D; &#39;***.png&#39;driver.save_screenshot(pic_name)# 找到图片验证码元素element &#x3D; driver.find_element_by_xpath(xpath_)left &#x3D; element.location[&#39;x&#39;] * screen_scale_ratetop &#x3D; element.location[&#39;y&#39;] * screen_scale_rateright &#x3D; (element.location[&#39;x&#39;] + element.size[&#39;width&#39;]) * screen_scale_ratebottom &#x3D; (element.location[&#39;y&#39;] + element.size[&#39;height&#39;]) * screen_scale_rateim &#x3D; Image.open(pic_name)# 裁剪图片im &#x3D; im.crop((left, top, right, bottom))im.save(pic_name)# 把图片转成base64,利用打码平台接口识别with open(pic_name, &#39;rb&#39;) as f:    code_img_base64 &#x3D; base64.b64encode(f.read()).decode()os.remove(pic_name)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="xpath解析"><a href="#xpath解析" class="headerlink" title="xpath解析"></a>xpath解析</h1><ul><li>// :从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</li><li>/ : 匹配当前目录下的直接子节点。</li><li>.. : 匹配当前节点的父节点。</li><li>@：选取属性。</li><li>//* : 选取文档中所有元素</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">text &#x3D; &quot;&quot;&quot;            &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;            &lt;bookstore&gt;            &lt;book&gt;              &lt;title lang&#x3D;&quot;eng&quot;&gt;Harry Potter&lt;&#x2F;title&gt;              &lt;price&gt;29.99&lt;&#x2F;price&gt;            &lt;&#x2F;book&gt;            &lt;book&gt;              &lt;title lang&#x3D;&quot;cn&quot;&gt;Learning XML&lt;&#x2F;title&gt;              &lt;price&gt;39.95&lt;&#x2F;price&gt;              &lt;aa lang&#x3D;&quot;cn eng aa bb&quot; name&#x3D;&quot;cc&quot;&gt;Learning XML&lt;&#x2F;aa&gt;            &lt;&#x2F;book&gt;            &lt;&#x2F;bookstore&gt;&quot;&quot;&quot;from lxml import etreehtml &#x3D; etree.HTML(text)# print(etree.tostring(html).decode(&#39;utf-8&#39;))# 选取所有指定的节点res &#x3D; html.xpath(&#39;&#x2F;&#x2F;book&#39;)# 获取指定节点的所有直接子节点res &#x3D; html.xpath(&#39;&#x2F;&#x2F;book&#x2F;aa&#39;)# 获取指定节点的父节点res &#x3D; html.xpath(&quot;&#x2F;&#x2F;aa&#x2F;..&quot;)# 通过属性匹配选择节点res &#x3D; html.xpath(&#39;&#x2F;&#x2F;title[@lang&#x3D;&quot;cn&quot;]&#39;)# 获取文本值res &#x3D; html.xpath(&#39;&#x2F;&#x2F;title[@lang&#x3D;&quot;cn&quot;]&#x2F;text()&#39;)res &#x3D; html.xpath(&#39;&#x2F;&#x2F;price&#x2F;text()&#39;)# 获取属性值 [&#39;eng&#39;, &#39;cn&#39;]res &#x3D; html.xpath(&#39;&#x2F;&#x2F;title&#x2F;@lang&#39;)# 属性多值匹配res &#x3D; html.xpath(&#39;&#x2F;&#x2F;aa[contains(@lang,&quot;aa&quot;)]&#39;)# 对于属性值有多个的节点，不用contains函数的话，匹配到的是空[]res &#x3D; html.xpath(&#39;&#x2F;&#x2F;aa[@lang&#x3D;&quot;aa&quot;]&#39;)# 文本匹配res &#x3D; html.xpath(&#39;&#x2F;&#x2F;title[contains(text(), &quot;XML&quot;)]&#39;)# 运算符res &#x3D; html.xpath(&#39;&#x2F;&#x2F;aa[contains(@lang,&quot;aa&quot;) and @name&#x3D;&quot;cc&quot;]&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Python爬虫—代理池维护"><a href="#Python爬虫—代理池维护" class="headerlink" title="Python爬虫—代理池维护"></a>Python爬虫—代理池维护</h1><h2 id="大致思路"><a href="#大致思路" class="headerlink" title="大致思路"></a>大致思路</h2><ol><li>去代理网站上爬取大量代理IP，并将其存储在redis数据库。</li><li>定时获取redis中的所有代理IP，检测每一个代理IP是否可用。</li><li>通过flask，对外提供获取代理IP的接口，如果想要使用代理池中的代理IP，只需要访问我们提供的接口即可。<br><strong>现在网上免费代理IP网站越来越少，而且免费的代理质量非常不稳定，本文只是提供构建代理IP池的一种思路，实战的话还是要想办法获取优质的代理。</strong></li></ol><h2 id="代理池系统具体实现思路"><a href="#代理池系统具体实现思路" class="headerlink" title="代理池系统具体实现思路"></a>代理池系统具体实现思路</h2><p><img src="../pic/spiders/proxypool.png" alt=""></p><h2 id="代理池完整代码"><a href="#代理池完整代码" class="headerlink" title="代理池完整代码"></a><a href="agent_pool">代理池完整代码</a></h2><h4 id="agent-pool-py-整体流程"><a href="#agent-pool-py-整体流程" class="headerlink" title="agent_pool.py 整体流程"></a>agent_pool.py 整体流程</h4><p>存储模块：主要实现的功能是，去一些免费代理网站爬取大量的代理IP，并存储至redis数据库中。redis的Sorted Set结构是一个有序集合，我们会对每一个爬取到的代理IP<br>设置一个初始化的优先级10，Sorted Set也是通过这个优先级来进行排序的。&lt;/br&gt;</p><ul><li>Getter:爬取代理网站的免费代理IP，存入redis</li><li>Tester:从redis中取出代理，测试代理是否可用，并调整代理IP的优先级</li><li>Controller:启动Getter()与Tester()</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">from Crawler import Crawlerfrom RedisClient import RedisClientimport tracebackimport timeimport requestsimport multiprocessingfrom concurrent import futuresFULL_COUNT &#x3D; 2000class Getter(object):    # 爬取代理网站的免费代理IP，存入redis    def __init__(self):        self.redis_client &#x3D; RedisClient()        self.crawler &#x3D; Crawler()    def is_full(self):        # 判断代理池是否满了        return self.redis_client.get_proxy_count() &gt;&#x3D; FULL_COUNT    def run(self):        # 将爬取到的代理存入redis        if not self.is_full():            proxys &#x3D; self.crawler.get_crawler_proxy()            for proxy in proxys:                self.redis_client.add(proxy)class Tester(object):    # 从redis中取出代理，测试代理是否可用，并调整代理IP的优先级    def __init__(self, test_url):        self.redisdb &#x3D; RedisClient()        # 用来测试代理是否可用的地址        self.test_url &#x3D; test_url    def test_proxy(self, proxy):        try:            if isinstance(proxy, bytes):                proxy &#x3D; proxy.decode(&#39;utf-8&#39;)            proxies &#x3D; &#123;                &#39;http&#39;: &#39;http:&#x2F;&#x2F;&#39; + proxy,                &#39;https&#39;: &#39;https:&#x2F;&#x2F;&#39; + proxy            &#125;            print(&#39;正在检测:&#123;&#125;&#39;.format(proxy))            res &#x3D; requests.get(self.test_url, proxies&#x3D;proxies, timeout&#x3D;10)            if res.status_code &#x3D;&#x3D; 200:                return True, proxy            else:                return False, proxy                # 代理不可用，就降低其优先级        except Exception as e:            return False, proxy            # print(&#39;代理检测异常:&#123;&#125;  &#123;&#125;&#39;.format(proxy, e))            self.redisdb.decrease(proxy)            print(&#39;代理不可用:&#123;&#125;&#39;.format(proxy))    def run(self):        print(&#39;启动检测模块......&#39;)        try:            # 获取redis中所有爬取到的代理            proxies &#x3D; self.redisdb.get_all_proxy()            for i in range(0, len(proxies), 50):                test_proxies &#x3D; proxies[i:i+50]                workers &#x3D; len(test_proxies)                with futures.ThreadPoolExecutor(workers) as executor:                    tasks_res &#x3D; executor.map(self.test_proxy, test_proxies)                    for res, proxy in tasks_res:                        if not res:                            # 代理不可用，就降低其优先级                            self.redisdb.decrease(proxy)                            print(&#39;代理不可用:&#123;&#125;&#39;.format(proxy))                        else:                            # 代理可用,将其优先级置为最大                            self.redisdb.max(proxy)                            print(&#39;代理可用:&#123;&#125;&#39;.format(proxy))        except Exception as e:            print(traceback.format_exc())            print(&#39;检测模块出错！！！&#39;)class Controller(object):    def control_get(self):        # 获取功能：爬取代理网站，将代理存储到redis        getter &#x3D; Getter()        while True:            try:                getter.run()            except:                print(traceback.format_exc())            time.sleep(30)    def control_test(self):        # 检测功能，检测redis中的代理是否可用        tester &#x3D; Tester(test_url&#x3D;&#39;http:&#x2F;&#x2F;www.baidu.com&#39;)        while True:            try:                tester.run()            except:                print(traceback.format_exc())            time.sleep(30)    def run(self):        print(&#39;代理池开始运行了......&#39;)        # 两个进程        get &#x3D; multiprocessing.Process(target&#x3D;self.control_get)        get.start()        test &#x3D; multiprocessing.Process(target&#x3D;self.control_test)        test.start()if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    control &#x3D; Controller()    control.run()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="WebAPI-to-get-proxy-py-通过flask向外提供获取代理IP的接口"><a href="#WebAPI-to-get-proxy-py-通过flask向外提供获取代理IP的接口" class="headerlink" title="WebAPI_to_get_proxy.py 通过flask向外提供获取代理IP的接口"></a>WebAPI_to_get_proxy.py 通过flask向外提供获取代理IP的接口</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">from flask import Flask, gimport RedisClient&quot;&quot;&quot;    对外提供web接口，通过提供的web接口，来获取redis中的代理    g是上下文对象，处理请求时，用于临时存储的对象，每次请求都会重设这个变量。比如：我们可以获取一些临时请求的用户信息。&quot;&quot;&quot;app &#x3D; Flask(__name__)@app.route(&#39;&#x2F;&#39;)def index():    return &#39;&lt;h2&gt;欢迎来到daacheng代理池系统&lt;&#x2F;h2&gt;&#39;def get():    if not hasattr(g, &#39;redis&#39;):        g.redis &#x3D; RedisClient.RedisClient()    return g.redis@app.route(&#39;&#x2F;random&#39;)def get_random_proxy():    # 从代理池中返回一个代理    redisdb &#x3D; get()    return redisdb.get_proxy()@app.route(&#39;&#x2F;count&#39;)def count():    # 查询代理池中代理的个数    redisdb &#x3D; get()    return str(redisdb.get_proxy_count())@app.route(&#39;&#x2F;all&#39;)def get_all():    # 查询代理池中代理的个数    redisdb &#x3D; get()    return str(redisdb.get_all_proxy())if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    app.run(host&#x3D;&#39;0.0.0.0&#39;, port&#x3D;5000)    app.debug &#x3D; True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">爬虫概念，requests库,BeautifulSoup库，selenium自动化，xpath解析，代理池维护</summary>
    
    
    
    <category term="爬虫" scheme="https://changqingaas.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
  </entry>
  
</feed>
